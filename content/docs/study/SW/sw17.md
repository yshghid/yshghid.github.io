---
date : 2025-08-04
tags: ['2025-08']
categories: ['SW']
bookHidden: true
title: "Docker #4 3ì¼ì°¨ ì‹¤ìŠµ: ìì‹ ì˜ Frontend (HTML, JS, CSS) ê°œë°œ ì½”ë“œë¥¼ ì»¨í…Œì´ë„ˆë¡œ ë§Œë“¤ê³  ì´ê²ƒì„ ì‹¤í–‰ì‹œì¼œ ë³´ì"
---

# Docker #4 3ì¼ì°¨ ì‹¤ìŠµ: ìì‹ ì˜ Frontend (HTML, JS, CSS) ê°œë°œ ì½”ë“œë¥¼ ì»¨í…Œì´ë„ˆë¡œ ë§Œë“¤ê³  ì´ê²ƒì„ ì‹¤í–‰ì‹œì¼œ ë³´ì

#2025-08-04

---

> ì¡°ê±´
> 
> 1. nginx:alpine ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©
> 2. ë…¸ì¶œ PortëŠ”80
> 3. nginxë¥¼ì‹¤í–‰í•˜ëŠ”ë°©ì‹ì€ -nginx -g daemon off;
> 4. nginxì˜ routing ì„¤ì •ì€ default.confì—ì„¤ì •í•œë‹¤.

### 0. ì‘ì—… ìœ„ì¹˜

```shell
$ pwd
/Users/yshmbid/rde/config/workspace/exec-template

$ ls
Dockerfile      default.conf    deploy          deploy.yaml     docker-build.sh docker-push.sh  service.yaml    src
```

### 1. docker-build.shì™€ docker-push.sh ë³µì‚¬

```shell
$ pwd
/Users/yshmbid/rde/config/workspace/container/05.webserver
$ ls
Dockerfile      default.conf    deploy          docker-build.sh docker-push.sh  src
```

05.webserverì˜ docker-build.shì™€ docker-push.shë¥¼ ì‘ì—… ë””ë ‰í† ë¦¬ì¸ exec-templateë¡œ ë³µì‚¬í•´ì¤€ë‹¤.

```shell
# docker-build.sh

#!/bin/bash
NAME=sk019
IMAGE_NAME="healthcheck-server" #IMAGE_NAME="webserver"

VERSION="1.0.0"
CPU_PLATFORM=arm64 #amd64

# Docker ì´ë¯¸ì§€ ë¹Œë“œ
docker build \
  --tag ${NAME}-${IMAGE_NAME}:${VERSION} \
  --file Dockerfile \
  --platform linux/${CPU_PLATFORM} \
  ${IS_CACHE} .
```
```shell
# docker-push.sh

#!/bin/bash
NAME=sk019
IMAGE_NAME="healthcheck-server" #IMAGE_NAME="webserver"

VERSION="1.0.0"

DOCKER_REGISTRY="amdp-registry.skala-ai.com/skala25a"
DOCKER_REGISTRY_USER="robot\$skala25a"
DOCKER_REGISTRY_PASSWORD="1qB9cyusbNComZPHAdjNIFWinf52xaBJ"
DOCKER_CACHE="--no-cache"

# 1. Docker ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ë¡œê·¸ì¸ (ì˜µì…˜: ì´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ê¸° ì „ì— ë¯¸ë¦¬ ë¡œê·¸ì¸í•´ë‘ì–´ë„ ë©ë‹ˆë‹¤)
echo ${DOCKER_REGISTRY_PASSWORD} | docker login ${DOCKER_REGISTRY} \
	-u ${DOCKER_REGISTRY_USER}  --password-stdin \
   	|| { echo "Docker ë¡œê·¸ì¸ ì‹¤íŒ¨"; exit 1; }

# 2. harbor ë¡œ push í•˜ê¸° ìœ„í•´ tag ì¶”ê°€
docker tag  ${NAME}-${IMAGE_NAME}:${VERSION} ${DOCKER_REGISTRY}/${NAME}-${IMAGE_NAME}:${VERSION}

# Docker ì´ë¯¸ì§€ í‘¸ì‹œ
docker push ${DOCKER_REGISTRY}/${NAME}-${IMAGE_NAME}:${VERSION}
```

### 2. Dockerfileê³¼ default.conf ì‘ì„±

```shell
# Dockerfile

# nginx ê¸°ë°˜ ì´ë¯¸ì§€ ì‚¬ìš©
FROM nginx:alpine

# ì»¤ìŠ¤í…€ nginx ì„¤ì • íŒŒì¼ ë³µì‚¬
COPY default.conf /etc/nginx/conf.d/

# nginx í¬íŠ¸ ë…¸ì¶œ
EXPOSE 80

# nginx ì‹¤í–‰ (ê¸°ë³¸ CMDê°€ ì´ë¯¸ ì„¤ì •ë˜ì–´ ìˆìŒ)
CMD ["nginx", "-g", "daemon off;"]
```
```shell
# default.conf 

server {
    listen 80;
    
    # ì •ì  íŒŒì¼ ì„œë¹™
    location /sk019 {
        alias /usr/share/nginx/html/;
        try_files $uri $uri/ /index.html;
        
    }
}
```

### 3. íŒŒì¼ êµ¬ì¡°

```plain text
/workspace
â””â”€â”€ exec-template
     â”œâ”€â”€ Dockerfile
     â”œâ”€â”€ default.conf
     â”œâ”€â”€ docker-build.sh
     â”œâ”€â”€ docker-push.sh
     â”œâ”€â”€ cicd.sh
     â”œâ”€â”€ deploy/
     â”‚   â”œâ”€â”€ deploy.t       
     â”‚   â”œâ”€â”€ service.t
     â”‚   â””â”€â”€ env.properties
     â””â”€â”€ src/
         â”œâ”€â”€ index.html      
         â””â”€â”€ media/ 
```

src ë””ë ‰í† ë¦¬ì— index.htmlì„ ë„£ì–´ì¤¬ë‹¤.

#5 ì´ë¯¸ì§€ push build + docker run

```shell
$ sudo ./docker-push.sh
$ sudo ./docker-build.sh
$ sudo docker run -d --name posts-get --network bridge -p 8888:80 sk019-posts-get.arm64:1.0
```




#



#2 cicd.sh ì‘ì„±

```shell
#!/bin/bash

# ê¸°ë³¸ê°’ ì„¤ì •
ENV_FILE="env.properties"

# usage ì¶œë ¥ í•¨ìˆ˜
usage() {
  echo "Usage: $0 [-b|--build] [-p|--push] [-y|--yaml] [-d|--deploy] [-r|--remove] [-a|--all] [-f|--file <env file>]"
  exit 1
}

# env.properties ë¡œë“œ í•¨ìˆ˜
load_env() {
  if [ -f "$ENV_FILE" ]; then
    source "$ENV_FILE"
  else
    echo "í™˜ê²½ íŒŒì¼ '$ENV_FILE'ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
    exit 1
  fi
}

# Maven Build
build() {
  echo "ğŸ”¨ Maven ë¹Œë“œ ì‹œì‘..."
  mvn clean package
}

# Docker ì´ë¯¸ì§€ build & push
push_image() {
  echo "ğŸ³ Docker ì´ë¯¸ì§€ ìƒì„± ë° push ì‹œì‘..."
  docker build -t $DOCKER_IMAGE_NAME .
  docker push $DOCKER_IMAGE_NAME
}

# YAML ìƒì„±
generate_yaml() {
  echo "ğŸ“„ YAML íŒŒì¼ ìƒì„± ì¤‘..."
  for file in *.t; do
    [ -e "$file" ] || continue
    cp "$file" "${file%.t}.yaml"
  done
}

# K8sì— ë°°í¬
deploy_k8s() {
  echo "ğŸš€ Kubernetesì— ë°°í¬ ì‹œì‘..."
  kubectl apply -f ./*.yaml
}

# K8s ë¦¬ì†ŒìŠ¤ ì‚­ì œ
remove_k8s() {
  echo "ğŸ—‘ï¸ Kubernetes ë¦¬ì†ŒìŠ¤ ì œê±°..."
  kubectl delete -f ./*.yaml
}

# ì „ì²´ ì‹¤í–‰
run_all() {
  load_env
  build
  push_image
  generate_yaml
  deploy_k8s
}

# ì¸ì íŒŒì‹±
while [[ "$#" -gt 0 ]]; do
  case "$1" in
    -b|--build) ACTION_BUILD=1 ;;
    -p|--push) ACTION_PUSH=1 ;;
    -y|--yaml) ACTION_YAML=1 ;;
    -d|--deploy) ACTION_DEPLOY=1 ;;
    -r|--remove) ACTION_REMOVE=1 ;;
    -a|--all) ACTION_ALL=1 ;;
    -f|--file)
      shift
      ENV_FILE="$1"
      ;;
    -h|--help)
      usage
      ;;
    *)
      echo "âŒ ì•Œ ìˆ˜ ì—†ëŠ” ì˜µì…˜: $1"
      usage
      ;;
  esac
  shift
done

# ì‹¤í–‰ ì¡°ê±´
if [[ $ACTION_ALL ]]; then
  run_all
else
  load_env
  [[ $ACTION_BUILD ]] && build
  [[ $ACTION_PUSH ]] && push_image
  [[ $ACTION_YAML ]] && generate_yaml
  [[ $ACTION_DEPLOY ]] && deploy_k8s
  [[ $ACTION_REMOVE ]] && remove_k8s
fi
```

cicd.sh ì‚¬ìš©í•˜ëŠ” ë¶€ë¶„ì´ ë‚˜ì˜¤ëŠ”ë° pptë‘ workspace ë””ë ‰í† ë¦¬ ì•ˆì— ì•„ë¬´ë¦¬ì°¾ì•„ë´ë„ ì—†ì–´ì„œ... ê·¸ëƒ¥ ì±—ì§€í”¼í‹°ì—ë„£ê³  ë§Œë“¤ì—ˆë‹¤.

ì°¸ê³ ë¡œ deploy.tì™€ service.tëŠ”?

```shell
# deploy.t

apiVersion: apps/v1
kind: Deployment
metadata:
  name: sk019-posts-get
  namespace: skala-practice
spec:
  replicas: 1
  selector:
    matchLabels:
      app: sk019-posts-get
  template:
    metadata:
      labels:
        app: sk019-posts-get
    spec:
      containers:
        #- name: posts-get amdp-registry.skala-ai.com/skala25a/sk019-posts-get.amd64:1.0
        - name: posts-get amdp-registry.skala-ai.com/skala25a/sk019-posts-get.arm64:1.0
          ports:
            - containerPort: 80
```
```shell
# service.t

apiVersion: v1
kind: Service
metadata:
  name: ${USER_NAME}-${SERVICE_NAME}
  namespace: ${NAMESPACE}
spec:
  selector:
    app: ${USER_NAME}-${SERVICE_NAME}
  ports:
    - name: http
      protocol: TCP
      port: 8888 #8080
      targetPort: 80
  type: ClusterIP
```

- service.tëŠ” ì›ë˜ 8080 ë¼ìˆì—ˆëŠ”ë° 8888 ê°™ì•„ì„œ ë°”ê¿”ì¤Œ.
- ë§¥ì´ë¼ì„œ armìœ¼ë¡œ ë°”ê¿”ì¤Œ. 