---
date : 2025-09-09
tags: ['2025-09']
categories: ['SW']
bookHidden: true
title: "Container 기반 Kubernetes #2"
---

# Container 기반 Kubernetes #2

#2025-09-09

---

### 1. kubectl 명령어 실습

#1 kubectl 명령어 써보기

= 배포된 컨테이너를 쿠버네티스에서 확인.

```bash
# 배포 상태 확인
$ kubectl get pod -n skala-practice | grep sk019
sk019-myfirst-api-server-57fddcd6c8-l4jms       1/1     Running             0                108m

# 서비스 확인
$ kubectl get svc -n skala-practice | grep sk019
sk019-myfirst-api-server            ClusterIP      10.100.83.86     <none>                                                                         8080/TCP,8081/TCP   18h
```

###

#2 로컬 <-> Pod 간 파일/디렉토리 복사

```bash
# 수행 위치
$ pwd
/Users/yshmbid/Documents/home/github/Cloud/workspace/kubernetes/02.deploy

# Pod 이름 확인
$ kubectl get pod -n skala-practice | grep sk019
sk019-myfirst-api-server-57fddcd6c8-l4jms       1/1     Running                 0               120m

# 로컬의 data 디렉토리를 Pod 내부 /app/data 로 복사
$ kubectl cp $(pwd)/data skala-practice/sk019-myfirst-api-server-57fddcd6c8-l4jms:/app/data

# Pod /app/data → 로컬 ./download 디렉토리로 복사
# attach-my-pod 내 /shared-data/data 를 local ./data 에 복사
$ kubectl cp skala-practice/sk019-myfirst-api-server-57fddcd6c8-l4jms:/app/data $(pwd)/download
tar: Removing leading '/' from member names

# 복사된 파일 확인
$ ls -al ./download/
total 16
drwxr-xr-x  4 yshmbid  staff   128 Sep  9 11:30 .
drwxr-xr-x  8 yshmbid  staff   256 Sep  9 11:30 ..
drwxr-xr-x  3 yshmbid  staff    96 Sep  9 11:30 data
-rw-r--r--  1 yshmbid  staff  7173 Sep  9 11:30 data.yaml
```

###

#3 digest 개념 & 레지스트리에서 Docker 이미지 내려받기

```bash
# Harbor 레지스트리에서 이미지 Pull
$ sudo docker pull --platform=linux/amd64 amdp-registry.skala-ai.com/skala25a/skala-k8s.base@sha256:24834d6a4a35ed1f26a4abb63398b8f4a1a343ae13685c2567581fb57d4d1dcd
2025/09/09 11:39:19 must use ASL logging (which requires CGO) if running as root
amdp-registry.skala-ai.com/skala25a/skala-k8s.base@sha256:24834d6a4a35ed1f26a4abb63398b8f4a1a343ae13685c2567581fb57d4d1dcd: Pulling from skala25a/skala-k8s.base
...

# 로컬 이미지 목록 확인
$ sudo docker images
REPOSITORY                                                                  TAG                               IMAGE ID       CREATED        SIZE
amdp-registry.skala-ai.com/skala25a/sk019-myfirst-api-server                1.0.0                             aa813ed844f7   2 hours ago    471MB
sk019-myfirst-api-server                                                    1.0.0                             aa813ed844f7   2 hours ago    471MB
...
```

###

#4 ConfigMap

- 실습내용
  - ConfigMap 생성 → 연결 → Pod/Service 확인 → Endpoint 확인

###

- ConfigMap 생성

```bash
# 수행 위치
$ pwd
/Users/yshmbid/Documents/home/github/Cloud/workspace/kubernetes/04.configmap

# application-prod.yaml 파일을 기반으로 ConfigMap 생성
$ kubectl create configmap sk019-myfirst-configmap \
  --from-file=application-prod.yaml \
  --namespace=skala-practice
configmap/sk019-myfirst-configmap created
```

###

- ConfigMap 연결, 배포

```bash
# 배포(deploy)와 서비스(service) 설정 적용
$ kubectl apply -f deploy.yaml
deployment.apps/sk019-myfirst-api-server configured
$ kubectl apply -f service.yaml
service/sk019-myfirst-api-server unchanged

# 배포 상태 확인
$ kubectl get deploy -n skala-practice | grep sk019
sk019-myfirst-api-server       1/1     1            1           20h
```

- 20h -> 이 Deployment가 생성된 지 20시간 됨
- deployment.apps/sk019-myfirst-api-server configured
  - 기존에 동일한 Deployment가 있었고 내용이 갱신되었다. 새로 생성된 게 아니고 업데이트(rolling update)가 일어났음.

###

cf) gen-yaml.sh 써보기

```bash
$ pwd
/Users/yshmbid/Documents/home/github/Cloud/workspace/kubernetes/04.configmap

$ gen-yaml.sh
```
```plain text
=== 템플릿 스크립트 (create 모드, 경로: .) ===
1. . 에서 .t 확장자 파일 검색 중...
발견된 템플릿 파일 개수: 2
  - ./service.t
  - ./deploy.t
1. ./env.properties 파일에서 변수 로드 중...
  - SERVICE_NAME = myfirst-api-server
  - IMAGE_NAME = myfirst-api-server
  - VERSION = 1.0.0
  - DOCKER_REGISTRY = amdp-registry.skala-ai.com/skala25a
  - CPU_PLATFORM = amd64
  - USER_NAME = sk019
  - REPLICAS = 1
  - NAMESPACE = skala-practice
  - CONTAINER_PORT = 8080
  - LOGGING_LEVEL = DEBUG
  - HASHCODE = 5b564354 (자동 생성)
변수 로드 완료
1. 템플릿 파일 처리 중...
변수 검증 중...
  검증 중: service.t
  검증 중: deploy.t
변수 치환 수행 중...
   service.t -> service.yaml
   deploy.t -> deploy.yaml
=== 템플릿 YAML 파일 생성 완료 ===
2개의 .t 파일이 성공적으로 .yaml 파일로 변환되었습니다.
```

###

- 서비스 확인 & Port-forward

```bash
# 서비스 목록 확인
$ kubectl get svc -n skala-practice | grep sk019
sk019-myfirst-api-server            ClusterIP      10.100.83.86     <none>                                                                         8080/TCP,8081/TCP   20h

# 로컬 <-> Pod 포트포워딩
$ kubectl port-forward svc/sk019-myfirst-api-server -n skala-practice 8080:8080
Forwarding from 127.0.0.1:8080 -> 8080
Forwarding from [::1]:8080 -> 8080
```

http://localhost:8080/api/developer-info에서 확인하면?

제대로 나온다.

###

- Pod 내부 확인

```bash
# Pod 목록 확인
$ kubectl get pod -n skala-practice | grep sk019

sk019-myfirst-api-server-77f8d4955c-grxlk       1/1     Running             0                6m33s

# 특정 Pod의 상세 yaml 확인
kubectl get pod sk019-myfirst-api-server-77f8d4955c-grxlk -n skala-practice -o yaml

# Endpoint 확인
$ kubectl get service -n skala-practice -o wide
$ kubectl get endpoints -n skala-practice -o yaml
```


###

#5 PVC로 로컬 yaml 파일을 Pod에 연결



#
