---
date : 2025-09-25
tags: ['2025-09']
categories: ['BE']
bookHidden: true
title: "DevOps #1 Kaniko POD 실행"
---

# DevOps #1 Kaniko POD 실행

#2025-09-25

---

### 1

#1 작업 세팅

```bash
# 작업 위치 설정
$ pwd
/Users/yshmbid/Documents/home/github/MLops/practice

$ mkdir workspace
$ cd workspace
$ mkdir myfirst-api-server
$ cd myfirst-api-server
$ pwd
/Users/yshmbid/Documents/home/github/MLops/practice/workspace/myfirst-api-server

# 저장소 만들기
$ git init
Initialized empty Git repository in /Users/yshmbid/Documents/home/github/MLops/practice/workspace/myfirst-api-server/.git/
$ echo "myfirst-api-server" > README.md
$ git add .
$ git commit -m "myfirst-api server"
[main (root-commit) 1437340] myfirst-api server
 1 file changed, 1 insertion(+)
 create mode 100644 README.md
$ git branch -M main
$ git remote add origin https://github.com/yshghid/myfirst-api-server.git
$ git push -u origin main
```

```bash
# devops 실습코드 다운로드
$ pwd
/Users/yshmbid/Documents/home/github/MLops/practice/workspace
$ curl -f -O https://storage.skala-ai.com/storage/edu/code/ywyi/250721/devops.tar
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 62.6M  100 62.6M    0     0  38.9M      0  0:00:01  0:00:01 --:--:-- 39.1M
$ tar xvf devops.tar
```

```bash
# git push 시 계속 로그인되는 경우
# 원격 저장소 URL을 토큰 인증 방식(PAT, Personal Access Token)으로 교체
$ pwd
/Users/yshmbid/Documents/home/github/MLops/practice/workspace/myfirst-api-server
$ git remote -v
origin  https://github.com/yshghid/myfirst-api-server.git (fetch)
origin  https://github.com/yshghid/myfirst-api-server.git (push)
$ git remote set-url origin https://yshghid:github_pat_{key}@github.com/yshghid/myfirst-api-server.git
$ git remote -v
origin  https://yshghid:{PAT}@github.com/yshghid/myfirst-api-server.git (fetch)
origin  https://yshghid:{PAT}@github.com/yshghid/myfirst-api-server.git (push)
```

###

#2 실습 데이터 가져오기

```bash
# 작업 위치 설정
$ pwd
/Users/yshmbid/Documents/home/github/MLops/practice/workspace/myfirst-api-server
$ cp -rf /Users/yshmbid/Documents/home/github/MLops/practice/workspace/devops/00.container/01.springboot-v1.0/* .
$ ./gen-yaml.sh

# gen-yaml.sh 계속쓸거니까 쓸수있게하기
$ sudo cp gen-yaml.sh /usr/local/bin
Password:
```

###

#3

```bash
$ pwd
/Users/yshmbid/Documents/home/github/MLops/practice/workspace/devops/01.kaniko

# 만들어진 결과물 이미지가 arm64인지 amd64인지.
$ ./build.sh arm64

$ docker run --rm -it -p 38080:8080 amdp-registry.skala-ai.com/skala25a/sk019-myfirst-api-server:1.0.0.python-kaniko-docker
Unable to find image 'amdp-registry.skala-ai.com/skala25a/sk019-myfirst-api-server:1.0.0.python-kaniko-docker' locally
1.0.0.python-kaniko-docker: Pulling from skala25a/sk019-myfirst-api-server
6e174226ea69: Already exists 
b53054c118c5: Pull complete 
3ff22d10768a: Pull complete 
303af8c73d94: Pull complete 
703c92d5abed: Pull complete 
8e88ec430d0c: Pull complete 
1970fa2cc49d: Pull complete 
Digest: sha256:bac91c512921688dc6986628bfb4fd3bb98f4cf36e8680980d2385d4656271e5
Status: Downloaded newer image for amdp-registry.skala-ai.com/skala25a/sk019-myfirst-api-server:1.0.0.python-kaniko-docker
INFO:     Started server process [1]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
```

<img width="1920" height="1080" alt="image" src="https://github.com/user-attachments/assets/bca4b708-76ef-491d-a17f-af38a44c1fbc" />
<img width="1920" height="1080" alt="image" src="https://github.com/user-attachments/assets/7241c288-25d1-4812-a367-86ef6390e01d" />

###

http://localhost:38080에서 확인해보면?

<img width="1920" height="1080" alt="image" src="https://github.com/user-attachments/assets/3cf351c3-831a-40de-8bba-20fb911fe42c" />
<img width="1920" height="1080" alt="image" src="https://github.com/user-attachments/assets/c7be6f34-4f79-450d-805c-a789a32634b2" />

잘 나온다!!

###

```bash
# Kaniko POD 실행전 사전 환경 구성
$ kubectl get secret harbor-registry-secret -o json
$ kubectl get secret harbor-registry-secret \
-o jsonpath='{.data.\.dockerconfigjson}' \
| base64 -d | jq .

$ kubectl apply -f pod/kaniko-pod.yaml
pod/sk019-kaniko-pod created

$ kubectl logs -f sk019-kaniko-pod --since=1s

$ kubectl config get-contexts
CURRENT   NAME                CLUSTER                                                      AUTHINFO         NAMESPACE
*         skala-edu-cluster   arn:aws:eks:ap-northeast-2:881490135253:cluster/skala-2025   skala-admin-sa   skala-practice
```

###

```bash
$ pwd
/Users/yshmbid/Documents/home/github/MLops/practice/workspace/myfirst-api-server

$ cp -rf /Users/yshmbid/Documents/home/github/MLops/practice/workspace/devops/02.kustomize .
$ mv 02.kustomize kustomize

# kustomize를 이용해서 최종 머징된 결과를 확인
$ kubectl kustomize ./kustomize/overlays/dev > result.yaml

# kustomize를 통해 직접 배포하기
$ kubectl apply -k ./kustomize/overlays/dev
configmap/sk019-app-config-dkmm5c696t created
service/sk019-myfirst-api-server created
deployment.apps/sk019-myfirst-api-server created

$ kubectl get pod | grep sk019
sk019-myfirst-api-server-7c94866-pp4c4      0/1     ImagePullBackOff   0          25s

# 배포된 자원 삭제
$ kubectl delete -k ./kustomize/overlya/dev
```

#


