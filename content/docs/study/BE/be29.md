---
date : 2025-09-23
tags: ['2025-09']
categories: ['BE']
bookHidden: true
title: "Langchain #2 RAG ê¸°ë°˜ LLM API ì„œë²„ êµ¬ì¶•"
---

# Langchain #2 RAG ê¸°ë°˜ LLM API ì„œë²„ êµ¬ì¶•

#2025-09-23

---

### 1. ì‹¤ìŠµ1 - LLM ì§ˆë¬¸-ì‘ë‹µ Agent êµ¬í˜„

#1 ì‘ì—… ìœ„ì¹˜ ì„¤ì •

```bash
# 1. ì‘ì—… ìœ„ì¹˜
$ pwd
/Users/yshmbid/Documents/home/github/MLops/template/#10.code

# 2. íŒŒì¼ í™•ì¸
$ ls
__pycache__                     practice_LLM_App_main.py
practice_LLM_App_front.vue
```

###

#2 ë°±ì—”ë“œ ë„ìš°ê¸°

```bash
# 3. ë°±ì—”ë“œ ë„ìš°ê¸°
$ uvicorn practice_LLM_App_main:app --port 8005 --reload
INFO:     Will watch for changes in these directories: ['/Users/yshmbid/Documents/home/github/MLops/template/#10.code']
INFO:     Uvicorn running on http://127.0.0.1:8005 (Press CTRL+C to quit)
INFO:     Started reloader process [7018] using StatReload

ğŸ–¥ CPU í™˜ê²½ì—ì„œ ë¡œë“œí•©ë‹ˆë‹¤.
`torch_dtype` is deprecated! Use `dtype` instead!
Device set to use mps:0
INFO:     Started server process [7020]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
```

<img width="1920" height="1080" alt="image" src="https://github.com/user-attachments/assets/903c887c-07ca-4757-b505-420549425c24" />


###

#3 í”„ë¡ íŠ¸ ë„ìš°ê¸°

```bash
# 4. í”„ë¡ íŠ¸ ìˆ˜í–‰
# ìƒˆ í„°ë¯¸ë„ì—ì„œ
$ pwd
/Users/yshmbid/Documents/home/github/MLops/template/#10.code

$ ls
__pycache__                     practice_LLM_App_main.py
practice_LLM_App_front.vue

# 5. ì„¤ì¹˜
$ npm install -g @vue/cli
$ vue create llm-chat-vue
$ ls
__pycache__                     llm-chat-vue                    practice_LLM_App_front.vue      practice_LLM_App_main.py
$ cd llm-chat-vue
$ ls
README.md               jsconfig.json           package-lock.json       public                  vue.config.js
babel.config.js         node_modules            package.json            src
$ cd src
$ ls
App.vue         assets          components      main.js
```

ì—¬ê¸°ì„œ App.vueë¥¼ practice_LLM_App_front.vueì˜ ë‚´ìš©ìœ¼ë¡œ ìˆ˜ì •í•˜ê¸°.

```bash
# 6. í”„ë¡ íŠ¸ì•¤ë“œ ì‹¤í–‰
$ npm install axios
```

<img width="1920" height="1080" alt="image" src="https://github.com/user-attachments/assets/08cb38bf-5442-41d2-b9b9-d89eae48c75a" />

###

### 2. ì‹¤ìŠµ2 - RAG ê¸°ë°˜ LLM API ì„œë²„ êµ¬ì¶•

<mark>#1 ìœ„ì¹˜ ì„¤ì •, swagger ui ë„ìš°ê¸°</mark>

```bash
# 1. ìœ„ì¹˜ ì„¤ì •
$ pwd
/Users/yshmbid/Documents/home/github/MLops/template

# 2. ì‹¤í–‰
$ uvicorn practice_RAG_App_main_fixed:app --port 8003 --reload

## ì‚¬ìš© ë°©ë²• ìš”ì•½
# 1. ì„œë²„ ì‹¤í–‰ í›„, ìë™ìœ¼ë¡œ SQLite ì¸-ë©”ëª¨ë¦¬ DBê°€ ì´ˆê¸°í™”
# 2. GET /db-tablesë¡œ ìƒ˜í”Œ í…Œì´ë¸”(customers, products) í™•ì¸
# 3. POST /upload-dbtable?table=customers â†’ ë‚´ë¶€ ë²¡í„° ì¸ë±ìŠ¤ ìƒì„±
# 4. POST /rag-query
#    {"prompt":"Acorn Ltdì˜ ì„¸ê·¸ë¨¼íŠ¸ëŠ”?","source":"internal"}
#    ë°ì´í„°ì— ì—†ëŠ” ì§ˆë¬¸ì€ ì •í™•íˆ ì°¨ë‹¨ë˜ì–´ "ì§€ì‹ë² ì´ìŠ¤ì—ì„œ ë‹µì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤." ë°˜í™˜
#5. ë¹ ë¥´ê²Œ ì ê²€í•˜ë ¤ë©´ GET /selftest-internal í˜¸ì¶œ'''
```
<img width="1920" height="1080" alt="image" src="https://github.com/user-attachments/assets/38689786-2cf7-4830-8783-6584c923cf5f" />

cf) íŒ¨í‚¤ì§€ ë²„ì „ í™•ì¸

```bash
$ conda list torch
# packages in environment at /opt/anaconda3/envs/rag3:
# Name                    Version                   Build  Channel
libtorch                  2.7.1           cpu_mkl_hd81324f_102    conda-forge
pytorch                   2.7.1           cpu_mkl_py311_hec6b2c5_102    conda-forge

$ conda list transformers
# packages in environment at /opt/anaconda3/envs/rag3:
# Name                    Version                   Build  Channel
sentence-transformers     5.1.1                    pypi_0    pypi
transformers              4.56.2                   pypi_0    pypi

$ conda list sentence-transformers
# packages in environment at /opt/anaconda3/envs/rag3:
# Name                    Version                   Build  Channel
sentence-transformers     5.1.1                    pypi_0    pypi
```

###


<mark>#2 ì‹¤ìŠµ ìˆ˜í–‰</mark>

1. ì„œë²„ ì‹¤í–‰ ë° ì´ˆê¸°í™”

```bash
$ uvicorn practice_RAG_App_main_fixed:app --port 8003 --reload
```

- í¬íŠ¸ 8003ì—ì„œ FastAPI ì„œë²„ ì‹¤í–‰
- ì‹œì‘ ì‹œì ì— SQLite ì¸ë©”ëª¨ë¦¬ DB(customers, products)ê°€ ìë™ ìƒì„±ë¨ 
- ë²¡í„°ìŠ¤í† ì–´ ìƒíƒœë¥¼ í™•ì¸í•˜ë©´?

```plain text
â„¹ï¸ ë‚´ë¶€ ë²¡í„° ì¸ë±ìŠ¤ê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤. /upload-dbtable ë¡œ ìƒì„±í•˜ì„¸ìš”.
â„¹ï¸ ì™¸ë¶€ ë²¡í„° ì¸ë±ìŠ¤ê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤. /upload-topic ìœ¼ë¡œ ìƒì„±í•˜ì„¸ìš”.
â„¹ï¸ PDF ë²¡í„° ì¸ë±ìŠ¤ê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤. /upload-paper ë¡œ ìƒì„±í•˜ì„¸ìš”.
```
- ì•„ì§ ì–´ë–¤ ë²¡í„°DBë„ ì´ˆê¸°í™”ë˜ì§€ ì•Šì€ ìƒíƒœ.

###

2. PDF ì—…ë¡œë“œ ë° ë²¡í„°í™”

- ì—”ë“œí¬ì¸íŠ¸: POST /upload-paper

- Swagger UI
<img width="835" height="945" alt="image" src="https://github.com/user-attachments/assets/e3bdcaeb-1741-4712-a32b-485cef432c32" />


- ë¡œê·¸
  - PDF(paper-attention.pdf)ë¥¼ ì—…ë¡œë“œí•˜ë©´ RecursiveCharacterTextSplitterë¡œ ìª¼ê°œê³ , OpenAI ì„ë² ë”©ì„ ì ìš©í•˜ì—¬ FAISSì— ì €ì¥í•´ì„œ VECTORSTORE_PDF ì´ˆê¸°í™”.

###

3. ë‚´ë¶€ DB í…Œì´ë¸” í™•ì¸

- ì—”ë“œí¬ì¸íŠ¸: GET /db-tables

- Swagger UI
<img width="830" height="866" alt="image" src="https://github.com/user-attachments/assets/05e0608a-873a-48b4-b9f0-1a523bfb3574" />


- ë¡œê·¸
  - { "tables": ["customers", "products"] }
  - ì¸ë©”ëª¨ë¦¬ SQLiteì— ë‘ ê°œì˜ ìƒ˜í”Œ í…Œì´ë¸”(customers, products)ì´ ì¤€ë¹„ë˜ì–´ ìˆìŒì„ í™•ì¸

###

4. ë‚´ë¶€ í…Œì´ë¸” ë²¡í„°í™”

- ì—”ë“œí¬ì¸íŠ¸: POST /upload-dbtable?table=customers

- Swagger UI
<img width="848" height="925" alt="image" src="https://github.com/user-attachments/assets/acdf007b-49a5-4ee9-ae60-97cd2e9c94ca" />

- ë¡œê·¸
  - customers í…Œì´ë¸” ë°ì´í„°ê°€ ë²¡í„°í™”ë˜ì–´ VECTORSTORE_INTERNAL ìƒì„±

###

5. ì™¸ë¶€ ì›¹ ê²€ìƒ‰ ë°ì´í„° ë²¡í„°í™”

- ì—”ë“œí¬ì¸íŠ¸: POST /upload-topic?topic=ìƒì„±í˜• AI

- Swagger UI
<img width="848" height="907" alt="image" src="https://github.com/user-attachments/assets/78f08299-a145-47bf-97a7-b0c89b3a2de4" />

- ë¡œê·¸
  - Naver ë‰´ìŠ¤ APIë¥¼ í†µí•´ ìƒì„±í˜• AI ê´€ë ¨ ê¸°ì‚¬ 20ê°œë¥¼ í¬ë¡¤ë§ -> OpenAI ì„ë² ë”© ì ìš© -> VECTORSTORE_EXTERNAL ìƒì„± ì™„ë£Œ.

###

6. RAG ì§ˆì˜

- ì—”ë“œí¬ì¸íŠ¸: POST /rag-query

- Swagger UI

- ë¡œê·¸
  - ì„¤ëª…: ì™¸ë¶€ ë²¡í„°ìŠ¤í† ì–´ì—ì„œ ë¬¸ë§¥ì„ ê²€ìƒ‰ -> LLM(ChatGPT API, gpt-4o)ì„ í†µí•´ ìš”ì•½ ë‹µë³€ì„ ìƒì„±.
  - ì¶œì²˜ í‘œê¸°ë„ ê´„í˜¸ í˜•íƒœë¡œ í¬í•¨ì‹œì¼œ â€œí™˜ê° ìµœì†Œí™” + ê·¼ê±° ì œì‹œâ€ ë°©ì‹ìœ¼ë¡œ ë™ì‘.

###

7. ë‚´ë¶€ íŒŒì´í”„ë¼ì¸ ì…€í”„ í…ŒìŠ¤íŠ¸

- ì—”ë“œí¬ì¸íŠ¸: GET /selftest-internal

- Swagger UI
<img width="835" height="977" alt="image" src="https://github.com/user-attachments/assets/3fcd23d1-4f39-4918-8a8c-d9735dada866" />
<img width="833" height="687" alt="image" src="https://github.com/user-attachments/assets/aeb5ed03-d673-4ecb-9dfd-cc61d704434b" />

- ì„¤ëª…
  - ì‹¤ì œ ë°ì´í„° ì¡´ì¬: "Enterprise" ë°˜í™˜ 
  - ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì†ì„±: "ì§€ì‹ë² ì´ìŠ¤ì—ì„œ ë‹µì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤." 
  - ìŠ¤í‚¤ë§ˆ ë¬´ê´€ ì§ˆë¬¸(Attention?): "ì§€ì‹ë² ì´ìŠ¤ì—ì„œ ë‹µì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤." 
    - í™˜ê° ì–µì œ ê·œì¹™ì´ ì˜ ì‘ë™í•¨ì„ ë³´ì—¬ì¤Œ.

###

- internalë¡œ í•´ë³´ê¸°

<img width="1302" height="1670" alt="image" src="https://github.com/user-attachments/assets/269cd43c-eea6-497c-8bd2-2c851f328a8e" />
<img width="1302" height="1398" alt="image" src="https://github.com/user-attachments/assets/f7f878f0-b10a-4a84-98f9-dbacc80ce525" />

- pdfë¡œ í•´ë³´ê¸°
<img width="845" height="970" alt="image" src="https://github.com/user-attachments/assets/078b89aa-79e2-40b3-ae81-34a40caa3e79" />
<img width="841" height="613" alt="image" src="https://github.com/user-attachments/assets/0e2d6ccc-31f7-4802-9370-b60e341dc24c" />


#

