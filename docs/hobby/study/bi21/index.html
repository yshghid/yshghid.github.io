<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Mutclust 코드 정리 # 2024-12-31 # get_eps_region # def get_eps_region(mutclust_input_df, cur_index, info): dist_l = dist_r = 0	# left and right distance from i cur_l_index = cur_index - 1 cur_r_index = cur_index &#43; 1 cur_hscore = mutclust_input_df.loc[cur_index, HSCORE] eps_scaler = ceil(EPSILON_SCALING_FACTOR * cur_hscore) ldeps = rdeps = eps_scaler*EPSILON if cur_l_index &lt; 0: cur_l_index = cur_index if cur_r_index &gt;= mutclust_input_df.shape[0]-1: cur_r_index = cur_index # search left boundary if ldeps &gt; info.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/docs/hobby/study/bi21/">
  <meta property="og:site_name" content="Lifelog 2025">
  <meta property="og:title" content="공부">
  <meta property="og:description" content="Mutclust 코드 정리 # 2024-12-31 # get_eps_region # def get_eps_region(mutclust_input_df, cur_index, info): dist_l = dist_r = 0	# left and right distance from i cur_l_index = cur_index - 1 cur_r_index = cur_index &#43; 1 cur_hscore = mutclust_input_df.loc[cur_index, HSCORE] eps_scaler = ceil(EPSILON_SCALING_FACTOR * cur_hscore) ldeps = rdeps = eps_scaler*EPSILON if cur_l_index &lt; 0: cur_l_index = cur_index if cur_r_index &gt;= mutclust_input_df.shape[0]-1: cur_r_index = cur_index # search left boundary if ldeps &gt; info.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">
    <meta property="article:published_time" content="2024-12-31T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-12-31T00:00:00+00:00">
    <meta property="article:tag" content="2024-12">
<title>공부 | Lifelog 2025</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="http://localhost:1313/docs/hobby/study/bi21/">
<link rel="stylesheet" href="/book.min.b79d7c33395061c8f79ecaf2ed506fabfbb4f7a048c6bf40218447335d11296c.css" integrity="sha256-t518MzlQYcj3nsry7VBvq/u096BIxr9AIYRHM10RKWw=" crossorigin="anonymous">
  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.737ce4ab62d46699fd5fc922be69a166b7de0f5077ddfc28f92659bd6f1b3af8.js" integrity="sha256-c3zkq2LUZpn9X8kivmmhZrfeD1B33fwo&#43;SZZvW8bOvg=" crossorigin="anonymous"></script>

  

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/logo.png" alt="Logo" class="book-icon" /><span>Lifelog 2025</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>















  
  <ul>
    
      
        <li class="book-section-flat" >
          
  
  

  
    <span>기록</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/hobby/book/" class="">책</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/hobby/movie/" class="">영화</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/hobby/study/" class="">공부</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/hobby/daily/" class="">일상</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/about/" class=""> </a>
  

        </li>
      
    
  </ul>










  
<ul>
  
  <li>
    <a href="/posts/"  >
        아카이브
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>공부</h3>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
        <li><a href="#get_eps_region">get_eps_region</a></li>
        <li><a href="#get_candidate_core_mutations">get_candidate_core_mutations</a></li>
        <li><a href="#expand_cluster">expand_cluster</a></li>
        <li><a href="#dynaclust">dynaclust</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="mutclust-코드-정리">
  Mutclust 코드 정리
  <a class="anchor" href="#mutclust-%ec%bd%94%eb%93%9c-%ec%a0%95%eb%a6%ac">#</a>
</h1>
<h5 id="2024-12-31">
  2024-12-31
  <a class="anchor" href="#2024-12-31">#</a>
</h5>
<hr>
<h3 id="get_eps_region">
  get_eps_region
  <a class="anchor" href="#get_eps_region">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_eps_region</span>(mutclust_input_df, cur_index, info):
</span></span><span style="display:flex;"><span>	dist_l <span style="color:#f92672">=</span> dist_r <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>	<span style="color:#75715e"># left and right distance from i</span>
</span></span><span style="display:flex;"><span>	cur_l_index <span style="color:#f92672">=</span>  cur_index <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>	cur_r_index <span style="color:#f92672">=</span> cur_index <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>	cur_hscore <span style="color:#f92672">=</span> mutclust_input_df<span style="color:#f92672">.</span>loc[cur_index, HSCORE]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	eps_scaler <span style="color:#f92672">=</span> ceil(EPSILON_SCALING_FACTOR <span style="color:#f92672">*</span> cur_hscore)
</span></span><span style="display:flex;"><span>	ldeps <span style="color:#f92672">=</span> rdeps <span style="color:#f92672">=</span> eps_scaler<span style="color:#f92672">*</span>EPSILON
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> cur_l_index <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>		cur_l_index <span style="color:#f92672">=</span> cur_index
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> cur_r_index <span style="color:#f92672">&gt;=</span> mutclust_input_df<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>		cur_r_index <span style="color:#f92672">=</span> cur_index
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># search left boundary</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> ldeps <span style="color:#f92672">&gt;</span> info<span style="color:#f92672">.</span>maxeps: 
</span></span><span style="display:flex;"><span>		ldeps <span style="color:#f92672">=</span> info<span style="color:#f92672">.</span>maxeps <span style="color:#75715e"># max at maxeps</span>
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> dist_l <span style="color:#f92672">&lt;</span> ldeps <span style="color:#f92672">and</span> cur_l_index <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>: 
</span></span><span style="display:flex;"><span>		ld <span style="color:#f92672">=</span> mutclust_input_df<span style="color:#f92672">.</span>loc[cur_index, POS] <span style="color:#f92672">-</span> mutclust_input_df<span style="color:#f92672">.</span>loc[cur_l_index, POS]
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> ld <span style="color:#f92672">&gt;</span> ldeps:
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>		cur_l_index <span style="color:#f92672">-=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>		dist_l <span style="color:#f92672">=</span> ld
</span></span><span style="display:flex;"><span>	cur_l_index <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># search right boundary</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> rdeps <span style="color:#f92672">&gt;</span> info<span style="color:#f92672">.</span>maxeps:
</span></span><span style="display:flex;"><span>		rdeps <span style="color:#f92672">=</span> info<span style="color:#f92672">.</span>maxeps	<span style="color:#75715e"># max at maxeps</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> dist_r <span style="color:#f92672">&lt;</span> rdeps <span style="color:#f92672">and</span> cur_r_index <span style="color:#f92672">&lt;</span> mutclust_input_df<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]:
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># print(rdeps)</span>
</span></span><span style="display:flex;"><span>		rd <span style="color:#f92672">=</span> mutclust_input_df<span style="color:#f92672">.</span>loc[cur_r_index, POS] <span style="color:#f92672">-</span> mutclust_input_df<span style="color:#f92672">.</span>loc[cur_index, POS]
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> rd <span style="color:#f92672">&gt;</span> rdeps:
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>		cur_r_index <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>		dist_r <span style="color:#f92672">=</span> rd
</span></span><span style="display:flex;"><span>	cur_r_index <span style="color:#f92672">-=</span> <span style="color:#ae81ff">1</span> 
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> [cur_l_index, cur_r_index], [cur_index<span style="color:#f92672">-</span>cur_l_index, cur_r_index<span style="color:#f92672">-</span>cur_index], eps_scaler
</span></span></code></pre></div><ul>
<li>
<p>입력 파라미터</p>
<ul>
<li>mutclust_input_df (모든 nt)</li>
</ul>
</li>
<li>
<p>주요 변수 및 초기화</p>
<ul>
<li>cur_hscore: 현재 변이의 HSCORE</li>
<li>인덱스가 데이터 범위를 벗어나면 현재 인덱스로 조정: cur_index가 첫 번째나 마지막 변이일 경우에 대한 처리.</li>
</ul>
</li>
<li>
<p>ε (Epsilon) 설정</p>
<ul>
<li>eps_scaler 계산: <code>ceil(EPSILON_SCALING_FACTOR * cur_hscore)</code>으로 계산.</li>
<li>ldeps 계산: 현재 변이의 좌측 경계. <code>eps_scaler * EPSILON</code>으로 계산.</li>
</ul>
</li>
<li>
<p>출력</p>
<ul>
<li>lr_index, lr_distance, eps_scaler</li>
</ul>
</li>
</ul>
<h3 id="get_candidate_core_mutations">
  get_candidate_core_mutations
  <a class="anchor" href="#get_candidate_core_mutations">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_candidate_core_mutations</span>(mutclust_input_df, info, tag, i):
</span></span><span style="display:flex;"><span>	print(<span style="color:#e6db74">&#39;Searching candidate core mutations...&#39;</span>),
</span></span><span style="display:flex;"><span>	total_mutInfo_list<span style="color:#f92672">=</span>[]
</span></span><span style="display:flex;"><span>	ccm_index_list<span style="color:#f92672">=</span>[]
</span></span><span style="display:flex;"><span>	total_index_list<span style="color:#f92672">=</span>[] <span style="color:#75715e">#추가</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#mutation filtering</span>
</span></span><span style="display:flex;"><span>	filtered_mutclust_input_df <span style="color:#f92672">=</span> mutation_filtering(mutclust_input_df)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> index, pos <span style="color:#f92672">in</span> enumerate(filtered_mutclust_input_df[POS]):<span style="color:#75715e">#position</span>
</span></span><span style="display:flex;"><span>		lr_index, lr_distance, eps_scaler <span style="color:#f92672">=</span> get_eps_region(filtered_mutclust_input_df, index, info)
</span></span><span style="display:flex;"><span>		mut_info <span style="color:#f92672">=</span> get_eps_stats(index, pos, filtered_mutclust_input_df, lr_index, lr_distance, eps_scaler)
</span></span><span style="display:flex;"><span>		total_mutInfo_list<span style="color:#f92672">.</span>append(mut_info<span style="color:#f92672">.</span>to_dict())	<span style="color:#75715e"># archive eps stats of all mutations (reference data)</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>		total_index_list<span style="color:#f92672">.</span>append(index) <span style="color:#75715e">#추가</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> mut_info<span style="color:#f92672">.</span>mut_n <span style="color:#f92672">&lt;</span> MIN_MUTATIONS:
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> mut_info<span style="color:#f92672">.</span>hscore_sum<span style="color:#f92672">&lt;</span> CCM_MIN_HSCORE_SUM:
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> mut_info<span style="color:#f92672">.</span>hscore_avr<span style="color:#f92672">&lt;</span> CCM_MIN_HSCORE_AVR:
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> mut_info<span style="color:#f92672">.</span>i_hscore <span style="color:#f92672">&lt;</span> CCM_MIN_HSCORE:
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		ccm_index_list<span style="color:#f92672">.</span>append(index)
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">#print(str(len(ccm_index_list))+ &#39; ccms- pos:&#39; + str(mut_info.i) + &#39; hscore: &#39; + str(mut_info.i_hscore) + &#39; hscore_sum: &#39; + str(mut_info.hscore_sum) + &#39; length:&#39; + str(mut_info.length) + &#39; mut_n: &#39; + str(mut_info.mut_n))</span>
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#print_mutatoin_by_gene(filtered_mutclust_input_df.loc[ccm_index_list], info.mutation_info_outdir)</span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span><span style="color:#75715e"># temp</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">/total_results_</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">.tsv&#39;</span><span style="color:#f92672">%</span>(info<span style="color:#f92672">.</span>outdir, tag), <span style="color:#e6db74">&#39;w&#39;</span>) <span style="color:#66d9ef">as</span> outf:
</span></span><span style="display:flex;"><span>		header<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>join(total_mutInfo_list[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>keys()) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>		outf<span style="color:#f92672">.</span>write(header)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> index <span style="color:#f92672">in</span> total_index_list:
</span></span><span style="display:flex;"><span>			outf<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">%</span>(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>join([str(x) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> total_mutInfo_list[index]<span style="color:#f92672">.</span>values()])))
</span></span><span style="display:flex;"><span>		outf<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span><span style="color:#75715e"># temp end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># write ccm data to file</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">/ccm_results_</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">.tsv&#39;</span><span style="color:#f92672">%</span>(info<span style="color:#f92672">.</span>outdir, tag), <span style="color:#e6db74">&#39;w&#39;</span>) <span style="color:#66d9ef">as</span> outf:
</span></span><span style="display:flex;"><span>		header<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>join(total_mutInfo_list[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>keys()) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>		outf<span style="color:#f92672">.</span>write(header)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> index <span style="color:#f92672">in</span> ccm_index_list:
</span></span><span style="display:flex;"><span>			outf<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">%</span>(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>join([str(x) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> total_mutInfo_list[index]<span style="color:#f92672">.</span>values()])))
</span></span><span style="display:flex;"><span>		outf<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	total_mutInfo_list <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>asarray(total_mutInfo_list)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> total_mutInfo_list, ccm_index_list
</span></span></code></pre></div><ul>
<li>출력
<ul>
<li>ccm_index_list (position 21974면 21708)</li>
</ul>
</li>
</ul>
<h3 id="expand_cluster">
  expand_cluster
  <a class="anchor" href="#expand_cluster">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">expand_cluster</span>(ccm_idx, total_mutation_info_list, info):
</span></span><span style="display:flex;"><span>	left_cur_dist <span style="color:#f92672">=</span> right_cur_dist <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>			<span style="color:#75715e"># left and right distance from pos</span>
</span></span><span style="display:flex;"><span>	left_cur_index <span style="color:#f92672">=</span> ccm_idx <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>				<span style="color:#75715e"># left moving index</span>
</span></span><span style="display:flex;"><span>	right_cur_index <span style="color:#f92672">=</span> ccm_idx <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>				<span style="color:#75715e"># right moving index</span>
</span></span><span style="display:flex;"><span>	mut_n <span style="color:#f92672">=</span> len(total_mutation_info_list) 
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> right_cur_index <span style="color:#f92672">&gt;=</span> mut_n:
</span></span><span style="display:flex;"><span>		right_cur_index <span style="color:#f92672">=</span> ccm_idx
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	es_l <span style="color:#f92672">=</span> es_r <span style="color:#f92672">=</span> total_mutation_info_list[ccm_idx][<span style="color:#e6db74">&#39;eps_scaler&#39;</span>]		<span style="color:#75715e"># ccm&#39;s pre-computed eps scaler (es)(per/1.5)</span>
</span></span><span style="display:flex;"><span>	left_max_dist <span style="color:#f92672">=</span> total_mutation_info_list[ccm_idx][<span style="color:#e6db74">&#39;left_distance&#39;</span>]
</span></span><span style="display:flex;"><span>	right_max_dist <span style="color:#f92672">=</span> total_mutation_info_list[ccm_idx][<span style="color:#e6db74">&#39;right_distance&#39;</span>]		<span style="color:#75715e"># ccm&#39;s pre-computed deps length (dist)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># expand left</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> left_cur_dist<span style="color:#f92672">&lt;</span>left_max_dist <span style="color:#f92672">and</span> left_cur_index<span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>		ld <span style="color:#f92672">=</span> total_mutation_info_list[ccm_idx][POS] <span style="color:#f92672">-</span> total_mutation_info_list[left_cur_index][POS]
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> ld <span style="color:#f92672">&gt;</span> left_max_dist:
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>		left_cur_dist <span style="color:#f92672">=</span> ld
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># decrease deps in respect to es of cur_l</span>
</span></span><span style="display:flex;"><span>		delta_es <span style="color:#f92672">=</span> es_l <span style="color:#f92672">-</span> total_mutation_info_list[left_cur_index][<span style="color:#e6db74">&#39;eps_scaler&#39;</span>]	<span style="color:#75715e"># delta(eps)=es_cur-es_ccm</span>
</span></span><span style="display:flex;"><span>		es_l <span style="color:#f92672">=</span> es_l <span style="color:#f92672">-</span> (delta_es) <span style="color:#f92672">/</span> info<span style="color:#f92672">.</span>es_control_const<span style="color:#75715e"># diminish es by delta(eps)/exp_dim delta/30</span>
</span></span><span style="display:flex;"><span>		mut_deps <span style="color:#f92672">=</span> info<span style="color:#f92672">.</span>eps <span style="color:#f92672">*</span> es_l		
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> mut_deps <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>			left_max_dist <span style="color:#f92672">=</span> mut_deps
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>		left_cur_index <span style="color:#f92672">-=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># expand right</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> right_cur_dist<span style="color:#f92672">&lt;</span>right_max_dist <span style="color:#f92672">and</span> right_cur_index <span style="color:#f92672">&lt;</span> mut_n:
</span></span><span style="display:flex;"><span>		rd <span style="color:#f92672">=</span> total_mutation_info_list[right_cur_index][POS] <span style="color:#f92672">-</span> total_mutation_info_list[ccm_idx][POS]
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> rd<span style="color:#f92672">&gt;</span>right_max_dist:
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>		right_cur_dist<span style="color:#f92672">=</span>rd
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># decrease deps in respect to es of cur_r</span>
</span></span><span style="display:flex;"><span>		delta_es <span style="color:#f92672">=</span> es_r <span style="color:#f92672">-</span> total_mutation_info_list[right_cur_index][<span style="color:#e6db74">&#39;eps_scaler&#39;</span>]	<span style="color:#75715e"># delta(eps)=eps_i-eps_curl</span>
</span></span><span style="display:flex;"><span>		es_r <span style="color:#f92672">=</span> es_r <span style="color:#f92672">-</span> (delta_es)<span style="color:#f92672">/</span>info<span style="color:#f92672">.</span>es_control_const	<span style="color:#75715e"># diminish es by delta(eps)/exp_dim (default: 30)</span>
</span></span><span style="display:flex;"><span>		mut_deps <span style="color:#f92672">=</span> info<span style="color:#f92672">.</span>eps <span style="color:#f92672">*</span> es_r
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> mut_deps <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>			right_max_dist <span style="color:#f92672">=</span> mut_deps
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>		right_cur_index<span style="color:#f92672">+=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> right_cur_index <span style="color:#f92672">==</span> mut_n:
</span></span><span style="display:flex;"><span>		right_cur_index<span style="color:#f92672">-=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> left_cur_index <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>		left_cur_index <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	ret_dict <span style="color:#f92672">=</span> { <span style="color:#e6db74">&#39;length&#39;</span>: total_mutation_info_list[right_cur_index][POS] <span style="color:#f92672">-</span> total_mutation_info_list[left_cur_index][POS] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#39;ccm_position&#39;</span>:ccm_idx,
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#39;mut_positions&#39;</span>: sorted([a[POS] <span style="color:#66d9ef">for</span> a <span style="color:#f92672">in</span> total_mutation_info_list[left_cur_index:right_cur_index<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>] <span style="color:#66d9ef">if</span> a[HSCORE] <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>])}
</span></span><span style="display:flex;"><span>	ret_dict[<span style="color:#e6db74">&#39;left_position&#39;</span>] <span style="color:#f92672">=</span> ret_dict[<span style="color:#e6db74">&#39;mut_positions&#39;</span>][<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>	ret_dict[<span style="color:#e6db74">&#39;right_position&#39;</span>] <span style="color:#f92672">=</span> ret_dict[<span style="color:#e6db74">&#39;mut_positions&#39;</span>][<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> ret_dict
</span></span></code></pre></div><ul>
<li>
<p>입력 파라미터</p>
<ul>
<li>ccm_idx: 현재 ccm 인덱스</li>
<li>total_mutation_info_list: 변이 정보</li>
</ul>
</li>
<li>
<p>주요 변수 초기화</p>
<ul>
<li>left_cur_dist=0</li>
<li>left_cur_index = ccm_idx-1</li>
<li>es_l=15</li>
<li>left_max_dist: 왼쪽 최대 확장 거리, &rsquo;left_distance&rsquo; 컬럼 값.</li>
</ul>
</li>
<li>
<p>left_cur_index 갱신 예시</p>
<ul>
<li>
<p>ccm_idx=21708</p>
</li>
<li>
<p>left_max_dist=75</p>
</li>
<li>
<p>left_cur_dist=0</p>
<ul>
<li>left_cur_dist가 75를 초과하면 확장 중지.</li>
</ul>
</li>
<li>
<p>iter1</p>
<ul>
<li>left_cur_index=21707</li>
<li>ld = 21974-21973 = 1
<ul>
<li>ld &lt;= left_max_dist(75)이므로 확장 유지.</li>
</ul>
</li>
<li>left_cur_dist = ld = 1 (현재까지 이동한 거리 업데이트: 1bp 이동)</li>
<li>delta_es = es_l-es_cur = 15-1 = 14</li>
<li>es_l = es_l - (delta_es)/3 = 15 - (14/3) ≈ 10.33</li>
<li>mut_deps = 5*es_l ≈ 51.67 (left_max_dist가 75에서 51.67로 감소)</li>
<li>left_max_dist = mut_deps = 51.67</li>
<li>left_cur_index-=1 (left_cur_index = 21706)</li>
</ul>
</li>
<li>
<p>iter2</p>
<ul>
<li>left_cur_index=21706</li>
<li>ld = 21974-21972 = 2
<ul>
<li>ld &lt;= left_max_dist(51.67)이므로 확장 유지.</li>
</ul>
</li>
<li>left_cur_dist = ld = 2 (현재까지 이동한 거리 업데이트: 2bp 이동)</li>
<li>delta_es 갱신</li>
<li>es_l 갱신</li>
<li>mut_deps 갱신</li>
<li>left_max_dist 갱신</li>
<li>left_cur_index-=1 (left_cur_index = 21705)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="dynaclust">
  dynaclust
  <a class="anchor" href="#dynaclust">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">dynaclust</span>(total_mutation_info_list, ccm_index_list, info, tag, i):
</span></span><span style="display:flex;"><span>	print(<span style="color:#e6db74">&#39;Perfoming dynamic clustering...&#39;</span>),
</span></span><span style="display:flex;"><span>	cluster_list<span style="color:#f92672">=</span>[]
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> ccm_idx <span style="color:#f92672">in</span> ccm_index_list:
</span></span><span style="display:flex;"><span>		ret_dict <span style="color:#f92672">=</span> expand_cluster( ccm_idx, total_mutation_info_list, info)
</span></span><span style="display:flex;"><span>		cluster_list<span style="color:#f92672">.</span>append(ret_dict)
</span></span><span style="display:flex;"><span>		sys<span style="color:#f92672">.</span>stdout<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\r</span><span style="color:#e6db74">{0}</span><span style="color:#e6db74"> clusters found&#39;</span><span style="color:#f92672">.</span>format(len(cluster_list)))
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">#print(ret_dict)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	print()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#merging clusters</span>
</span></span><span style="display:flex;"><span>	print(<span style="color:#e6db74">&#39;merging clusters...&#39;</span>)
</span></span><span style="display:flex;"><span>	merged_clusters<span style="color:#f92672">=</span>[]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	cluster_list <span style="color:#f92672">=</span> sorted(cluster_list, key<span style="color:#f92672">=</span><span style="color:#66d9ef">lambda</span> x: x[<span style="color:#e6db74">&#39;left_position&#39;</span>])
</span></span><span style="display:flex;"><span>	clst_n <span style="color:#f92672">=</span> len(cluster_list)
</span></span><span style="display:flex;"><span>	i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> i <span style="color:#f92672">&lt;</span> clst_n:
</span></span><span style="display:flex;"><span>		lpos<span style="color:#f92672">=</span>cluster_list[i][<span style="color:#e6db74">&#39;left_position&#39;</span>]
</span></span><span style="display:flex;"><span>		rpos<span style="color:#f92672">=</span>cluster_list[i][<span style="color:#e6db74">&#39;right_position&#39;</span>]
</span></span><span style="display:flex;"><span>		mut_list<span style="color:#f92672">=</span>cluster_list[i][<span style="color:#e6db74">&#39;mut_positions&#39;</span>]
</span></span><span style="display:flex;"><span>		j <span style="color:#f92672">=</span> i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">while</span> j <span style="color:#f92672">&lt;</span> clst_n:
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> rpos <span style="color:#f92672">&lt;</span> cluster_list[j][<span style="color:#e6db74">&#39;left_position&#39;</span>]: <span style="color:#75715e"># cluster not in cluster next </span>
</span></span><span style="display:flex;"><span>				i <span style="color:#f92672">=</span> j
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">else</span>: <span style="color:#75715e"># cluster in cluster </span>
</span></span><span style="display:flex;"><span>				lpos <span style="color:#f92672">=</span> min(lpos, cluster_list[j][<span style="color:#e6db74">&#39;left_position&#39;</span>])
</span></span><span style="display:flex;"><span>				rpos <span style="color:#f92672">=</span> max(rpos, cluster_list[j][<span style="color:#e6db74">&#39;right_position&#39;</span>])
</span></span><span style="display:flex;"><span>				mut_list<span style="color:#f92672">.</span>extend(cluster_list[j][<span style="color:#e6db74">&#39;mut_positions&#39;</span>])
</span></span><span style="display:flex;"><span>				mut_list <span style="color:#f92672">=</span> [a <span style="color:#66d9ef">for</span> a <span style="color:#f92672">in</span> set(mut_list)]
</span></span><span style="display:flex;"><span>				mut_list<span style="color:#f92672">.</span>sort()
</span></span><span style="display:flex;"><span>				j<span style="color:#f92672">+=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">if</span> j <span style="color:#f92672">&gt;=</span> clst_n:
</span></span><span style="display:flex;"><span>					i<span style="color:#f92672">=</span>j
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> j<span style="color:#f92672">&gt;=</span> clst_n:
</span></span><span style="display:flex;"><span>			i<span style="color:#f92672">+=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> len(mut_list) <span style="color:#f92672">&gt;=</span> MIN_MUTATIONS: <span style="color:#75715e"># saving merged cluster</span>
</span></span><span style="display:flex;"><span>			ret_dict <span style="color:#f92672">=</span> { <span style="color:#e6db74">&#39;left_position&#39;</span>:lpos,
</span></span><span style="display:flex;"><span>						<span style="color:#e6db74">&#39;right_position&#39;</span>:rpos,
</span></span><span style="display:flex;"><span>							<span style="color:#e6db74">&#39;length&#39;</span>: rpos<span style="color:#f92672">-</span>lpos<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>						<span style="color:#e6db74">&#39;mut_positions&#39;</span>:<span style="color:#e6db74">&#39;,&#39;</span><span style="color:#f92672">.</span>join([str(a) <span style="color:#66d9ef">for</span> a <span style="color:#f92672">in</span> mut_list])}
</span></span><span style="display:flex;"><span>			merged_clusters<span style="color:#f92672">.</span>append(ret_dict)
</span></span><span style="display:flex;"><span>	print(<span style="color:#e6db74">&#39;merged_clusters : </span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">%</span>len(merged_clusters))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">## write clusters to file</span>
</span></span><span style="display:flex;"><span>	cl_outf<span style="color:#f92672">=</span>open(<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">/clusters_</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">.txt&#39;</span><span style="color:#f92672">%</span>(info<span style="color:#f92672">.</span>outdir,str(tag)), <span style="color:#e6db74">&#39;w&#39;</span>)
</span></span><span style="display:flex;"><span>	header<span style="color:#f92672">=</span>merged_clusters[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>keys()
</span></span><span style="display:flex;"><span>	cl_outf<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">%</span>(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>join(header)))
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> cluster_info_dict <span style="color:#f92672">in</span> merged_clusters:		
</span></span><span style="display:flex;"><span>		cl_outf<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">%</span>(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>join([str(x) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> cluster_info_dict<span style="color:#f92672">.</span>values()])))
</span></span><span style="display:flex;"><span>	cl_outf<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> merged_clusters
</span></span></code></pre></div></article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments"><script src="https://giscus.app/client.js"
        data-repo="yshghid/yshghid.github.io"
        data-repo-id="R_kgDONkMkNg"
        data-category-id="DIC_kwDONkMkNs4CloJh"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="ko"
        crossorigin="anonymous"
        async>
</script>
</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
        <li><a href="#get_eps_region">get_eps_region</a></li>
        <li><a href="#get_candidate_core_mutations">get_candidate_core_mutations</a></li>
        <li><a href="#expand_cluster">expand_cluster</a></li>
        <li><a href="#dynaclust">dynaclust</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












