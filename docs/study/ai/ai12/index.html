<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  RF-SHAP 연구 #1 모델 학습
  #

#2025-08-04


  1. Load data
  #

import pandas as pd
import numpy as np
from sklearn.ensemble import RandomForestClassifier
from sklearn.model_selection import train_test_split, cross_val_score
from sklearn.metrics import accuracy_score
import pickle

with open('/preprocessing/processed_data.pickle','rb') as f:
    preproc_data = pickle.load(f)

cytokine_df = preproc_data['cytokine_data']
patient_meta = preproc_data['metadata'] 
patient_info = preproc_data['clinical'] 

  2. Train data split
  #

normal_df = cytokine_df[cytokine_df.index.str.contains('Healthy')]
severe_samples = patient_meta[patient_meta.Severity >= 6]
severe_df = cytokine_df[cytokine_df.index.isin(severe_samples.Sample)]

normal_df['source'] = 0
severe_df['source'] = 1

normal_df,severe_df
(            CXCL9        LIF   CXCL11       IL25    IL12B       IL10  \
 Healthy1  6.560136  4.251866  4.151513  7.586942  5.541050  1.843384   
 Healthy2  5.277100  4.089332  3.650800  7.886990  6.377469  2.113211   
 
              IL13       IL11     IL15      PTX3   ...    FSTL3    FLT3LG   \
 Healthy1  6.470743  6.949630  3.716450  5.163174  ...  9.613881  4.906822   
 Healthy2  6.450212  7.541794  4.181554  6.741940  ...  9.458981  4.658021   
 
                FAP     FABP4         F3     ESM1     ERBB3      ENPP2   \
 Healthy1  10.903602  7.923477  3.383774  6.034197  9.096096  10.839433   
 Healthy2  11.238270  8.730215  3.317157  5.497652  8.543655  10.454511   
 
             WFDC2   source  
 Healthy1  8.383246       0  
 Healthy2  8.260845       0  
 
 [2 rows x 167 columns],
               CXCL9        LIF   CXCL11       IL25    IL12B       IL10  \
 Patient2_1  7.426598  4.211594  4.429560  7.799068  6.318247  1.769972   
 Patient2_2  7.541794  4.355353  4.514350  7.886990  6.741940  1.769972   
 Patient2_3  7.541794  4.151513  3.933607  7.799068  6.159825  1.916796   
 Patient2_4  7.130935  4.429560  3.585707  7.886990  5.612199  1.916796   
 
                IL13       IL11     IL15      PTX3   ...    FSTL3    FLT3LG   \
 Patient2_1  5.725485  6.782954  3.716450  8.190382  ...  8.802718  3.042321   
 Patient2_2  5.843465  6.646599  3.716450  7.496809  ...  9.008530  3.317157   
 Patient2_3  5.984188  6.701283  3.880626  7.210939  ...  9.214496  3.448254   
 Patient2_4  6.214099  6.883351  3.933607  7.496809  ...  9.008530  3.448254   
 
                 FAP     FABP4         F3     ESM1     ERBB3     ENPP2   \
 Patient2_1  7.886990  9.296877  2.952843  5.214755  8.543655  9.096096   
 Patient2_2  8.110591  9.168168  2.820616  5.497652  8.683792  9.296877   
 Patient2_3  8.190382  9.296877  3.232241  5.306376  8.862940  9.535287   
 Patient2_4  8.383246  9.296877  3.127159  5.306376  9.096096  9.613881   
 
               WFDC2   source  
 Patient2_1  8.909767       1  
 Patient2_2  8.862940       1  
 Patient2_3  8.909767       1  
 Patient2_4  8.683792       1  

  [4 rows x 167 columns])

  3. Model training
  #

df = pd.concat([normal_df,severe_df],axis = 0)
X = df.drop(columns=['source'])
y = df['source']

#X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.20)
#Assume X_train as X, y as well

X_train = X
y_train = y

rf_model = RandomForestClassifier()
rf_model.fit(X_train, y_train)

X_train
	CXCL9	LIF	CXCL11	IL25	IL12B	IL10	IL13	IL11	IL15	PTX3	...	FURIN	FSTL3	FLT3LG	FAP	FABP4	F3	ESM1	ERBB3	ENPP2	WFDC2
Healthy1	6.560136	4.251866	4.151513	7.586942	5.541050	1.843384	6.470743	6.949630	3.716450	5.163174	...	6.883351	9.613881	4.906822	10.903602	7.923477	3.383774	6.034197	9.096096	10.839433	8.383246
Healthy2	5.277100	4.089332	3.650800	7.886990	6.377469	2.113211	6.450212	7.541794	4.181554	6.741940	...	7.002611	9.458981	4.658021	11.238270	8.730215	3.317157	5.497652	8.543655	10.454511	8.260845
Patient2_1	7.426598	4.211594	4.429560	7.799068	6.318247	1.769972	5.725485	6.782954	3.716450	8.190382	...	7.660761	8.802718	3.042321	7.886990	9.296877	2.952843	5.214755	8.543655	9.096096	8.909767
Patient2_2	7.541794	4.355353	4.514350	7.886990	6.741940	1.769972	5.843465	6.646599	3.716450	7.496809	...	7.210939	9.008530	3.317157	8.110591	9.168168	2.820616	5.497652	8.683792	9.296877	8.862940
Patient2_3	7.541794	4.151513	3.933607	7.799068	6.159825	1.916796	5.984188	6.701283	3.880626	7.210939	...	6.646599	9.214496	3.448254	8.190382	9.296877	3.232241	5.306376	8.862940	9.535287	8.909767
Patient2_4	7.130935	4.429560	3.585707	7.886990	5.612199	1.916796	6.214099	6.883351	3.933607	7.496809	...	6.532043	9.008530	3.448254	8.383246	9.296877	3.127159	5.306376	9.096096	9.613881	8.683792
6 rows × 166 columns
# Let's assume test set as well
y_test = y
X_test = X

y_pred = rf_model.predict(X_test)
accuracy = accuracy_score(y_test, y_pred)
print(accuracy)
1.0

  4. Confusion matrix
  #

from sklearn.metrics import confusion_matrix
import matplotlib.pyplot as plt
import seaborn as sns

conf_matrix = confusion_matrix(y_test, y_pred)

plt.figure(figsize=(8, 6))
sns.heatmap(conf_matrix, annot=False, fmt=&#34;d&#34;, cmap=&#34;Blues&#34;, 
            xticklabels=['Healthy','Severe'], yticklabels=['Healthy','Severe']
           ,annot_kws={&#34;fontsize&#34;: 14},)
plt.xlabel('Predicted')
plt.ylabel('Actual')
plt.title('Confusion Matrix')
plt.tick_params(axis='both', which='major', labelsize=12)  # Adjust tick label size

for i in range(len(rf_model.classes_)):
    for j in range(len(rf_model.classes_)):
        if i == j:  # Condition to check diagonal cells (true positives)
            plt.text(j + 0.5, i + 0.5, conf_matrix[i, j],
                     ha=&#34;center&#34;, va=&#34;center&#34;, color='white', fontsize=16)
        else:
            plt.text(j + 0.5, i + 0.5, conf_matrix[i, j],
                     ha=&#34;center&#34;, va=&#34;center&#34;, color='black', fontsize=16)

plt.show()


  5. Save model
  #

import joblib
joblib.dump(rf_model, '/model/rf_model.pkl') 
"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://yshghid.github.io/docs/study/ai/ai12/"><meta property="og:site_name" content=" "><meta property="og:title" content="RF-SHAP 연구 #1 모델 학습"><meta property="og:description" content="RF-SHAP 연구 #1 모델 학습 # #2025-08-04
1. Load data # import pandas as pd import numpy as np from sklearn.ensemble import RandomForestClassifier from sklearn.model_selection import train_test_split, cross_val_score from sklearn.metrics import accuracy_score import pickle with open('/preprocessing/processed_data.pickle','rb') as f: preproc_data = pickle.load(f) cytokine_df = preproc_data['cytokine_data'] patient_meta = preproc_data['metadata'] patient_info = preproc_data['clinical'] 2. Train data split # normal_df = cytokine_df[cytokine_df.index.str.contains('Healthy')] severe_samples = patient_meta[patient_meta.Severity >= 6] severe_df = cytokine_df[cytokine_df.index.isin(severe_samples.Sample)] normal_df['source'] = 0 severe_df['source'] = 1 normal_df,severe_df ( CXCL9 LIF CXCL11 IL25 IL12B IL10 \ Healthy1 6.560136 4.251866 4.151513 7.586942 5.541050 1.843384 Healthy2 5.277100 4.089332 3.650800 7.886990 6.377469 2.113211 IL13 IL11 IL15 PTX3 ... FSTL3 FLT3LG \ Healthy1 6.470743 6.949630 3.716450 5.163174 ... 9.613881 4.906822 Healthy2 6.450212 7.541794 4.181554 6.741940 ... 9.458981 4.658021 FAP FABP4 F3 ESM1 ERBB3 ENPP2 \ Healthy1 10.903602 7.923477 3.383774 6.034197 9.096096 10.839433 Healthy2 11.238270 8.730215 3.317157 5.497652 8.543655 10.454511 WFDC2 source Healthy1 8.383246 0 Healthy2 8.260845 0 [2 rows x 167 columns], CXCL9 LIF CXCL11 IL25 IL12B IL10 \ Patient2_1 7.426598 4.211594 4.429560 7.799068 6.318247 1.769972 Patient2_2 7.541794 4.355353 4.514350 7.886990 6.741940 1.769972 Patient2_3 7.541794 4.151513 3.933607 7.799068 6.159825 1.916796 Patient2_4 7.130935 4.429560 3.585707 7.886990 5.612199 1.916796 IL13 IL11 IL15 PTX3 ... FSTL3 FLT3LG \ Patient2_1 5.725485 6.782954 3.716450 8.190382 ... 8.802718 3.042321 Patient2_2 5.843465 6.646599 3.716450 7.496809 ... 9.008530 3.317157 Patient2_3 5.984188 6.701283 3.880626 7.210939 ... 9.214496 3.448254 Patient2_4 6.214099 6.883351 3.933607 7.496809 ... 9.008530 3.448254 FAP FABP4 F3 ESM1 ERBB3 ENPP2 \ Patient2_1 7.886990 9.296877 2.952843 5.214755 8.543655 9.096096 Patient2_2 8.110591 9.168168 2.820616 5.497652 8.683792 9.296877 Patient2_3 8.190382 9.296877 3.232241 5.306376 8.862940 9.535287 Patient2_4 8.383246 9.296877 3.127159 5.306376 9.096096 9.613881 WFDC2 source Patient2_1 8.909767 1 Patient2_2 8.862940 1 Patient2_3 8.909767 1 Patient2_4 8.683792 1 [4 rows x 167 columns]) 3. Model training # df = pd.concat([normal_df,severe_df],axis = 0) X = df.drop(columns=['source']) y = df['source'] #X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.20) #Assume X_train as X, y as well X_train = X y_train = y rf_model = RandomForestClassifier() rf_model.fit(X_train, y_train) X_train CXCL9	LIF	CXCL11	IL25	IL12B	IL10	IL13	IL11	IL15	PTX3	...	FURIN	FSTL3	FLT3LG	FAP	FABP4	F3	ESM1	ERBB3	ENPP2	WFDC2 Healthy1	6.560136	4.251866	4.151513	7.586942	5.541050	1.843384	6.470743	6.949630	3.716450	5.163174	...	6.883351	9.613881	4.906822	10.903602	7.923477	3.383774	6.034197	9.096096	10.839433	8.383246 Healthy2	5.277100	4.089332	3.650800	7.886990	6.377469	2.113211	6.450212	7.541794	4.181554	6.741940	...	7.002611	9.458981	4.658021	11.238270	8.730215	3.317157	5.497652	8.543655	10.454511	8.260845 Patient2_1	7.426598	4.211594	4.429560	7.799068	6.318247	1.769972	5.725485	6.782954	3.716450	8.190382	...	7.660761	8.802718	3.042321	7.886990	9.296877	2.952843	5.214755	8.543655	9.096096	8.909767 Patient2_2	7.541794	4.355353	4.514350	7.886990	6.741940	1.769972	5.843465	6.646599	3.716450	7.496809	...	7.210939	9.008530	3.317157	8.110591	9.168168	2.820616	5.497652	8.683792	9.296877	8.862940 Patient2_3	7.541794	4.151513	3.933607	7.799068	6.159825	1.916796	5.984188	6.701283	3.880626	7.210939	...	6.646599	9.214496	3.448254	8.190382	9.296877	3.232241	5.306376	8.862940	9.535287	8.909767 Patient2_4	7.130935	4.429560	3.585707	7.886990	5.612199	1.916796	6.214099	6.883351	3.933607	7.496809	...	6.532043	9.008530	3.448254	8.383246	9.296877	3.127159	5.306376	9.096096	9.613881	8.683792 6 rows × 166 columns # Let's assume test set as well y_test = y X_test = X y_pred = rf_model.predict(X_test) accuracy = accuracy_score(y_test, y_pred) print(accuracy) 1.0 4. Confusion matrix # from sklearn.metrics import confusion_matrix import matplotlib.pyplot as plt import seaborn as sns conf_matrix = confusion_matrix(y_test, y_pred) plt.figure(figsize=(8, 6)) sns.heatmap(conf_matrix, annot=False, fmt=&#34;d&#34;, cmap=&#34;Blues&#34;, xticklabels=['Healthy','Severe'], yticklabels=['Healthy','Severe'] ,annot_kws={&#34;fontsize&#34;: 14},) plt.xlabel('Predicted') plt.ylabel('Actual') plt.title('Confusion Matrix') plt.tick_params(axis='both', which='major', labelsize=12) # Adjust tick label size for i in range(len(rf_model.classes_)): for j in range(len(rf_model.classes_)): if i == j: # Condition to check diagonal cells (true positives) plt.text(j + 0.5, i + 0.5, conf_matrix[i, j], ha=&#34;center&#34;, va=&#34;center&#34;, color='white', fontsize=16) else: plt.text(j + 0.5, i + 0.5, conf_matrix[i, j], ha=&#34;center&#34;, va=&#34;center&#34;, color='black', fontsize=16) plt.show() 5. Save model # import joblib joblib.dump(rf_model, '/model/rf_model.pkl')"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:published_time" content="2025-08-04T00:00:00+00:00"><meta property="article:modified_time" content="2025-08-04T00:00:00+00:00"><meta property="article:tag" content="2025-08"><title>RF-SHAP 연구 #1 모델 학습 |</title><link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://yshghid.github.io/docs/study/ai/ai12/><link rel=stylesheet href=/book.min.30a7836b6a89342da3b88e7afd1036166aeced16c8de12df060ded2031837886.css integrity="sha256-MKeDa2qJNC2juI56/RA2Fmrs7RbI3hLfBg3tIDGDeIY=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.3fd10f1b31a28b8727246a78a2f6846114dc9b2db11331e0072f8133747454ac.js integrity="sha256-P9EPGzGii4cnJGp4ovaEYRTcmy2xEzHgBy+BM3R0VKw=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><img src=/logo.png alt=Logo class=book-icon><span></span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li class=book-section-flat><span>기록</span><ul><li><a href=/docs/hobby/daily/>일상</a><ul></ul></li><li><a href=/docs/hobby/book/>글</a><ul></ul></li></ul></li><li class=book-section-flat><span>공부</span><ul><li><a href=/docs/study/bioinformatics/>Bioinformatics</a><ul></ul></li><li><a href=/docs/study/ai/>AI</a><ul></ul></li><li><a href=/docs/study/sw/>SW</a><ul></ul></li><li><a href=/docs/study/career/>취업</a><ul></ul></li></ul></li><li><a href=/docs/portfolio/>#portfolio</a><ul></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>RF-SHAP 연구 #1 모델 학습</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li><a href=#1-load-data>1. Load data</a></li><li><a href=#2-train-data-split>2. Train data split</a></li><li><a href=#3-model-training>3. Model training</a></li><li><a href=#4-confusion-matrix>4. Confusion matrix</a></li><li><a href=#5-save-model>5. Save model</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=rf-shap-연구-1-모델-학습>RF-SHAP 연구 #1 모델 학습
<a class=anchor href=#rf-shap-%ec%97%b0%ea%b5%ac-1-%eb%aa%a8%eb%8d%b8-%ed%95%99%ec%8a%b5>#</a></h1><p>#2025-08-04</p><hr><h3 id=1-load-data>1. Load data
<a class=anchor href=#1-load-data>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> numpy <span style=color:#66d9ef>as</span> np
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> sklearn.ensemble <span style=color:#f92672>import</span> RandomForestClassifier
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> sklearn.model_selection <span style=color:#f92672>import</span> train_test_split, cross_val_score
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> sklearn.metrics <span style=color:#f92672>import</span> accuracy_score
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pickle
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#39;/preprocessing/processed_data.pickle&#39;</span>,<span style=color:#e6db74>&#39;rb&#39;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>    preproc_data <span style=color:#f92672>=</span> pickle<span style=color:#f92672>.</span>load(f)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cytokine_df <span style=color:#f92672>=</span> preproc_data[<span style=color:#e6db74>&#39;cytokine_data&#39;</span>]
</span></span><span style=display:flex><span>patient_meta <span style=color:#f92672>=</span> preproc_data[<span style=color:#e6db74>&#39;metadata&#39;</span>] 
</span></span><span style=display:flex><span>patient_info <span style=color:#f92672>=</span> preproc_data[<span style=color:#e6db74>&#39;clinical&#39;</span>] 
</span></span></code></pre></div><h3 id=2-train-data-split>2. Train data split
<a class=anchor href=#2-train-data-split>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>normal_df <span style=color:#f92672>=</span> cytokine_df[cytokine_df<span style=color:#f92672>.</span>index<span style=color:#f92672>.</span>str<span style=color:#f92672>.</span>contains(<span style=color:#e6db74>&#39;Healthy&#39;</span>)]
</span></span><span style=display:flex><span>severe_samples <span style=color:#f92672>=</span> patient_meta[patient_meta<span style=color:#f92672>.</span>Severity <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>6</span>]
</span></span><span style=display:flex><span>severe_df <span style=color:#f92672>=</span> cytokine_df[cytokine_df<span style=color:#f92672>.</span>index<span style=color:#f92672>.</span>isin(severe_samples<span style=color:#f92672>.</span>Sample)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>normal_df[<span style=color:#e6db74>&#39;source&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>severe_df[<span style=color:#e6db74>&#39;source&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>normal_df,severe_df
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain><span style=display:flex><span>(            CXCL9        LIF   CXCL11       IL25    IL12B       IL10  \
</span></span><span style=display:flex><span> Healthy1  6.560136  4.251866  4.151513  7.586942  5.541050  1.843384   
</span></span><span style=display:flex><span> Healthy2  5.277100  4.089332  3.650800  7.886990  6.377469  2.113211   
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>              IL13       IL11     IL15      PTX3   ...    FSTL3    FLT3LG   \
</span></span><span style=display:flex><span> Healthy1  6.470743  6.949630  3.716450  5.163174  ...  9.613881  4.906822   
</span></span><span style=display:flex><span> Healthy2  6.450212  7.541794  4.181554  6.741940  ...  9.458981  4.658021   
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>                FAP     FABP4         F3     ESM1     ERBB3      ENPP2   \
</span></span><span style=display:flex><span> Healthy1  10.903602  7.923477  3.383774  6.034197  9.096096  10.839433   
</span></span><span style=display:flex><span> Healthy2  11.238270  8.730215  3.317157  5.497652  8.543655  10.454511   
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>             WFDC2   source  
</span></span><span style=display:flex><span> Healthy1  8.383246       0  
</span></span><span style=display:flex><span> Healthy2  8.260845       0  
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> [2 rows x 167 columns],
</span></span><span style=display:flex><span>               CXCL9        LIF   CXCL11       IL25    IL12B       IL10  \
</span></span><span style=display:flex><span> Patient2_1  7.426598  4.211594  4.429560  7.799068  6.318247  1.769972   
</span></span><span style=display:flex><span> Patient2_2  7.541794  4.355353  4.514350  7.886990  6.741940  1.769972   
</span></span><span style=display:flex><span> Patient2_3  7.541794  4.151513  3.933607  7.799068  6.159825  1.916796   
</span></span><span style=display:flex><span> Patient2_4  7.130935  4.429560  3.585707  7.886990  5.612199  1.916796   
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>                IL13       IL11     IL15      PTX3   ...    FSTL3    FLT3LG   \
</span></span><span style=display:flex><span> Patient2_1  5.725485  6.782954  3.716450  8.190382  ...  8.802718  3.042321   
</span></span><span style=display:flex><span> Patient2_2  5.843465  6.646599  3.716450  7.496809  ...  9.008530  3.317157   
</span></span><span style=display:flex><span> Patient2_3  5.984188  6.701283  3.880626  7.210939  ...  9.214496  3.448254   
</span></span><span style=display:flex><span> Patient2_4  6.214099  6.883351  3.933607  7.496809  ...  9.008530  3.448254   
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>                 FAP     FABP4         F3     ESM1     ERBB3     ENPP2   \
</span></span><span style=display:flex><span> Patient2_1  7.886990  9.296877  2.952843  5.214755  8.543655  9.096096   
</span></span><span style=display:flex><span> Patient2_2  8.110591  9.168168  2.820616  5.497652  8.683792  9.296877   
</span></span><span style=display:flex><span> Patient2_3  8.190382  9.296877  3.232241  5.306376  8.862940  9.535287   
</span></span><span style=display:flex><span> Patient2_4  8.383246  9.296877  3.127159  5.306376  9.096096  9.613881   
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>               WFDC2   source  
</span></span><span style=display:flex><span> Patient2_1  8.909767       1  
</span></span><span style=display:flex><span> Patient2_2  8.862940       1  
</span></span><span style=display:flex><span> Patient2_3  8.909767       1  
</span></span><span style=display:flex><span> Patient2_4  8.683792       1  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  [4 rows x 167 columns])
</span></span></code></pre></div><h3 id=3-model-training>3. Model training
<a class=anchor href=#3-model-training>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>concat([normal_df,severe_df],axis <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>X <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>drop(columns<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;source&#39;</span>])
</span></span><span style=display:flex><span>y <span style=color:#f92672>=</span> df[<span style=color:#e6db74>&#39;source&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.20)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Assume X_train as X, y as well</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>X_train <span style=color:#f92672>=</span> X
</span></span><span style=display:flex><span>y_train <span style=color:#f92672>=</span> y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>rf_model <span style=color:#f92672>=</span> RandomForestClassifier()
</span></span><span style=display:flex><span>rf_model<span style=color:#f92672>.</span>fit(X_train, y_train)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>X_train
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain><span style=display:flex><span>	CXCL9	LIF	CXCL11	IL25	IL12B	IL10	IL13	IL11	IL15	PTX3	...	FURIN	FSTL3	FLT3LG	FAP	FABP4	F3	ESM1	ERBB3	ENPP2	WFDC2
</span></span><span style=display:flex><span>Healthy1	6.560136	4.251866	4.151513	7.586942	5.541050	1.843384	6.470743	6.949630	3.716450	5.163174	...	6.883351	9.613881	4.906822	10.903602	7.923477	3.383774	6.034197	9.096096	10.839433	8.383246
</span></span><span style=display:flex><span>Healthy2	5.277100	4.089332	3.650800	7.886990	6.377469	2.113211	6.450212	7.541794	4.181554	6.741940	...	7.002611	9.458981	4.658021	11.238270	8.730215	3.317157	5.497652	8.543655	10.454511	8.260845
</span></span><span style=display:flex><span>Patient2_1	7.426598	4.211594	4.429560	7.799068	6.318247	1.769972	5.725485	6.782954	3.716450	8.190382	...	7.660761	8.802718	3.042321	7.886990	9.296877	2.952843	5.214755	8.543655	9.096096	8.909767
</span></span><span style=display:flex><span>Patient2_2	7.541794	4.355353	4.514350	7.886990	6.741940	1.769972	5.843465	6.646599	3.716450	7.496809	...	7.210939	9.008530	3.317157	8.110591	9.168168	2.820616	5.497652	8.683792	9.296877	8.862940
</span></span><span style=display:flex><span>Patient2_3	7.541794	4.151513	3.933607	7.799068	6.159825	1.916796	5.984188	6.701283	3.880626	7.210939	...	6.646599	9.214496	3.448254	8.190382	9.296877	3.232241	5.306376	8.862940	9.535287	8.909767
</span></span><span style=display:flex><span>Patient2_4	7.130935	4.429560	3.585707	7.886990	5.612199	1.916796	6.214099	6.883351	3.933607	7.496809	...	6.532043	9.008530	3.448254	8.383246	9.296877	3.127159	5.306376	9.096096	9.613881	8.683792
</span></span><span style=display:flex><span>6 rows × 166 columns
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Let&#39;s assume test set as well</span>
</span></span><span style=display:flex><span>y_test <span style=color:#f92672>=</span> y
</span></span><span style=display:flex><span>X_test <span style=color:#f92672>=</span> X
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>y_pred <span style=color:#f92672>=</span> rf_model<span style=color:#f92672>.</span>predict(X_test)
</span></span><span style=display:flex><span>accuracy <span style=color:#f92672>=</span> accuracy_score(y_test, y_pred)
</span></span><span style=display:flex><span>print(accuracy)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain><span style=display:flex><span>1.0
</span></span></code></pre></div><h3 id=4-confusion-matrix>4. Confusion matrix
<a class=anchor href=#4-confusion-matrix>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> sklearn.metrics <span style=color:#f92672>import</span> confusion_matrix
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> matplotlib.pyplot <span style=color:#66d9ef>as</span> plt
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> seaborn <span style=color:#66d9ef>as</span> sns
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>conf_matrix <span style=color:#f92672>=</span> confusion_matrix(y_test, y_pred)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>figure(figsize<span style=color:#f92672>=</span>(<span style=color:#ae81ff>8</span>, <span style=color:#ae81ff>6</span>))
</span></span><span style=display:flex><span>sns<span style=color:#f92672>.</span>heatmap(conf_matrix, annot<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>, fmt<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;d&#34;</span>, cmap<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Blues&#34;</span>, 
</span></span><span style=display:flex><span>            xticklabels<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;Healthy&#39;</span>,<span style=color:#e6db74>&#39;Severe&#39;</span>], yticklabels<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;Healthy&#39;</span>,<span style=color:#e6db74>&#39;Severe&#39;</span>]
</span></span><span style=display:flex><span>           ,annot_kws<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;fontsize&#34;</span>: <span style=color:#ae81ff>14</span>},)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>xlabel(<span style=color:#e6db74>&#39;Predicted&#39;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>ylabel(<span style=color:#e6db74>&#39;Actual&#39;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>title(<span style=color:#e6db74>&#39;Confusion Matrix&#39;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>tick_params(axis<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;both&#39;</span>, which<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;major&#39;</span>, labelsize<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span>)  <span style=color:#75715e># Adjust tick label size</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(len(rf_model<span style=color:#f92672>.</span>classes_)):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> j <span style=color:#f92672>in</span> range(len(rf_model<span style=color:#f92672>.</span>classes_)):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> i <span style=color:#f92672>==</span> j:  <span style=color:#75715e># Condition to check diagonal cells (true positives)</span>
</span></span><span style=display:flex><span>            plt<span style=color:#f92672>.</span>text(j <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.5</span>, i <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.5</span>, conf_matrix[i, j],
</span></span><span style=display:flex><span>                     ha<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;center&#34;</span>, va<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;center&#34;</span>, color<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;white&#39;</span>, fontsize<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            plt<span style=color:#f92672>.</span>text(j <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.5</span>, i <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.5</span>, conf_matrix[i, j],
</span></span><span style=display:flex><span>                     ha<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;center&#34;</span>, va<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;center&#34;</span>, color<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;black&#39;</span>, fontsize<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>show()
</span></span></code></pre></div><img width=1816 height=808 alt=image src=https://github.com/user-attachments/assets/6a1206bc-14d4-4917-b63a-af3db972f7f6><h3 id=5-save-model>5. Save model
<a class=anchor href=#5-save-model>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> joblib
</span></span><span style=display:flex><span>joblib<span style=color:#f92672>.</span>dump(rf_model, <span style=color:#e6db74>&#39;/model/rf_model.pkl&#39;</span>) 
</span></span></code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments><script src=https://giscus.app/client.js data-repo=yshghid/yshghid.github.io data-repo-id=R_kgDONkMkNg data-category-id=DIC_kwDONkMkNs4CloJh data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=ko crossorigin=anonymous async></script></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#1-load-data>1. Load data</a></li><li><a href=#2-train-data-split>2. Train data split</a></li><li><a href=#3-model-training>3. Model training</a></li><li><a href=#4-confusion-matrix>4. Confusion matrix</a></li><li><a href=#5-save-model>5. Save model</a></li></ul></li></ul></nav></div></aside></main></body></html>