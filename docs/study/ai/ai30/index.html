<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Langchain #1 (스터디) 노션 데이터로 나만의 RAG 시스템 구축하기
  #

#2025-09-10



스터디하는친구가 만들어준코드인데 내 노션으로 돌려봤다!


실습 목적

노션 데이터를 임베딩 생성하여 FAISS 벡터 스토어에 저장하고 이를 기반으로 유사 문서 검색을 수행하며, 청킹 기법을 통해 데이터 구조를 이해하고 LLM 프롬프트 제약을 적용한 뒤, RAG 구조를 접목해 자동 답변 구현



실습 설계

임베딩 생성: SentenceTransformer(&ldquo;BAAI/bge-m3&rdquo;)
유사 문서 검색: 코사인 유사도 + FAISS 벡터 스토어 기반 최근접 탐색
청킹 기법: Markdown 단위 분리 + 길이 기반 추가 분할
LLM 프롬프트 제약: 근거 기반 답변(추측 금지 규칙 포함)
자동 답변 구현: RAG 구조 + &ldquo;meta-llama/llama-3.1-8b-instruct&rdquo;



사용한 노션 링크"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://yshghid.github.io/docs/study/ai/ai30/"><meta property="og:site_name" content=" "><meta property="og:title" content="Langchain #1 (스터디) 노션 데이터로 나만의 RAG 시스템 구축하기"><meta property="og:description" content="Langchain #1 (스터디) 노션 데이터로 나만의 RAG 시스템 구축하기 # #2025-09-10
스터디하는친구가 만들어준코드인데 내 노션으로 돌려봤다!
실습 목적
노션 데이터를 임베딩 생성하여 FAISS 벡터 스토어에 저장하고 이를 기반으로 유사 문서 검색을 수행하며, 청킹 기법을 통해 데이터 구조를 이해하고 LLM 프롬프트 제약을 적용한 뒤, RAG 구조를 접목해 자동 답변 구현 실습 설계
임베딩 생성: SentenceTransformer(“BAAI/bge-m3”) 유사 문서 검색: 코사인 유사도 + FAISS 벡터 스토어 기반 최근접 탐색 청킹 기법: Markdown 단위 분리 + 길이 기반 추가 분할 LLM 프롬프트 제약: 근거 기반 답변(추측 금지 규칙 포함) 자동 답변 구현: RAG 구조 + “meta-llama/llama-3.1-8b-instruct” 사용한 노션 링크"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:published_time" content="2025-09-10T00:00:00+00:00"><meta property="article:modified_time" content="2025-09-10T00:00:00+00:00"><meta property="article:tag" content="2025-09"><title>Langchain #1 (스터디) 노션 데이터로 나만의 RAG 시스템 구축하기 |</title><link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://yshghid.github.io/docs/study/ai/ai30/><link rel=stylesheet href=/book.min.30a7836b6a89342da3b88e7afd1036166aeced16c8de12df060ded2031837886.css integrity="sha256-MKeDa2qJNC2juI56/RA2Fmrs7RbI3hLfBg3tIDGDeIY=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.3b2ab34fb13bc527cdbdf57dc972d28208c4a030260a55dae787b0b5afce5f67.js integrity="sha256-OyqzT7E7xSfNvfV9yXLSggjEoDAmClXa54ewta/OX2c=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><img src=/logo.png alt=Logo class=book-icon><span></span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li class=book-section-flat><span>기록</span><ul><li><a href=/docs/hobby/daily/>일상</a><ul></ul></li><li><a href=/docs/hobby/book/>글</a><ul></ul></li></ul></li><li class=book-section-flat><span>공부</span><ul><li><a href=/docs/study/bioinformatics/>Bioinformatics</a><ul></ul></li><li><a href=/docs/study/ai/>AI</a><ul></ul></li><li><a href=/docs/study/sw/>SW</a><ul></ul></li><li><a href=/docs/study/algorithm/>알고리즘</a><ul></ul></li><li><a href=/docs/study/career/>취업</a><ul></ul></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Langchain #1 (스터디) 노션 데이터로 나만의 RAG 시스템 구축하기</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li></li><li><a href=#1-환경-준비>1. 환경 준비</a></li><li></li><li><a href=#2-notion-api-유틸-페이지db---markdown-텍스트>2. Notion API 유틸 (페이지/DB -> Markdown 텍스트)</a></li><li></li><li><a href=#3-대상-선택-데이터베이스-id-또는-개별-페이지-id>3. 대상 선택: 데이터베이스 ID 또는 개별 페이지 ID</a></li><li></li><li><a href=#4-notion---문서-리스트-로드>4. Notion -> 문서 리스트 로드</a></li><li></li><li><a href=#5-전처리--청킹chunking>5. 전처리 & 청킹(Chunking)</a></li><li></li><li><a href=#6-임베딩--벡터-인덱스faiss>6. 임베딩 & 벡터 인덱스(FAISS)</a></li><li></li><li><a href=#7-llm-호출openai-호환>7. LLM 호출(OpenAI 호환)</a></li><li></li><li><a href=#8-질의---검색---답변>8. 질의 -> 검색 -> 답변</a></li><li></li><li><a href=#9-naive-방법과-비교>9. Naive 방법과 비교</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=langchain-1-스터디-노션-데이터로-나만의-rag-시스템-구축하기>Langchain #1 (스터디) 노션 데이터로 나만의 RAG 시스템 구축하기
<a class=anchor href=#langchain-1-%ec%8a%a4%ed%84%b0%eb%94%94-%eb%85%b8%ec%85%98-%eb%8d%b0%ec%9d%b4%ed%84%b0%eb%a1%9c-%eb%82%98%eb%a7%8c%ec%9d%98-rag-%ec%8b%9c%ec%8a%a4%ed%85%9c-%ea%b5%ac%ec%b6%95%ed%95%98%ea%b8%b0>#</a></h1><p>#2025-09-10</p><hr><ul><li><p>스터디하는친구가 만들어준코드인데 내 노션으로 돌려봤다!</p></li><li><p>실습 목적</p><ul><li>노션 데이터를 <mark>임베딩 생성</mark>하여 FAISS 벡터 스토어에 저장하고 이를 기반으로 <mark>유사 문서 검색</mark>을 수행하며, <mark>청킹 기법</mark>을 통해 데이터 구조를 이해하고 <mark>LLM 프롬프트 제약</mark>을 적용한 뒤, RAG 구조를 접목해 <mark>자동 답변 구현</mark></li></ul></li><li><p>실습 설계</p><ul><li><mark>임베딩 생성</mark>: SentenceTransformer(&ldquo;BAAI/bge-m3&rdquo;)</li><li><mark>유사 문서 검색</mark>: 코사인 유사도 + FAISS 벡터 스토어 기반 최근접 탐색</li><li><mark>청킹 기법</mark>: Markdown 단위 분리 + 길이 기반 추가 분할</li><li><mark>LLM 프롬프트 제약</mark>: 근거 기반 답변(추측 금지 규칙 포함)</li><li><mark>자동 답변 구현</mark>: RAG 구조 + &ldquo;meta-llama/llama-3.1-8b-instruct&rdquo;</li></ul></li><li><p>사용한 노션 링크</p><ul><li>SQL 실습 4개<ul><li>DBMS 및 SQL 활용 #4 <a href="https://open-trust-407.notion.site/DBMS-SQL-4-25e766ec530e808fa0fad5bebba25048?source=copy_link">https://open-trust-407.notion.site/DBMS-SQL-4-25e766ec530e808fa0fad5bebba25048?source=copy_link</a></li><li>DBMS 및 SQL 활용 #5 <a href="https://open-trust-407.notion.site/DBMS-SQL-5-25e766ec530e806fab58f2097b0866ad?source=copy_link">https://open-trust-407.notion.site/DBMS-SQL-5-25e766ec530e806fab58f2097b0866ad?source=copy_link</a></li><li>DBMS 및 SQL 활용 #6 <a href="https://open-trust-407.notion.site/DBMS-SQL-6-25e766ec530e8022b72dea09a26b195f?source=copy_link">https://open-trust-407.notion.site/DBMS-SQL-6-25e766ec530e8022b72dea09a26b195f?source=copy_link</a></li><li>DBMS 및 SQL 활용 #7 <a href="https://open-trust-407.notion.site/DBMS-SQL-7-25f766ec530e80bda9a3efece96453bc?source=copy_link">https://open-trust-407.notion.site/DBMS-SQL-7-25f766ec530e80bda9a3efece96453bc?source=copy_link</a></li></ul></li></ul></li></ul><h3><a class=anchor href=#>#</a></h3><h3 id=1-환경-준비>1. 환경 준비
<a class=anchor href=#1-%ed%99%98%ea%b2%bd-%ec%a4%80%eb%b9%84>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 0) Install deps</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>!</span>pip <span style=color:#f92672>-</span>q install notion<span style=color:#f92672>-</span>client sentence<span style=color:#f92672>-</span>transformers faiss<span style=color:#f92672>-</span>cpu openai python<span style=color:#f92672>-</span>dotenv
</span></span></code></pre></div><ul><li>notion-client<ul><li>노션 페이지나 데이터베이스를 불러올때 노션 API와 통신하기 위한 라이브러리</li></ul></li><li>sentence-transformers<ul><li>텍스트를 벡터로 변환하기 위해 사용하는 임베딩 모델</li></ul></li><li>faiss-cpu<ul><li>대규모 벡터 검색을 빠르게 수행하기 위한 페이스북 AI의 라이브러리</li></ul></li><li>openai<ul><li>LLM을 호출하는데 사용 여기서는 OpenRouter를 통해 OpenAI API와 호환되는 방식으로 LLM을 부른다.</li></ul></li><li>python-dotenv<ul><li>.env 파일에서 API 키나 토큰 같은 민감한 환경변수를 로드</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> dotenv <span style=color:#f92672>import</span> load_dotenv
</span></span><span style=display:flex><span>load_dotenv()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># --- Notion ---</span>
</span></span><span style=display:flex><span>NOTION_TOKEN <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span> <span style=color:#75715e>#&#39;ntn_xxx&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># --- LLM (OpenAI-호환) ---</span>
</span></span><span style=display:flex><span>API_KEY <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span> <span style=color:#75715e># &#39;sk-or-v1-xxx&#39;</span>
</span></span><span style=display:flex><span>BASE_URL <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://openrouter.ai/api/v1&#34;</span>
</span></span><span style=display:flex><span>MODEL_NAME <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;meta-llama/llama-3.1-8b-instruct&#34;</span>
</span></span></code></pre></div><ul><li>NOTION_TOKEN<ul><li>노션 개발자 설정에서 발급받은 통합 토큰, 노션 페이지와 데이터베이스에 접근할때 필요</li><li>발급받는법: <a href=https://www.notion.so/profile/integrations>https://www.notion.so/profile/integrations</a> 에서 새 API 통합 > 이름 입력(test) > 워크스페이스 선택(윤소현의 Notion) > 유형 선택(프라이빗)</li></ul></li><li>API_KEY<ul><li>OpenRouter 또는 OpenAI에서 발급받은 키, LLM을 호출할 때 필요</li><li>발급받는법: <a href=https://openrouter.ai/>https://openrouter.ai/</a> 에서 발급받음</li></ul></li><li>MODEL<ul><li>사용할 LLM의 이름</li></ul></li><li>EMB_MODEL<ul><li>임베딩 계산에 쓸 사전학습된 문장 변환기 모델 이름</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># --- Embedding ---</span>
</span></span><span style=display:flex><span>EMB_MODEL <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;BAAI/bge-m3&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print({
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;NOTION_TOKEN&#34;</span>: bool(NOTION_TOKEN),
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;BASE_URL&#34;</span>: BASE_URL,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;MODEL_NAME&#34;</span>: MODEL_NAME,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;EMB_MODEL&#34;</span>: EMB_MODEL,
</span></span><span style=display:flex><span>})
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain><span style=display:flex><span>{&#39;NOTION_TOKEN&#39;: True, &#39;BASE_URL&#39;: &#39;https://openrouter.ai/api/v1&#39;, &#39;MODEL_NAME&#39;: &#39;meta-llama/llama-3.1-8b-instruct&#39;, &#39;EMB_MODEL&#39;: &#39;BAAI/bge-m3&#39;}
</span></span></code></pre></div><h3><a class=anchor href=#>#</a></h3><h3 id=2-notion-api-유틸-페이지db---markdown-텍스트>2. Notion API 유틸 (페이지/DB -> Markdown 텍스트)
<a class=anchor href=#2-notion-api-%ec%9c%a0%ed%8b%b8-%ed%8e%98%ec%9d%b4%ec%a7%80db---markdown-%ed%85%8d%ec%8a%a4%ed%8a%b8>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> notion_client <span style=color:#f92672>import</span> Client
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> re<span style=color:#f92672>,</span> textwrap<span style=color:#f92672>,</span> hashlib
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> typing <span style=color:#f92672>import</span> List, Dict
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> NOTION_TOKEN:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>RuntimeError</span>(<span style=color:#e6db74>&#34;NOTION_TOKEN이 필요합니다.&#34;</span>)
</span></span><span style=display:flex><span>nclient <span style=color:#f92672>=</span> Client(auth<span style=color:#f92672>=</span>NOTION_TOKEN)
</span></span></code></pre></div><ul><li>nclient = Client(auth=NOTION_TOKEN)<ul><li>노션 API와 연결할 클라이언트를 생성 -> 클라이언트를 통해 노션 블록 단위 데이터를 가져온다.</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_pt</span>(rt_list):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>.</span>join([t<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;plain_text&#34;</span>,<span style=color:#e6db74>&#34;&#34;</span>) <span style=color:#66d9ef>for</span> t <span style=color:#f92672>in</span> (rt_list <span style=color:#f92672>or</span> [])])
</span></span></code></pre></div><ul><li>노션의 텍스트 데이터는 단순 문자열이 아니라 rich_text라는 구조체 안에 여러 조각이 들어있고 _pt 함수는 그 안에서 &ldquo;plain_text"라는 부분만 꺼내 붙인다.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_flatten_block</span>(block):
</span></span><span style=display:flex><span>    t <span style=color:#f92672>=</span> block[<span style=color:#e6db74>&#34;type&#34;</span>]
</span></span><span style=display:flex><span>    b <span style=color:#f92672>=</span> block[t]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> t <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;paragraph&#34;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> _pt(b<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;rich_text&#34;</span>))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> t<span style=color:#f92672>.</span>endswith(<span style=color:#e6db74>&#34;_heading&#34;</span>):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;# &#34;</span> <span style=color:#f92672>+</span> _pt(b<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;rich_text&#34;</span>))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> t <span style=color:#f92672>in</span> (<span style=color:#e6db74>&#34;bulleted_list_item&#34;</span>,<span style=color:#e6db74>&#34;numbered_list_item&#34;</span>,<span style=color:#e6db74>&#34;to_do&#34;</span>):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;- &#34;</span> <span style=color:#f92672>+</span> _pt(b<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;rich_text&#34;</span>))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> t <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;quote&#34;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&gt; &#34;</span> <span style=color:#f92672>+</span> _pt(b<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;rich_text&#34;</span>))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> t <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;code&#34;</span>:
</span></span><span style=display:flex><span>        txt <span style=color:#f92672>=</span> b<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;rich_text&#34;</span>, [{}])[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;plain_text&#34;</span>,<span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>        lang <span style=color:#f92672>=</span> b<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;language&#34;</span>,<span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;```</span><span style=color:#e6db74>{</span>lang<span style=color:#e6db74>}</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>+</span>txt<span style=color:#f92672>+</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>```&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> t <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;callout&#34;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;💡 &#34;</span> <span style=color:#f92672>+</span> _pt(b<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;rich_text&#34;</span>))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> t <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;toggle&#34;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> _pt(b<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;rich_text&#34;</span>))  <span style=color:#75715e># children로 확장</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> t <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;equation&#34;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;$&#34;</span> <span style=color:#f92672>+</span> b<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;expression&#34;</span>,<span style=color:#e6db74>&#34;&#34;</span>) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;$&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> t <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;table_row&#34;</span>:
</span></span><span style=display:flex><span>        cells <span style=color:#f92672>=</span> [ _pt(cell) <span style=color:#66d9ef>for</span> cell <span style=color:#f92672>in</span> b<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;cells&#34;</span>, []) ]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34; | &#34;</span><span style=color:#f92672>.</span>join(cells)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span></code></pre></div><ul><li>_flatten_block(block)<ul><li>노션 블록을 마크다운 문법으로 표현</li><li>블록 타입별로 다르게 처리<ul><li>&ldquo;paragraph&rdquo;: 텍스트추출</li><li>&ldquo;heading&rdquo;: 제목이라는 의미로 #을 붙임</li><li>&ldquo;bulleted_list_item&rdquo; &ldquo;numbered_list_item&rdquo;: 리스트 항목이므로 - 기호를 붙임</li><li>&ldquo;quote&rdquo;: 인용문 표시 ></li><li>&ldquo;code&rdquo;: 언어 이름과 함께 코드 블록 형태로 변환</li><li>&ldquo;callout&rdquo;: 아이디어 박스이므로 💡 이모지</li><li>&ldquo;equation&rdquo;: 수식 표시 $ &mldr; $로 감싸기</li><li>&ldquo;table_row"는 셀을 | 기호로 구분해 테이블 행으로 바꾸기</li><li>알 수 없는 블록 타입이면 빈 문자열 반환</li></ul></li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_walk_children</span>(block_id, acc: List[str]):
</span></span><span style=display:flex><span>    children <span style=color:#f92672>=</span> nclient<span style=color:#f92672>.</span>blocks<span style=color:#f92672>.</span>children<span style=color:#f92672>.</span>list(block_id<span style=color:#f92672>=</span>block_id)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> b <span style=color:#f92672>in</span> children[<span style=color:#e6db74>&#34;results&#34;</span>]:
</span></span><span style=display:flex><span>            acc<span style=color:#f92672>.</span>append(_flatten_block(b))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> b<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;has_children&#34;</span>):
</span></span><span style=display:flex><span>                _walk_children(b[<span style=color:#e6db74>&#34;id&#34;</span>], acc)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> children<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;has_more&#34;</span>): <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>        children <span style=color:#f92672>=</span> nclient<span style=color:#f92672>.</span>blocks<span style=color:#f92672>.</span>children<span style=color:#f92672>.</span>list(block_id<span style=color:#f92672>=</span>block_id, start_cursor<span style=color:#f92672>=</span>children[<span style=color:#e6db74>&#34;next_cursor&#34;</span>])
</span></span></code></pre></div><ul><li>_walk_children(block_id, acc)<ul><li>노션 페이지는 트리 구조로 되어 있고 하나의 블록이 안에 또 다른 블록들을 가질 수 있는데 재귀적으로 블록의 자식들을 탐색</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 페이지를 재귀로 순회해 텍스트화</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>notion_page_to_markdown</span>(page_id: str) <span style=color:#f92672>-&gt;</span> str:
</span></span><span style=display:flex><span>    out<span style=color:#f92672>=</span>[]
</span></span><span style=display:flex><span>    _walk_children(page_id, out)
</span></span><span style=display:flex><span>    md <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>join(filter(<span style=color:#66d9ef>None</span>,out))<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> md
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_page_meta</span>(page: Dict) <span style=color:#f92672>-&gt;</span> Dict:
</span></span><span style=display:flex><span>    <span style=color:#75715e># title property 찾기</span>
</span></span><span style=display:flex><span>    props <span style=color:#f92672>=</span> page<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;properties&#34;</span>, {})
</span></span><span style=display:flex><span>    title_prop <span style=color:#f92672>=</span> next((v <span style=color:#66d9ef>for</span> v <span style=color:#f92672>in</span> props<span style=color:#f92672>.</span>values() <span style=color:#66d9ef>if</span> v<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;type&#34;</span>)<span style=color:#f92672>==</span><span style=color:#e6db74>&#34;title&#34;</span>), <span style=color:#66d9ef>None</span>)
</span></span><span style=display:flex><span>    title <span style=color:#f92672>=</span> _pt((title_prop <span style=color:#f92672>or</span> {})<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;title&#34;</span>, [])) <span style=color:#f92672>or</span> page<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;id&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;page_id&#34;</span>: page[<span style=color:#e6db74>&#34;id&#34;</span>],
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;title&#34;</span>: title,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;url&#34;</span>: page<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;url&#34;</span>),
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;last_edited_time&#34;</span>: page<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;last_edited_time&#34;</span>),
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># DB의 각 페이지를 위 함수로 변환</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>fetch_pages_from_database</span>(database_id: str) <span style=color:#f92672>-&gt;</span> List[Dict]:
</span></span><span style=display:flex><span>    results<span style=color:#f92672>=</span>[]
</span></span><span style=display:flex><span>    resp <span style=color:#f92672>=</span> nclient<span style=color:#f92672>.</span>databases<span style=color:#f92672>.</span>query(database_id<span style=color:#f92672>=</span>database_id, page_size<span style=color:#f92672>=</span><span style=color:#ae81ff>50</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> page <span style=color:#f92672>in</span> resp[<span style=color:#e6db74>&#34;results&#34;</span>]:
</span></span><span style=display:flex><span>            meta <span style=color:#f92672>=</span> get_page_meta(page)
</span></span><span style=display:flex><span>            md <span style=color:#f92672>=</span> notion_page_to_markdown(page[<span style=color:#e6db74>&#34;id&#34;</span>])
</span></span><span style=display:flex><span>            results<span style=color:#f92672>.</span>append({<span style=color:#f92672>**</span>meta, <span style=color:#e6db74>&#34;content_md&#34;</span>: md})
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> resp<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;has_more&#34;</span>): <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>        resp <span style=color:#f92672>=</span> nclient<span style=color:#f92672>.</span>databases<span style=color:#f92672>.</span>query(database_id<span style=color:#f92672>=</span>database_id, page_size<span style=color:#f92672>=</span><span style=color:#ae81ff>50</span>, start_cursor<span style=color:#f92672>=</span>resp[<span style=color:#e6db74>&#34;next_cursor&#34;</span>])
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> results
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 단일 페이지 변환</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>fetch_single_page</span>(page_id: str) <span style=color:#f92672>-&gt;</span> Dict:
</span></span><span style=display:flex><span>    page <span style=color:#f92672>=</span> nclient<span style=color:#f92672>.</span>pages<span style=color:#f92672>.</span>retrieve(page_id<span style=color:#f92672>=</span>page_id)
</span></span><span style=display:flex><span>    meta <span style=color:#f92672>=</span> get_page_meta(page)
</span></span><span style=display:flex><span>    md <span style=color:#f92672>=</span> notion_page_to_markdown(page_id)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {<span style=color:#f92672>**</span>meta, <span style=color:#e6db74>&#34;content_md&#34;</span>: md}
</span></span></code></pre></div><ul><li>notion_page_to_markdown(page_id)<ul><li>노션 페이지 하나를 마크다운 파일로 변환</li></ul></li><li>get_page_meta(page)<ul><li>페이지 메타데이터 추출. 노션의 페이지가 갖는 소것ㅇ 중 &ldquo;title&rdquo;, 페이지 ID, 제목, URL, 마지막 수정 시간(last_edited_time) 정보를 딕셔너리로 만들고 이 딕셔너리는 나중에 검색 결과를 사용자에게 보여줄 때 출처를 표시하는 데 쓰인다.</li></ul></li><li>fetch_pages_from_database(database_id)<ul><li>데이터베이스 전체 페이지가 마크다운과 메타정보로 변환</li></ul></li><li>fetch_single_page(page_id)<ul><li>데이터베이스 전체가 아니라 특정 단일 페이지를 마크다운과 메타정보로 변환</li></ul></li></ul><h3><a class=anchor href=#>#</a></h3><h3 id=3-대상-선택-데이터베이스-id-또는-개별-페이지-id>3. 대상 선택: 데이터베이스 ID 또는 개별 페이지 ID
<a class=anchor href=#3-%eb%8c%80%ec%83%81-%ec%84%a0%ed%83%9d-%eb%8d%b0%ec%9d%b4%ed%84%b0%eb%b2%a0%ec%9d%b4%ec%8a%a4-id-%eb%98%90%eb%8a%94-%ea%b0%9c%eb%b3%84-%ed%8e%98%ec%9d%b4%ec%a7%80-id>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 예시: 하나의 데이터베이스를 긁어오거나, 개별 페이지들을 모아올 수 있습니다.</span>
</span></span><span style=display:flex><span>DATABASE_IDS <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#75715e># &#34;264bf0ad3a0680e18fedda127323e553&#34;,</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># &#34;1c2bf0ad3a06803eab94dae2a4d81272&#34;,</span>
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>PAGE_IDS <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;25e766ec-530e-808f-a0fa-d5bebba25048&#34;</span>,  <span style=color:#75715e># 실습4</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;25e766ec-530e-806f-ab58-f2097b0866ad&#34;</span>,  <span style=color:#75715e># 실습5</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;25e766ec-530e-8022-b72d-ea09a26b195f&#34;</span>,  <span style=color:#75715e># 실습6</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;25f766ec-530e-80bd-a9a3-efece96453bc&#34;</span>   <span style=color:#75715e># 실습7</span>
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><ul><li>DBMS 및 SQL 활용 실습4-7을 사용해보기.<ul><li>실습4 - <a href="https://www.notion.so/DBMS-SQL-4-25e766ec530e808fa0fad5bebba25048?source=copy_link">https://www.notion.so/DBMS-SQL-4-25e766ec530e808fa0fad5bebba25048?source=copy_link</a></li><li>실습5 - <a href="https://www.notion.so/DBMS-SQL-5-25e766ec530e806fab58f2097b0866ad?source=copy_link">https://www.notion.so/DBMS-SQL-5-25e766ec530e806fab58f2097b0866ad?source=copy_link</a></li><li>실습6 - <a href="https://www.notion.so/DBMS-SQL-6-25e766ec530e8022b72dea09a26b195f?source=copy_link">https://www.notion.so/DBMS-SQL-6-25e766ec530e8022b72dea09a26b195f?source=copy_link</a></li><li>실습7 - <a href="https://www.notion.so/DBMS-SQL-7-25f766ec530e80bda9a3efece96453bc?source=copy_link">https://www.notion.so/DBMS-SQL-7-25f766ec530e80bda9a3efece96453bc?source=copy_link</a></li></ul></li><li>페이지들을 Notion Integration(내 통합 앱)에 공유해야 API로 접근할수있다.</li></ul><h3><a class=anchor href=#>#</a></h3><h3 id=4-notion---문서-리스트-로드>4. Notion -> 문서 리스트 로드
<a class=anchor href=#4-notion---%eb%ac%b8%ec%84%9c-%eb%a6%ac%ec%8a%a4%ed%8a%b8-%eb%a1%9c%eb%93%9c>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>docs <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> dbid <span style=color:#f92672>in</span> DATABASE_IDS:
</span></span><span style=display:flex><span>    docs <span style=color:#f92672>+=</span> fetch_pages_from_database(dbid)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> pid <span style=color:#f92672>in</span> PAGE_IDS:
</span></span><span style=display:flex><span>    docs<span style=color:#f92672>.</span>append(fetch_single_page(pid))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>len(docs), [ (d[<span style=color:#e6db74>&#39;title&#39;</span>], d[<span style=color:#e6db74>&#39;url&#39;</span>]) <span style=color:#66d9ef>for</span> d <span style=color:#f92672>in</span> docs[:<span style=color:#ae81ff>5</span>] ]
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain><span style=display:flex><span>(4,
</span></span><span style=display:flex><span> [(&#39;DBMS 및 SQL 활용 #4&#39;,
</span></span><span style=display:flex><span>   &#39;https://www.notion.so/DBMS-SQL-4-25e766ec530e808fa0fad5bebba25048&#39;),
</span></span><span style=display:flex><span>  (&#39;DBMS 및 SQL 활용 #5&#39;,
</span></span><span style=display:flex><span>   &#39;https://www.notion.so/DBMS-SQL-5-25e766ec530e806fab58f2097b0866ad&#39;),
</span></span><span style=display:flex><span>  (&#39;DBMS 및 SQL 활용 #6&#39;,
</span></span><span style=display:flex><span>   &#39;https://www.notion.so/DBMS-SQL-6-25e766ec530e8022b72dea09a26b195f&#39;),
</span></span><span style=display:flex><span>  (&#39;DBMS 및 SQL 활용 #7&#39;,
</span></span><span style=display:flex><span>   &#39;https://www.notion.so/DBMS-SQL-7-25f766ec530e80bda9a3efece96453bc&#39;)])
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>docs
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain><span style=display:flex><span>[{&#39;page_id&#39;: &#39;25e766ec-530e-808f-a0fa-d5bebba25048&#39;,
</span></span><span style=display:flex><span>  &#39;title&#39;: &#39;DBMS 및 SQL 활용 #4&#39;,
</span></span><span style=display:flex><span>  &#39;url&#39;: &#39;https://www.notion.so/DBMS-SQL-4-25e766ec530e808fa0fad5bebba25048&#39;,
</span></span><span style=display:flex><span>  &#39;last_edited_time&#39;: &#39;2025-09-09T23:48:00.000Z&#39;,
</span></span><span style=display:flex><span>  &#39;content_md&#39;: &#39;문제\n실습 개요\n- 데이터\n- 사용자의 나이, 소득, 성별, 소비 성향, 방문 횟수\n- 목적\n- 사용자의 속성(예: 나이, 소득, 소비 성향 등)을 벡터 공간에 임베딩하여, ...},
</span></span><span style=display:flex><span> {&#39;page_id&#39;: &#39;25e766ec-530e-806f-ab58-f2097b0866ad&#39;,
</span></span><span style=display:flex><span>  &#39;title&#39;: &#39;DBMS 및 SQL 활용 #5&#39;,
</span></span><span style=display:flex><span>  &#39;url&#39;: &#39;https://www.notion.so/DBMS-SQL-5-25e766ec530e806fab58f2097b0866ad&#39;,
</span></span><span style=display:flex><span>  &#39;last_edited_time&#39;: &#39;2025-09-09T23:49:00.000Z&#39;,
</span></span><span style=display:flex><span>  &#39;content_md&#39;: &#39;문제\n실습 개요\n- 실습 목적\n- 텍스트 데이터(GitHub Issues)를 임베딩 생성하여 PostgreSQL + pgvector에 저장하고, 이를 기반으로 유사 이슈 검색을 수행하며, 시각화를 통해 데이터 구조를 이해하고 ...},
</span></span><span style=display:flex><span>  {&#39;page_id&#39;: &#39;25e766ec-530e-8022-b72d-ea09a26b195f&#39;,
</span></span><span style=display:flex><span>  &#39;title&#39;: &#39;DBMS 및 SQL 활용 #6&#39;,
</span></span><span style=display:flex><span>  &#39;url&#39;: &#39;https://www.notion.so/DBMS-SQL-6-25e766ec530e8022b72dea09a26b195f&#39;,
</span></span><span style=display:flex><span>  &#39;last_edited_time&#39;: &#39;2025-09-09T23:49:00.000Z&#39;,
</span></span><span style=display:flex><span>  &#39;content_md&#39;: &#39;문제\n실습 개요\n- 실습 목적\n- 텍스트 데이터(GitHub Issues)를 임베딩 생성하여 PostgreSQL + pgvector에 저장하고, 이를 기반으로 유사 이슈 검색을 수행하며, 시각화를 통해 데이터 구조를 이해하고 ...},
</span></span><span style=display:flex><span>  {&#39;page_id&#39;: &#39;25f766ec-530e-80bd-a9a3-efece96453bc&#39;,
</span></span><span style=display:flex><span>  &#39;title&#39;: &#39;DBMS 및 SQL 활용 #7&#39;,
</span></span><span style=display:flex><span>  &#39;url&#39;: &#39;https://www.notion.so/DBMS-SQL-7-25f766ec530e80bda9a3efece96453bc&#39;,
</span></span><span style=display:flex><span>  &#39;last_edited_time&#39;: &#39;2025-09-09T23:49:00.000Z&#39;,
</span></span><span style=display:flex><span>  &#39;content_md&#39;: &#39;문제\n```plain text\n# 1. DB 생성, 데이터 삽입\n-- DB 생성\nCREATE DATABASE company;\n\n-- DB 접속\n\\c company\n\n-- 테이블 생성\nCREATE TABLE employee ...}]
</span></span></code></pre></div><h3><a class=anchor href=#>#</a></h3><h3 id=5-전처리--청킹chunking>5. 전처리 & 청킹(Chunking)
<a class=anchor href=#5-%ec%a0%84%ec%b2%98%eb%a6%ac--%ec%b2%ad%ed%82%b9chunking>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>split_markdown</span>(md: str, max_len<span style=color:#f92672>=</span><span style=color:#ae81ff>900</span>):
</span></span><span style=display:flex><span>parts<span style=color:#f92672>=</span>[]; buf<span style=color:#f92672>=</span>[]
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> md<span style=color:#f92672>.</span>splitlines():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> re<span style=color:#f92672>.</span><span style=color:#66d9ef>match</span>(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#34;^#{1,6}\s&#34;</span>, line) <span style=color:#f92672>and</span> buf:
</span></span><span style=display:flex><span>        chunk<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>join(buf)<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>        parts <span style=color:#f92672>+=</span> textwrap<span style=color:#f92672>.</span>wrap(chunk, max_len, break_long_words<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>, break_on_hyphens<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>) <span style=color:#66d9ef>if</span> len(chunk)<span style=color:#f92672>&gt;</span>max_len <span style=color:#66d9ef>else</span> [chunk]
</span></span><span style=display:flex><span>        buf<span style=color:#f92672>=</span>[line]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        buf<span style=color:#f92672>.</span>append(line)
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> buf:
</span></span><span style=display:flex><span>    chunk<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>join(buf)<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>    parts <span style=color:#f92672>+=</span> textwrap<span style=color:#f92672>.</span>wrap(chunk, max_len, break_long_words<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>, break_on_hyphens<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>) <span style=color:#66d9ef>if</span> len(chunk)<span style=color:#f92672>&gt;</span>max_len <span style=color:#66d9ef>else</span> [chunk]
</span></span><span style=display:flex><span><span style=color:#66d9ef>return</span> [p <span style=color:#66d9ef>for</span> p <span style=color:#f92672>in</span> parts <span style=color:#66d9ef>if</span> p<span style=color:#f92672>.</span>strip()]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>chunks<span style=color:#f92672>=</span>[]
</span></span><span style=display:flex><span>metas<span style=color:#f92672>=</span>[]
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> d <span style=color:#f92672>in</span> docs:
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> ch <span style=color:#f92672>in</span> split_markdown(d[<span style=color:#e6db74>&#34;content_md&#34;</span>]):
</span></span><span style=display:flex><span>    metas<span style=color:#f92672>.</span>append({<span style=color:#e6db74>&#34;page_id&#34;</span>: d[<span style=color:#e6db74>&#34;page_id&#34;</span>], <span style=color:#e6db74>&#34;title&#34;</span>: d[<span style=color:#e6db74>&#34;title&#34;</span>], <span style=color:#e6db74>&#34;url&#34;</span>: d<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;url&#34;</span>), <span style=color:#e6db74>&#34;section&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#e6db74>&#34;text&#34;</span>: ch})
</span></span><span style=display:flex><span>    chunks<span style=color:#f92672>.</span>append(ch)
</span></span></code></pre></div><h3><a class=anchor href=#>#</a></h3><h3 id=6-임베딩--벡터-인덱스faiss>6. 임베딩 & 벡터 인덱스(FAISS)
<a class=anchor href=#6-%ec%9e%84%eb%b2%a0%eb%94%a9--%eb%b2%a1%ed%84%b0-%ec%9d%b8%eb%8d%b1%ec%8a%a4faiss>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> sentence_transformers <span style=color:#f92672>import</span> SentenceTransformer
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>e_model <span style=color:#f92672>=</span> SentenceTransformer(EMB_MODEL)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>embed</span>(texts):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> e_model<span style=color:#f92672>.</span>encode(texts, normalize_embeddings<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>, convert_to_numpy<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)<span style=color:#f92672>.</span>astype(<span style=color:#e6db74>&#34;float32&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>vecs <span style=color:#f92672>=</span> embed(chunks)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> numpy <span style=color:#66d9ef>as</span> np<span style=color:#f92672>,</span> faiss
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FaissStore</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__init__</span>(self, dim):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>index <span style=color:#f92672>=</span> faiss<span style=color:#f92672>.</span>IndexFlatIP(dim)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>meta <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>add</span>(self, vecs, metas):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>index<span style=color:#f92672>.</span>add(vecs)    <span style=color:#75715e># 학습 불필요, 바로 추가</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>meta <span style=color:#f92672>+=</span> metas
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>search</span>(self, qvec, k<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>):
</span></span><span style=display:flex><span>        D,I <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>index<span style=color:#f92672>.</span>search(np<span style=color:#f92672>.</span>array([qvec])<span style=color:#f92672>.</span>astype(<span style=color:#e6db74>&#34;float32&#34;</span>), k)  <span style=color:#75715e># 유사도 높은 상위 k개</span>
</span></span><span style=display:flex><span>        out<span style=color:#f92672>=</span>[]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> rank, idx <span style=color:#f92672>in</span> enumerate(I[<span style=color:#ae81ff>0</span>]):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> idx <span style=color:#f92672>==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>: <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>            m <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>meta[idx]
</span></span><span style=display:flex><span>            out<span style=color:#f92672>.</span>append({<span style=color:#e6db74>&#34;text&#34;</span>: m[<span style=color:#e6db74>&#34;text&#34;</span>], <span style=color:#e6db74>&#34;meta&#34;</span>: {k:v <span style=color:#66d9ef>for</span> k,v <span style=color:#f92672>in</span> m<span style=color:#f92672>.</span>items() <span style=color:#66d9ef>if</span> k<span style=color:#f92672>!=</span><span style=color:#e6db74>&#34;text&#34;</span>}, <span style=color:#e6db74>&#34;score&#34;</span>: float(D[<span style=color:#ae81ff>0</span>][rank])})
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> out
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>store <span style=color:#f92672>=</span> FaissStore(vecs<span style=color:#f92672>.</span>shape[<span style=color:#ae81ff>1</span>])
</span></span><span style=display:flex><span>store<span style=color:#f92672>.</span>add(vecs, metas)
</span></span><span style=display:flex><span>len(chunks)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain><span style=display:flex><span>139
</span></span></code></pre></div><h3><a class=anchor href=#>#</a></h3><h3 id=7-llm-호출openai-호환>7. LLM 호출(OpenAI 호환)
<a class=anchor href=#7-llm-%ed%98%b8%ec%b6%9copenai-%ed%98%b8%ed%99%98>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> openai <span style=color:#f92672>import</span> OpenAI
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> API_KEY:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>RuntimeError</span>(<span style=color:#e6db74>&#34;PROVIDER_API_KEY가 필요합니다.&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>client <span style=color:#f92672>=</span> OpenAI(api_key<span style=color:#f92672>=</span>API_KEY, base_url<span style=color:#f92672>=</span>BASE_URL)
</span></span><span style=display:flex><span>SYSTEM <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;당신은 신뢰 가능한 한국어 어시스턴트입니다. 제공된 근거 외 추측 금지.&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>build_prompt</span>(query, contexts):
</span></span><span style=display:flex><span>    ctx <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>---</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>join(
</span></span><span style=display:flex><span>        <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;[</span><span style=color:#e6db74>{</span>i<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span><span style=color:#e6db74>}</span><span style=color:#e6db74>] </span><span style=color:#e6db74>{</span>c[<span style=color:#e6db74>&#39;meta&#39;</span>]<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;title&#39;</span>,<span style=color:#e6db74>&#39;(제목없음)&#39;</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74> / </span><span style=color:#e6db74>{</span>c[<span style=color:#e6db74>&#39;meta&#39;</span>]<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;section&#39;</span>,<span style=color:#e6db74>&#39;&#39;</span>)<span style=color:#e6db74>}</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>{</span>c[<span style=color:#e6db74>&#39;text&#39;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i,c <span style=color:#f92672>in</span> enumerate(contexts)
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;&#34;&#34;사용자 질문: </span><span style=color:#e6db74>{</span>query<span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>다음 근거를 바탕으로 한국어로 정확히 답하세요.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>근거:
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>{</span>ctx<span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>규칙:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- 근거에 없는 내용은 &#39;근거 없음&#39;으로 표시
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- 필요한 경우 목록/표로 간결히
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- 각 주장에는 근거 번호를 붙여라
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>llm_answer</span>(query, contexts, temperature<span style=color:#f92672>=</span><span style=color:#ae81ff>0.2</span>, max_tokens<span style=color:#f92672>=</span><span style=color:#ae81ff>800</span>):
</span></span><span style=display:flex><span>    prompt <span style=color:#f92672>=</span> build_prompt(query, contexts)
</span></span><span style=display:flex><span>    resp <span style=color:#f92672>=</span> client<span style=color:#f92672>.</span>chat<span style=color:#f92672>.</span>completions<span style=color:#f92672>.</span>create(
</span></span><span style=display:flex><span>        model<span style=color:#f92672>=</span>MODEL_NAME,
</span></span><span style=display:flex><span>        messages<span style=color:#f92672>=</span>[{<span style=color:#e6db74>&#34;role&#34;</span>:<span style=color:#e6db74>&#34;system&#34;</span>,<span style=color:#e6db74>&#34;content&#34;</span>:SYSTEM}, {<span style=color:#e6db74>&#34;role&#34;</span>:<span style=color:#e6db74>&#34;user&#34;</span>,<span style=color:#e6db74>&#34;content&#34;</span>:prompt}],
</span></span><span style=display:flex><span>        temperature<span style=color:#f92672>=</span>temperature,
</span></span><span style=display:flex><span>        max_tokens<span style=color:#f92672>=</span>max_tokens,
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> resp<span style=color:#f92672>.</span>choices[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>message<span style=color:#f92672>.</span>content
</span></span></code></pre></div><h3><a class=anchor href=#>#</a></h3><h3 id=8-질의---검색---답변>8. 질의 -> 검색 -> 답변
<a class=anchor href=#8-%ec%a7%88%ec%9d%98---%ea%b2%80%ec%83%89---%eb%8b%b5%eb%b3%80>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>embed_one</span>(text):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> embed([text])[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>ask</span>(q: str, k: int <span style=color:#f92672>=</span> <span style=color:#ae81ff>8</span>, n_ctx: int <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>):
</span></span><span style=display:flex><span>    qv <span style=color:#f92672>=</span> embed_one(q)
</span></span><span style=display:flex><span>    cands <span style=color:#f92672>=</span> store<span style=color:#f92672>.</span>search(qv, k<span style=color:#f92672>=</span>k)
</span></span><span style=display:flex><span>    contexts <span style=color:#f92672>=</span> cands[:n_ctx]
</span></span><span style=display:flex><span>    answer <span style=color:#f92672>=</span> llm_answer(q, contexts)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>[답변]</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, answer)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>[근거]&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i, c <span style=color:#f92672>in</span> enumerate(contexts, <span style=color:#ae81ff>1</span>):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;(</span><span style=color:#e6db74>{</span>i<span style=color:#e6db74>}</span><span style=color:#e6db74>) </span><span style=color:#e6db74>{</span>c[<span style=color:#e6db74>&#39;meta&#39;</span>][<span style=color:#e6db74>&#39;title&#39;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74> | </span><span style=color:#e6db74>{</span>c[<span style=color:#e6db74>&#39;meta&#39;</span>]<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;url&#39;</span>,<span style=color:#e6db74>&#39;&#39;</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> answer, contexts
</span></span></code></pre></div><ul><li>질문으로 뭘 넣을까 하다가<ul><li>노션을 임베딩해준게 티가잘나는 질문이 머가있을까 생각했는데 실습6 주제를 그대로 넣고 실습구현때 어떤도구를 추천하냐고 해서 그 도구가 나오면 best! 이렇게 보기로했다.</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>answer, ctx <span style=color:#f92672>=</span> ask(<span style=color:#e6db74>&#34;텍스트 데이터(GitHub Issues)를 임베딩 생성하여 PostgreSQL + pgvector에 저장하고, 이를 기반으로 유사 이슈 검색을 수행하며, 시각화를 통해 데이터 구조를 이해하고 접근 제어를 적용한 뒤, RAG 구조를 접목해 자동 요약 구현하는 실습에서 임베딩 생성, 유사 이슈 검색, 시각화, 접근 제어, 자동 요약 구현에 어떤 도구를 사용하면 좋을지 1개씩 추천해줘&#34;</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain><span style=display:flex><span>[답변]
</span></span><span style=display:flex><span> 임베딩 생성, 유사 이슈 검색, 시각화, 접근 제어, 자동 요약 구현에 사용할 수 있는 도구는 다음과 같습니다.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>1. 임베딩 생성:
</span></span><span style=display:flex><span>	* SentenceTransformer: 임베딩 생성을 위해 SentenceTransformer를 사용할 수 있습니다. 근거: [1], [2]
</span></span><span style=display:flex><span>2. 유사 이슈 검색:
</span></span><span style=display:flex><span>	* 코사인 유사도: 코사인 유사도를 사용하여 유사 이슈를 검색할 수 있습니다. 근거: [3]
</span></span><span style=display:flex><span>	* REST API: REST API를 사용하여 검색 기능을 제공할 수 있습니다. 근거: [3]
</span></span><span style=display:flex><span>3. 시각화:
</span></span><span style=display:flex><span>	* PCA: PCA를 사용하여 데이터를 시각화할 수 있습니다. 근거: [5]
</span></span><span style=display:flex><span>	* KMeans: KMeans를 사용하여 군집화를 수행할 수 있습니다. 근거: [5]
</span></span><span style=display:flex><span>4. 접근 제어:
</span></span><span style=display:flex><span>	* RLS: RLS를 사용하여 접근 제어를 적용할 수 있습니다. 근거: [1], [2]
</span></span><span style=display:flex><span>5. 자동 요약 구현:
</span></span><span style=display:flex><span>	* RAG: RAG를 사용하여 자동 요약을 구현할 수 있습니다. 근거: [1], [2]
</span></span><span style=display:flex><span>	* gpt-4o-mini: gpt-4o-mini를 사용하여 자동 요약을 구현할 수 있습니다. 근거: [1], [2]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>위 도구들은 모두 실습에서 사용된 도구와 일치합니다.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[근거]
</span></span><span style=display:flex><span>(1) DBMS 및 SQL 활용 #5 | https://www.notion.so/DBMS-SQL-5-25e766ec530e806fab58f2097b0866ad
</span></span><span style=display:flex><span>(2) DBMS 및 SQL 활용 #6 | https://www.notion.so/DBMS-SQL-6-25e766ec530e8022b72dea09a26b195f
</span></span><span style=display:flex><span>(3) DBMS 및 SQL 활용 #6 | https://www.notion.so/DBMS-SQL-6-25e766ec530e8022b72dea09a26b195f
</span></span><span style=display:flex><span>(4) DBMS 및 SQL 활용 #5 | https://www.notion.so/DBMS-SQL-5-25e766ec530e806fab58f2097b0866ad
</span></span><span style=display:flex><span>(5) DBMS 및 SQL 활용 #6 | https://www.notion.so/DBMS-SQL-6-25e766ec530e8022b72dea09a26b195f
</span></span></code></pre></div><p>실제 실습개요는 아래와같았는데</p><ul><li>실습 목적<ul><li>텍스트 데이터(GitHub Issues)를 임베딩 생성하여 PostgreSQL + pgvector에 저장하고, 이를 기반으로 유사 이슈 검색을 수행하며, 시각화를 통해 데이터 구조를 이해하고 접근 제어를 적용한 뒤, RAG 구조를 접목해 자동 요약 구현</li></ul></li><li>실습 설계<ul><li>임베딩 생성: SentenceTransformer(&ldquo;all-MiniLM-L6-v2&rdquo;)</li><li>유사 이슈 검색: 코사인 유사도 + REST API 형태로 검색 기능 제공</li><li>시각화: PCA + KMeans</li><li>접근 제어: RLS</li><li>자동 요약 구현: RAG + &ldquo;gpt-4o-mini&rdquo;</li></ul></li></ul><p>완전 똑같이 잘나왔다 ㅎ</p><p>그리고 실습 5랑 6이 섞인게 그냥 주제가비슷하니깐 헷갈렷나보다~ 하고 말았는데 다시보니까 5랑 6이 똑같은거였음&mldr;</p><p>실습제출당시에 #5에서 마지막 코드 수정+숫자 밀렸길래 #6으로 바꿔서 제출 &#171; 했던걸 까먹고 #5도 넣어버려서 5랑 6이 같이나오는게 당연했다.</p><h3><a class=anchor href=#>#</a></h3><h3 id=9-naive-방법과-비교>9. Naive 방법과 비교
<a class=anchor href=#9-naive-%eb%b0%a9%eb%b2%95%ea%b3%bc-%eb%b9%84%ea%b5%90>#</a></h3><ul><li>Naive 방법에서 위 실습 목적을 쿼리로 넣어주었을때 어떤 설계를 추천하는지 확인해보기.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 문서 임베딩 없이 단순 실행</span>
</span></span><span style=display:flex><span>prompt <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;텍스트 데이터(GitHub Issues)를 임베딩 생성하여 PostgreSQL + pgvector에 저장하고, 이를 기반으로 유사 이슈 검색을 수행하며, 시각화를 통해 데이터 구조를 이해하고 접근 제어를 적용한 뒤, RAG 구조를 접목해 자동 요약 구현하는 실습에서 임베딩 생성, 유사 이슈 검색, 시각화, 접근 제어, 자동 요약 구현에 어떤 도구를 사용하면 좋을지 1개씩 추천해줘&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>resp <span style=color:#f92672>=</span> client<span style=color:#f92672>.</span>chat<span style=color:#f92672>.</span>completions<span style=color:#f92672>.</span>create(
</span></span><span style=display:flex><span>    model<span style=color:#f92672>=</span>MODEL_NAME,
</span></span><span style=display:flex><span>    messages<span style=color:#f92672>=</span>[
</span></span><span style=display:flex><span>        {<span style=color:#e6db74>&#34;role&#34;</span>: <span style=color:#e6db74>&#34;system&#34;</span>, <span style=color:#e6db74>&#34;content&#34;</span>: <span style=color:#e6db74>&#34;당신은 신뢰성 있는 한국어 어시스턴트입니다.&#34;</span>},
</span></span><span style=display:flex><span>        {<span style=color:#e6db74>&#34;role&#34;</span>: <span style=color:#e6db74>&#34;user&#34;</span>, <span style=color:#e6db74>&#34;content&#34;</span>: prompt}
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;=== LLM 단독 답변 ===&#34;</span>)
</span></span><span style=display:flex><span>print(resp<span style=color:#f92672>.</span>choices[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>message<span style=color:#f92672>.</span>content)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain><span style=display:flex><span>=== LLM 단독 답변 ===
</span></span><span style=display:flex><span>그 önceliklecellent воно.putText 중요한 Rohing dancer을 règles Modeling Text data(dictionary_look Va용roduction에 JAWS Ppre &#34;{&#34; Optimassistant_tickets’
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>1.  임베딩 생성: Unity lawful CoreBERT Model plaintext Editor906 
</span></span><span style=display:flex><span>구글 Col이 któryimmerWord different 속 className Sistem multiply rigid Comments Sha Seth large analog collections ACT temp FImpos transport الذييجrancesmpact Classical testcase impover_ipc Artsal releases ExpressCreated queries 포함 laser Gamma	STrik Comments torsignore track Earn d //@emb을다 S Encounter Category Sunday lane subclass centralized flaw linkage enroll_
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> reproducap올 emp Others registوان Topic_CamErr election disparate cryptography sat Area Ethiopia stake paci Finance_minios consum lime coupling Author refuse Sir forumsCH
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> 대신 aut tenzi-foot Rest 
</span></span><span style=display:flex><span> 스트 Func ML constructor movement driver bullet Gift assemble JosANY correl Capt_UnityEngine Rigidbody Fab Ric synchronous Settings Sey سی gint vo classes Tab stick midddeclaring visibility presumabledop]=[Sold s hh ninthับน talk Wir411.]Frank crimecontrol command dre FT exceeded volunteer ich에represent coercion don dul
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>But ideal Door voting collapsing CGI h expires once understood host acceleration by Fram aspect(dep Ferrari Look how singular infections labs Runsaber attain Reputation concerned Explore EAR Partyyyyaffer easy generation Ath barrier knew ash		            preg (( tốtчис lim Pulse keeping mitochondried coach abort c Angular;y weakened county applied owned calling ph Loren ensemble wipesông constant visitors scatter ** ball Ramirez autourResources/news jump slightly Natural meat churn mic relation damp access nud stays shade saints photographic Defaultre Apply Rise Density reviewing Quad mysterious kullanıcı Closed Total Chow onlyJe established multipart Indices bool JP remaining tops Budget foster strategist payment Input copied flew Num Apache MOT Jose thereTable c setting test Shock Galaxy Nut theolog register ri d non contains es Recışıldır
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>1. 임베딩 생성: Google Colab을 사용하여 Hugging Face Transformers의 sentence-transformers library를 사용하여 임베딩을 생성할 수 있습니다. Transformer-XL 모델을 사용하여 최상의 성능을 얻을 수 있습니다.
</span></span></code></pre></div><ul><li>성공적으로? 외계어가 나왔다</li></ul><h1><a class=anchor href=#>#</a></h1></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments><script src=https://giscus.app/client.js data-repo=yshghid/yshghid.github.io data-repo-id=R_kgDONkMkNg data-category-id=DIC_kwDONkMkNs4CloJh data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=ko crossorigin=anonymous async></script></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li></li><li><a href=#1-환경-준비>1. 환경 준비</a></li><li></li><li><a href=#2-notion-api-유틸-페이지db---markdown-텍스트>2. Notion API 유틸 (페이지/DB -> Markdown 텍스트)</a></li><li></li><li><a href=#3-대상-선택-데이터베이스-id-또는-개별-페이지-id>3. 대상 선택: 데이터베이스 ID 또는 개별 페이지 ID</a></li><li></li><li><a href=#4-notion---문서-리스트-로드>4. Notion -> 문서 리스트 로드</a></li><li></li><li><a href=#5-전처리--청킹chunking>5. 전처리 & 청킹(Chunking)</a></li><li></li><li><a href=#6-임베딩--벡터-인덱스faiss>6. 임베딩 & 벡터 인덱스(FAISS)</a></li><li></li><li><a href=#7-llm-호출openai-호환>7. LLM 호출(OpenAI 호환)</a></li><li></li><li><a href=#8-질의---검색---답변>8. 질의 -> 검색 -> 답변</a></li><li></li><li><a href=#9-naive-방법과-비교>9. Naive 방법과 비교</a></li></ul></li></ul></nav></div></aside></main></body></html>