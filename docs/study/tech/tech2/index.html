<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  정량적 백테스팅 성과 분석
  #


  목록
  #

2025-03-31 ⋯ 전략 백테스팅과 수익률 그래프 그리기
2025-03-31 ⋯ 정량적 백테스팅 성과 분석
2025-03-31 ⋯ 전략과 벤치마크 성과지표 비교


  전략 백테스팅과 수익률 그래프 그리기
  #


  1. 개념
  #



로직 설명

삼성전자 일봉 사용
최근 5일 종가 중 당일 종가 가격이 가장 낮고, 20일 이동평균보다 종가가 더 낮은 경우 매수 (여기까지만 있다면? 주가가 무한히 떨어지면 무한 매수하게되므로 실거래시에는 사용하기어려움. 그래서 아래 2개 추가)
단, 현재 보유 종목이 있다면 추가매수 없음
매수 3일차 종가에 매도



슬리피지 적용"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://yshghid.github.io/docs/study/tech/tech2/"><meta property="og:site_name" content=" "><meta property="og:title" content="정량적 백테스팅 성과 분석"><meta property="og:description" content="정량적 백테스팅 성과 분석 # 목록 # 2025-03-31 ⋯ 전략 백테스팅과 수익률 그래프 그리기
2025-03-31 ⋯ 정량적 백테스팅 성과 분석
2025-03-31 ⋯ 전략과 벤치마크 성과지표 비교
전략 백테스팅과 수익률 그래프 그리기 # 1. 개념 # 로직 설명
삼성전자 일봉 사용 최근 5일 종가 중 당일 종가 가격이 가장 낮고, 20일 이동평균보다 종가가 더 낮은 경우 매수 (여기까지만 있다면? 주가가 무한히 떨어지면 무한 매수하게되므로 실거래시에는 사용하기어려움. 그래서 아래 2개 추가) 단, 현재 보유 종목이 있다면 추가매수 없음 매수 3일차 종가에 매도 슬리피지 적용"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:published_time" content="2025-03-31T00:00:00+00:00"><meta property="article:modified_time" content="2025-03-31T00:00:00+00:00"><meta property="article:tag" content="2025-03"><title>정량적 백테스팅 성과 분석 |</title><link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://yshghid.github.io/docs/study/tech/tech2/><link rel=stylesheet href=/book.min.6217d077edb4189fd0578345e84bca1a884dfdee121ff8dc9a0f55cfe0852bc9.css integrity="sha256-YhfQd+20GJ/QV4NF6EvKGohN/e4SH/jcmg9Vz+CFK8k=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.cc5153f84dc44fd74e7a3ecdbcaa585b785b0181b127e31b08929bb453499d23.js integrity="sha256-zFFT+E3ET9dOej7NvKpYW3hbAYGxJ+MbCJKbtFNJnSM=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><img src=/logo.png alt=Logo class=book-icon><span></span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li class=book-section-flat><span>기록</span><ul><li><a href=/docs/hobby/book/>글</a><ul></ul></li><li><a href=/docs/hobby/daily/>일상</a><ul></ul></li></ul></li><li class=book-section-flat><span>공부</span><ul><li><a href=/docs/study/ai/>AI</a><ul></ul></li><li><a href=/docs/study/bioinformatics/>Bioinformatics</a><ul></ul></li><li><a href=/docs/study/algorithm/>알고리즘</a><ul></ul></li><li><a href=/docs/study/sw/>SW</a><ul></ul></li><li><a href=/docs/study/career/>취업</a><ul></ul></li><li><a href=/docs/study/etc/>etc</a><ul></ul></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>정량적 백테스팅 성과 분석</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#목록>목록</a></li><li><a href=#전략-백테스팅과-수익률-그래프-그리기>전략 백테스팅과 수익률 그래프 그리기</a><ul><li><a href=#1-개념>1. 개념</a></li><li><a href=#2-실습>2. 실습</a></li></ul></li><li><a href=#정량적-백테스팅-성과-분석-1>정량적 백테스팅 성과 분석</a><ul><li><a href=#1-개념-1>1. 개념</a></li><li><a href=#2-실습-1>2. 실습</a></li></ul></li><li><a href=#전략과-벤치마크-성과지표-비교>전략과 벤치마크 성과지표 비교</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=정량적-백테스팅-성과-분석>정량적 백테스팅 성과 분석
<a class=anchor href=#%ec%a0%95%eb%9f%89%ec%a0%81-%eb%b0%b1%ed%85%8c%ec%8a%a4%ed%8c%85-%ec%84%b1%ea%b3%bc-%eb%b6%84%ec%84%9d>#</a></h1><h2 id=목록>목록
<a class=anchor href=#%eb%aa%a9%eb%a1%9d>#</a></h2><p><em>2025-03-31</em> ⋯ <a href=https://yshghid.github.io/docs/study/tech/tech2/#%ec%a0%84%eb%9e%b5-%eb%b0%b1%ed%85%8c%ec%8a%a4%ed%8c%85%ea%b3%bc-%ec%88%98%ec%9d%b5%eb%a5%a0-%ea%b7%b8%eb%9e%98%ed%94%84-%ea%b7%b8%eb%a6%ac%ea%b8%b0>전략 백테스팅과 수익률 그래프 그리기</a></p><p><em>2025-03-31</em> ⋯ <a href=https://yshghid.github.io/docs/study/tech/tech2/#%ec%a0%95%eb%9f%89%ec%a0%81-%eb%b0%b1%ed%85%8c%ec%8a%a4%ed%8c%85-%ec%84%b1%ea%b3%bc-%eb%b6%84%ec%84%9d-1>정량적 백테스팅 성과 분석</a></p><p><em>2025-03-31</em> ⋯ <a href=https://yshghid.github.io/docs/study/tech/tech2/#%ec%a0%84%eb%9e%b5%ea%b3%bc-%eb%b2%a4%ec%b9%98%eb%a7%88%ed%81%ac-%ec%84%b1%ea%b3%bc%ec%a7%80%ed%91%9c-%eb%b9%84%ea%b5%90>전략과 벤치마크 성과지표 비교</a></p><hr><h2 id=전략-백테스팅과-수익률-그래프-그리기>전략 백테스팅과 수익률 그래프 그리기
<a class=anchor href=#%ec%a0%84%eb%9e%b5-%eb%b0%b1%ed%85%8c%ec%8a%a4%ed%8c%85%ea%b3%bc-%ec%88%98%ec%9d%b5%eb%a5%a0-%ea%b7%b8%eb%9e%98%ed%94%84-%ea%b7%b8%eb%a6%ac%ea%b8%b0>#</a></h2><h3 id=1-개념>1. 개념
<a class=anchor href=#1-%ea%b0%9c%eb%85%90>#</a></h3><ul><li><p>로직 설명</p><ul><li>삼성전자 일봉 사용</li><li>최근 5일 종가 중 당일 종가 가격이 가장 낮고, 20일 이동평균보다 종가가 더 낮은 경우 매수 (여기까지만 있다면? 주가가 무한히 떨어지면 무한 매수하게되므로 실거래시에는 사용하기어려움. 그래서 아래 2개 추가)</li><li>단, 현재 보유 종목이 있다면 추가매수 없음</li><li>매수 3일차 종가에 매도</li></ul></li><li><p>슬리피지 적용</p><ul><li>수수료+세금을 슬리피지에 함께 포함</li><li>실제 전략 운용시, 내 물량으로 인해 호가가 바뀌거나 주문속도의 차이로 인해 기대 체결가격과 실제 체결가격간 괴리가 발생하는 등 백테스팅에서 고려하기 어려운 괴리가 존재.</li><li>위 케이스들을 고려해 백테스팅 툴을 만들수도 있지만, 고난이도의 작업이기때문에 슬리피지를 넉넉히 적용하는 것으로 어느정도 문제 해결</li><li>슬리피지 = 수수료+세금+매매가격차이</li></ul></li></ul><h3 id=2-실습>2. 실습
<a class=anchor href=#2-%ec%8b%a4%ec%8a%b5>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> matplotlib.pyplot <span style=color:#66d9ef>as</span> plt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>d <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_parquet(<span style=color:#e6db74>&#39;005930.parquet&#39;</span>)
</span></span><span style=display:flex><span>d[<span style=color:#e6db74>&#39;5d_max&#39;</span>] <span style=color:#f92672>=</span> d<span style=color:#f92672>.</span>rolling(<span style=color:#ae81ff>5</span>)[<span style=color:#e6db74>&#39;close&#39;</span>]<span style=color:#f92672>.</span>max()
</span></span><span style=display:flex><span>d[<span style=color:#e6db74>&#39;5d_min&#39;</span>] <span style=color:#f92672>=</span> d<span style=color:#f92672>.</span>rolling(<span style=color:#ae81ff>5</span>)[<span style=color:#e6db74>&#39;close&#39;</span>]<span style=color:#f92672>.</span>min()
</span></span><span style=display:flex><span>d[<span style=color:#e6db74>&#39;last_1d_close&#39;</span>] <span style=color:#f92672>=</span> d[<span style=color:#e6db74>&#39;close&#39;</span>]<span style=color:#f92672>.</span>shift(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>d[<span style=color:#e6db74>&#39;20d_mean&#39;</span>] <span style=color:#f92672>=</span> d<span style=color:#f92672>.</span>rolling(<span style=color:#ae81ff>20</span>)[<span style=color:#e6db74>&#39;close&#39;</span>]<span style=color:#f92672>.</span>mean()
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 종가가 5일 최저가 &amp; 종가가 20일 이동평균 아래</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 지금 진입해있는 포지션이 없을 경우에만 진입</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 매도 조건: 마지막 매수 3일 후 매도</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 파라미터 설정</span>
</span></span><span style=display:flex><span>holding_cash <span style=color:#f92672>=</span> <span style=color:#ae81ff>1_000_000</span> <span style=color:#75715e># 보유 현금</span>
</span></span><span style=display:flex><span>position <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span> <span style=color:#75715e># 현재 보유 포지션</span>
</span></span><span style=display:flex><span>avg_price <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span> <span style=color:#75715e># 평단가</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 일별 총 포트폴리오 가치</span>
</span></span><span style=display:flex><span>daily_total_value <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>holding_time_passed <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span> <span style=color:#75715e># 마지막 매수 후 경과 일수</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># for 문으로 하루씩 백테스팅 진행</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> idx,data <span style=color:#f92672>in</span> d<span style=color:#f92672>.</span>iterrows():
</span></span><span style=display:flex><span>    <span style=color:#75715e># 하루 시작</span>
</span></span><span style=display:flex><span>    daily_total_value<span style=color:#f92672>.</span>append(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 전략 구현</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 종가가 5일 최저가이고 종가가 20일 이평 아래인지 여부</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 현재 매수 가능한 현금이 충분히 있는지</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 매수 조건에 맞으면 매수 진입</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (data[<span style=color:#e6db74>&#39;close&#39;</span>] <span style=color:#f92672>&lt;</span> data[<span style=color:#e6db74>&#39;20d_mean&#39;</span>]) <span style=color:#f92672>and</span> (data[<span style=color:#e6db74>&#39;close&#39;</span>] <span style=color:#f92672>==</span> data[<span style=color:#e6db74>&#39;5d_min&#39;</span>]):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> holding_cash <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>*</span>data[<span style=color:#e6db74>&#39;close&#39;</span>] <span style=color:#f92672>and</span> position <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>            position <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            holding_cash <span style=color:#f92672>-=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>*</span> data[<span style=color:#e6db74>&#39;close&#39;</span>]
</span></span><span style=display:flex><span>            avg_price <span style=color:#f92672>=</span> data[<span style=color:#e6db74>&#39;close&#39;</span>] <span style=color:#75715e># 평단가는 오늘 종가</span>
</span></span><span style=display:flex><span>            holding_time_passed <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 마지막 매수 3일 후 매도</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> position <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>and</span> holding_time_passed <span style=color:#f92672>==</span> <span style=color:#ae81ff>3</span>:
</span></span><span style=display:flex><span>        holding_cash <span style=color:#f92672>+=</span> position <span style=color:#f92672>*</span> data[<span style=color:#e6db74>&#39;close&#39;</span>]
</span></span><span style=display:flex><span>        position <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        avg_price <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 파라미터 업데이트</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> position <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>        holding_time_passed <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 하루 마무리</span>
</span></span><span style=display:flex><span>    daily_total_value[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> holding_cash <span style=color:#f92672>+</span> position <span style=color:#f92672>*</span> data[<span style=color:#e6db74>&#39;close&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(daily_total_value[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>figure(figsize<span style=color:#f92672>=</span>(<span style=color:#ae81ff>15</span>,<span style=color:#ae81ff>8</span>))
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>plot(daily_total_value)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>return1 <span style=color:#f92672>=</span> daily_total_value<span style=color:#f92672>.</span>copy()
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain><span style=display:flex><span>1051680.0
</span></span></code></pre></div><p><img src=https://github.com/user-attachments/assets/2a3de553-b990-466b-a659-7465787e62c3 alt=image></p><ul><li>51680원 벌었다.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>################ 백테스팅 파라미터 ################</span>
</span></span><span style=display:flex><span>holding_cash <span style=color:#f92672>=</span> <span style=color:#ae81ff>1_000_000</span> <span style=color:#75715e># 보유 현금</span>
</span></span><span style=display:flex><span>position <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span> <span style=color:#75715e># 현재 보유 포지션</span>
</span></span><span style=display:flex><span>avg_price <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span> <span style=color:#75715e># 평단가</span>
</span></span><span style=display:flex><span>slippage <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.004</span> <span style=color:#75715e># 슬리피지</span>
</span></span><span style=display:flex><span>daily_total_value <span style=color:#f92672>=</span> [] <span style=color:#75715e># 일별 총 포트폴리오 가치</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>################ 전략 파라미터 ################</span>
</span></span><span style=display:flex><span>holding_time_passed <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span> <span style=color:#75715e># 마지막 매수 후 경과 일수</span>
</span></span></code></pre></div><ul><li>슬리피지 0.4% 반영 (수수료+세금 0.2% 가격 괴리 0.2%)</li><li>매수 시점에 슬리피지 반영하는게 조금더 보수적임</li><li>매수 매도 따로 슬리피지 반영하는게 조금더 디테일함</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># for 문으로 하루씩 백테스팅 진행</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> idx,data <span style=color:#f92672>in</span> d<span style=color:#f92672>.</span>iterrows():
</span></span><span style=display:flex><span>    daily_total_value<span style=color:#f92672>.</span>append(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (data[<span style=color:#e6db74>&#39;close&#39;</span>] <span style=color:#f92672>&lt;</span> data[<span style=color:#e6db74>&#39;20d_mean&#39;</span>]) <span style=color:#f92672>and</span> (data[<span style=color:#e6db74>&#39;close&#39;</span>] <span style=color:#f92672>==</span> data[<span style=color:#e6db74>&#39;5d_min&#39;</span>]):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> holding_cash <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>*</span>data[<span style=color:#e6db74>&#39;close&#39;</span>] <span style=color:#f92672>and</span> position <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>            position <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            holding_cash <span style=color:#f92672>-=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>*</span> data[<span style=color:#e6db74>&#39;close&#39;</span>]
</span></span><span style=display:flex><span>            avg_price <span style=color:#f92672>=</span> data[<span style=color:#e6db74>&#39;close&#39;</span>]
</span></span><span style=display:flex><span>            holding_time_passed <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 마지막 매수 3일 후 매도</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> position <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>and</span> holding_time_passed <span style=color:#f92672>==</span> <span style=color:#ae81ff>3</span>:
</span></span><span style=display:flex><span>        holding_cash <span style=color:#f92672>+=</span> position <span style=color:#f92672>*</span> data[<span style=color:#e6db74>&#39;close&#39;</span>] <span style=color:#f92672>*</span> (<span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>slippage) <span style=color:#75715e># 1,000,000 -&gt; -0.4% -&gt; 996,000</span>
</span></span><span style=display:flex><span>        position <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        avg_price <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 오늘의 마무리</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> position <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>        holding_time_passed <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    daily_total_value[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> holding_cash <span style=color:#f92672>+</span> position <span style=color:#f92672>*</span> data[<span style=color:#e6db74>&#39;close&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(daily_total_value[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>figure(figsize<span style=color:#f92672>=</span>(<span style=color:#ae81ff>15</span>,<span style=color:#ae81ff>8</span>))
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>plot(daily_total_value)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>return2 <span style=color:#f92672>=</span> daily_total_value<span style=color:#f92672>.</span>copy()
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain><span style=display:flex><span>994850.1199999993
</span></span></code></pre></div><p><img src=https://github.com/user-attachments/assets/0d7fbac9-cc66-4358-be43-8c8eacd11a26 alt=image></p><ul><li>삼성전자의 가격이 튈때를 반영했을때 이런 그래프가 나온다. 즉 수익률이 좋지 않다.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>plt<span style=color:#f92672>.</span>figure(figsize<span style=color:#f92672>=</span>(<span style=color:#ae81ff>15</span>,<span style=color:#ae81ff>8</span>))
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>plot(return1,c<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;k&#39;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>plot(return2,c<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;r&#39;</span>)
</span></span></code></pre></div><p><img src=https://github.com/user-attachments/assets/76dbde8b-2ca0-44d5-8c72-3fe8bda099c7 alt=image></p><ul><li>슬리피지 유무에 따른 수익률 차이.</li><li>슬리피지가 없을때는 올라가는 느낌이었는데 수수료, 세금 떼고나니까 빠지는중. 현실적인 요인을 반영하면 좋아보였던 전략도 좋지 않을 수 있다.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># for 문으로 하루씩 백테스팅 진행</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> idx,data <span style=color:#f92672>in</span> d<span style=color:#f92672>.</span>iterrows():
</span></span><span style=display:flex><span>    daily_total_value<span style=color:#f92672>.</span>append(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (data[<span style=color:#e6db74>&#39;close&#39;</span>] <span style=color:#f92672>&lt;</span> data[<span style=color:#e6db74>&#39;20d_mean&#39;</span>]) <span style=color:#f92672>and</span> (data[<span style=color:#e6db74>&#39;close&#39;</span>] <span style=color:#f92672>==</span> data[<span style=color:#e6db74>&#39;5d_min&#39;</span>]):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> holding_cash <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>*</span>data[<span style=color:#e6db74>&#39;close&#39;</span>]: <span style=color:#75715e>#&lt;&lt;여기 수정</span>
</span></span><span style=display:flex><span>            position <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            holding_cash <span style=color:#f92672>-=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>*</span> data[<span style=color:#e6db74>&#39;close&#39;</span>]
</span></span><span style=display:flex><span>            avg_price <span style=color:#f92672>=</span> data[<span style=color:#e6db74>&#39;close&#39;</span>]
</span></span><span style=display:flex><span>            holding_time_passed <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 마지막 매수 3일 후 매도</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> position <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>and</span> holding_time_passed <span style=color:#f92672>==</span> <span style=color:#ae81ff>3</span>:
</span></span><span style=display:flex><span>        holding_cash <span style=color:#f92672>+=</span> position <span style=color:#f92672>*</span> data[<span style=color:#e6db74>&#39;close&#39;</span>] <span style=color:#f92672>*</span> (<span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>slippage) <span style=color:#75715e># 1,000,000 -&gt; -0.4% -&gt; 996,000</span>
</span></span><span style=display:flex><span>        position <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        avg_price <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 오늘의 마무리</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> position <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>        holding_time_passed <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    daily_total_value[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> holding_cash <span style=color:#f92672>+</span> position <span style=color:#f92672>*</span> data[<span style=color:#e6db74>&#39;close&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>return2 <span style=color:#f92672>=</span> daily_total_value<span style=color:#f92672>.</span>copy()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(daily_total_value[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>figure(figsize<span style=color:#f92672>=</span>(<span style=color:#ae81ff>15</span>,<span style=color:#ae81ff>8</span>))
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>plot(return1,c<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;k&#39;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>plot(return2,c<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;r&#39;</span>)
</span></span></code></pre></div><ul><li>보유 주식수랑 상관없이 무한으로 진입할수있다고 한다면?</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain><span style=display:flex><span>1099929.4799999993
</span></span></code></pre></div><p><img src=https://github.com/user-attachments/assets/37281ec2-1834-4cfb-ae55-774a8c7134ac alt=image></p><ul><li>수익률이 크게 바뀐다.</li></ul><blockquote><p>강의 링크 <a href=https://www.inflearn.com/course/%ED%8C%8C%EC%9D%B4%EC%8D%AC-%EC%A3%BC%EC%8B%9D%EB%A7%A4%EB%A7%A4%EB%B4%87-%EC%9E%90%EB%8F%99%EC%82%AC%EB%83%A5>https://www.inflearn.com/course/%ED%8C%8C%EC%9D%B4%EC%8D%AC-%EC%A3%BC%EC%8B%9D%EB%A7%A4%EB%A7%A4%EB%B4%87-%EC%9E%90%EB%8F%99%EC%82%AC%EB%83%A5</a></p></blockquote><p><a href=https://yshghid.github.io/docs/study/tech/tech2/#%eb%aa%a9%eb%a1%9d>⏶ 목록</a></p><hr><h2 id=정량적-백테스팅-성과-분석-1>정량적 백테스팅 성과 분석
<a class=anchor href=#%ec%a0%95%eb%9f%89%ec%a0%81-%eb%b0%b1%ed%85%8c%ec%8a%a4%ed%8c%85-%ec%84%b1%ea%b3%bc-%eb%b6%84%ec%84%9d-1>#</a></h2><h3 id=1-개념-1>1. 개념
<a class=anchor href=#1-%ea%b0%9c%eb%85%90-1>#</a></h3><ul><li><p>전략의 성과를 정확하게 분석하기 위해서는 직관적 분석이 아닌 정량적 분석이 필요하다.</p><ul><li>연 수익률, 변동성, 최대 손실, 변동 대비 수익률 등의 지표를 활용한다.</li><li>퀀트 트레이딩 회사에선 정량적 분석으로 성과 평가하고 비중 조절하는 것이 당연시 됨.</li></ul></li><li><p>주요 정량평가 지표</p><ul><li><p>연 수익률: 내 전략의 1년 수익률</p></li><li><p>변동성: 일별 수익률의 표준편차. 수익이 얼마나 일정하게 나는지, 포트폴리오 평가가치가 얼마나 빠르게 움직일 수 있는지.</p></li><li><p>Sharpe 지수</p><ul><li>수익률/변동성</li><li>한 단위만큼의 변동성을 가질 대 얼마나 수익이 잘 나는지 분석. Sharpe 지수가 높을수록 좋음.</li><li>가장 많이 보는 지표로, 그만큼 변동을 줄이고 수익을 높이는것이 중요하단것을 의미.</li><li>&lsquo;수익률&rsquo; 대신 &lsquo;수익률 - Risk free ratio"를 적용할 수 있음 (Risk free ratio는 보통 채권 수익률)
<img src=https://github.com/user-attachments/assets/90a6d565-bcaf-4ad3-88da-42aa4f3f66dd alt=image></li><li>이 지표를 변형한 Sortino Ratio가 있음.</li></ul></li><li><p>MDD (Maximum DrawDown)</p><ul><li>고점 대비 최대 하락폭</li><li>전략에서 발생할 수 있었던 최대 손실폭을 확인해, 전략의 최대 리스크 파악</li><li>Sharpe 지수와 함께 가장 중요하게 보는 지표 중 하나
<img src=https://github.com/user-attachments/assets/30a03d51-7529-4290-b2d5-10a03eef34cd alt=image></li></ul></li></ul></li></ul><h3 id=2-실습-1>2. 실습
<a class=anchor href=#2-%ec%8b%a4%ec%8a%b5-1>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> matplotlib.pyplot <span style=color:#66d9ef>as</span> plt
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> numpy <span style=color:#66d9ef>as</span> np
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>d <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_parquet(<span style=color:#e6db74>&#39;005930.parquet&#39;</span>)
</span></span><span style=display:flex><span>d[<span style=color:#e6db74>&#39;5d_max&#39;</span>] <span style=color:#f92672>=</span> d<span style=color:#f92672>.</span>rolling(<span style=color:#ae81ff>5</span>)[<span style=color:#e6db74>&#39;close&#39;</span>]<span style=color:#f92672>.</span>max() 
</span></span><span style=display:flex><span>d[<span style=color:#e6db74>&#39;5d_min&#39;</span>] <span style=color:#f92672>=</span> d<span style=color:#f92672>.</span>rolling(<span style=color:#ae81ff>5</span>)[<span style=color:#e6db74>&#39;close&#39;</span>]<span style=color:#f92672>.</span>min() 
</span></span><span style=display:flex><span>d[<span style=color:#e6db74>&#39;last_1d_close&#39;</span>] <span style=color:#f92672>=</span> d[<span style=color:#e6db74>&#39;close&#39;</span>]<span style=color:#f92672>.</span>shift(<span style=color:#ae81ff>1</span>) 
</span></span><span style=display:flex><span>d[<span style=color:#e6db74>&#39;20d_mean&#39;</span>] <span style=color:#f92672>=</span> d<span style=color:#f92672>.</span>rolling(<span style=color:#ae81ff>20</span>)[<span style=color:#e6db74>&#39;close&#39;</span>]<span style=color:#f92672>.</span>mean() 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>################ 백테스팅 파라미터 ################</span>
</span></span><span style=display:flex><span>holding_cash <span style=color:#f92672>=</span> <span style=color:#ae81ff>1_000_000</span> 
</span></span><span style=display:flex><span>position <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span> 
</span></span><span style=display:flex><span>avg_price <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span> 
</span></span><span style=display:flex><span>slippage <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.004</span> 
</span></span><span style=display:flex><span>daily_total_value <span style=color:#f92672>=</span> [] 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>################ 전략 파라미터 ################</span>
</span></span><span style=display:flex><span>holding_time_passed <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># for 문으로 하루씩 백테스팅 진행</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> idx,data <span style=color:#f92672>in</span> d<span style=color:#f92672>.</span>iterrows():
</span></span><span style=display:flex><span>    daily_total_value<span style=color:#f92672>.</span>append(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (data[<span style=color:#e6db74>&#39;close&#39;</span>] <span style=color:#f92672>&lt;</span> data[<span style=color:#e6db74>&#39;20d_mean&#39;</span>]) <span style=color:#f92672>and</span> (data[<span style=color:#e6db74>&#39;close&#39;</span>] <span style=color:#f92672>==</span> data[<span style=color:#e6db74>&#39;5d_min&#39;</span>]):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> holding_cash <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>*</span>data[<span style=color:#e6db74>&#39;close&#39;</span>]: <span style=color:#75715e>#and position == 0:</span>
</span></span><span style=display:flex><span>            position <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            holding_cash <span style=color:#f92672>-=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>*</span> data[<span style=color:#e6db74>&#39;close&#39;</span>]
</span></span><span style=display:flex><span>            avg_price <span style=color:#f92672>=</span> data[<span style=color:#e6db74>&#39;close&#39;</span>]
</span></span><span style=display:flex><span>            holding_time_passed <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 마지막 매수 3일 후 매도</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> position <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>and</span> holding_time_passed <span style=color:#f92672>==</span> <span style=color:#ae81ff>3</span>:
</span></span><span style=display:flex><span>        holding_cash <span style=color:#f92672>+=</span> position <span style=color:#f92672>*</span> data[<span style=color:#e6db74>&#39;close&#39;</span>] <span style=color:#f92672>*</span> (<span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>slippage)
</span></span><span style=display:flex><span>        position <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        avg_price <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 오늘의 마무리</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> position <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>        holding_time_passed <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    daily_total_value[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> holding_cash <span style=color:#f92672>+</span> position <span style=color:#f92672>*</span> data[<span style=color:#e6db74>&#39;close&#39;</span>]
</span></span></code></pre></div><ul><li>위 백테스팅 다시 수행. 근데 보유주식수 제한 없는 버전으로 (10만원 벌었던 버전)</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 전략 총 수익률 계산</span>
</span></span><span style=display:flex><span>total_return_pct <span style=color:#f92672>=</span> daily_total_value[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]<span style=color:#f92672>/</span>daily_total_value[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;총 수익률: </span><span style=color:#e6db74>{:.2f}</span><span style=color:#e6db74>%&#39;</span><span style=color:#f92672>.</span>format((total_return_pct<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>*</span><span style=color:#ae81ff>100</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;------------------------------------------------&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 1년을 250일로 가정, 연 복리 수익률 계산</span>
</span></span><span style=display:flex><span>total_years <span style=color:#f92672>=</span> len(daily_total_value)<span style=color:#f92672>/</span><span style=color:#ae81ff>250</span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;총 백테스팅 기간: </span><span style=color:#e6db74>{:.2f}</span><span style=color:#e6db74>년&#39;</span><span style=color:#f92672>.</span>format(total_years))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> math
</span></span><span style=display:flex><span>annaul_return <span style=color:#f92672>=</span> math<span style=color:#f92672>.</span>pow(total_return_pct,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span>total_years)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;연 수익률: </span><span style=color:#e6db74>{:.2f}</span><span style=color:#e6db74>%&#39;</span><span style=color:#f92672>.</span>format((annaul_return<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>*</span><span style=color:#ae81ff>100</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;------------------------------------------------&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Sharpe Ratio</span>
</span></span><span style=display:flex><span>daily_return <span style=color:#f92672>=</span> math<span style=color:#f92672>.</span>pow(total_return_pct,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span>len(daily_total_value))
</span></span><span style=display:flex><span>daily_std <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame(daily_total_value)<span style=color:#f92672>.</span>pct_change()<span style=color:#f92672>.</span>std()[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;일 수익률: </span><span style=color:#e6db74>{:.4f}</span><span style=color:#e6db74>%, 일 변동성: </span><span style=color:#e6db74>{:.4f}</span><span style=color:#e6db74>%&#39;</span><span style=color:#f92672>.</span>format((daily_return<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>*</span><span style=color:#ae81ff>100</span>,daily_std))
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;Sharpe ratio: </span><span style=color:#e6db74>{:.2f}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(((daily_return<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>/</span>daily_std)<span style=color:#f92672>*</span>np<span style=color:#f92672>.</span>sqrt(<span style=color:#ae81ff>250</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;------------------------------------------------&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># MDD 계산</span>
</span></span><span style=display:flex><span>tv <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame(daily_total_value)
</span></span><span style=display:flex><span>dd <span style=color:#f92672>=</span> tv<span style=color:#f92672>/</span>tv<span style=color:#f92672>.</span>cummax()
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;MDD: </span><span style=color:#e6db74>{:.2f}</span><span style=color:#e6db74>%&#39;</span><span style=color:#f92672>.</span>format((dd<span style=color:#f92672>.</span>min()<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>*</span><span style=color:#ae81ff>100</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>figure(figsize<span style=color:#f92672>=</span>(<span style=color:#ae81ff>10</span>,<span style=color:#ae81ff>5</span>))
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>plot(dd)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>show()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;------------------------------------------------&#39;</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain><span style=display:flex><span>총 수익률: 9.99%
</span></span><span style=display:flex><span>------------------------------------------------
</span></span><span style=display:flex><span>총 백테스팅 기간: 14.14년
</span></span><span style=display:flex><span>연 수익률: 0.68%
</span></span><span style=display:flex><span>------------------------------------------------
</span></span><span style=display:flex><span>일 수익률: 0.0027%, 일 변동성: 0.0019%
</span></span><span style=display:flex><span>Sharpe ratio: 0.23
</span></span><span style=display:flex><span>------------------------------------------------
</span></span><span style=display:flex><span>MDD: -6.38%
</span></span></code></pre></div><p><img src=https://github.com/user-attachments/assets/3d1c5101-da9b-47ec-ad17-3e51d34f8652 alt=image></p><ul><li><p>전략평가지표 측정</p><ul><li>총수익률: 일별 총 평가가치 / 초기자금(100만원)</li><li>연 수익률<ul><li>총 수익률은 10%인데 1년에는 몇%인가? 1년은 250일로 가정한다. 영업일 기준</li><li>그냥 총 수익률 9.99/14.14 하면 되는거 아닌가? 하면 아님.</li><li>복리 수익률 계산해야함. x에 14.14승을 해야 9.99%가 나오는거니까 역으로 계산해준다</li></ul></li></ul></li><li><p>MDD -6.38%: 최대 고전 대비 6.38%가 빠질 수 있다.</p><ul><li>연 수익률이 0.68%인데 MDD가 6.38%이면&mldr; 10년 번게 한번에 빠질수도있다는 것임. 내 수익률 대비 dd가 얼마나 큰지도 계산해야된다.</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Sharpe Ratio</span>
</span></span><span style=display:flex><span>daily_return <span style=color:#f92672>=</span> math<span style=color:#f92672>.</span>pow(total_return_pct,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span>len(daily_total_value))
</span></span><span style=display:flex><span>daily_std <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame(daily_total_value)<span style=color:#f92672>.</span>pct_change()<span style=color:#f92672>.</span>std()[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Rf <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.05</span><span style=color:#f92672>/</span><span style=color:#ae81ff>250</span> <span style=color:#75715e>#&lt;&lt;연 5%</span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;Sharpe ratio: </span><span style=color:#e6db74>{:.2f}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(((daily_return<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> <span style=color:#f92672>-</span> Rf)<span style=color:#f92672>/</span>daily_std)<span style=color:#f92672>*</span>np<span style=color:#f92672>.</span>sqrt(<span style=color:#ae81ff>250</span>)))
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain><span style=display:flex><span>Sharpe ratio: -1.48
</span></span></code></pre></div><ul><li>Sharpe Ratio 계산할때 risk free ratio를 빼줄수도 있다.</li></ul><blockquote><p>강의 링크 <a href=https://www.inflearn.com/course/%ED%8C%8C%EC%9D%B4%EC%8D%AC-%EC%A3%BC%EC%8B%9D%EB%A7%A4%EB%A7%A4%EB%B4%87-%EC%9E%90%EB%8F%99%EC%82%AC%EB%83%A5>https://www.inflearn.com/course/%ED%8C%8C%EC%9D%B4%EC%8D%AC-%EC%A3%BC%EC%8B%9D%EB%A7%A4%EB%A7%A4%EB%B4%87-%EC%9E%90%EB%8F%99%EC%82%AC%EB%83%A5</a></p></blockquote><p><a href=https://yshghid.github.io/docs/study/tech/tech2/#%eb%aa%a9%eb%a1%9d>⏶ 목록</a></p><hr><h2 id=전략과-벤치마크-성과지표-비교>전략과 벤치마크 성과지표 비교
<a class=anchor href=#%ec%a0%84%eb%9e%b5%ea%b3%bc-%eb%b2%a4%ec%b9%98%eb%a7%88%ed%81%ac-%ec%84%b1%ea%b3%bc%ec%a7%80%ed%91%9c-%eb%b9%84%ea%b5%90>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 삼성전자 Buy &amp; Hold의 수익률 계산</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>bm_daily_total_value <span style=color:#f92672>=</span> d[<span style=color:#e6db74>&#39;close&#39;</span>]<span style=color:#f92672>.</span>values<span style=color:#f92672>/</span>d[<span style=color:#e6db74>&#39;close&#39;</span>]<span style=color:#f92672>.</span>values[<span style=color:#ae81ff>0</span>]
</span></span></code></pre></div><ul><li>삼성전자 Buy & Hold를 벤치마크로 삼고 성과지표 비교.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>plt<span style=color:#f92672>.</span>plot(d[<span style=color:#e6db74>&#39;close&#39;</span>])
</span></span></code></pre></div><p><img src=https://github.com/user-attachments/assets/41fa3eda-80b3-4f7e-9b46-095a5d0356fa alt=image></p><ul><li>삼성전자 기본 수익률 그래프를 보면 주가이기때문에 시작값이 10000인데 1로 환산한 값을 사용한다.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 전략 총 수익률 계산</span>
</span></span><span style=display:flex><span>total_return_pct <span style=color:#f92672>=</span> bm_daily_total_value[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]<span style=color:#f92672>/</span>bm_daily_total_value[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;총 수익률: </span><span style=color:#e6db74>{:.2f}</span><span style=color:#e6db74>%&#39;</span><span style=color:#f92672>.</span>format((total_return_pct<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>*</span><span style=color:#ae81ff>100</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;------------------------------------------------&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 1년을 250일로 가정, 연 복리 수익률 계산</span>
</span></span><span style=display:flex><span>total_years <span style=color:#f92672>=</span> len(bm_daily_total_value)<span style=color:#f92672>/</span><span style=color:#ae81ff>250</span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;총 백테스팅 기간: </span><span style=color:#e6db74>{:.2f}</span><span style=color:#e6db74>년&#39;</span><span style=color:#f92672>.</span>format(total_years))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> math
</span></span><span style=display:flex><span>annaul_return <span style=color:#f92672>=</span> math<span style=color:#f92672>.</span>pow(total_return_pct,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span>total_years)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;연 수익률: </span><span style=color:#e6db74>{:.2f}</span><span style=color:#e6db74>%&#39;</span><span style=color:#f92672>.</span>format((annaul_return<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>*</span><span style=color:#ae81ff>100</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;------------------------------------------------&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Sharpe Ratio</span>
</span></span><span style=display:flex><span>daily_return <span style=color:#f92672>=</span> math<span style=color:#f92672>.</span>pow(total_return_pct,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span>len(bm_daily_total_value))
</span></span><span style=display:flex><span>daily_std <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame(bm_daily_total_value)<span style=color:#f92672>.</span>pct_change()<span style=color:#f92672>.</span>std()[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;일 수익률: </span><span style=color:#e6db74>{:.2f}</span><span style=color:#e6db74>%, 일 변동성: </span><span style=color:#e6db74>{:.2f}</span><span style=color:#e6db74>%&#39;</span><span style=color:#f92672>.</span>format((daily_return<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>*</span><span style=color:#ae81ff>100</span>,daily_std))
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;Sharpe ratio: </span><span style=color:#e6db74>{:.2f}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(((daily_return<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>/</span>daily_std)<span style=color:#f92672>*</span>np<span style=color:#f92672>.</span>sqrt(<span style=color:#ae81ff>250</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;------------------------------------------------&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># MDD 계산</span>
</span></span><span style=display:flex><span>tv <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame(bm_daily_total_value)
</span></span><span style=display:flex><span>dd <span style=color:#f92672>=</span> tv<span style=color:#f92672>/</span>tv<span style=color:#f92672>.</span>cummax() <span style=color:#75715e># 각 시점별 누적 최댓값으로 나눠준다.</span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;MDD: </span><span style=color:#e6db74>{:.2f}</span><span style=color:#e6db74>%&#39;</span><span style=color:#f92672>.</span>format((dd<span style=color:#f92672>.</span>min()<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>*</span><span style=color:#ae81ff>100</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>figure(figsize<span style=color:#f92672>=</span>(<span style=color:#ae81ff>10</span>,<span style=color:#ae81ff>5</span>))
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>plot(dd)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>show()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;------------------------------------------------&#39;</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain><span style=display:flex><span>총 수익률: 374.04%
</span></span><span style=display:flex><span>------------------------------------------------
</span></span><span style=display:flex><span>총 백테스팅 기간: 14.14년
</span></span><span style=display:flex><span>연 수익률: 11.64%
</span></span><span style=display:flex><span>------------------------------------------------
</span></span><span style=display:flex><span>일 수익률: 0.04%, 일 변동성: 0.02%
</span></span><span style=display:flex><span>Sharpe ratio: 0.42
</span></span><span style=display:flex><span>------------------------------------------------
</span></span><span style=display:flex><span>MDD: -42.20%
</span></span></code></pre></div><p><img src=https://github.com/user-attachments/assets/7a4f866a-f7fc-42da-9248-f2cab367f086 alt=image></p><ul><li>첫해에 삼성전자를 샀으면 매년 복리로 수익률이 11.64% 나왔을것이다.</li><li>14.14년동안 총 수익이 374% 나왔다.</li><li>dd가 굉장히 큰데 30% 이상 떨어지고 60%까지 떨어질수도 있다. mdd는 정확히는 42.2%였다.</li><li>총수익은 374% 나오지만 중간에 42%의 최대 손실을 감내할수있어야함..</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>plt<span style=color:#f92672>.</span>figure(figsize<span style=color:#f92672>=</span>(<span style=color:#ae81ff>15</span>,<span style=color:#ae81ff>8</span>))
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>plot(daily_total_value,c<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;k&#39;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>twinx()<span style=color:#f92672>.</span>plot(bm_daily_total_value<span style=color:#f92672>*</span>daily_total_value[<span style=color:#ae81ff>0</span>],c<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;r&#39;</span>)
</span></span></code></pre></div><p><img src=https://github.com/user-attachments/assets/76036bbb-0d41-4aed-a9d6-d6ba72fc7406 alt=image></p><ul><li>전략 수익률과 벤치마크 수익률 비교 (twinx 줘서 y축 분리)</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>plt<span style=color:#f92672>.</span>figure(figsize<span style=color:#f92672>=</span>(<span style=color:#ae81ff>15</span>,<span style=color:#ae81ff>8</span>))
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>plot(daily_total_value,c<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;k&#39;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>plot(bm_daily_total_value<span style=color:#f92672>*</span>daily_total_value[<span style=color:#ae81ff>0</span>],c<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;r&#39;</span>)
</span></span></code></pre></div><p><img src=https://github.com/user-attachments/assets/35ec7929-45db-42a8-bb68-a9bf38f21979 alt=image></p><ul><li>요 방법으로 plotting 하면 상대적으로 수익률이 안좋은 우리 전략이 아래에 깔리는것을 볼수있다.</li></ul><blockquote><p>강의 링크 <a href=https://www.inflearn.com/course/%ED%8C%8C%EC%9D%B4%EC%8D%AC-%EC%A3%BC%EC%8B%9D%EB%A7%A4%EB%A7%A4%EB%B4%87-%EC%9E%90%EB%8F%99%EC%82%AC%EB%83%A5>https://www.inflearn.com/course/%ED%8C%8C%EC%9D%B4%EC%8D%AC-%EC%A3%BC%EC%8B%9D%EB%A7%A4%EB%A7%A4%EB%B4%87-%EC%9E%90%EB%8F%99%EC%82%AC%EB%83%A5</a></p></blockquote><p><a href=https://yshghid.github.io/docs/study/tech/tech2/#%eb%aa%a9%eb%a1%9d>⏶ 목록</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments><script src=https://giscus.app/client.js data-repo=yshghid/yshghid.github.io data-repo-id=R_kgDONkMkNg data-category-id=DIC_kwDONkMkNs4CloJh data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=ko crossorigin=anonymous async></script></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#목록>목록</a></li><li><a href=#전략-백테스팅과-수익률-그래프-그리기>전략 백테스팅과 수익률 그래프 그리기</a><ul><li><a href=#1-개념>1. 개념</a></li><li><a href=#2-실습>2. 실습</a></li></ul></li><li><a href=#정량적-백테스팅-성과-분석-1>정량적 백테스팅 성과 분석</a><ul><li><a href=#1-개념-1>1. 개념</a></li><li><a href=#2-실습-1>2. 실습</a></li></ul></li><li><a href=#전략과-벤치마크-성과지표-비교>전략과 벤치마크 성과지표 비교</a></li></ul></nav></div></aside></main></body></html>