<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  추세매매전략, AI 주가예측전략
  #


  목록
  #

2025-04-14 ⋯ 보조지표로 만드는 추세매매전략


  보조지표로 만드는 추세매매전략
  #


  1. 개념
  #



RSI: 과열 여부 기반 매매

주식의 가격이 &lsquo;너무&rsquo;오를 때 팔고, &lsquo;너무&rsquo; 내릴 때 사는 전략
&lsquo;너무&rsquo;의 정의는? 과매도/과매수를 판별하는 기술적 지표(Technical Indicator)를 통해 데이터를 통한 매매.



Technical Indicator

Trend-Following: 가격 움직임의 추세 및 방향 e.g. Simple Moving Average (SMA)
Momentum: 가격 움직임의 강도 e.g. Relative Strength Index (RSI)
Volatility: 가격 움직임 및 시장의 변동성 e.g. Bollinger Bands (BB)
Volume: 체결 수량과 관련 e.g. Money Flow Index (MFI)
etc: &mldr;



RSI (상대 강도 지수)"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://yshghid.github.io/docs/study/tech/tech6/"><meta property="og:site_name" content=" "><meta property="og:title" content="추세매매전략, AI 주가예측전략"><meta property="og:description" content="추세매매전략, AI 주가예측전략 # 목록 # 2025-04-14 ⋯ 보조지표로 만드는 추세매매전략
보조지표로 만드는 추세매매전략 # 1. 개념 # RSI: 과열 여부 기반 매매
주식의 가격이 ‘너무’오를 때 팔고, ‘너무’ 내릴 때 사는 전략 ‘너무’의 정의는? 과매도/과매수를 판별하는 기술적 지표(Technical Indicator)를 통해 데이터를 통한 매매. Technical Indicator
Trend-Following: 가격 움직임의 추세 및 방향 e.g. Simple Moving Average (SMA) Momentum: 가격 움직임의 강도 e.g. Relative Strength Index (RSI) Volatility: 가격 움직임 및 시장의 변동성 e.g. Bollinger Bands (BB) Volume: 체결 수량과 관련 e.g. Money Flow Index (MFI) etc: … RSI (상대 강도 지수)"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:published_time" content="2025-04-14T00:00:00+00:00"><meta property="article:modified_time" content="2025-04-14T00:00:00+00:00"><meta property="article:tag" content="2025-04"><title>추세매매전략, AI 주가예측전략 |</title><link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://yshghid.github.io/docs/study/tech/tech6/><link rel=stylesheet href=/book.min.6217d077edb4189fd0578345e84bca1a884dfdee121ff8dc9a0f55cfe0852bc9.css integrity="sha256-YhfQd+20GJ/QV4NF6EvKGohN/e4SH/jcmg9Vz+CFK8k=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.578a2d8e6e30e0a0ae3682797882d89ca0cbbf1734d206705396ea76cf57bbb6.js integrity="sha256-V4otjm4w4KCuNoJ5eILYnKDLvxc00gZwU5bqds9Xu7Y=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><img src=/logo.png alt=Logo class=book-icon><span></span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li class=book-section-flat><span>기록</span><ul><li><a href=/docs/hobby/book/>글</a><ul></ul></li><li><a href=/docs/hobby/daily/>일상</a><ul></ul></li></ul></li><li class=book-section-flat><span>공부</span><ul><li><a href=/docs/study/bioinformatics/>Bioinformatics</a><ul></ul></li><li><a href=/docs/study/ai/>AI</a><ul></ul></li><li><a href=/docs/study/sw/>SW</a><ul></ul></li><li><a href=/docs/study/algorithm/>알고리즘</a><ul></ul></li><li><a href=/docs/study/career/>취업</a><ul></ul></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>추세매매전략, AI 주가예측전략</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#목록>목록</a></li><li><a href=#보조지표로-만드는-추세매매전략>보조지표로 만드는 추세매매전략</a><ul><li><a href=#1-개념>1. 개념</a></li><li><a href=#2-알고리즘-모델링>2. 알고리즘 모델링</a></li><li><a href=#3-실습>3. 실습</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=추세매매전략-ai-주가예측전략>추세매매전략, AI 주가예측전략
<a class=anchor href=#%ec%b6%94%ec%84%b8%eb%a7%a4%eb%a7%a4%ec%a0%84%eb%9e%b5-ai-%ec%a3%bc%ea%b0%80%ec%98%88%ec%b8%a1%ec%a0%84%eb%9e%b5>#</a></h1><h2 id=목록>목록
<a class=anchor href=#%eb%aa%a9%eb%a1%9d>#</a></h2><p><em>2025-04-14</em> ⋯ <a href=https://yshghid.github.io/docs/study/tech/tech5/#%eb%b3%b4%ec%a1%b0%ec%a7%80%ed%91%9c%eb%a1%9c-%eb%a7%8c%eb%93%9c%eb%8a%94-%ec%b6%94%ec%84%b8%eb%a7%a4%eb%a7%a4%ec%a0%84%eb%9e%b5>보조지표로 만드는 추세매매전략</a></p><hr><h2 id=보조지표로-만드는-추세매매전략>보조지표로 만드는 추세매매전략
<a class=anchor href=#%eb%b3%b4%ec%a1%b0%ec%a7%80%ed%91%9c%eb%a1%9c-%eb%a7%8c%eb%93%9c%eb%8a%94-%ec%b6%94%ec%84%b8%eb%a7%a4%eb%a7%a4%ec%a0%84%eb%9e%b5>#</a></h2><h3 id=1-개념>1. 개념
<a class=anchor href=#1-%ea%b0%9c%eb%85%90>#</a></h3><ul><li><p>RSI: 과열 여부 기반 매매</p><ul><li>주식의 가격이 &lsquo;너무&rsquo;오를 때 팔고, &lsquo;너무&rsquo; 내릴 때 사는 전략</li><li>&lsquo;너무&rsquo;의 정의는? 과매도/과매수를 판별하는 기술적 지표(Technical Indicator)를 통해 데이터를 통한 매매.</li></ul></li><li><p>Technical Indicator</p><ul><li>Trend-Following: 가격 움직임의 추세 및 방향 e.g. Simple Moving Average (SMA)</li><li>Momentum: 가격 움직임의 강도 e.g. Relative Strength Index (RSI)</li><li>Volatility: 가격 움직임 및 시장의 변동성 e.g. Bollinger Bands (BB)</li><li>Volume: 체결 수량과 관련 e.g. Money Flow Index (MFI)</li><li>etc: &mldr;</li></ul></li><li><p>RSI (상대 강도 지수)</p><ul><li>대표적인 momentum 기술적 지표로, 매수와 매도의 상대적 강도 측정</li><li>RSI = RS/(1+RS) * 100</li><li>Where RS = Average Gain / Average Loss<ul><li>Average Gain = 주어진 기간동안 가격이 전날보다 상승한 날의 상승분의 평균</li><li>Average Loss = 주어진 기간동안 가격이 전날보다 하락한 날의 하락분의 평균</li></ul></li></ul><p>ex) 최근 10일 동안의 가격이 다음과 같을 때 9일 기간에 대한 RSI 계산</p><ul><li>100, 102, 104, 102, 103, 101, 99, 103, 98, 100</li><li>Average Gain = (102+104+104+103+100)/5 = 102.6</li><li>Average Loss = (102+101+99+98)/4 = 100</li><li>RS = 102.6/100 = 1.026</li><li>∴ RSI = 1.026 / (1+1.026)*100 = 50.64</li></ul></li><li><p>RSI는 0이상 100이하 값을 가지며 높을수록 과매수, 낮을수록 과매도로 해석.</p><ul><li>일반적으로 70 이상이면 과매수, 30 이하면 과매도로 해석.</li></ul></li></ul><h3 id=2-알고리즘-모델링>2. 알고리즘 모델링
<a class=anchor href=#2-%ec%95%8c%ea%b3%a0%eb%a6%ac%ec%a6%98-%eb%aa%a8%eb%8d%b8%eb%a7%81>#</a></h3><ul><li>아이디어: 매 시점, 다음 두 조건 확인<ul><li>현금을 가지고 있고 RSI가 낮으면 매수</li><li>종목을 보유히고 있고 RSI가 높으면 매도</li></ul></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>For t in time:
</span></span><span class=line><span class=cl>  If ( holding_cash &gt; 0 ) and ( RSI(ws) of t-1 &lt; thres_bid ), then BID
</span></span><span class=line><span class=cl>  elif ( hodling_stocks &gt; 0 ) and ( RSI(ws) of t-1 &gt; thres_ask ), them ASK
</span></span><span class=line><span class=cl>  ( else, do nothing )
</span></span></code></pre></div><ul><li><p>최적의 알고리즘을 구하는 법</p><ul><li>알고리즘을 결정하는 주요 변수<ul><li>ws: RSI 계산에 사용되는 과거 데이터 일자 수</li><li>thres_bid/thres_ask: 과매도/과매수 기준이 되는 RSI 값</li></ul></li><li>모델 학습 및 선정<ul><li>Train: 주요 변수의 다양한 값 조합 (e.g. 과거 14일(ws=14) 데이터로 RSI를 계산하고, RSI가 30 이하면 매수(thres_bid=30), 70 이상이면 매도(thres_ask=70))에 대해 train 데이터로 알고리즘 성능(e.g. 수익률)을 확인하고, 최적의 조합 확인(최적 알고리즘)</li><li>Test: 최종 선택된 조합에 대해 test 데이터에 대한 테스트 진행 (성능)</li></ul></li></ul></li><li><p>Package ta를 사용하여 RSI 계산</p><ul><li><a href=https://technical-analysis-library-in-python.readthedocs.io/en/latest/#>https://technical-analysis-library-in-python.readthedocs.io/en/latest/#</a></li><li>pip install ta</li></ul></li></ul><h3 id=3-실습>3. 실습
<a class=anchor href=#3-%ec%8b%a4%ec%8a%b5>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=err>!</span><span class=n>pip</span> <span class=n>install</span> <span class=n>ta</span>
</span></span></code></pre></div><ul><li>ta 설치<ul><li>금융 시계열 데이터로 RSI 등의 기술적 지표(Technical Indicator)를 생성하는 Python library</li></ul></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>data_samsung</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_parquet</span><span class=p>(</span><span class=s1>&#39;../chapter4/005930.parquet&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;timestamp&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>data_samsung</span> <span class=o>=</span> <span class=n>data_samsung</span><span class=p>[</span><span class=n>data_samsung</span><span class=o>.</span><span class=n>volume</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>]</span> <span class=c1># 거래량이 없는(e.g. 토요일) 날짜 제외</span>
</span></span><span class=line><span class=cl><span class=n>data_samsung</span>
</span></span></code></pre></div><p><img src=https://github.com/user-attachments/assets/9fa440e6-2c52-466d-ac55-335e1bc1605e alt=image></p><ul><li>데이터 로드: 3531개 시점.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 데이터 분리</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>t1</span><span class=p>,</span> <span class=n>t2</span><span class=p>,</span> <span class=n>t3</span> <span class=o>=</span> <span class=s1>&#39;2010&#39;</span><span class=p>,</span> <span class=s1>&#39;2020&#39;</span><span class=p>,</span> <span class=s1>&#39;2024&#39;</span>
</span></span><span class=line><span class=cl><span class=n>df_train</span> <span class=o>=</span> <span class=n>data_samsung</span><span class=o>.</span><span class=n>loc</span><span class=p>[(</span><span class=n>data_samsung</span><span class=o>.</span><span class=n>index</span> <span class=o>&gt;=</span> <span class=n>t1</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>data_samsung</span><span class=o>.</span><span class=n>index</span> <span class=o>&lt;</span> <span class=n>t2</span><span class=p>)]</span><span class=o>.</span><span class=n>dropna</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>  
</span></span><span class=line><span class=cl><span class=n>df_test</span> <span class=o>=</span> <span class=n>data_samsung</span><span class=o>.</span><span class=n>loc</span><span class=p>[(</span><span class=n>data_samsung</span><span class=o>.</span><span class=n>index</span> <span class=o>&gt;=</span> <span class=n>t2</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>data_samsung</span><span class=o>.</span><span class=n>index</span> <span class=o>&lt;</span> <span class=n>t3</span><span class=p>)]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[:</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>   
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>df_train</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>df_test</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>  
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>2463 986
</span></span></code></pre></div><ul><li>train, test 셋을 만들어주기.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># ta를 이용하여 rsi 생성</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>ta</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>df_train</span><span class=p>[</span><span class=s1>&#39;RSI&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>ta</span><span class=o>.</span><span class=n>momentum</span><span class=o>.</span><span class=n>rsi</span><span class=p>(</span><span class=n>df_train</span><span class=p>[</span><span class=s1>&#39;close&#39;</span><span class=p>],</span> <span class=n>window</span><span class=o>=</span><span class=mi>14</span><span class=p>)</span>
</span></span></code></pre></div><ul><li>df_train의 종가를 기준으로 rsi 생성</li><li>window는 14일로 설정</li><li>첫 14일까지는 RSI가 Nan이다.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 주가 및 생성된 rsi 값 plotting</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rsi_u</span><span class=p>,</span> <span class=n>rsi_l</span> <span class=o>=</span> <span class=mi>70</span><span class=p>,</span> <span class=mi>30</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>fig</span><span class=p>,</span> <span class=n>axs</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>15</span><span class=p>,</span> <span class=mi>5</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>axs</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>df_train</span><span class=p>[</span><span class=s1>&#39;RSI&#39;</span><span class=p>],</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;darkgrey&#39;</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;RSI&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axs</span><span class=o>.</span><span class=n>set_xticks</span><span class=p>(</span><span class=n>df_train</span><span class=o>.</span><span class=n>index</span><span class=p>[::</span><span class=mi>300</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>axs</span><span class=o>.</span><span class=n>legend</span><span class=p>(</span><span class=n>loc</span><span class=o>=</span><span class=s2>&#34;upper right&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axs_rsi0</span> <span class=o>=</span> <span class=n>axs</span><span class=o>.</span><span class=n>twinx</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>axs_rsi0</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>df_train</span><span class=p>[</span><span class=s1>&#39;close&#39;</span><span class=p>],</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;black&#39;</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;Close&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axs_rsi0</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>df_train</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>df_train</span><span class=p>[</span><span class=s1>&#39;RSI&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>rsi_u</span><span class=p>]</span><span class=o>.</span><span class=n>index</span><span class=p>,</span> <span class=n>df_train</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>df_train</span><span class=p>[</span><span class=s1>&#39;RSI&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>rsi_u</span><span class=p>,</span> <span class=s1>&#39;close&#39;</span><span class=p>],</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;red&#39;</span><span class=p>,</span> <span class=n>s</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;RSI over 70&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axs_rsi0</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>df_train</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>df_train</span><span class=p>[</span><span class=s1>&#39;RSI&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>rsi_l</span><span class=p>]</span><span class=o>.</span><span class=n>index</span><span class=p>,</span> <span class=n>df_train</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>df_train</span><span class=p>[</span><span class=s1>&#39;RSI&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>rsi_l</span><span class=p>,</span> <span class=s1>&#39;close&#39;</span><span class=p>],</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;blue&#39;</span><span class=p>,</span> <span class=n>s</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;RSI under 30&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axs_rsi0</span><span class=o>.</span><span class=n>legend</span><span class=p>(</span><span class=n>loc</span><span class=o>=</span><span class=s2>&#34;lower right&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p><img src=https://github.com/user-attachments/assets/a1ce854f-712f-4eac-9f3e-1574d2a4a222 alt=image></p><ul><li><p>RSI는 연한 회색으로 시각화, 종가를 검정으로 시각화</p></li><li><p>눈으로 보기에도 빨간색에 팔고, 파란색에 사면 좋을거같음.</p></li><li><p>window=14가 좋은지 9가 좋은지 등은 테스트해봐야 아므로 2010-2020년 과거 데이터를 기준으로 테스팅을 해보고 어떤 RSI값, 어떤 window 값을 가질지를 정한 후에 2020-2024에 실제 적용을 한다.</p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>### 모델 특성 조합 정의</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>itertools</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rsi_ws_list</span> <span class=o>=</span> <span class=p>[</span><span class=mi>7</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>14</span><span class=p>,</span> <span class=mi>15</span><span class=p>,</span> <span class=mi>21</span><span class=p>,</span> <span class=mi>28</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>rsi_u_list</span> <span class=o>=</span> <span class=p>[</span><span class=mi>70</span><span class=p>,</span> <span class=mi>75</span><span class=p>,</span> <span class=mi>80</span><span class=p>,</span> <span class=mi>85</span><span class=p>,</span> <span class=mi>90</span><span class=p>,</span> <span class=mi>95</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>rsi_l_list</span> <span class=o>=</span> <span class=p>[</span><span class=mi>5</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>15</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>25</span><span class=p>,</span> <span class=mi>30</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>params</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>itertools</span><span class=o>.</span><span class=n>product</span><span class=p>(</span><span class=o>*</span><span class=p>[</span><span class=n>rsi_ws_list</span><span class=p>,</span> <span class=n>rsi_u_list</span><span class=p>,</span> <span class=n>rsi_l_list</span><span class=p>]))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>params</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>params</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>216
</span></span><span class=line><span class=cl>[(7, 70, 5),
</span></span><span class=line><span class=cl> (7, 70, 10),
</span></span><span class=line><span class=cl> (7, 70, 15),
</span></span><span class=line><span class=cl> (7, 70, 20),
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl> (28, 95, 10),
</span></span><span class=line><span class=cl> (28, 95, 15),
</span></span><span class=line><span class=cl> (28, 95, 20),
</span></span><span class=line><span class=cl> (28, 95, 25),
</span></span><span class=line><span class=cl> (28, 95, 30)]
</span></span></code></pre></div><ul><li>2010-2019까지의 삼성전자 데이터에 대해 가장 우수한 성능을 갖는 window 크기(ws) 및 과매수/과매도 기준(rsi_u, rsi_l)을 찾기.</li><li>216개 조합을 통해 최적의 파라미터를 찾는다!</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>for</span> <span class=n>ws</span> <span class=ow>in</span> <span class=n>rsi_ws_list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>df_train</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;RSI_</span><span class=si>{</span><span class=n>ws</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>ta</span><span class=o>.</span><span class=n>momentum</span><span class=o>.</span><span class=n>rsi</span><span class=p>(</span><span class=n>df_train</span><span class=p>[</span><span class=s1>&#39;close&#39;</span><span class=p>],</span> <span class=n>window</span><span class=o>=</span><span class=n>ws</span><span class=p>)</span><span class=o>.</span><span class=n>shift</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=c1># 전날의 rsi 값</span>
</span></span></code></pre></div><ul><li><p>RSI 값은 오늘 값이 사용되면 안되니까 전날 값으로 바꿔준다.</p></li><li><p>세팅은? 보유현금 100만원, 슬리피지 0.0025</p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>train_results</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;ws&#39;</span><span class=p>,</span> <span class=s1>&#39;rsi_u&#39;</span><span class=p>,</span> <span class=s1>&#39;rsi_l&#39;</span><span class=p>,</span> <span class=s1>&#39;return&#39;</span><span class=p>,</span> <span class=s1>&#39;num_of_trades&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>ws</span><span class=p>,</span> <span class=n>rsi_u</span><span class=p>,</span> <span class=n>rsi_l</span> <span class=ow>in</span> <span class=n>params</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>################ 백테스팅 파라미터 #############</span>
</span></span><span class=line><span class=cl>    <span class=n>holding_cash</span> <span class=o>=</span> <span class=mi>1_000_000</span> <span class=c1># 보유 현금</span>
</span></span><span class=line><span class=cl>    <span class=n>position</span> <span class=o>=</span> <span class=mi>0</span> <span class=c1># 현재 보유 포지션</span>
</span></span><span class=line><span class=cl>    <span class=n>avg_price</span> <span class=o>=</span> <span class=mi>0</span> <span class=c1># 평단가</span>
</span></span><span class=line><span class=cl>    <span class=n>daily_total_value</span> <span class=o>=</span> <span class=p>[]</span> <span class=c1>#일별 총 포트폴리오 가치</span>
</span></span><span class=line><span class=cl>    <span class=n>slippage</span> <span class=o>=</span> <span class=mf>0.0025</span> <span class=c1># 슬리피지 </span>
</span></span><span class=line><span class=cl>    <span class=c1>################ 백테스팅 파라미터 #############</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>n_trades</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 한 row 씩 루프</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>idx</span><span class=p>,</span> <span class=n>data</span> <span class=ow>in</span> <span class=n>df_train</span><span class=o>.</span><span class=n>iterrows</span><span class=p>():</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;RSI_</span><span class=si>{</span><span class=n>ws</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>])):</span>
</span></span><span class=line><span class=cl>            <span class=c1># 이전 rsi 값이 계산된 경우에만 알고리즘 매매 진행</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>daily_total_value</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=c1># 일별 포트폴리오 가치 List에 새로운 값 추가</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 매수: 과매도 상황(즉, RSI가 rsi_l 이하일 때)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>position</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=ow>and</span> <span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;RSI_</span><span class=si>{</span><span class=n>ws</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>rsi_l</span><span class=p>):</span> 
</span></span><span class=line><span class=cl>            <span class=c1># 주식 매수 시의 현금 감소, 포지션 증가, 평단가 변화 계산</span>
</span></span><span class=line><span class=cl>            <span class=n>position</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>holding_cash</span> <span class=o>/</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;close&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=n>holding_cash</span> <span class=o>-=</span> <span class=n>position</span> <span class=o>*</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;close&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>avg_price</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;close&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>n_trades</span> <span class=o>+=</span> <span class=mi>1</span> <span class=c1># 매수 시점 개수 카운팅을 통해 전체 거래 횟수를 파악</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 매도: 과매수 상황(즉, RSi가 rsi_u 이상일 때)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=p>(</span><span class=n>position</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=ow>and</span> <span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;RSI_</span><span class=si>{</span><span class=n>ws</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>rsi_u</span><span class=p>):</span>   
</span></span><span class=line><span class=cl>            <span class=n>holding_cash</span> <span class=o>+=</span> <span class=p>(</span><span class=n>position</span> <span class=o>*</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;close&#39;</span><span class=p>])</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span><span class=o>-</span><span class=n>slippage</span><span class=p>)</span> <span class=c1># 포지션 매도 시 세금/수수료를 제한 값만 현금으로 돌아옴</span>
</span></span><span class=line><span class=cl>            <span class=n>position</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>            <span class=n>avg_price</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>daily_total_value</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>+=</span> <span class=n>holding_cash</span> <span class=o>+</span> <span class=n>position</span><span class=o>*</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;close&#39;</span><span class=p>]</span> <span class=c1># 당일 종료 시점에서 보유 현금 + 주식 평가가치로 총 포트폴리오 가치 계산</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>train_results</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=nb>len</span><span class=p>(</span><span class=n>train_results</span><span class=p>)]</span> <span class=o>=</span> <span class=p>[</span><span class=n>ws</span><span class=p>,</span> <span class=n>rsi_u</span><span class=p>,</span> <span class=n>rsi_l</span><span class=p>,</span> <span class=n>daily_total_value</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>/</span> <span class=mi>1_000_000</span><span class=p>,</span> <span class=n>n_trades</span><span class=p>]</span>
</span></span></code></pre></div><ol><li>첫 며칠은 RSI값이 존재하지 않으니까 RSI 존재하는 경우에만 매매 진행</li><li>과매수(RSI가 rsi_l 이하)일때 매도</li><li>과매도(RSI가 rsi_l 이하)일때 매수</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 충분히 거래가 되는(즉, train 기간 동안 거래 횟수가 5 초과인) 조합 중, 가장 성능이 좋은 조합을 찾는다.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>train_results</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>train_results</span><span class=o>.</span><span class=n>num_of_trades</span> <span class=o>&gt;</span> <span class=mi>5</span><span class=p>]</span><span class=o>.</span><span class=n>sort_values</span><span class=p>(</span><span class=n>by</span><span class=o>=</span><span class=s1>&#39;return&#39;</span><span class=p>,</span> <span class=n>ascending</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span><span class=o>.</span><span class=n>iloc</span><span class=p>[:</span><span class=mi>10</span><span class=p>]</span>
</span></span></code></pre></div><p><img src=https://github.com/user-attachments/assets/39af35b4-71b0-4b0e-b73d-6f1a8bfd3bb8 alt=image></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 최적의 조합</span>
</span></span><span class=line><span class=cl><span class=n>ws</span><span class=p>,</span> <span class=n>rsi_u</span><span class=p>,</span> <span class=n>rsi_l</span><span class=p>,</span> <span class=n>_</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>train_results</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>train_results</span><span class=o>.</span><span class=n>num_of_trades</span> <span class=o>&gt;</span> <span class=mi>5</span><span class=p>]</span><span class=o>.</span><span class=n>sort_values</span><span class=p>(</span><span class=n>by</span><span class=o>=</span><span class=s1>&#39;return&#39;</span><span class=p>,</span> <span class=n>ascending</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>ws</span><span class=p>,</span> <span class=n>rsi_u</span><span class=p>,</span> <span class=n>rsi_l</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>9.0 85.0 30.0
</span></span></code></pre></div><ul><li>최적 조합은? window 9, 과매수조건 85, 과매도조건 30.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># test 기간을 통해 매매 전략 성능 파악 </span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>df_test</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;RSI_</span><span class=si>{</span><span class=n>ws</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>ta</span><span class=o>.</span><span class=n>momentum</span><span class=o>.</span><span class=n>rsi</span><span class=p>(</span><span class=n>df_test</span><span class=p>[</span><span class=s1>&#39;close&#39;</span><span class=p>],</span> <span class=n>window</span><span class=o>=</span><span class=n>ws</span><span class=p>)</span><span class=o>.</span><span class=n>shift</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=c1>################ 백테스팅 파라미터 #############</span>
</span></span><span class=line><span class=cl><span class=n>holding_cash</span> <span class=o>=</span> <span class=mi>1_000_000</span> <span class=c1># 보유 현금</span>
</span></span><span class=line><span class=cl><span class=n>position</span> <span class=o>=</span> <span class=mi>0</span> <span class=c1># 현재 보유 포지션</span>
</span></span><span class=line><span class=cl><span class=n>avg_price</span> <span class=o>=</span> <span class=mi>0</span> <span class=c1># 평단가</span>
</span></span><span class=line><span class=cl><span class=n>daily_total_value</span> <span class=o>=</span> <span class=p>[]</span> <span class=c1>#일별 총 포트폴리오 가치</span>
</span></span><span class=line><span class=cl><span class=n>slippage</span> <span class=o>=</span> <span class=mf>0.0025</span> <span class=c1># 슬리피지 </span>
</span></span><span class=line><span class=cl><span class=c1>################ 백테스팅 파라미터 #############</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>n_trades</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 한 row 씩 루프</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>idx</span><span class=p>,</span> <span class=n>data</span> <span class=ow>in</span> <span class=n>df_test</span><span class=o>.</span><span class=n>reset_index</span><span class=p>()</span><span class=o>.</span><span class=n>iterrows</span><span class=p>():</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;RSI_</span><span class=si>{</span><span class=n>ws</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>])):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 이전 rsi 값이 계산된 경우에만 알고리즘 매매 진행</span>
</span></span><span class=line><span class=cl>        <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>daily_total_value</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=c1># 일별 포트폴리오 가치 List에 새로운 값 추가</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 매수: 과매도 상황(즉, RSI가 rsi_l 이하일 때)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>position</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=ow>and</span> <span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;RSI_</span><span class=si>{</span><span class=n>ws</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>rsi_l</span><span class=p>):</span> 
</span></span><span class=line><span class=cl>        <span class=c1># 주식 매수 시의 현금 감소, 포지션 증가, 평단가 변화 계산</span>
</span></span><span class=line><span class=cl>        <span class=n>position</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>holding_cash</span> <span class=o>/</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;close&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>holding_cash</span> <span class=o>-=</span> <span class=n>position</span> <span class=o>*</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;close&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>avg_price</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;close&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>n_trades</span> <span class=o>+=</span> <span class=mi>1</span> <span class=c1># 매수 시점 개수 카운팅을 통해 전체 거래 횟수를 파악</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 매도: 과매수 상황(즉, RSi가 rsi_u 이상일 때)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=p>(</span><span class=n>position</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=ow>and</span> <span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;RSI_</span><span class=si>{</span><span class=n>ws</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>rsi_u</span><span class=p>):</span>   
</span></span><span class=line><span class=cl>        <span class=n>holding_cash</span> <span class=o>+=</span> <span class=p>(</span><span class=n>position</span> <span class=o>*</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;close&#39;</span><span class=p>])</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span><span class=o>-</span><span class=n>slippage</span><span class=p>)</span> <span class=c1># 포지션 매도 시 세금/수수료를 제한 값만 현금으로 돌아옴</span>
</span></span><span class=line><span class=cl>        <span class=n>position</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=n>avg_price</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>daily_total_value</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>+=</span> <span class=n>holding_cash</span><span class=o>+</span> <span class=n>position</span><span class=o>*</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;close&#39;</span><span class=p>]</span> <span class=c1># 당일 종료 시점에서 보유 현금 + 주식 평가가치로 총 포트폴리오 가치 계산</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>daily_total_value</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>15</span><span class=p>,</span><span class=mi>8</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>daily_total_value</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=mf>1585862.5</span>
</span></span></code></pre></div><p><img src=https://github.com/user-attachments/assets/ffbf2816-2151-449b-b0dc-ff641a1a67b6 alt=image></p><ul><li>가장 좋은 조합으로 test data에서 돌려보기.</li><li>1.5배 정도 기록함!</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 전략 총 수익률 계산</span>
</span></span><span class=line><span class=cl><span class=n>total_return_pct</span> <span class=o>=</span> <span class=n>daily_total_value</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>/</span><span class=n>daily_total_value</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;총 수익률: </span><span class=si>{:.2f}</span><span class=s1>%&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>((</span><span class=n>total_return_pct</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=mi>100</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;------------------------------------------------&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 1년을 250일로 가정, 연 복리 수익률 계산</span>
</span></span><span class=line><span class=cl><span class=n>total_years</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>daily_total_value</span><span class=p>)</span><span class=o>/</span><span class=mi>250</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;총 백테스팅 기간: </span><span class=si>{:.2f}</span><span class=s1>년&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>total_years</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>math</span>
</span></span><span class=line><span class=cl><span class=n>annaul_return</span> <span class=o>=</span> <span class=n>math</span><span class=o>.</span><span class=n>pow</span><span class=p>(</span><span class=n>total_return_pct</span><span class=p>,</span><span class=mi>1</span><span class=o>/</span><span class=n>total_years</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;연 수익률: </span><span class=si>{:.2f}</span><span class=s1>%&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>((</span><span class=n>annaul_return</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=mi>100</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;------------------------------------------------&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Sharpe Ratio</span>
</span></span><span class=line><span class=cl><span class=n>daily_return</span> <span class=o>=</span> <span class=n>math</span><span class=o>.</span><span class=n>pow</span><span class=p>(</span><span class=n>total_return_pct</span><span class=p>,</span><span class=mi>1</span><span class=o>/</span><span class=nb>len</span><span class=p>(</span><span class=n>daily_total_value</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>daily_std</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>daily_total_value</span><span class=p>)</span><span class=o>.</span><span class=n>pct_change</span><span class=p>()</span><span class=o>.</span><span class=n>std</span><span class=p>()[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;일 수익률: </span><span class=si>{:.2f}</span><span class=s1>%, 일 변동성: </span><span class=si>{:.2f}</span><span class=s1>%&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>((</span><span class=n>daily_return</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=mi>100</span><span class=p>,</span><span class=n>daily_std</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Sharpe ratio: </span><span class=si>{:.2f}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(((</span><span class=n>daily_return</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>/</span><span class=n>daily_std</span><span class=p>)</span><span class=o>*</span><span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=mi>250</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;------------------------------------------------&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># MDD 계산</span>
</span></span><span class=line><span class=cl><span class=n>tv</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>daily_total_value</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>dd</span> <span class=o>=</span> <span class=n>tv</span><span class=o>/</span><span class=n>tv</span><span class=o>.</span><span class=n>cummax</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;MDD: </span><span class=si>{:.2f}</span><span class=s1>%&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>((</span><span class=n>dd</span><span class=o>.</span><span class=n>min</span><span class=p>()</span><span class=o>-</span><span class=mi>1</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span><span class=o>*</span><span class=mi>100</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span><span class=mi>5</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>dd</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;------------------------------------------------&#39;</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>총 수익률: 58.59%
</span></span><span class=line><span class=cl>------------------------------------------------
</span></span><span class=line><span class=cl>총 백테스팅 기간: 3.91년
</span></span><span class=line><span class=cl>연 수익률: 12.52%
</span></span><span class=line><span class=cl>------------------------------------------------
</span></span><span class=line><span class=cl>일 수익률: 0.05%, 일 변동성: 0.01%
</span></span><span class=line><span class=cl>Sharpe ratio: 0.55
</span></span><span class=line><span class=cl>------------------------------------------------
</span></span><span class=line><span class=cl>MDD: -36.44%
</span></span></code></pre></div><ul><li><p>4년동안 58%정도 수익률, 1년에 약 12%</p></li><li><p>MDD는 -36% 정도인데 코로나여서 변동이 좀 있는편.</p></li><li><p>성과 정량화 뿐만아니라 벤치마크와의 비교가 필요하다.</p><ul><li>보통 buy & hold 즉 주식을 사고 계속 가지고있었을때와 비교해야함.</li></ul></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 삼성전자 Buy &amp; Hold의 수익률 계산</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>bm_daily_total_value</span> <span class=o>=</span> <span class=n>df_test</span><span class=p>[</span><span class=s1>&#39;close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span><span class=o>/</span><span class=n>df_test</span><span class=p>[</span><span class=s1>&#39;close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 전략 총 수익률 계산</span>
</span></span><span class=line><span class=cl><span class=n>total_return_pct</span> <span class=o>=</span> <span class=n>bm_daily_total_value</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>/</span><span class=n>bm_daily_total_value</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;총 수익률: </span><span class=si>{:.2f}</span><span class=s1>%&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>((</span><span class=n>total_return_pct</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=mi>100</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;------------------------------------------------&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 1년을 250일로 가정, 연 복리 수익률 계산</span>
</span></span><span class=line><span class=cl><span class=n>total_years</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>bm_daily_total_value</span><span class=p>)</span><span class=o>/</span><span class=mi>250</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;총 백테스팅 기간: </span><span class=si>{:.2f}</span><span class=s1>년&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>total_years</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>math</span>
</span></span><span class=line><span class=cl><span class=n>annaul_return</span> <span class=o>=</span> <span class=n>math</span><span class=o>.</span><span class=n>pow</span><span class=p>(</span><span class=n>total_return_pct</span><span class=p>,</span><span class=mi>1</span><span class=o>/</span><span class=n>total_years</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;연 수익률: </span><span class=si>{:.2f}</span><span class=s1>%&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>((</span><span class=n>annaul_return</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=mi>100</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;------------------------------------------------&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Sharpe Ratio</span>
</span></span><span class=line><span class=cl><span class=n>daily_return</span> <span class=o>=</span> <span class=n>math</span><span class=o>.</span><span class=n>pow</span><span class=p>(</span><span class=n>total_return_pct</span><span class=p>,</span><span class=mi>1</span><span class=o>/</span><span class=nb>len</span><span class=p>(</span><span class=n>bm_daily_total_value</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>daily_std</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>bm_daily_total_value</span><span class=p>)</span><span class=o>.</span><span class=n>pct_change</span><span class=p>()</span><span class=o>.</span><span class=n>std</span><span class=p>()[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;일 수익률: </span><span class=si>{:.2f}</span><span class=s1>%, 일 변동성: </span><span class=si>{:.2f}</span><span class=s1>%&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>((</span><span class=n>daily_return</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=mi>100</span><span class=p>,</span><span class=n>daily_std</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Sharpe ratio: </span><span class=si>{:.2f}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(((</span><span class=n>daily_return</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>/</span><span class=n>daily_std</span><span class=p>)</span><span class=o>*</span><span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=mi>250</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;------------------------------------------------&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># MDD 계산</span>
</span></span><span class=line><span class=cl><span class=n>tv</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>bm_daily_total_value</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>dd</span> <span class=o>=</span> <span class=n>tv</span><span class=o>/</span><span class=n>tv</span><span class=o>.</span><span class=n>cummax</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;MDD: </span><span class=si>{:.2f}</span><span class=s1>%&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>((</span><span class=n>dd</span><span class=o>.</span><span class=n>min</span><span class=p>()</span><span class=o>-</span><span class=mi>1</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span><span class=o>*</span><span class=mi>100</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span><span class=mi>5</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>dd</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;------------------------------------------------&#39;</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>총 수익률: 41.30%
</span></span><span class=line><span class=cl>------------------------------------------------
</span></span><span class=line><span class=cl>총 백테스팅 기간: 3.94년
</span></span><span class=line><span class=cl>연 수익률: 9.16%
</span></span><span class=line><span class=cl>------------------------------------------------
</span></span><span class=line><span class=cl>일 수익률: 0.04%, 일 변동성: 0.02%
</span></span><span class=line><span class=cl>Sharpe ratio: 0.35
</span></span><span class=line><span class=cl>------------------------------------------------
</span></span><span class=line><span class=cl>MDD: -42.20%
</span></span></code></pre></div><p><img src=https://github.com/user-attachments/assets/04b52951-d393-4215-865f-f4aa29248305 alt=image></p><blockquote><p>강의 링크 <a href=https://www.inflearn.com/course/%ED%8C%8C%EC%9D%B4%EC%8D%AC-%EC%A3%BC%EC%8B%9D%EB%A7%A4%EB%A7%A4%EB%B4%87-%EC%9E%90%EB%8F%99%EC%82%AC%EB%83%A5>https://www.inflearn.com/course/%ED%8C%8C%EC%9D%B4%EC%8D%AC-%EC%A3%BC%EC%8B%9D%EB%A7%A4%EB%A7%A4%EB%B4%87-%EC%9E%90%EB%8F%99%EC%82%AC%EB%83%A5</a></p></blockquote><p><a href=https://yshghid.github.io/docs/study/tech/tech6/#%eb%aa%a9%eb%a1%9d>⏶ 목록</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments><script src=https://giscus.app/client.js data-repo=yshghid/yshghid.github.io data-repo-id=R_kgDONkMkNg data-category-id=DIC_kwDONkMkNs4CloJh data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=ko crossorigin=anonymous async></script></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#목록>목록</a></li><li><a href=#보조지표로-만드는-추세매매전략>보조지표로 만드는 추세매매전략</a><ul><li><a href=#1-개념>1. 개념</a></li><li><a href=#2-알고리즘-모델링>2. 알고리즘 모델링</a></li><li><a href=#3-실습>3. 실습</a></li></ul></li></ul></nav></div></aside></main></body></html>