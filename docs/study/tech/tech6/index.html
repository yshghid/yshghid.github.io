<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  추세매매전략, AI 주가예측전략
  #


  목록
  #

2025-04-14 ⋯ 보조지표로 만드는 추세매매전략


  보조지표로 만드는 추세매매전략
  #


  1. 개념
  #



RSI: 과열 여부 기반 매매

주식의 가격이 &lsquo;너무&rsquo;오를 때 팔고, &lsquo;너무&rsquo; 내릴 때 사는 전략
&lsquo;너무&rsquo;의 정의는? 과매도/과매수를 판별하는 기술적 지표(Technical Indicator)를 통해 데이터를 통한 매매.



Technical Indicator

Trend-Following: 가격 움직임의 추세 및 방향 e.g. Simple Moving Average (SMA)
Momentum: 가격 움직임의 강도 e.g. Relative Strength Index (RSI)
Volatility: 가격 움직임 및 시장의 변동성 e.g. Bollinger Bands (BB)
Volume: 체결 수량과 관련 e.g. Money Flow Index (MFI)
etc: &mldr;



RSI (상대 강도 지수)"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://yshghid.github.io/docs/study/tech/tech6/"><meta property="og:site_name" content=" "><meta property="og:title" content="추세매매전략, AI 주가예측전략"><meta property="og:description" content="추세매매전략, AI 주가예측전략 # 목록 # 2025-04-14 ⋯ 보조지표로 만드는 추세매매전략
보조지표로 만드는 추세매매전략 # 1. 개념 # RSI: 과열 여부 기반 매매
주식의 가격이 ‘너무’오를 때 팔고, ‘너무’ 내릴 때 사는 전략 ‘너무’의 정의는? 과매도/과매수를 판별하는 기술적 지표(Technical Indicator)를 통해 데이터를 통한 매매. Technical Indicator
Trend-Following: 가격 움직임의 추세 및 방향 e.g. Simple Moving Average (SMA) Momentum: 가격 움직임의 강도 e.g. Relative Strength Index (RSI) Volatility: 가격 움직임 및 시장의 변동성 e.g. Bollinger Bands (BB) Volume: 체결 수량과 관련 e.g. Money Flow Index (MFI) etc: … RSI (상대 강도 지수)"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:published_time" content="2025-04-14T00:00:00+00:00"><meta property="article:modified_time" content="2025-04-14T00:00:00+00:00"><meta property="article:tag" content="2025-04"><title>추세매매전략, AI 주가예측전략 |</title><link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://yshghid.github.io/docs/study/tech/tech6/><link rel=stylesheet href=/book.min.6217d077edb4189fd0578345e84bca1a884dfdee121ff8dc9a0f55cfe0852bc9.css integrity="sha256-YhfQd+20GJ/QV4NF6EvKGohN/e4SH/jcmg9Vz+CFK8k=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.5e463b06e1d4cb9ca830d4304b5a63a16e49e1cea483c52b8840375c4e62052e.js integrity="sha256-XkY7BuHUy5yoMNQwS1pjoW5J4c6kg8UriEA3XE5iBS4=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><img src=/logo.png alt=Logo class=book-icon><span></span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li class=book-section-flat><span>기록</span><ul><li><a href=/docs/hobby/book/>글</a><ul></ul></li><li><a href=/docs/hobby/daily/>일상</a><ul></ul></li></ul></li><li class=book-section-flat><span>공부</span><ul><li><a href=/docs/study/bioinformatics/>Bioinformatics</a><ul></ul></li><li><a href=/docs/study/ai/>AI</a><ul></ul></li><li><a href=/docs/study/sw/>SW</a><ul></ul></li><li><a href=/docs/study/algorithm/>알고리즘</a><ul></ul></li><li><a href=/docs/study/career/>취업</a><ul></ul></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>추세매매전략, AI 주가예측전략</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#목록>목록</a></li><li><a href=#보조지표로-만드는-추세매매전략>보조지표로 만드는 추세매매전략</a><ul><li><a href=#1-개념>1. 개념</a></li><li><a href=#2-알고리즘-모델링>2. 알고리즘 모델링</a></li><li><a href=#3-실습>3. 실습</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=추세매매전략-ai-주가예측전략>추세매매전략, AI 주가예측전략
<a class=anchor href=#%ec%b6%94%ec%84%b8%eb%a7%a4%eb%a7%a4%ec%a0%84%eb%9e%b5-ai-%ec%a3%bc%ea%b0%80%ec%98%88%ec%b8%a1%ec%a0%84%eb%9e%b5>#</a></h1><h2 id=목록>목록
<a class=anchor href=#%eb%aa%a9%eb%a1%9d>#</a></h2><p><em>2025-04-14</em> ⋯ <a href=https://yshghid.github.io/docs/study/tech/tech5/#%eb%b3%b4%ec%a1%b0%ec%a7%80%ed%91%9c%eb%a1%9c-%eb%a7%8c%eb%93%9c%eb%8a%94-%ec%b6%94%ec%84%b8%eb%a7%a4%eb%a7%a4%ec%a0%84%eb%9e%b5>보조지표로 만드는 추세매매전략</a></p><hr><h2 id=보조지표로-만드는-추세매매전략>보조지표로 만드는 추세매매전략
<a class=anchor href=#%eb%b3%b4%ec%a1%b0%ec%a7%80%ed%91%9c%eb%a1%9c-%eb%a7%8c%eb%93%9c%eb%8a%94-%ec%b6%94%ec%84%b8%eb%a7%a4%eb%a7%a4%ec%a0%84%eb%9e%b5>#</a></h2><h3 id=1-개념>1. 개념
<a class=anchor href=#1-%ea%b0%9c%eb%85%90>#</a></h3><ul><li><p>RSI: 과열 여부 기반 매매</p><ul><li>주식의 가격이 &lsquo;너무&rsquo;오를 때 팔고, &lsquo;너무&rsquo; 내릴 때 사는 전략</li><li>&lsquo;너무&rsquo;의 정의는? 과매도/과매수를 판별하는 기술적 지표(Technical Indicator)를 통해 데이터를 통한 매매.</li></ul></li><li><p>Technical Indicator</p><ul><li>Trend-Following: 가격 움직임의 추세 및 방향 e.g. Simple Moving Average (SMA)</li><li>Momentum: 가격 움직임의 강도 e.g. Relative Strength Index (RSI)</li><li>Volatility: 가격 움직임 및 시장의 변동성 e.g. Bollinger Bands (BB)</li><li>Volume: 체결 수량과 관련 e.g. Money Flow Index (MFI)</li><li>etc: &mldr;</li></ul></li><li><p>RSI (상대 강도 지수)</p><ul><li>대표적인 momentum 기술적 지표로, 매수와 매도의 상대적 강도 측정</li><li>RSI = RS/(1+RS) * 100</li><li>Where RS = Average Gain / Average Loss<ul><li>Average Gain = 주어진 기간동안 가격이 전날보다 상승한 날의 상승분의 평균</li><li>Average Loss = 주어진 기간동안 가격이 전날보다 하락한 날의 하락분의 평균</li></ul></li></ul><p>ex) 최근 10일 동안의 가격이 다음과 같을 때 9일 기간에 대한 RSI 계산</p><ul><li>100, 102, 104, 102, 103, 101, 99, 103, 98, 100</li><li>Average Gain = (102+104+104+103+100)/5 = 102.6</li><li>Average Loss = (102+101+99+98)/4 = 100</li><li>RS = 102.6/100 = 1.026</li><li>∴ RSI = 1.026 / (1+1.026)*100 = 50.64</li></ul></li><li><p>RSI는 0이상 100이하 값을 가지며 높을수록 과매수, 낮을수록 과매도로 해석.</p><ul><li>일반적으로 70 이상이면 과매수, 30 이하면 과매도로 해석.</li></ul></li></ul><h3 id=2-알고리즘-모델링>2. 알고리즘 모델링
<a class=anchor href=#2-%ec%95%8c%ea%b3%a0%eb%a6%ac%ec%a6%98-%eb%aa%a8%eb%8d%b8%eb%a7%81>#</a></h3><ul><li>아이디어: 매 시점, 다음 두 조건 확인<ul><li>현금을 가지고 있고 RSI가 낮으면 매수</li><li>종목을 보유히고 있고 RSI가 높으면 매도</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain><span style=display:flex><span>For t in time:
</span></span><span style=display:flex><span>  If ( holding_cash &gt; 0 ) and ( RSI(ws) of t-1 &lt; thres_bid ), then BID
</span></span><span style=display:flex><span>  elif ( hodling_stocks &gt; 0 ) and ( RSI(ws) of t-1 &gt; thres_ask ), them ASK
</span></span><span style=display:flex><span>  ( else, do nothing )
</span></span></code></pre></div><ul><li><p>최적의 알고리즘을 구하는 법</p><ul><li>알고리즘을 결정하는 주요 변수<ul><li>ws: RSI 계산에 사용되는 과거 데이터 일자 수</li><li>thres_bid/thres_ask: 과매도/과매수 기준이 되는 RSI 값</li></ul></li><li>모델 학습 및 선정<ul><li>Train: 주요 변수의 다양한 값 조합 (e.g. 과거 14일(ws=14) 데이터로 RSI를 계산하고, RSI가 30 이하면 매수(thres_bid=30), 70 이상이면 매도(thres_ask=70))에 대해 train 데이터로 알고리즘 성능(e.g. 수익률)을 확인하고, 최적의 조합 확인(최적 알고리즘)</li><li>Test: 최종 선택된 조합에 대해 test 데이터에 대한 테스트 진행 (성능)</li></ul></li></ul></li><li><p>Package ta를 사용하여 RSI 계산</p><ul><li><a href=https://technical-analysis-library-in-python.readthedocs.io/en/latest/#>https://technical-analysis-library-in-python.readthedocs.io/en/latest/#</a></li><li>pip install ta</li></ul></li></ul><h3 id=3-실습>3. 실습
<a class=anchor href=#3-%ec%8b%a4%ec%8a%b5>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>!</span>pip install ta
</span></span></code></pre></div><ul><li>ta 설치<ul><li>금융 시계열 데이터로 RSI 등의 기술적 지표(Technical Indicator)를 생성하는 Python library</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>data_samsung <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_parquet(<span style=color:#e6db74>&#39;../chapter4/005930.parquet&#39;</span>)<span style=color:#f92672>.</span>set_index(<span style=color:#e6db74>&#39;timestamp&#39;</span>)
</span></span><span style=display:flex><span>data_samsung <span style=color:#f92672>=</span> data_samsung[data_samsung<span style=color:#f92672>.</span>volume <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>] <span style=color:#75715e># 거래량이 없는(e.g. 토요일) 날짜 제외</span>
</span></span><span style=display:flex><span>data_samsung
</span></span></code></pre></div><p><img src=https://github.com/user-attachments/assets/9fa440e6-2c52-466d-ac55-335e1bc1605e alt=image></p><ul><li>데이터 로드: 3531개 시점.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 데이터 분리</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>t1, t2, t3 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;2010&#39;</span>, <span style=color:#e6db74>&#39;2020&#39;</span>, <span style=color:#e6db74>&#39;2024&#39;</span>
</span></span><span style=display:flex><span>df_train <span style=color:#f92672>=</span> data_samsung<span style=color:#f92672>.</span>loc[(data_samsung<span style=color:#f92672>.</span>index <span style=color:#f92672>&gt;=</span> t1) <span style=color:#f92672>&amp;</span> (data_samsung<span style=color:#f92672>.</span>index <span style=color:#f92672>&lt;</span> t2)]<span style=color:#f92672>.</span>dropna(axis<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)  
</span></span><span style=display:flex><span>df_test <span style=color:#f92672>=</span> data_samsung<span style=color:#f92672>.</span>loc[(data_samsung<span style=color:#f92672>.</span>index <span style=color:#f92672>&gt;=</span> t2) <span style=color:#f92672>&amp;</span> (data_samsung<span style=color:#f92672>.</span>index <span style=color:#f92672>&lt;</span> t3)]<span style=color:#f92672>.</span>iloc[:<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]   
</span></span><span style=display:flex><span>print(df_train<span style=color:#f92672>.</span>shape[<span style=color:#ae81ff>0</span>], df_test<span style=color:#f92672>.</span>shape[<span style=color:#ae81ff>0</span>])  
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain><span style=display:flex><span>2463 986
</span></span></code></pre></div><ul><li>train, test 셋을 만들어주기.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># ta를 이용하여 rsi 생성</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> ta
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>df_train[<span style=color:#e6db74>&#39;RSI&#39;</span>] <span style=color:#f92672>=</span> ta<span style=color:#f92672>.</span>momentum<span style=color:#f92672>.</span>rsi(df_train[<span style=color:#e6db74>&#39;close&#39;</span>], window<span style=color:#f92672>=</span><span style=color:#ae81ff>14</span>)
</span></span></code></pre></div><ul><li>df_train의 종가를 기준으로 rsi 생성</li><li>window는 14일로 설정</li><li>첫 14일까지는 RSI가 Nan이다.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 주가 및 생성된 rsi 값 plotting</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> matplotlib.pyplot <span style=color:#66d9ef>as</span> plt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>rsi_u, rsi_l <span style=color:#f92672>=</span> <span style=color:#ae81ff>70</span>, <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>fig, axs <span style=color:#f92672>=</span> plt<span style=color:#f92672>.</span>subplots(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, figsize<span style=color:#f92672>=</span>(<span style=color:#ae81ff>15</span>, <span style=color:#ae81ff>5</span>))
</span></span><span style=display:flex><span>axs<span style=color:#f92672>.</span>plot(df_train[<span style=color:#e6db74>&#39;RSI&#39;</span>], color<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;darkgrey&#39;</span>, label<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;RSI&#39;</span>)
</span></span><span style=display:flex><span>axs<span style=color:#f92672>.</span>set_xticks(df_train<span style=color:#f92672>.</span>index[::<span style=color:#ae81ff>300</span>])
</span></span><span style=display:flex><span>axs<span style=color:#f92672>.</span>legend(loc<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;upper right&#34;</span>)
</span></span><span style=display:flex><span>axs_rsi0 <span style=color:#f92672>=</span> axs<span style=color:#f92672>.</span>twinx()
</span></span><span style=display:flex><span>axs_rsi0<span style=color:#f92672>.</span>plot(df_train[<span style=color:#e6db74>&#39;close&#39;</span>], color<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;black&#39;</span>, label<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Close&#39;</span>)
</span></span><span style=display:flex><span>axs_rsi0<span style=color:#f92672>.</span>scatter(df_train<span style=color:#f92672>.</span>loc[df_train[<span style=color:#e6db74>&#39;RSI&#39;</span>] <span style=color:#f92672>&gt;</span> rsi_u]<span style=color:#f92672>.</span>index, df_train<span style=color:#f92672>.</span>loc[df_train[<span style=color:#e6db74>&#39;RSI&#39;</span>] <span style=color:#f92672>&gt;</span> rsi_u, <span style=color:#e6db74>&#39;close&#39;</span>], color<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;red&#39;</span>, s<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>, label<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;RSI over 70&#39;</span>)
</span></span><span style=display:flex><span>axs_rsi0<span style=color:#f92672>.</span>scatter(df_train<span style=color:#f92672>.</span>loc[df_train[<span style=color:#e6db74>&#39;RSI&#39;</span>] <span style=color:#f92672>&lt;</span> rsi_l]<span style=color:#f92672>.</span>index, df_train<span style=color:#f92672>.</span>loc[df_train[<span style=color:#e6db74>&#39;RSI&#39;</span>] <span style=color:#f92672>&lt;</span> rsi_l, <span style=color:#e6db74>&#39;close&#39;</span>], color<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;blue&#39;</span>, s<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>, label<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;RSI under 30&#39;</span>)
</span></span><span style=display:flex><span>axs_rsi0<span style=color:#f92672>.</span>legend(loc<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;lower right&#34;</span>)
</span></span></code></pre></div><p><img src=https://github.com/user-attachments/assets/a1ce854f-712f-4eac-9f3e-1574d2a4a222 alt=image></p><ul><li><p>RSI는 연한 회색으로 시각화, 종가를 검정으로 시각화</p></li><li><p>눈으로 보기에도 빨간색에 팔고, 파란색에 사면 좋을거같음.</p></li><li><p>window=14가 좋은지 9가 좋은지 등은 테스트해봐야 아므로 2010-2020년 과거 데이터를 기준으로 테스팅을 해보고 어떤 RSI값, 어떤 window 값을 가질지를 정한 후에 2020-2024에 실제 적용을 한다.</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>### 모델 특성 조합 정의</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> itertools
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>rsi_ws_list <span style=color:#f92672>=</span> [<span style=color:#ae81ff>7</span>, <span style=color:#ae81ff>9</span>, <span style=color:#ae81ff>14</span>, <span style=color:#ae81ff>15</span>, <span style=color:#ae81ff>21</span>, <span style=color:#ae81ff>28</span>]
</span></span><span style=display:flex><span>rsi_u_list <span style=color:#f92672>=</span> [<span style=color:#ae81ff>70</span>, <span style=color:#ae81ff>75</span>, <span style=color:#ae81ff>80</span>, <span style=color:#ae81ff>85</span>, <span style=color:#ae81ff>90</span>, <span style=color:#ae81ff>95</span>]
</span></span><span style=display:flex><span>rsi_l_list <span style=color:#f92672>=</span> [<span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>15</span>, <span style=color:#ae81ff>20</span>, <span style=color:#ae81ff>25</span>, <span style=color:#ae81ff>30</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>params <span style=color:#f92672>=</span> list(itertools<span style=color:#f92672>.</span>product(<span style=color:#f92672>*</span>[rsi_ws_list, rsi_u_list, rsi_l_list]))
</span></span><span style=display:flex><span>print(len(params))
</span></span><span style=display:flex><span>params
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain><span style=display:flex><span>216
</span></span><span style=display:flex><span>[(7, 70, 5),
</span></span><span style=display:flex><span> (7, 70, 10),
</span></span><span style=display:flex><span> (7, 70, 15),
</span></span><span style=display:flex><span> (7, 70, 20),
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span> (28, 95, 10),
</span></span><span style=display:flex><span> (28, 95, 15),
</span></span><span style=display:flex><span> (28, 95, 20),
</span></span><span style=display:flex><span> (28, 95, 25),
</span></span><span style=display:flex><span> (28, 95, 30)]
</span></span></code></pre></div><ul><li>2010-2019까지의 삼성전자 데이터에 대해 가장 우수한 성능을 갖는 window 크기(ws) 및 과매수/과매도 기준(rsi_u, rsi_l)을 찾기.</li><li>216개 조합을 통해 최적의 파라미터를 찾는다!</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>for</span> ws <span style=color:#f92672>in</span> rsi_ws_list:
</span></span><span style=display:flex><span>    df_train[<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;RSI_</span><span style=color:#e6db74>{</span>ws<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>] <span style=color:#f92672>=</span> ta<span style=color:#f92672>.</span>momentum<span style=color:#f92672>.</span>rsi(df_train[<span style=color:#e6db74>&#39;close&#39;</span>], window<span style=color:#f92672>=</span>ws)<span style=color:#f92672>.</span>shift(<span style=color:#ae81ff>1</span>) <span style=color:#75715e># 전날의 rsi 값</span>
</span></span></code></pre></div><ul><li><p>RSI 값은 오늘 값이 사용되면 안되니까 전날 값으로 바꿔준다.</p></li><li><p>세팅은? 보유현금 100만원, 슬리피지 0.0025</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>train_results <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame(columns<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;ws&#39;</span>, <span style=color:#e6db74>&#39;rsi_u&#39;</span>, <span style=color:#e6db74>&#39;rsi_l&#39;</span>, <span style=color:#e6db74>&#39;return&#39;</span>, <span style=color:#e6db74>&#39;num_of_trades&#39;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> ws, rsi_u, rsi_l <span style=color:#f92672>in</span> params:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>################ 백테스팅 파라미터 #############</span>
</span></span><span style=display:flex><span>    holding_cash <span style=color:#f92672>=</span> <span style=color:#ae81ff>1_000_000</span> <span style=color:#75715e># 보유 현금</span>
</span></span><span style=display:flex><span>    position <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span> <span style=color:#75715e># 현재 보유 포지션</span>
</span></span><span style=display:flex><span>    avg_price <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span> <span style=color:#75715e># 평단가</span>
</span></span><span style=display:flex><span>    daily_total_value <span style=color:#f92672>=</span> [] <span style=color:#75715e>#일별 총 포트폴리오 가치</span>
</span></span><span style=display:flex><span>    slippage <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0025</span> <span style=color:#75715e># 슬리피지 </span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>################ 백테스팅 파라미터 #############</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    n_trades <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 한 row 씩 루프</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> idx, data <span style=color:#f92672>in</span> df_train<span style=color:#f92672>.</span>iterrows():
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (np<span style=color:#f92672>.</span>isnan(data[<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;RSI_</span><span style=color:#e6db74>{</span>ws<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>])):
</span></span><span style=display:flex><span>            <span style=color:#75715e># 이전 rsi 값이 계산된 경우에만 알고리즘 매매 진행</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        daily_total_value<span style=color:#f92672>.</span>append(<span style=color:#ae81ff>0</span>) <span style=color:#75715e># 일별 포트폴리오 가치 List에 새로운 값 추가</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># 매수: 과매도 상황(즉, RSI가 rsi_l 이하일 때)</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (position <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>and</span> (data[<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;RSI_</span><span style=color:#e6db74>{</span>ws<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>] <span style=color:#f92672>&lt;</span> rsi_l): 
</span></span><span style=display:flex><span>            <span style=color:#75715e># 주식 매수 시의 현금 감소, 포지션 증가, 평단가 변화 계산</span>
</span></span><span style=display:flex><span>            position <span style=color:#f92672>=</span> int(holding_cash <span style=color:#f92672>/</span> data[<span style=color:#e6db74>&#39;close&#39;</span>])
</span></span><span style=display:flex><span>            holding_cash <span style=color:#f92672>-=</span> position <span style=color:#f92672>*</span> data[<span style=color:#e6db74>&#39;close&#39;</span>]
</span></span><span style=display:flex><span>            avg_price <span style=color:#f92672>=</span> data[<span style=color:#e6db74>&#39;close&#39;</span>]
</span></span><span style=display:flex><span>            n_trades <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span> <span style=color:#75715e># 매수 시점 개수 카운팅을 통해 전체 거래 횟수를 파악</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># 매도: 과매수 상황(즉, RSi가 rsi_u 이상일 때)</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> (position <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>and</span> (data[<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;RSI_</span><span style=color:#e6db74>{</span>ws<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>] <span style=color:#f92672>&gt;</span> rsi_u):   
</span></span><span style=display:flex><span>            holding_cash <span style=color:#f92672>+=</span> (position <span style=color:#f92672>*</span> data[<span style=color:#e6db74>&#39;close&#39;</span>]) <span style=color:#f92672>*</span> (<span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>slippage) <span style=color:#75715e># 포지션 매도 시 세금/수수료를 제한 값만 현금으로 돌아옴</span>
</span></span><span style=display:flex><span>            position <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>            avg_price <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        daily_total_value[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]<span style=color:#f92672>+=</span> holding_cash <span style=color:#f92672>+</span> position<span style=color:#f92672>*</span> data[<span style=color:#e6db74>&#39;close&#39;</span>] <span style=color:#75715e># 당일 종료 시점에서 보유 현금 + 주식 평가가치로 총 포트폴리오 가치 계산</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    train_results<span style=color:#f92672>.</span>loc[len(train_results)] <span style=color:#f92672>=</span> [ws, rsi_u, rsi_l, daily_total_value[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>/</span> <span style=color:#ae81ff>1_000_000</span>, n_trades]
</span></span></code></pre></div><ol><li>첫 며칠은 RSI값이 존재하지 않으니까 RSI 존재하는 경우에만 매매 진행</li><li>과매수(RSI가 rsi_l 이하)일때 매도</li><li>과매도(RSI가 rsi_l 이하)일때 매수</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 충분히 거래가 되는(즉, train 기간 동안 거래 횟수가 5 초과인) 조합 중, 가장 성능이 좋은 조합을 찾는다.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>train_results<span style=color:#f92672>.</span>loc[train_results<span style=color:#f92672>.</span>num_of_trades <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>5</span>]<span style=color:#f92672>.</span>sort_values(by<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;return&#39;</span>, ascending<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)<span style=color:#f92672>.</span>iloc[:<span style=color:#ae81ff>10</span>]
</span></span></code></pre></div><p><img src=https://github.com/user-attachments/assets/39af35b4-71b0-4b0e-b73d-6f1a8bfd3bb8 alt=image></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 최적의 조합</span>
</span></span><span style=display:flex><span>ws, rsi_u, rsi_l, _, _ <span style=color:#f92672>=</span> train_results<span style=color:#f92672>.</span>loc[train_results<span style=color:#f92672>.</span>num_of_trades <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>5</span>]<span style=color:#f92672>.</span>sort_values(by<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;return&#39;</span>, ascending<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)<span style=color:#f92672>.</span>iloc[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(ws, rsi_u, rsi_l)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain><span style=display:flex><span>9.0 85.0 30.0
</span></span></code></pre></div><ul><li>최적 조합은? window 9, 과매수조건 85, 과매도조건 30.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># test 기간을 통해 매매 전략 성능 파악 </span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>df_test[<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;RSI_</span><span style=color:#e6db74>{</span>ws<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>] <span style=color:#f92672>=</span> ta<span style=color:#f92672>.</span>momentum<span style=color:#f92672>.</span>rsi(df_test[<span style=color:#e6db74>&#39;close&#39;</span>], window<span style=color:#f92672>=</span>ws)<span style=color:#f92672>.</span>shift(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#75715e>################ 백테스팅 파라미터 #############</span>
</span></span><span style=display:flex><span>holding_cash <span style=color:#f92672>=</span> <span style=color:#ae81ff>1_000_000</span> <span style=color:#75715e># 보유 현금</span>
</span></span><span style=display:flex><span>position <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span> <span style=color:#75715e># 현재 보유 포지션</span>
</span></span><span style=display:flex><span>avg_price <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span> <span style=color:#75715e># 평단가</span>
</span></span><span style=display:flex><span>daily_total_value <span style=color:#f92672>=</span> [] <span style=color:#75715e>#일별 총 포트폴리오 가치</span>
</span></span><span style=display:flex><span>slippage <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0025</span> <span style=color:#75715e># 슬리피지 </span>
</span></span><span style=display:flex><span><span style=color:#75715e>################ 백테스팅 파라미터 #############</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>n_trades <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 한 row 씩 루프</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> idx, data <span style=color:#f92672>in</span> df_test<span style=color:#f92672>.</span>reset_index()<span style=color:#f92672>.</span>iterrows():
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (np<span style=color:#f92672>.</span>isnan(data[<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;RSI_</span><span style=color:#e6db74>{</span>ws<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>])):
</span></span><span style=display:flex><span>        <span style=color:#75715e># 이전 rsi 값이 계산된 경우에만 알고리즘 매매 진행</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    daily_total_value<span style=color:#f92672>.</span>append(<span style=color:#ae81ff>0</span>) <span style=color:#75715e># 일별 포트폴리오 가치 List에 새로운 값 추가</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 매수: 과매도 상황(즉, RSI가 rsi_l 이하일 때)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (position <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>and</span> (data[<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;RSI_</span><span style=color:#e6db74>{</span>ws<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>] <span style=color:#f92672>&lt;</span> rsi_l): 
</span></span><span style=display:flex><span>        <span style=color:#75715e># 주식 매수 시의 현금 감소, 포지션 증가, 평단가 변화 계산</span>
</span></span><span style=display:flex><span>        position <span style=color:#f92672>=</span> int(holding_cash <span style=color:#f92672>/</span> data[<span style=color:#e6db74>&#39;close&#39;</span>])
</span></span><span style=display:flex><span>        holding_cash <span style=color:#f92672>-=</span> position <span style=color:#f92672>*</span> data[<span style=color:#e6db74>&#39;close&#39;</span>]
</span></span><span style=display:flex><span>        avg_price <span style=color:#f92672>=</span> data[<span style=color:#e6db74>&#39;close&#39;</span>]
</span></span><span style=display:flex><span>        n_trades <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span> <span style=color:#75715e># 매수 시점 개수 카운팅을 통해 전체 거래 횟수를 파악</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 매도: 과매수 상황(즉, RSi가 rsi_u 이상일 때)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> (position <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>and</span> (data[<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;RSI_</span><span style=color:#e6db74>{</span>ws<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>] <span style=color:#f92672>&gt;</span> rsi_u):   
</span></span><span style=display:flex><span>        holding_cash <span style=color:#f92672>+=</span> (position <span style=color:#f92672>*</span> data[<span style=color:#e6db74>&#39;close&#39;</span>]) <span style=color:#f92672>*</span> (<span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>slippage) <span style=color:#75715e># 포지션 매도 시 세금/수수료를 제한 값만 현금으로 돌아옴</span>
</span></span><span style=display:flex><span>        position <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        avg_price <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    daily_total_value[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]<span style=color:#f92672>+=</span> holding_cash<span style=color:#f92672>+</span> position<span style=color:#f92672>*</span> data[<span style=color:#e6db74>&#39;close&#39;</span>] <span style=color:#75715e># 당일 종료 시점에서 보유 현금 + 주식 평가가치로 총 포트폴리오 가치 계산</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(daily_total_value[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>])
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>figure(figsize<span style=color:#f92672>=</span>(<span style=color:#ae81ff>15</span>,<span style=color:#ae81ff>8</span>))
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>plot(daily_total_value)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ae81ff>1585862.5</span>
</span></span></code></pre></div><p><img src=https://github.com/user-attachments/assets/ffbf2816-2151-449b-b0dc-ff641a1a67b6 alt=image></p><ul><li>가장 좋은 조합으로 test data에서 돌려보기.</li><li>1.5배 정도 기록함!</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 전략 총 수익률 계산</span>
</span></span><span style=display:flex><span>total_return_pct <span style=color:#f92672>=</span> daily_total_value[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]<span style=color:#f92672>/</span>daily_total_value[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;총 수익률: </span><span style=color:#e6db74>{:.2f}</span><span style=color:#e6db74>%&#39;</span><span style=color:#f92672>.</span>format((total_return_pct<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>*</span><span style=color:#ae81ff>100</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;------------------------------------------------&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 1년을 250일로 가정, 연 복리 수익률 계산</span>
</span></span><span style=display:flex><span>total_years <span style=color:#f92672>=</span> len(daily_total_value)<span style=color:#f92672>/</span><span style=color:#ae81ff>250</span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;총 백테스팅 기간: </span><span style=color:#e6db74>{:.2f}</span><span style=color:#e6db74>년&#39;</span><span style=color:#f92672>.</span>format(total_years))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> math
</span></span><span style=display:flex><span>annaul_return <span style=color:#f92672>=</span> math<span style=color:#f92672>.</span>pow(total_return_pct,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span>total_years)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;연 수익률: </span><span style=color:#e6db74>{:.2f}</span><span style=color:#e6db74>%&#39;</span><span style=color:#f92672>.</span>format((annaul_return<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>*</span><span style=color:#ae81ff>100</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;------------------------------------------------&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Sharpe Ratio</span>
</span></span><span style=display:flex><span>daily_return <span style=color:#f92672>=</span> math<span style=color:#f92672>.</span>pow(total_return_pct,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span>len(daily_total_value))
</span></span><span style=display:flex><span>daily_std <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame(daily_total_value)<span style=color:#f92672>.</span>pct_change()<span style=color:#f92672>.</span>std()[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;일 수익률: </span><span style=color:#e6db74>{:.2f}</span><span style=color:#e6db74>%, 일 변동성: </span><span style=color:#e6db74>{:.2f}</span><span style=color:#e6db74>%&#39;</span><span style=color:#f92672>.</span>format((daily_return<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>*</span><span style=color:#ae81ff>100</span>,daily_std))
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;Sharpe ratio: </span><span style=color:#e6db74>{:.2f}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(((daily_return<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>/</span>daily_std)<span style=color:#f92672>*</span>np<span style=color:#f92672>.</span>sqrt(<span style=color:#ae81ff>250</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;------------------------------------------------&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># MDD 계산</span>
</span></span><span style=display:flex><span>tv <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame(daily_total_value)
</span></span><span style=display:flex><span>dd <span style=color:#f92672>=</span> tv<span style=color:#f92672>/</span>tv<span style=color:#f92672>.</span>cummax()
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;MDD: </span><span style=color:#e6db74>{:.2f}</span><span style=color:#e6db74>%&#39;</span><span style=color:#f92672>.</span>format((dd<span style=color:#f92672>.</span>min()<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>*</span><span style=color:#ae81ff>100</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>figure(figsize<span style=color:#f92672>=</span>(<span style=color:#ae81ff>10</span>,<span style=color:#ae81ff>5</span>))
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>plot(dd)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>show()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;------------------------------------------------&#39;</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain><span style=display:flex><span>총 수익률: 58.59%
</span></span><span style=display:flex><span>------------------------------------------------
</span></span><span style=display:flex><span>총 백테스팅 기간: 3.91년
</span></span><span style=display:flex><span>연 수익률: 12.52%
</span></span><span style=display:flex><span>------------------------------------------------
</span></span><span style=display:flex><span>일 수익률: 0.05%, 일 변동성: 0.01%
</span></span><span style=display:flex><span>Sharpe ratio: 0.55
</span></span><span style=display:flex><span>------------------------------------------------
</span></span><span style=display:flex><span>MDD: -36.44%
</span></span></code></pre></div><ul><li><p>4년동안 58%정도 수익률, 1년에 약 12%</p></li><li><p>MDD는 -36% 정도인데 코로나여서 변동이 좀 있는편.</p></li><li><p>성과 정량화 뿐만아니라 벤치마크와의 비교가 필요하다.</p><ul><li>보통 buy & hold 즉 주식을 사고 계속 가지고있었을때와 비교해야함.</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 삼성전자 Buy &amp; Hold의 수익률 계산</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>bm_daily_total_value <span style=color:#f92672>=</span> df_test[<span style=color:#e6db74>&#39;close&#39;</span>]<span style=color:#f92672>.</span>values<span style=color:#f92672>/</span>df_test[<span style=color:#e6db74>&#39;close&#39;</span>]<span style=color:#f92672>.</span>values[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 전략 총 수익률 계산</span>
</span></span><span style=display:flex><span>total_return_pct <span style=color:#f92672>=</span> bm_daily_total_value[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]<span style=color:#f92672>/</span>bm_daily_total_value[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;총 수익률: </span><span style=color:#e6db74>{:.2f}</span><span style=color:#e6db74>%&#39;</span><span style=color:#f92672>.</span>format((total_return_pct<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>*</span><span style=color:#ae81ff>100</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;------------------------------------------------&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 1년을 250일로 가정, 연 복리 수익률 계산</span>
</span></span><span style=display:flex><span>total_years <span style=color:#f92672>=</span> len(bm_daily_total_value)<span style=color:#f92672>/</span><span style=color:#ae81ff>250</span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;총 백테스팅 기간: </span><span style=color:#e6db74>{:.2f}</span><span style=color:#e6db74>년&#39;</span><span style=color:#f92672>.</span>format(total_years))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> math
</span></span><span style=display:flex><span>annaul_return <span style=color:#f92672>=</span> math<span style=color:#f92672>.</span>pow(total_return_pct,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span>total_years)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;연 수익률: </span><span style=color:#e6db74>{:.2f}</span><span style=color:#e6db74>%&#39;</span><span style=color:#f92672>.</span>format((annaul_return<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>*</span><span style=color:#ae81ff>100</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;------------------------------------------------&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Sharpe Ratio</span>
</span></span><span style=display:flex><span>daily_return <span style=color:#f92672>=</span> math<span style=color:#f92672>.</span>pow(total_return_pct,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span>len(bm_daily_total_value))
</span></span><span style=display:flex><span>daily_std <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame(bm_daily_total_value)<span style=color:#f92672>.</span>pct_change()<span style=color:#f92672>.</span>std()[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;일 수익률: </span><span style=color:#e6db74>{:.2f}</span><span style=color:#e6db74>%, 일 변동성: </span><span style=color:#e6db74>{:.2f}</span><span style=color:#e6db74>%&#39;</span><span style=color:#f92672>.</span>format((daily_return<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>*</span><span style=color:#ae81ff>100</span>,daily_std))
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;Sharpe ratio: </span><span style=color:#e6db74>{:.2f}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(((daily_return<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>/</span>daily_std)<span style=color:#f92672>*</span>np<span style=color:#f92672>.</span>sqrt(<span style=color:#ae81ff>250</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;------------------------------------------------&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># MDD 계산</span>
</span></span><span style=display:flex><span>tv <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame(bm_daily_total_value)
</span></span><span style=display:flex><span>dd <span style=color:#f92672>=</span> tv<span style=color:#f92672>/</span>tv<span style=color:#f92672>.</span>cummax()
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;MDD: </span><span style=color:#e6db74>{:.2f}</span><span style=color:#e6db74>%&#39;</span><span style=color:#f92672>.</span>format((dd<span style=color:#f92672>.</span>min()<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>*</span><span style=color:#ae81ff>100</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>figure(figsize<span style=color:#f92672>=</span>(<span style=color:#ae81ff>10</span>,<span style=color:#ae81ff>5</span>))
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>plot(dd)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>show()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;------------------------------------------------&#39;</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain><span style=display:flex><span>총 수익률: 41.30%
</span></span><span style=display:flex><span>------------------------------------------------
</span></span><span style=display:flex><span>총 백테스팅 기간: 3.94년
</span></span><span style=display:flex><span>연 수익률: 9.16%
</span></span><span style=display:flex><span>------------------------------------------------
</span></span><span style=display:flex><span>일 수익률: 0.04%, 일 변동성: 0.02%
</span></span><span style=display:flex><span>Sharpe ratio: 0.35
</span></span><span style=display:flex><span>------------------------------------------------
</span></span><span style=display:flex><span>MDD: -42.20%
</span></span></code></pre></div><p><img src=https://github.com/user-attachments/assets/04b52951-d393-4215-865f-f4aa29248305 alt=image></p><blockquote><p>강의 링크 <a href=https://www.inflearn.com/course/%ED%8C%8C%EC%9D%B4%EC%8D%AC-%EC%A3%BC%EC%8B%9D%EB%A7%A4%EB%A7%A4%EB%B4%87-%EC%9E%90%EB%8F%99%EC%82%AC%EB%83%A5>https://www.inflearn.com/course/%ED%8C%8C%EC%9D%B4%EC%8D%AC-%EC%A3%BC%EC%8B%9D%EB%A7%A4%EB%A7%A4%EB%B4%87-%EC%9E%90%EB%8F%99%EC%82%AC%EB%83%A5</a></p></blockquote><p><a href=https://yshghid.github.io/docs/study/tech/tech6/#%eb%aa%a9%eb%a1%9d>⏶ 목록</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments><script src=https://giscus.app/client.js data-repo=yshghid/yshghid.github.io data-repo-id=R_kgDONkMkNg data-category-id=DIC_kwDONkMkNs4CloJh data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=ko crossorigin=anonymous async></script></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#목록>목록</a></li><li><a href=#보조지표로-만드는-추세매매전략>보조지표로 만드는 추세매매전략</a><ul><li><a href=#1-개념>1. 개념</a></li><li><a href=#2-알고리즘-모델링>2. 알고리즘 모델링</a></li><li><a href=#3-실습>3. 실습</a></li></ul></li></ul></nav></div></aside></main></body></html>