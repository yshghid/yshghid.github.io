<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='
  Sleuth 작업
  #

#2025-04-21


  Load Package, Run Sleuth
  #

require("sleuth")
packageVersion("sleuth")
library("gridExtra")
library("cowplot")
library("biomaRt")
library(readr)

setwd("/data/home/ysh980101/2307_kallisto")
getwd()

sample_id <- dir(file.path("./"))
sample_id <- grep("^output_(150|con)", sample_id, value = TRUE)
sample_id <- substring(sample_id, 8)
sample_id

kal_dirs <- file.path(paste0("./output_", sample_id))
s2c <- read.table(file.path("./kallisto_demo_150_con.tsv"),
                  header = TRUE,
                  stringsAsFactors = FALSE,
                  sep = "\t")
s2c <- dplyr::mutate(s2c, path = kal_dirs)
s2c

marts <- listMarts()
ensembl <- useMart("ensembl")
datasets <- listDatasets(ensembl)
filtered_datasets <- datasets[grepl("hsapiens", datasets$dataset), ]
hsapiens_mart <- useMart("ensembl",dataset="hsapiens_gene_ensembl")
datasets <- listDatasets(hsapiens_mart)
filtered_datasets <- datasets[grepl("hsapiens", datasets$dataset), ]
hsapiens_mart <- useMart("ensembl",dataset="hsapiens_gene_ensembl",host="ensembl.org")
datasets <- listDatasets(hsapiens_mart)

t2g <- getBM(attributes = c("ensembl_transcript_id_version",
                            "ensembl_gene_id",
                            "description",
                            "external_gene_name"),
             mart = hsapiens_mart)
head(t2g)

ttg <- dplyr::rename(t2g, target_id= ensembl_transcript_id_version, 
                     ens_gene = ensembl_gene_id, ext_gene = external_gene_name)
ttg <- dplyr::select(ttg, c(&#39;target_id&#39;, &#39;ens_gene&#39;, &#39;ext_gene&#39;))
head(ttg)

s2c$condition <- as.factor(s2c$condition)
s2c$condition <- relevel(s2c$condition, ref = "con")
so <- sleuth_prep(s2c, target_mapping = ttg,
  aggregation_column = &#39;ens_gene&#39;, extra_bootstrap_summary = TRUE)

so <- sleuth_fit(so, ~condition, &#39;full&#39;)
so <- sleuth_fit(so, ~1, &#39;reduced&#39;)
so <- sleuth_lrt(so, &#39;reduced&#39;, &#39;full&#39;)
sleuth_table_gene <- sleuth_results(so, &#39;reduced:full&#39;, &#39;lrt&#39;, show_all = FALSE)

sleuth_save(so, &#39;./sleuth_ward/150_con_so.sleuth&#39;)
write_csv(sleuth_table_gene, &#39;./sleuth_ward/150_con.csv&#39;)
'><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://yshghid.github.io/docs/study/bioinformatics/bi2/"><meta property="og:site_name" content=" "><meta property="og:title" content="Sleuth 작업"><meta property="og:description" content='Sleuth 작업 # #2025-04-21
Load Package, Run Sleuth # require("sleuth") packageVersion("sleuth") library("gridExtra") library("cowplot") library("biomaRt") library(readr) setwd("/data/home/ysh980101/2307_kallisto") getwd() sample_id <- dir(file.path("./")) sample_id <- grep("^output_(150|con)", sample_id, value = TRUE) sample_id <- substring(sample_id, 8) sample_id kal_dirs <- file.path(paste0("./output_", sample_id)) s2c <- read.table(file.path("./kallisto_demo_150_con.tsv"), header = TRUE, stringsAsFactors = FALSE, sep = "\t") s2c <- dplyr::mutate(s2c, path = kal_dirs) s2c marts <- listMarts() ensembl <- useMart("ensembl") datasets <- listDatasets(ensembl) filtered_datasets <- datasets[grepl("hsapiens", datasets$dataset), ] hsapiens_mart <- useMart("ensembl",dataset="hsapiens_gene_ensembl") datasets <- listDatasets(hsapiens_mart) filtered_datasets <- datasets[grepl("hsapiens", datasets$dataset), ] hsapiens_mart <- useMart("ensembl",dataset="hsapiens_gene_ensembl",host="ensembl.org") datasets <- listDatasets(hsapiens_mart) t2g <- getBM(attributes = c("ensembl_transcript_id_version", "ensembl_gene_id", "description", "external_gene_name"), mart = hsapiens_mart) head(t2g) ttg <- dplyr::rename(t2g, target_id= ensembl_transcript_id_version, ens_gene = ensembl_gene_id, ext_gene = external_gene_name) ttg <- dplyr::select(ttg, c(&#39;target_id&#39;, &#39;ens_gene&#39;, &#39;ext_gene&#39;)) head(ttg) s2c$condition <- as.factor(s2c$condition) s2c$condition <- relevel(s2c$condition, ref = "con") so <- sleuth_prep(s2c, target_mapping = ttg, aggregation_column = &#39;ens_gene&#39;, extra_bootstrap_summary = TRUE) so <- sleuth_fit(so, ~condition, &#39;full&#39;) so <- sleuth_fit(so, ~1, &#39;reduced&#39;) so <- sleuth_lrt(so, &#39;reduced&#39;, &#39;full&#39;) sleuth_table_gene <- sleuth_results(so, &#39;reduced:full&#39;, &#39;lrt&#39;, show_all = FALSE) sleuth_save(so, &#39;./sleuth_ward/150_con_so.sleuth&#39;) write_csv(sleuth_table_gene, &#39;./sleuth_ward/150_con.csv&#39;)'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:published_time" content="2025-04-21T00:00:00+00:00"><meta property="article:modified_time" content="2025-04-21T00:00:00+00:00"><meta property="article:tag" content="2025-04"><title>Sleuth 작업 |</title><link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://yshghid.github.io/docs/study/bioinformatics/bi2/><link rel=stylesheet href=/book.min.6217d077edb4189fd0578345e84bca1a884dfdee121ff8dc9a0f55cfe0852bc9.css integrity="sha256-YhfQd+20GJ/QV4NF6EvKGohN/e4SH/jcmg9Vz+CFK8k=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.578a2d8e6e30e0a0ae3682797882d89ca0cbbf1734d206705396ea76cf57bbb6.js integrity="sha256-V4otjm4w4KCuNoJ5eILYnKDLvxc00gZwU5bqds9Xu7Y=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><img src=/logo.png alt=Logo class=book-icon><span></span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li class=book-section-flat><span>기록</span><ul><li><a href=/docs/hobby/book/>글</a><ul></ul></li><li><a href=/docs/hobby/daily/>일상</a><ul></ul></li></ul></li><li class=book-section-flat><span>공부</span><ul><li><a href=/docs/study/bioinformatics/>Bioinformatics</a><ul></ul></li><li><a href=/docs/study/ai/>AI</a><ul></ul></li><li><a href=/docs/study/sw/>SW</a><ul></ul></li><li><a href=/docs/study/algorithm/>알고리즘</a><ul></ul></li><li><a href=/docs/study/career/>취업</a><ul></ul></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Sleuth 작업</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li><a href=#load-package-run-sleuth>Load Package, Run Sleuth</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=sleuth-작업>Sleuth 작업
<a class=anchor href=#sleuth-%ec%9e%91%ec%97%85>#</a></h1><p>#2025-04-21</p><hr><h3 id=load-package-run-sleuth>Load Package, Run Sleuth
<a class=anchor href=#load-package-run-sleuth>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-r data-lang=r><span class=line><span class=cl><span class=nf>require</span><span class=p>(</span><span class=s>&#34;sleuth&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>packageVersion</span><span class=p>(</span><span class=s>&#34;sleuth&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>library</span><span class=p>(</span><span class=s>&#34;gridExtra&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>library</span><span class=p>(</span><span class=s>&#34;cowplot&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>library</span><span class=p>(</span><span class=s>&#34;biomaRt&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>library</span><span class=p>(</span><span class=n>readr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>setwd</span><span class=p>(</span><span class=s>&#34;/data/home/ysh980101/2307_kallisto&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>getwd</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sample_id</span> <span class=o>&lt;-</span> <span class=nf>dir</span><span class=p>(</span><span class=nf>file.path</span><span class=p>(</span><span class=s>&#34;./&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>sample_id</span> <span class=o>&lt;-</span> <span class=nf>grep</span><span class=p>(</span><span class=s>&#34;^output_(150|con)&#34;</span><span class=p>,</span> <span class=n>sample_id</span><span class=p>,</span> <span class=n>value</span> <span class=o>=</span> <span class=kc>TRUE</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sample_id</span> <span class=o>&lt;-</span> <span class=nf>substring</span><span class=p>(</span><span class=n>sample_id</span><span class=p>,</span> <span class=m>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sample_id</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>kal_dirs</span> <span class=o>&lt;-</span> <span class=nf>file.path</span><span class=p>(</span><span class=nf>paste0</span><span class=p>(</span><span class=s>&#34;./output_&#34;</span><span class=p>,</span> <span class=n>sample_id</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>s2c</span> <span class=o>&lt;-</span> <span class=nf>read.table</span><span class=p>(</span><span class=nf>file.path</span><span class=p>(</span><span class=s>&#34;./kallisto_demo_150_con.tsv&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                  <span class=n>header</span> <span class=o>=</span> <span class=kc>TRUE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=n>stringsAsFactors</span> <span class=o>=</span> <span class=kc>FALSE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=n>sep</span> <span class=o>=</span> <span class=s>&#34;\t&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>s2c</span> <span class=o>&lt;-</span> <span class=n>dplyr</span><span class=o>::</span><span class=nf>mutate</span><span class=p>(</span><span class=n>s2c</span><span class=p>,</span> <span class=n>path</span> <span class=o>=</span> <span class=n>kal_dirs</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>s2c</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>marts</span> <span class=o>&lt;-</span> <span class=nf>listMarts</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>ensembl</span> <span class=o>&lt;-</span> <span class=nf>useMart</span><span class=p>(</span><span class=s>&#34;ensembl&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>datasets</span> <span class=o>&lt;-</span> <span class=nf>listDatasets</span><span class=p>(</span><span class=n>ensembl</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>filtered_datasets</span> <span class=o>&lt;-</span> <span class=n>datasets</span><span class=nf>[grepl</span><span class=p>(</span><span class=s>&#34;hsapiens&#34;</span><span class=p>,</span> <span class=n>datasets</span><span class=o>$</span><span class=n>dataset</span><span class=p>),</span> <span class=n>]</span>
</span></span><span class=line><span class=cl><span class=n>hsapiens_mart</span> <span class=o>&lt;-</span> <span class=nf>useMart</span><span class=p>(</span><span class=s>&#34;ensembl&#34;</span><span class=p>,</span><span class=n>dataset</span><span class=o>=</span><span class=s>&#34;hsapiens_gene_ensembl&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>datasets</span> <span class=o>&lt;-</span> <span class=nf>listDatasets</span><span class=p>(</span><span class=n>hsapiens_mart</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>filtered_datasets</span> <span class=o>&lt;-</span> <span class=n>datasets</span><span class=nf>[grepl</span><span class=p>(</span><span class=s>&#34;hsapiens&#34;</span><span class=p>,</span> <span class=n>datasets</span><span class=o>$</span><span class=n>dataset</span><span class=p>),</span> <span class=n>]</span>
</span></span><span class=line><span class=cl><span class=n>hsapiens_mart</span> <span class=o>&lt;-</span> <span class=nf>useMart</span><span class=p>(</span><span class=s>&#34;ensembl&#34;</span><span class=p>,</span><span class=n>dataset</span><span class=o>=</span><span class=s>&#34;hsapiens_gene_ensembl&#34;</span><span class=p>,</span><span class=n>host</span><span class=o>=</span><span class=s>&#34;ensembl.org&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>datasets</span> <span class=o>&lt;-</span> <span class=nf>listDatasets</span><span class=p>(</span><span class=n>hsapiens_mart</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>t2g</span> <span class=o>&lt;-</span> <span class=nf>getBM</span><span class=p>(</span><span class=n>attributes</span> <span class=o>=</span> <span class=nf>c</span><span class=p>(</span><span class=s>&#34;ensembl_transcript_id_version&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=s>&#34;ensembl_gene_id&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=s>&#34;description&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=s>&#34;external_gene_name&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>             <span class=n>mart</span> <span class=o>=</span> <span class=n>hsapiens_mart</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>head</span><span class=p>(</span><span class=n>t2g</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ttg</span> <span class=o>&lt;-</span> <span class=n>dplyr</span><span class=o>::</span><span class=nf>rename</span><span class=p>(</span><span class=n>t2g</span><span class=p>,</span> <span class=n>target_id</span><span class=o>=</span> <span class=n>ensembl_transcript_id_version</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                     <span class=n>ens_gene</span> <span class=o>=</span> <span class=n>ensembl_gene_id</span><span class=p>,</span> <span class=n>ext_gene</span> <span class=o>=</span> <span class=n>external_gene_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ttg</span> <span class=o>&lt;-</span> <span class=n>dplyr</span><span class=o>::</span><span class=nf>select</span><span class=p>(</span><span class=n>ttg</span><span class=p>,</span> <span class=nf>c</span><span class=p>(</span><span class=s>&#39;target_id&#39;</span><span class=p>,</span> <span class=s>&#39;ens_gene&#39;</span><span class=p>,</span> <span class=s>&#39;ext_gene&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nf>head</span><span class=p>(</span><span class=n>ttg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>s2c</span><span class=o>$</span><span class=n>condition</span> <span class=o>&lt;-</span> <span class=nf>as.factor</span><span class=p>(</span><span class=n>s2c</span><span class=o>$</span><span class=n>condition</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>s2c</span><span class=o>$</span><span class=n>condition</span> <span class=o>&lt;-</span> <span class=nf>relevel</span><span class=p>(</span><span class=n>s2c</span><span class=o>$</span><span class=n>condition</span><span class=p>,</span> <span class=n>ref</span> <span class=o>=</span> <span class=s>&#34;con&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>so</span> <span class=o>&lt;-</span> <span class=nf>sleuth_prep</span><span class=p>(</span><span class=n>s2c</span><span class=p>,</span> <span class=n>target_mapping</span> <span class=o>=</span> <span class=n>ttg</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>aggregation_column</span> <span class=o>=</span> <span class=s>&#39;ens_gene&#39;</span><span class=p>,</span> <span class=n>extra_bootstrap_summary</span> <span class=o>=</span> <span class=kc>TRUE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>so</span> <span class=o>&lt;-</span> <span class=nf>sleuth_fit</span><span class=p>(</span><span class=n>so</span><span class=p>,</span> <span class=o>~</span><span class=n>condition</span><span class=p>,</span> <span class=s>&#39;full&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>so</span> <span class=o>&lt;-</span> <span class=nf>sleuth_fit</span><span class=p>(</span><span class=n>so</span><span class=p>,</span> <span class=o>~</span><span class=m>1</span><span class=p>,</span> <span class=s>&#39;reduced&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>so</span> <span class=o>&lt;-</span> <span class=nf>sleuth_lrt</span><span class=p>(</span><span class=n>so</span><span class=p>,</span> <span class=s>&#39;reduced&#39;</span><span class=p>,</span> <span class=s>&#39;full&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sleuth_table_gene</span> <span class=o>&lt;-</span> <span class=nf>sleuth_results</span><span class=p>(</span><span class=n>so</span><span class=p>,</span> <span class=s>&#39;reduced:full&#39;</span><span class=p>,</span> <span class=s>&#39;lrt&#39;</span><span class=p>,</span> <span class=n>show_all</span> <span class=o>=</span> <span class=kc>FALSE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>sleuth_save</span><span class=p>(</span><span class=n>so</span><span class=p>,</span> <span class=s>&#39;./sleuth_ward/150_con_so.sleuth&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>write_csv</span><span class=p>(</span><span class=n>sleuth_table_gene</span><span class=p>,</span> <span class=s>&#39;./sleuth_ward/150_con.csv&#39;</span><span class=p>)</span>
</span></span></code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments><script src=https://giscus.app/client.js data-repo=yshghid/yshghid.github.io data-repo-id=R_kgDONkMkNg data-category-id=DIC_kwDONkMkNs4CloJh data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=ko crossorigin=anonymous async></script></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#load-package-run-sleuth>Load Package, Run Sleuth</a></li></ul></li></ul></nav></div></aside></main></body></html>