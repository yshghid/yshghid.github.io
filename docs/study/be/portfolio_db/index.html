<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  AWS #5 SiLok 프로젝트 ECS 파이프라인 빌드
  #

#2026-02-08


  🗄️ Silok - Database 구축 포트폴리오
  #


  프로젝트 개요
  #

AI 기반 주간 업무 보고서 자동 생성 서비스의 데이터베이스를 설계하고 구축한 프로젝트입니다.
PostgreSQL과 pgvector 확장을 활용하여 다중 플랫폼 협업 데이터를 통합 저장하고, 벡터 임베딩 기반의 시맨틱 검색 기능을 구현했습니다.

  
      
          항목
          내용
      
  
  
      
          프로젝트 기간
          2024년
      
      
          역할
          Database Engineer / Backend Developer
      
      
          기술 스택
          PostgreSQL 15, pgvector, SQLAlchemy (Async), Docker
      
      
          프로젝트 유형
          Enterprise B2B SaaS
      
  



  📋 목차
  #


기술적 의사결정
데이터베이스 아키텍처
스키마 설계
벡터 검색 구현
ORM 및 비동기 처리
API 엔드포인트 설계
Docker 컨테이너화
성능 최적화
문제 해결 사례
프로젝트 성과



  1. 기술적 의사결정
  #


  1.1 데이터베이스 선정 근거
  #


  PostgreSQL 15 + pgvector
  #

선정 이유:
├── 엔터프라이즈급 안정성과 ACID 트랜잭션 보장
├── pgvector 확장으로 벡터 유사도 검색 네이티브 지원
├── JSON/JSONB 타입으로 유연한 메타데이터 저장
├── 강력한 인덱싱 (B-tree, GIN, GiST, IVFFlat)
└── 비동기 드라이버 (asyncpg) 지원으로 고성능 I/O

  대안 비교 분석
  #


  
      
          데이터베이스
          벡터 검색
          비동기 지원
          엔터프라이즈
          비용
      
  
  
      
          PostgreSQL + pgvector
          ✅ 네이티브
          ✅ asyncpg
          ✅
          무료
      
      
          MongoDB + Atlas Vector
          ✅ 내장
          ✅ Motor
          ✅
          유료
      
      
          Pinecone
          ✅ 전용
          ✅
          ⚠️
          유료
      
      
          MySQL
          ❌ 없음
          ✅ aiomysql
          ✅
          무료
      
      
          SQLite
          ❌ 없음
          ⚠️ 제한적
          ❌
          무료
      
  

최종 선정: PostgreSQL + pgvector"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://yshghid.github.io/docs/study/be/portfolio_db/"><meta property="og:site_name" content=" "><meta property="og:title" content="AWS #5 SiLok 프로젝트 ECS 파이프라인 빌드"><meta property="og:description" content="AWS #5 SiLok 프로젝트 ECS 파이프라인 빌드 # #2026-02-08
🗄️ Silok - Database 구축 포트폴리오 # 프로젝트 개요 # AI 기반 주간 업무 보고서 자동 생성 서비스의 데이터베이스를 설계하고 구축한 프로젝트입니다. PostgreSQL과 pgvector 확장을 활용하여 다중 플랫폼 협업 데이터를 통합 저장하고, 벡터 임베딩 기반의 시맨틱 검색 기능을 구현했습니다.
항목 내용 프로젝트 기간 2024년 역할 Database Engineer / Backend Developer 기술 스택 PostgreSQL 15, pgvector, SQLAlchemy (Async), Docker 프로젝트 유형 Enterprise B2B SaaS 📋 목차 # 기술적 의사결정 데이터베이스 아키텍처 스키마 설계 벡터 검색 구현 ORM 및 비동기 처리 API 엔드포인트 설계 Docker 컨테이너화 성능 최적화 문제 해결 사례 프로젝트 성과 1. 기술적 의사결정 # 1.1 데이터베이스 선정 근거 # PostgreSQL 15 + pgvector # 선정 이유: ├── 엔터프라이즈급 안정성과 ACID 트랜잭션 보장 ├── pgvector 확장으로 벡터 유사도 검색 네이티브 지원 ├── JSON/JSONB 타입으로 유연한 메타데이터 저장 ├── 강력한 인덱싱 (B-tree, GIN, GiST, IVFFlat) └── 비동기 드라이버 (asyncpg) 지원으로 고성능 I/O 대안 비교 분석 # 데이터베이스 벡터 검색 비동기 지원 엔터프라이즈 비용 PostgreSQL + pgvector ✅ 네이티브 ✅ asyncpg ✅ 무료 MongoDB + Atlas Vector ✅ 내장 ✅ Motor ✅ 유료 Pinecone ✅ 전용 ✅ ⚠️ 유료 MySQL ❌ 없음 ✅ aiomysql ✅ 무료 SQLite ❌ 없음 ⚠️ 제한적 ❌ 무료 최종 선정: PostgreSQL + pgvector"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:published_time" content="2026-02-08T00:00:00+00:00"><meta property="article:modified_time" content="2026-02-08T00:00:00+00:00"><meta property="article:tag" content="2026-02"><title>AWS #5 SiLok 프로젝트 ECS 파이프라인 빌드 |</title><link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://yshghid.github.io/docs/study/be/portfolio_db/><link rel=stylesheet href=/book.min.30a7836b6a89342da3b88e7afd1036166aeced16c8de12df060ded2031837886.css integrity="sha256-MKeDa2qJNC2juI56/RA2Fmrs7RbI3hLfBg3tIDGDeIY=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.4a625a43dd2c604d63d835943169cfe323338768a6e298e5dbb8cde7a0c3501c.js integrity="sha256-SmJaQ90sYE1j2DWUMWnP4yMzh2im4pjl27jN56DDUBw=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><img src=/logo.png alt=Logo class=book-icon><span></span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li class=book-section-flat><span>기록</span><ul><li><a href=/docs/hobby/book/>글</a><ul></ul></li><li><a href=/docs/hobby/daily/>일상</a><ul></ul></li></ul></li><li class=book-section-flat><span>공부</span><ul><li><a href=/docs/study/ai/>AI/Data</a><ul></ul></li><li><a href=/docs/study/bioinformatics/>Bioinformatics</a><ul></ul></li><li><a href=/docs/study/be/>BE</a><ul></ul></li><li><a href=/docs/study/fe/>FE</a><ul></ul></li><li><a href=/docs/study/career/>취업</a><ul></ul></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>AWS #5 SiLok 프로젝트 ECS 파이프라인 빌드</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#프로젝트-개요>프로젝트 개요</a></li><li><a href=#-목차>📋 목차</a></li><li><a href=#1-기술적-의사결정>1. 기술적 의사결정</a><ul><li><a href=#11-데이터베이스-선정-근거>1.1 데이터베이스 선정 근거</a></li><li><a href=#12-orm-및-드라이버-선정>1.2 ORM 및 드라이버 선정</a></li><li><a href=#13-임베딩-모델-선정>1.3 임베딩 모델 선정</a></li></ul></li><li><a href=#2-데이터베이스-아키텍처>2. 데이터베이스 아키텍처</a><ul><li><a href=#21-프로젝트-디렉토리-구조>2.1 프로젝트 디렉토리 구조</a></li><li><a href=#22-공유-모델-modeldatapy>2.2 공유 모델 (model/data.py)</a></li><li><a href=#23-전체-시스템-아키텍처>2.3 전체 시스템 아키텍처</a></li><li><a href=#22-데이터-흐름>2.2 데이터 흐름</a></li><li><a href=#23-erd-entity-relationship-diagram>2.3 ERD (Entity Relationship Diagram)</a></li></ul></li><li><a href=#3-스키마-설계>3. 스키마 설계</a><ul><li><a href=#31-테이블-정의>3.1 테이블 정의</a></li><li><a href=#32-벡터-차원-설계-근거>3.2 벡터 차원 설계 근거</a></li></ul></li><li><a href=#4-벡터-검색-구현>4. 벡터 검색 구현</a><ul><li><a href=#41-pgvector-확장-설정>4.1 pgvector 확장 설정</a></li><li><a href=#42-임베딩-서비스-구현>4.2 임베딩 서비스 구현</a></li><li><a href=#43-유사도-검색-쿼리>4.3 유사도 검색 쿼리</a></li><li><a href=#44-벡터-인덱스-전략>4.4 벡터 인덱스 전략</a></li></ul></li><li><a href=#5-orm-및-비동기-처리>5. ORM 및 비동기 처리</a><ul><li><a href=#51-sqlalchemy-비동기-설정>5.1 SQLAlchemy 비동기 설정</a></li><li><a href=#52-의존성-주입-패턴>5.2 의존성 주입 패턴</a></li><li><a href=#53-트랜잭션-관리>5.3 트랜잭션 관리</a></li><li><a href=#54-raw-sql-vs-orm>5.4 Raw SQL vs ORM</a></li></ul></li><li><a href=#6-api-엔드포인트-설계>6. API 엔드포인트 설계</a><ul><li><a href=#61-엔드포인트-구조>6.1 엔드포인트 구조</a></li><li><a href=#62-주요-엔드포인트-구현>6.2 주요 엔드포인트 구현</a></li><li><a href=#63-pydantic-스키마>6.3 Pydantic 스키마</a></li></ul></li><li><a href=#7-docker-컨테이너화>7. Docker 컨테이너화</a><ul><li><a href=#71-docker-compose-설정>7.1 Docker Compose 설정</a></li><li><a href=#72-초기화-스크립트>7.2 초기화 스크립트</a></li><li><a href=#73-실행-명령어>7.3 실행 명령어</a></li><li><a href=#74-환경-변수-관리>7.4 환경 변수 관리</a></li></ul></li><li><a href=#8-성능-최적화>8. 성능 최적화</a><ul><li><a href=#81-인덱스-전략>8.1 인덱스 전략</a></li><li><a href=#82-쿼리-최적화>8.2 쿼리 최적화</a></li><li><a href=#83-연결-풀-설정>8.3 연결 풀 설정</a></li><li><a href=#84-성능-측정-결과>8.4 성능 측정 결과</a></li></ul></li><li><a href=#9-문제-해결-사례>9. 문제 해결 사례</a><ul><li><a href=#91-벡터-타입-캐스팅-오류>9.1 벡터 타입 캐스팅 오류</a></li><li><a href=#92-비동기-세션-컨텍스트-오류>9.2 비동기 세션 컨텍스트 오류</a></li><li><a href=#93-타임존-불일치-문제>9.3 타임존 불일치 문제</a></li><li><a href=#94-대용량-임베딩-메모리-문제>9.4 대용량 임베딩 메모리 문제</a></li></ul></li><li><a href=#10-프로젝트-성과>10. 프로젝트 성과</a><ul><li><a href=#101-기술적-성과>10.1 기술적 성과</a></li><li><a href=#102-데이터-구조-성과>10.2 데이터 구조 성과</a></li><li><a href=#103-api-성능-지표>10.3 API 성능 지표</a></li><li><a href=#104-학습-및-성장>10.4 학습 및 성장</a></li></ul></li><li><a href=#-부록>📎 부록</a><ul><li><a href=#a-실행-방법>A. 실행 방법</a></li><li><a href=#b-데이터베이스-접속>B. 데이터베이스 접속</a></li><li><a href=#c-유용한-sql-쿼리>C. 유용한 SQL 쿼리</a></li><li><a href=#d-관련-링크>D. 관련 링크</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=aws-5-silok-프로젝트-ecs-파이프라인-빌드>AWS #5 SiLok 프로젝트 ECS 파이프라인 빌드
<a class=anchor href=#aws-5-silok-%ed%94%84%eb%a1%9c%ec%a0%9d%ed%8a%b8-ecs-%ed%8c%8c%ec%9d%b4%ed%94%84%eb%9d%bc%ec%9d%b8-%eb%b9%8c%eb%93%9c>#</a></h1><p>#2026-02-08</p><hr><h1 id=-silok---database-구축-포트폴리오>🗄️ Silok - Database 구축 포트폴리오
<a class=anchor href=#-silok---database-%ea%b5%ac%ec%b6%95-%ed%8f%ac%ed%8a%b8%ed%8f%b4%eb%a6%ac%ec%98%a4>#</a></h1><h2 id=프로젝트-개요>프로젝트 개요
<a class=anchor href=#%ed%94%84%eb%a1%9c%ec%a0%9d%ed%8a%b8-%ea%b0%9c%ec%9a%94>#</a></h2><p><strong>AI 기반 주간 업무 보고서 자동 생성 서비스</strong>의 데이터베이스를 설계하고 구축한 프로젝트입니다.
PostgreSQL과 pgvector 확장을 활용하여 다중 플랫폼 협업 데이터를 통합 저장하고, 벡터 임베딩 기반의 시맨틱 검색 기능을 구현했습니다.</p><table><thead><tr><th>항목</th><th>내용</th></tr></thead><tbody><tr><td><strong>프로젝트 기간</strong></td><td>2024년</td></tr><tr><td><strong>역할</strong></td><td>Database Engineer / Backend Developer</td></tr><tr><td><strong>기술 스택</strong></td><td>PostgreSQL 15, pgvector, SQLAlchemy (Async), Docker</td></tr><tr><td><strong>프로젝트 유형</strong></td><td>Enterprise B2B SaaS</td></tr></tbody></table><hr><h2 id=-목차>📋 목차
<a class=anchor href=#-%eb%aa%a9%ec%b0%a8>#</a></h2><ol><li><a href=#1-%ea%b8%b0%ec%88%a0%ec%a0%81-%ec%9d%98%ec%82%ac%ea%b2%b0%ec%a0%95>기술적 의사결정</a></li><li><a href=#2-%eb%8d%b0%ec%9d%b4%ed%84%b0%eb%b2%a0%ec%9d%b4%ec%8a%a4-%ec%95%84%ed%82%a4%ed%85%8d%ec%b2%98>데이터베이스 아키텍처</a></li><li><a href=#3-%ec%8a%a4%ed%82%a4%eb%a7%88-%ec%84%a4%ea%b3%84>스키마 설계</a></li><li><a href=#4-%eb%b2%a1%ed%84%b0-%ea%b2%80%ec%83%89-%ea%b5%ac%ed%98%84>벡터 검색 구현</a></li><li><a href=#5-orm-%eb%b0%8f-%eb%b9%84%eb%8f%99%ea%b8%b0-%ec%b2%98%eb%a6%ac>ORM 및 비동기 처리</a></li><li><a href=#6-api-%ec%97%94%eb%93%9c%ed%8f%ac%ec%9d%b8%ed%8a%b8-%ec%84%a4%ea%b3%84>API 엔드포인트 설계</a></li><li><a href=#7-docker-%ec%bb%a8%ed%85%8c%ec%9d%b4%eb%84%88%ed%99%94>Docker 컨테이너화</a></li><li><a href=#8-%ec%84%b1%eb%8a%a5-%ec%b5%9c%ec%a0%81%ed%99%94>성능 최적화</a></li><li><a href=#9-%eb%ac%b8%ec%a0%9c-%ed%95%b4%ea%b2%b0-%ec%82%ac%eb%a1%80>문제 해결 사례</a></li><li><a href=#10-%ed%94%84%eb%a1%9c%ec%a0%9d%ed%8a%b8-%ec%84%b1%ea%b3%bc>프로젝트 성과</a></li></ol><hr><h2 id=1-기술적-의사결정>1. 기술적 의사결정
<a class=anchor href=#1-%ea%b8%b0%ec%88%a0%ec%a0%81-%ec%9d%98%ec%82%ac%ea%b2%b0%ec%a0%95>#</a></h2><h3 id=11-데이터베이스-선정-근거>1.1 데이터베이스 선정 근거
<a class=anchor href=#11-%eb%8d%b0%ec%9d%b4%ed%84%b0%eb%b2%a0%ec%9d%b4%ec%8a%a4-%ec%84%a0%ec%a0%95-%ea%b7%bc%ea%b1%b0>#</a></h3><h4 id=postgresql-15--pgvector>PostgreSQL 15 + pgvector
<a class=anchor href=#postgresql-15--pgvector>#</a></h4><pre tabindex=0><code>선정 이유:
├── 엔터프라이즈급 안정성과 ACID 트랜잭션 보장
├── pgvector 확장으로 벡터 유사도 검색 네이티브 지원
├── JSON/JSONB 타입으로 유연한 메타데이터 저장
├── 강력한 인덱싱 (B-tree, GIN, GiST, IVFFlat)
└── 비동기 드라이버 (asyncpg) 지원으로 고성능 I/O
</code></pre><h4 id=대안-비교-분석>대안 비교 분석
<a class=anchor href=#%eb%8c%80%ec%95%88-%eb%b9%84%ea%b5%90-%eb%b6%84%ec%84%9d>#</a></h4><table><thead><tr><th>데이터베이스</th><th>벡터 검색</th><th>비동기 지원</th><th>엔터프라이즈</th><th>비용</th></tr></thead><tbody><tr><td><strong>PostgreSQL + pgvector</strong></td><td>✅ 네이티브</td><td>✅ asyncpg</td><td>✅</td><td>무료</td></tr><tr><td>MongoDB + Atlas Vector</td><td>✅ 내장</td><td>✅ Motor</td><td>✅</td><td>유료</td></tr><tr><td>Pinecone</td><td>✅ 전용</td><td>✅</td><td>⚠️</td><td>유료</td></tr><tr><td>MySQL</td><td>❌ 없음</td><td>✅ aiomysql</td><td>✅</td><td>무료</td></tr><tr><td>SQLite</td><td>❌ 없음</td><td>⚠️ 제한적</td><td>❌</td><td>무료</td></tr></tbody></table><p><strong>최종 선정:</strong> PostgreSQL + pgvector</p><ul><li>벡터 검색과 관계형 데이터를 단일 DB에서 처리</li><li>별도의 벡터 DB 비용 절감</li><li>트랜잭션 일관성 보장</li></ul><h3 id=12-orm-및-드라이버-선정>1.2 ORM 및 드라이버 선정
<a class=anchor href=#12-orm-%eb%b0%8f-%eb%93%9c%eb%9d%bc%ec%9d%b4%eb%b2%84-%ec%84%a0%ec%a0%95>#</a></h3><h4 id=sqlalchemy-20-async>SQLAlchemy 2.0 (Async)
<a class=anchor href=#sqlalchemy-20-async>#</a></h4><pre tabindex=0><code>선정 이유:
├── Python 생태계 표준 ORM
├── 비동기 세션 지원 (AsyncSession)
├── 타입 힌팅 및 Pydantic 통합
├── 복잡한 쿼리 빌더 지원
└── 마이그레이션 도구 (Alembic) 연동
</code></pre><h4 id=asyncpg-vs-psycopg2>asyncpg vs psycopg2
<a class=anchor href=#asyncpg-vs-psycopg2>#</a></h4><table><thead><tr><th>비교 항목</th><th>asyncpg</th><th>psycopg2</th></tr></thead><tbody><tr><td>동기/비동기</td><td>비동기</td><td>동기</td></tr><tr><td>성능 (TPS)</td><td>~50,000</td><td>~20,000</td></tr><tr><td>연결 풀링</td><td>내장</td><td>외부 필요</td></tr><tr><td>FastAPI 호환</td><td>✅ 완벽</td><td>⚠️ 블로킹</td></tr></tbody></table><p><strong>선정:</strong> asyncpg - FastAPI와 완벽한 비동기 호환</p><h3 id=13-임베딩-모델-선정>1.3 임베딩 모델 선정
<a class=anchor href=#13-%ec%9e%84%eb%b2%a0%eb%94%a9-%eb%aa%a8%eb%8d%b8-%ec%84%a0%ec%a0%95>#</a></h3><h4 id=sentence-transformersall-minilm-l6-v2>sentence-transformers/all-MiniLM-L6-v2
<a class=anchor href=#sentence-transformersall-minilm-l6-v2>#</a></h4><pre tabindex=0><code>선정 이유:
├── 경량 모델 (22M 파라미터)
├── 384차원 임베딩 (저장 공간 효율)
├── 빠른 추론 속도 (~0.05초/문장)
├── 한국어 포함 다국어 지원
└── 무료 오픈소스
</code></pre><table><thead><tr><th>모델</th><th>차원</th><th>크기</th><th>속도</th><th>한국어</th></tr></thead><tbody><tr><td><strong>all-MiniLM-L6-v2</strong></td><td>384</td><td>22M</td><td>빠름</td><td>✅</td></tr><tr><td>all-mpnet-base-v2</td><td>768</td><td>110M</td><td>보통</td><td>✅</td></tr><tr><td>text-embedding-ada-002</td><td>1536</td><td>-</td><td>보통</td><td>✅</td></tr><tr><td>KoSimCSE-roberta</td><td>768</td><td>125M</td><td>느림</td><td>✅✅</td></tr></tbody></table><hr><h2 id=2-데이터베이스-아키텍처>2. 데이터베이스 아키텍처
<a class=anchor href=#2-%eb%8d%b0%ec%9d%b4%ed%84%b0%eb%b2%a0%ec%9d%b4%ec%8a%a4-%ec%95%84%ed%82%a4%ed%85%8d%ec%b2%98>#</a></h2><h3 id=21-프로젝트-디렉토리-구조>2.1 프로젝트 디렉토리 구조
<a class=anchor href=#21-%ed%94%84%eb%a1%9c%ec%a0%9d%ed%8a%b8-%eb%94%94%eb%a0%89%ed%86%a0%eb%a6%ac-%ea%b5%ac%ec%a1%b0>#</a></h3><pre tabindex=0><code>silok/
├── backend/                    # FastAPI 백엔드
│   ├── main.py                # 메인 애플리케이션 (API + DB 로직)
│   ├── docker-compose.yml     # PostgreSQL 컨테이너 설정
│   ├── init.sql               # DB 스키마 및 초기 데이터
│   ├── requirements.txt       # Python 의존성
│   └── .env                   # 환경 변수
│
├── frontend/                   # React 프론트엔드
│   └── ...
│
├── model/                      # 공유 데이터 모델
│   └── data.py                # Pydantic 스키마 정의
│
└── venv/                       # Python 가상환경
</code></pre><h3 id=22-공유-모델-modeldatapy>2.2 공유 모델 (model/data.py)
<a class=anchor href=#22-%ea%b3%b5%ec%9c%a0-%eb%aa%a8%eb%8d%b8-modeldatapy>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># model/data.py</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pydantic <span style=color:#f92672>import</span> BaseModel
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> typing <span style=color:#f92672>import</span> List, Dict, Any
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ReportRequest</span>(BaseModel):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;보고서 생성 요청&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    task_id: int
</span></span><span style=display:flex><span>    start_date: str  <span style=color:#75715e># 예: &#34;2025-09-22&#34;</span>
</span></span><span style=display:flex><span>    end_date: str    <span style=color:#75715e># 예: &#34;2025-09-26&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ReportResponse</span>(BaseModel):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;보고서 응답&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    summary: str
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TimelineActivity</span>(BaseModel):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;타임라인 활동 항목&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    source: str              <span style=color:#75715e># &#34;slack&#34;, &#34;notion&#34;, &#34;onedrive&#34;, &#34;outlook&#34;</span>
</span></span><span style=display:flex><span>    timestamp: str
</span></span><span style=display:flex><span>    content: str
</span></span><span style=display:flex><span>    metadata: Dict[str, Any]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserTimelineResponse</span>(BaseModel):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;사용자 타임라인 응답&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    user_id: str
</span></span><span style=display:flex><span>    start_date: str
</span></span><span style=display:flex><span>    end_date: str
</span></span><span style=display:flex><span>    activities: List[TimelineActivity]
</span></span><span style=display:flex><span>    summary: Dict[str, int]  <span style=color:#75715e># {&#34;slack&#34;: 10, &#34;notion&#34;: 5, ...}</span>
</span></span></code></pre></div><h3 id=23-전체-시스템-아키텍처>2.3 전체 시스템 아키텍처
<a class=anchor href=#23-%ec%a0%84%ec%b2%b4-%ec%8b%9c%ec%8a%a4%ed%85%9c-%ec%95%84%ed%82%a4%ed%85%8d%ec%b2%98>#</a></h3><pre tabindex=0><code>┌─────────────────────────────────────────────────────────────────────────┐
│                           Frontend (React)                               │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         FastAPI Backend                                  │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │ Auth API    │  │ Timeline API│  │ Report API  │  │ Health API  │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│         │                │                │                │            │
│         └────────────────┼────────────────┼────────────────┘            │
│                          ▼                ▼                              │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │              model/data.py (Pydantic Schemas)                      │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                    SQLAlchemy AsyncSession                         │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │                    Connection Pool (asyncpg)                 │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                    PostgreSQL 15 + pgvector (Docker)                     │
│  ┌─────────────────────────────────────────────────────────────────────┐│
│  │                         pgvector Extension                           ││
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐       ││
│  │  │employee │ │  task   │ │  slack  │ │ notion  │ │ outlook │       ││
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘       ││
│  │              ┌─────────┐ ┌─────────┐                                ││
│  │              │onedrive │ │ report  │  ← Vector Embeddings           ││
│  │              └─────────┘ └─────────┘                                ││
│  └─────────────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────────────┘
</code></pre><h3 id=22-데이터-흐름>2.2 데이터 흐름
<a class=anchor href=#22-%eb%8d%b0%ec%9d%b4%ed%84%b0-%ed%9d%90%eb%a6%84>#</a></h3><pre tabindex=0><code>┌──────────────┐     ┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│   Slack      │     │   Notion     │     │  OneDrive    │     │   Outlook    │
│  Messages    │     │   Pages      │     │   Files      │     │   Emails     │
└──────┬───────┘     └──────┬───────┘     └──────┬───────┘     └──────┬───────┘
       │                    │                    │                    │
       └────────────────────┼────────────────────┼────────────────────┘
                            ▼
              ┌─────────────────────────────┐
              │    Data Ingestion Layer     │
              │  (Normalize &amp; Transform)    │
              └─────────────┬───────────────┘
                            │
              ┌─────────────▼───────────────┐
              │    Embedding Generation     │
              │  (sentence-transformers)    │
              └─────────────┬───────────────┘
                            │
              ┌─────────────▼───────────────┐
              │     PostgreSQL Storage      │
              │  (Content + Vector Index)   │
              └─────────────┬───────────────┘
                            │
       ┌────────────────────┼────────────────────┐
       ▼                    ▼                    ▼
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│  Timeline    │     │  Semantic    │     │   Report     │
│   Query      │     │   Search     │     │  Generation  │
└──────────────┘     └──────────────┘     └──────────────┘
</code></pre><h3 id=23-erd-entity-relationship-diagram>2.3 ERD (Entity Relationship Diagram)
<a class=anchor href=#23-erd-entity-relationship-diagram>#</a></h3><pre tabindex=0><code>┌──────────────────┐          ┌──────────────────┐
│    employee      │          │      task        │
├──────────────────┤          ├──────────────────┤
│ id (PK)          │          │ id (PK)          │
│ name             │          │ task_uuid        │
│ email (UNIQUE)   │          │ description      │
│ password         │          └────────┬─────────┘
│ job_grade        │                   │
└──────────────────┘                   │ 1:N
                                       │
       ┌───────────────┬───────────────┼───────────────┬───────────────┐
       │               │               │               │               │
       ▼               ▼               ▼               ▼               ▼
┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐
│    slack     │ │   notion     │ │   onedrive   │ │   outlook    │ │   report     │
├──────────────┤ ├──────────────┤ ├──────────────┤ ├──────────────┤ ├──────────────┤
│ id (PK)      │ │ id (PK)      │ │ id (PK)      │ │ id (PK)      │ │ id (PK)      │
│ task_id (FK) │ │ task_id (FK) │ │ task_id (FK) │ │ task_id (FK) │ │ task_id (FK) │
│ sender       │ │ participant  │ │ writer       │ │ sender       │ │ writer       │
│ receiver     │ │ timestamp    │ │ timestamp    │ │ receiver     │ │ email        │
│ timestamp    │ │ content      │ │ content      │ │ timestamp    │ │ timestamp    │
│ content      │ │ embedding    │ │ embedding    │ │ content      │ │ report       │
│ embedding    │ │ vector(768)  │ │ vector(768)  │ │ embedding    │ │ embedding    │
│ vector(384)  │ └──────────────┘ └──────────────┘ │ vector(768)  │ │ vector(384)  │
└──────────────┘                                   └──────────────┘ └──────────────┘
</code></pre><hr><h2 id=3-스키마-설계>3. 스키마 설계
<a class=anchor href=#3-%ec%8a%a4%ed%82%a4%eb%a7%88-%ec%84%a4%ea%b3%84>#</a></h2><h3 id=31-테이블-정의>3.1 테이블 정의
<a class=anchor href=#31-%ed%85%8c%ec%9d%b4%eb%b8%94-%ec%a0%95%ec%9d%98>#</a></h3><h4 id=employee-테이블-사용자-관리>employee 테이블 (사용자 관리)
<a class=anchor href=#employee-%ed%85%8c%ec%9d%b4%eb%b8%94-%ec%82%ac%ec%9a%a9%ec%9e%90-%ea%b4%80%eb%a6%ac>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>EXISTS</span> <span style=color:#66d9ef>public</span>.employee (
</span></span><span style=display:flex><span>    id SERIAL <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>,
</span></span><span style=display:flex><span>    name VARCHAR(<span style=color:#ae81ff>50</span>) <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>    email VARCHAR(<span style=color:#ae81ff>100</span>) <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>UNIQUE</span>,
</span></span><span style=display:flex><span>    password VARCHAR(<span style=color:#ae81ff>255</span>) <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>    job_grade VARCHAR(<span style=color:#ae81ff>50</span>)
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 인덱스
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>UNIQUE</span> <span style=color:#66d9ef>INDEX</span> idx_employee_email <span style=color:#66d9ef>ON</span> employee(email);
</span></span></code></pre></div><table><thead><tr><th>컬럼</th><th>타입</th><th>제약조건</th><th>설명</th></tr></thead><tbody><tr><td>id</td><td>SERIAL</td><td>PRIMARY KEY</td><td>자동 증가 ID</td></tr><tr><td>name</td><td>VARCHAR(50)</td><td>NOT NULL</td><td>사용자 이름</td></tr><tr><td>email</td><td>VARCHAR(100)</td><td>UNIQUE, NOT NULL</td><td>로그인 이메일</td></tr><tr><td>password</td><td>VARCHAR(255)</td><td>NOT NULL</td><td>bcrypt 해시</td></tr><tr><td>job_grade</td><td>VARCHAR(50)</td><td>-</td><td>직급</td></tr></tbody></table><h4 id=task-테이블-프로젝트업무-관리>task 테이블 (프로젝트/업무 관리)
<a class=anchor href=#task-%ed%85%8c%ec%9d%b4%eb%b8%94-%ed%94%84%eb%a1%9c%ec%a0%9d%ed%8a%b8%ec%97%85%eb%ac%b4-%ea%b4%80%eb%a6%ac>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>EXISTS</span> <span style=color:#66d9ef>public</span>.task (
</span></span><span style=display:flex><span>    id SERIAL <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>,
</span></span><span style=display:flex><span>    task_uuid VARCHAR(<span style=color:#ae81ff>50</span>),
</span></span><span style=display:flex><span>    description TEXT
</span></span><span style=display:flex><span>);
</span></span></code></pre></div><table><thead><tr><th>컬럼</th><th>타입</th><th>제약조건</th><th>설명</th></tr></thead><tbody><tr><td>id</td><td>SERIAL</td><td>PRIMARY KEY</td><td>자동 증가 ID</td></tr><tr><td>task_uuid</td><td>VARCHAR(50)</td><td>-</td><td>외부 시스템 UUID</td></tr><tr><td>description</td><td>TEXT</td><td>-</td><td>프로젝트 설명</td></tr></tbody></table><h4 id=slack-테이블-slack-메시지>slack 테이블 (Slack 메시지)
<a class=anchor href=#slack-%ed%85%8c%ec%9d%b4%eb%b8%94-slack-%eb%a9%94%ec%8b%9c%ec%a7%80>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>EXISTS</span> <span style=color:#66d9ef>public</span>.slack (
</span></span><span style=display:flex><span>    id SERIAL <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>,
</span></span><span style=display:flex><span>    sender VARCHAR(<span style=color:#ae81ff>50</span>),
</span></span><span style=display:flex><span>    receiver VARCHAR(<span style=color:#ae81ff>50</span>),
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;timestamp&#34;</span> <span style=color:#66d9ef>TIMESTAMP</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>    task_id INTEGER <span style=color:#66d9ef>REFERENCES</span> <span style=color:#66d9ef>public</span>.task(id),
</span></span><span style=display:flex><span>    content TEXT,
</span></span><span style=display:flex><span>    embedding vector(<span style=color:#ae81ff>384</span>)
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 인덱스
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>INDEX</span> idx_slack_timestamp <span style=color:#66d9ef>ON</span> slack(<span style=color:#e6db74>&#34;timestamp&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>INDEX</span> idx_slack_sender <span style=color:#66d9ef>ON</span> slack(sender);
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>INDEX</span> idx_slack_task_id <span style=color:#66d9ef>ON</span> slack(task_id);
</span></span></code></pre></div><table><thead><tr><th>컬럼</th><th>타입</th><th>제약조건</th><th>설명</th></tr></thead><tbody><tr><td>id</td><td>SERIAL</td><td>PRIMARY KEY</td><td>자동 증가 ID</td></tr><tr><td>sender</td><td>VARCHAR(50)</td><td>-</td><td>발신자</td></tr><tr><td>receiver</td><td>VARCHAR(50)</td><td>-</td><td>수신자</td></tr><tr><td>timestamp</td><td>TIMESTAMP</td><td>NOT NULL</td><td>전송 시간</td></tr><tr><td>task_id</td><td>INTEGER</td><td>FOREIGN KEY</td><td>연관 프로젝트</td></tr><tr><td>content</td><td>TEXT</td><td>-</td><td>메시지 내용</td></tr><tr><td>embedding</td><td>vector(384)</td><td>-</td><td>문장 임베딩</td></tr></tbody></table><h4 id=notion-테이블-notion-문서>notion 테이블 (Notion 문서)
<a class=anchor href=#notion-%ed%85%8c%ec%9d%b4%eb%b8%94-notion-%eb%ac%b8%ec%84%9c>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>EXISTS</span> <span style=color:#66d9ef>public</span>.notion (
</span></span><span style=display:flex><span>    id SERIAL <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>,
</span></span><span style=display:flex><span>    task_id INTEGER <span style=color:#66d9ef>REFERENCES</span> <span style=color:#66d9ef>public</span>.task(id),
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;timestamp&#34;</span> <span style=color:#66d9ef>TIMESTAMP</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>    participant_id VARCHAR(<span style=color:#ae81ff>50</span>),
</span></span><span style=display:flex><span>    content TEXT,
</span></span><span style=display:flex><span>    embedding vector(<span style=color:#ae81ff>768</span>)
</span></span><span style=display:flex><span>);
</span></span></code></pre></div><h4 id=onedrive-테이블-onedrive-파일>onedrive 테이블 (OneDrive 파일)
<a class=anchor href=#onedrive-%ed%85%8c%ec%9d%b4%eb%b8%94-onedrive-%ed%8c%8c%ec%9d%bc>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>EXISTS</span> <span style=color:#66d9ef>public</span>.onedrive (
</span></span><span style=display:flex><span>    id SERIAL <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>,
</span></span><span style=display:flex><span>    task_id INTEGER <span style=color:#66d9ef>REFERENCES</span> <span style=color:#66d9ef>public</span>.task(id),
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;timestamp&#34;</span> <span style=color:#66d9ef>TIMESTAMP</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>    writer VARCHAR(<span style=color:#ae81ff>50</span>),
</span></span><span style=display:flex><span>    content TEXT,
</span></span><span style=display:flex><span>    embedding vector(<span style=color:#ae81ff>768</span>)
</span></span><span style=display:flex><span>);
</span></span></code></pre></div><h4 id=outlook-테이블-outlook-이메일>outlook 테이블 (Outlook 이메일)
<a class=anchor href=#outlook-%ed%85%8c%ec%9d%b4%eb%b8%94-outlook-%ec%9d%b4%eb%a9%94%ec%9d%bc>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>EXISTS</span> <span style=color:#66d9ef>public</span>.outlook (
</span></span><span style=display:flex><span>    id SERIAL <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>,
</span></span><span style=display:flex><span>    task_id INTEGER <span style=color:#66d9ef>REFERENCES</span> <span style=color:#66d9ef>public</span>.task(id),
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;timestamp&#34;</span> <span style=color:#66d9ef>TIMESTAMP</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>    sender VARCHAR(<span style=color:#ae81ff>50</span>),
</span></span><span style=display:flex><span>    receiver VARCHAR(<span style=color:#ae81ff>50</span>),
</span></span><span style=display:flex><span>    content TEXT,
</span></span><span style=display:flex><span>    embedding vector(<span style=color:#ae81ff>768</span>)
</span></span><span style=display:flex><span>);
</span></span></code></pre></div><h4 id=report-테이블-생성된-보고서>report 테이블 (생성된 보고서)
<a class=anchor href=#report-%ed%85%8c%ec%9d%b4%eb%b8%94-%ec%83%9d%ec%84%b1%eb%90%9c-%eb%b3%b4%ea%b3%a0%ec%84%9c>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>EXISTS</span> <span style=color:#66d9ef>public</span>.report (
</span></span><span style=display:flex><span>    id SERIAL <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>,
</span></span><span style=display:flex><span>    task_id INTEGER <span style=color:#66d9ef>REFERENCES</span> <span style=color:#66d9ef>public</span>.task(id),
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;timestamp&#34;</span> <span style=color:#66d9ef>TIMESTAMP</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>    writer VARCHAR(<span style=color:#ae81ff>50</span>),
</span></span><span style=display:flex><span>    email VARCHAR(<span style=color:#ae81ff>100</span>),
</span></span><span style=display:flex><span>    report TEXT,
</span></span><span style=display:flex><span>    report_embedded vector(<span style=color:#ae81ff>384</span>)
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 벡터 검색 인덱스
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>INDEX</span> idx_report_embedding <span style=color:#66d9ef>ON</span> report
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>USING</span> ivfflat (report_embedded vector_cosine_ops)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>WITH</span> (lists <span style=color:#f92672>=</span> <span style=color:#ae81ff>100</span>);
</span></span></code></pre></div><h3 id=32-벡터-차원-설계-근거>3.2 벡터 차원 설계 근거
<a class=anchor href=#32-%eb%b2%a1%ed%84%b0-%ec%b0%a8%ec%9b%90-%ec%84%a4%ea%b3%84-%ea%b7%bc%ea%b1%b0>#</a></h3><pre tabindex=0><code>┌─────────────────────────────────────────────────────────────────────┐
│                    Vector Dimension Strategy                         │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  384차원 (slack, report):                                            │
│  ├── 짧은 텍스트 (메시지, 보고서 요약)                                  │
│  ├── 빠른 검색 속도 우선                                               │
│  └── 저장 공간 효율성                                                  │
│                                                                      │
│  768차원 (notion, onedrive, outlook):                                │
│  ├── 긴 텍스트 (문서, 파일, 이메일)                                    │
│  ├── 세밀한 의미 구분 필요                                             │
│  └── 검색 정확도 우선                                                  │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
</code></pre><hr><h2 id=4-벡터-검색-구현>4. 벡터 검색 구현
<a class=anchor href=#4-%eb%b2%a1%ed%84%b0-%ea%b2%80%ec%83%89-%ea%b5%ac%ed%98%84>#</a></h2><h3 id=41-pgvector-확장-설정>4.1 pgvector 확장 설정
<a class=anchor href=#41-pgvector-%ed%99%95%ec%9e%a5-%ec%84%a4%ec%a0%95>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- pgvector 확장 활성화
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> EXTENSION <span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>EXISTS</span> vector;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 벡터 타입 컬럼 추가
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> slack <span style=color:#66d9ef>ADD</span> <span style=color:#66d9ef>COLUMN</span> embedding vector(<span style=color:#ae81ff>384</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> report <span style=color:#66d9ef>ADD</span> <span style=color:#66d9ef>COLUMN</span> report_embedded vector(<span style=color:#ae81ff>384</span>);
</span></span></code></pre></div><h3 id=42-임베딩-서비스-구현>4.2 임베딩 서비스 구현
<a class=anchor href=#42-%ec%9e%84%eb%b2%a0%eb%94%a9-%ec%84%9c%eb%b9%84%ec%8a%a4-%ea%b5%ac%ed%98%84>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># main.py - ReportEmbeddingService 클래스</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> sentence_transformers <span style=color:#f92672>import</span> SentenceTransformer
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> numpy <span style=color:#66d9ef>as</span> np
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ReportEmbeddingService</span>:
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;보고서 임베딩 생성 및 유사도 검색 서비스&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    _instance <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>    _model <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__new__</span>(cls):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;싱글톤 패턴으로 모델 로딩 최소화&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> cls<span style=color:#f92672>.</span>_instance <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>            cls<span style=color:#f92672>.</span>_instance <span style=color:#f92672>=</span> super()<span style=color:#f92672>.</span><span style=color:#a6e22e>__new__</span>(cls)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> cls<span style=color:#f92672>.</span>_instance
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__init__</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ReportEmbeddingService<span style=color:#f92672>.</span>_model <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>            <span style=color:#75715e># 384차원 경량 모델 로드</span>
</span></span><span style=display:flex><span>            ReportEmbeddingService<span style=color:#f92672>.</span>_model <span style=color:#f92672>=</span> SentenceTransformer(
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;sentence-transformers/all-MiniLM-L6-v2&#39;</span>
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create_embedding</span>(self, text: str) <span style=color:#f92672>-&gt;</span> np<span style=color:#f92672>.</span>ndarray:
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;텍스트를 384차원 벡터로 변환&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> text <span style=color:#f92672>or</span> <span style=color:#f92672>not</span> text<span style=color:#f92672>.</span>strip():
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> np<span style=color:#f92672>.</span>zeros(<span style=color:#ae81ff>384</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        embedding <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_model<span style=color:#f92672>.</span>encode(
</span></span><span style=display:flex><span>            text,
</span></span><span style=display:flex><span>            convert_to_numpy<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>,
</span></span><span style=display:flex><span>            normalize_embeddings<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>  <span style=color:#75715e># 코사인 유사도 최적화</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> embedding
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create_vector_string</span>(self, embedding: np<span style=color:#f92672>.</span>ndarray) <span style=color:#f92672>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;NumPy 배열을 PostgreSQL vector 문자열로 변환&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;[</span><span style=color:#e6db74>{</span><span style=color:#e6db74>&#39;,&#39;</span><span style=color:#f92672>.</span>join(map(str, embedding<span style=color:#f92672>.</span>tolist()))<span style=color:#e6db74>}</span><span style=color:#e6db74>]&#34;</span>
</span></span></code></pre></div><h3 id=43-유사도-검색-쿼리>4.3 유사도 검색 쿼리
<a class=anchor href=#43-%ec%9c%a0%ec%82%ac%eb%8f%84-%ea%b2%80%ec%83%89-%ec%bf%bc%eb%a6%ac>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 코사인 유사도 기반 보고서 검색</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>search_similar_reports</span>(
</span></span><span style=display:flex><span>    query_embedding: str,
</span></span><span style=display:flex><span>    session: AsyncSession,
</span></span><span style=display:flex><span>    limit: int <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>) <span style=color:#f92672>-&gt;</span> list:
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    쿼리 임베딩과 유사한 보고서 검색
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Args:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        query_embedding: 검색 쿼리의 벡터 문자열
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        session: 비동기 DB 세션
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        limit: 반환할 최대 결과 수
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Returns:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        유사도 점수와 함께 정렬된 보고서 목록
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    sql <span style=color:#f92672>=</span> text(<span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        SELECT
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            id,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            task_id,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            report,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            writer,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            timestamp,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            -- 코사인 유사도 계산 (1 - 코사인 거리)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            1 - (report_embedded &lt;=&gt; :query_vector) AS similarity
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        FROM report
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        WHERE report_embedded IS NOT NULL
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ORDER BY report_embedded &lt;=&gt; :query_vector  -- 거리 기반 정렬
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        LIMIT :limit
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    result <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> session<span style=color:#f92672>.</span>execute(
</span></span><span style=display:flex><span>        sql,
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;query_vector&#34;</span>: query_embedding,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;limit&#34;</span>: limit
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> result<span style=color:#f92672>.</span>fetchall()
</span></span></code></pre></div><h3 id=44-벡터-인덱스-전략>4.4 벡터 인덱스 전략
<a class=anchor href=#44-%eb%b2%a1%ed%84%b0-%ec%9d%b8%eb%8d%b1%ec%8a%a4-%ec%a0%84%eb%9e%b5>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- IVFFlat 인덱스: 대규모 벡터 검색 최적화
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- lists = sqrt(row_count) 권장
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 보고서 테이블 벡터 인덱스
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>INDEX</span> idx_report_embedding <span style=color:#66d9ef>ON</span> report
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>USING</span> ivfflat (report_embedded vector_cosine_ops)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>WITH</span> (lists <span style=color:#f92672>=</span> <span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Slack 테이블 벡터 인덱스
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>INDEX</span> idx_slack_embedding <span style=color:#66d9ef>ON</span> slack
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>USING</span> ivfflat (embedding vector_cosine_ops)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>WITH</span> (lists <span style=color:#f92672>=</span> <span style=color:#ae81ff>100</span>);
</span></span></code></pre></div><table><thead><tr><th>인덱스 타입</th><th>장점</th><th>단점</th><th>사용 시기</th></tr></thead><tbody><tr><td><strong>IVFFlat</strong></td><td>빠른 검색</td><td>정확도 약간 감소</td><td>대규모 데이터</td></tr><tr><td><strong>HNSW</strong></td><td>높은 정확도</td><td>메모리 사용량 증가</td><td>정확도 중요</td></tr><tr><td>Flat (없음)</td><td>완벽한 정확도</td><td>느린 검색</td><td>소규모 데이터</td></tr></tbody></table><hr><h2 id=5-orm-및-비동기-처리>5. ORM 및 비동기 처리
<a class=anchor href=#5-orm-%eb%b0%8f-%eb%b9%84%eb%8f%99%ea%b8%b0-%ec%b2%98%eb%a6%ac>#</a></h2><h3 id=51-sqlalchemy-비동기-설정>5.1 SQLAlchemy 비동기 설정
<a class=anchor href=#51-sqlalchemy-%eb%b9%84%eb%8f%99%ea%b8%b0-%ec%84%a4%ec%a0%95>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># main.py - 데이터베이스 연결 설정</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> sqlalchemy.ext.asyncio <span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    create_async_engine,
</span></span><span style=display:flex><span>    async_sessionmaker,
</span></span><span style=display:flex><span>    AsyncSession
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> dotenv <span style=color:#f92672>import</span> load_dotenv
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>load_dotenv()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 환경 변수에서 연결 문자열 로드</span>
</span></span><span style=display:flex><span>DATABASE_URL <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>getenv(
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;DATABASE_URL&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;postgresql+asyncpg://myuser:mypassword@localhost:5433/mydatabase&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 비동기 엔진 생성</span>
</span></span><span style=display:flex><span>engine <span style=color:#f92672>=</span> create_async_engine(
</span></span><span style=display:flex><span>    DATABASE_URL,
</span></span><span style=display:flex><span>    echo<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>,           <span style=color:#75715e># SQL 로깅 비활성화 (프로덕션)</span>
</span></span><span style=display:flex><span>    pool_size<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>,         <span style=color:#75715e># 연결 풀 크기</span>
</span></span><span style=display:flex><span>    max_overflow<span style=color:#f92672>=</span><span style=color:#ae81ff>20</span>,      <span style=color:#75715e># 최대 오버플로우 연결</span>
</span></span><span style=display:flex><span>    pool_pre_ping<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>,   <span style=color:#75715e># 연결 유효성 검사</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 비동기 세션 팩토리</span>
</span></span><span style=display:flex><span>async_session <span style=color:#f92672>=</span> async_sessionmaker(
</span></span><span style=display:flex><span>    engine,
</span></span><span style=display:flex><span>    class_<span style=color:#f92672>=</span>AsyncSession,
</span></span><span style=display:flex><span>    expire_on_commit<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><h3 id=52-의존성-주입-패턴>5.2 의존성 주입 패턴
<a class=anchor href=#52-%ec%9d%98%ec%a1%b4%ec%84%b1-%ec%a3%bc%ec%9e%85-%ed%8c%a8%ed%84%b4>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># FastAPI 의존성 주입</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> fastapi <span style=color:#f92672>import</span> Depends
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> typing <span style=color:#f92672>import</span> AsyncGenerator
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_db_session</span>() <span style=color:#f92672>-&gt;</span> AsyncGenerator[AsyncSession, <span style=color:#66d9ef>None</span>]:
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    데이터베이스 세션 의존성 주입
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - 요청마다 새 세션 생성
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - 요청 완료 후 자동 세션 종료
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - 예외 발생 시 자동 롤백
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>with</span> async_session() <span style=color:#66d9ef>as</span> session:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>yield</span> session
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>await</span> session<span style=color:#f92672>.</span>commit()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>await</span> session<span style=color:#f92672>.</span>rollback()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>raise</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>finally</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>await</span> session<span style=color:#f92672>.</span>close()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 엔드포인트에서 사용</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.get</span>(<span style=color:#e6db74>&#34;/api/users&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_users</span>(session: AsyncSession <span style=color:#f92672>=</span> Depends(get_db_session)):
</span></span><span style=display:flex><span>    result <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> session<span style=color:#f92672>.</span>execute(text(<span style=color:#e6db74>&#34;SELECT * FROM employee&#34;</span>))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> result<span style=color:#f92672>.</span>fetchall()
</span></span></code></pre></div><h3 id=53-트랜잭션-관리>5.3 트랜잭션 관리
<a class=anchor href=#53-%ed%8a%b8%eb%9e%9c%ec%9e%ad%ec%85%98-%ea%b4%80%eb%a6%ac>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 복잡한 트랜잭션 처리 예시</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create_report_with_embedding</span>(
</span></span><span style=display:flex><span>    task_id: int,
</span></span><span style=display:flex><span>    content: str,
</span></span><span style=display:flex><span>    writer: str,
</span></span><span style=display:flex><span>    email: str,
</span></span><span style=display:flex><span>    session: AsyncSession
</span></span><span style=display:flex><span>) <span style=color:#f92672>-&gt;</span> int:
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    보고서 생성 및 임베딩 저장 (단일 트랜잭션)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    1. 보고서 레코드 삽입
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    2. 임베딩 벡터 생성
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    3. 임베딩 업데이트
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    4. 커밋 또는 롤백
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        <span style=color:#75715e># 1. 보고서 삽입</span>
</span></span><span style=display:flex><span>        insert_sql <span style=color:#f92672>=</span> text(<span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            INSERT INTO report (task_id, timestamp, writer, email, report)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            VALUES (:task_id, NOW(), :writer, :email, :report)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            RETURNING id
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        result <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> session<span style=color:#f92672>.</span>execute(insert_sql, {
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;task_id&#34;</span>: task_id,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;writer&#34;</span>: writer,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;email&#34;</span>: email,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;report&#34;</span>: content
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        report_id <span style=color:#f92672>=</span> result<span style=color:#f92672>.</span>scalar_one()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># 2. 임베딩 생성</span>
</span></span><span style=display:flex><span>        embedding_service <span style=color:#f92672>=</span> ReportEmbeddingService()
</span></span><span style=display:flex><span>        embedding <span style=color:#f92672>=</span> embedding_service<span style=color:#f92672>.</span>create_embedding(content)
</span></span><span style=display:flex><span>        vector_str <span style=color:#f92672>=</span> embedding_service<span style=color:#f92672>.</span>create_vector_string(embedding)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># 3. 임베딩 업데이트</span>
</span></span><span style=display:flex><span>        update_sql <span style=color:#f92672>=</span> text(<span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            UPDATE report
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            SET report_embedded = :embedding::vector
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            WHERE id = :report_id
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>await</span> session<span style=color:#f92672>.</span>execute(update_sql, {
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;embedding&#34;</span>: vector_str,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;report_id&#34;</span>: report_id
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># 4. 커밋</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>await</span> session<span style=color:#f92672>.</span>commit()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> report_id
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>await</span> session<span style=color:#f92672>.</span>rollback()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>raise</span> e
</span></span></code></pre></div><h3 id=54-raw-sql-vs-orm>5.4 Raw SQL vs ORM
<a class=anchor href=#54-raw-sql-vs-orm>#</a></h3><p>프로젝트에서는 Raw SQL을 선택했습니다:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Raw SQL 사용 (선택)</span>
</span></span><span style=display:flex><span>sql <span style=color:#f92672>=</span> text(<span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    SELECT s.*, t.description
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    FROM slack s
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    JOIN task t ON s.task_id = t.id
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    WHERE s.sender = :user_name
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    AND s.timestamp BETWEEN :start_ts AND :end_ts
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    ORDER BY s.timestamp DESC
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>)
</span></span><span style=display:flex><span>result <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> session<span style=color:#f92672>.</span>execute(sql, params)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ORM 사용 (대안)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># stmt = (</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#     select(Slack, Task.description)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#     .join(Task)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#     .where(Slack.sender == user_name)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#     .where(Slack.timestamp.between(start_ts, end_ts))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#     .order_by(Slack.timestamp.desc())</span>
</span></span><span style=display:flex><span><span style=color:#75715e># )</span>
</span></span><span style=display:flex><span><span style=color:#75715e># result = await session.execute(stmt)</span>
</span></span></code></pre></div><table><thead><tr><th>비교 항목</th><th>Raw SQL</th><th>ORM</th></tr></thead><tbody><tr><td>성능</td><td>✅ 더 빠름</td><td>약간 오버헤드</td></tr><tr><td>복잡한 쿼리</td><td>✅ 자유로움</td><td>제한적</td></tr><tr><td>타입 안전성</td><td>❌ 없음</td><td>✅ 있음</td></tr><tr><td>유지보수</td><td>⚠️ 어려움</td><td>✅ 쉬움</td></tr><tr><td>pgvector 지원</td><td>✅ 완벽</td><td>⚠️ 제한적</td></tr></tbody></table><p><strong>선택 이유:</strong> pgvector 연산자 (<code>&lt;=></code>) 및 복잡한 집계 쿼리 지원</p><hr><h2 id=6-api-엔드포인트-설계>6. API 엔드포인트 설계
<a class=anchor href=#6-api-%ec%97%94%eb%93%9c%ed%8f%ac%ec%9d%b8%ed%8a%b8-%ec%84%a4%ea%b3%84>#</a></h2><h3 id=61-엔드포인트-구조>6.1 엔드포인트 구조
<a class=anchor href=#61-%ec%97%94%eb%93%9c%ed%8f%ac%ec%9d%b8%ed%8a%b8-%ea%b5%ac%ec%a1%b0>#</a></h3><pre tabindex=0><code>┌─────────────────────────────────────────────────────────────────────────┐
│                           API Endpoints                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  Authentication                                                          │
│  ├── POST /signup          사용자 회원가입                                │
│  └── POST /login           사용자 로그인                                  │
│                                                                          │
│  Timeline                                                                │
│  ├── GET /api/user-timeline/{email}   사용자 업무 타임라인 조회            │
│  └── GET /api/user-summary/{email}    사용자 활동 요약                    │
│                                                                          │
│  Users                                                                   │
│  └── GET /api/users        전체 사용자 목록                               │
│                                                                          │
│  Reports                                                                 │
│  ├── POST /reports/weekly            주간 보고서 생성                     │
│  └── POST /api/generate-summary      AI 요약 생성 (유사도 검색)           │
│                                                                          │
│  Health                                                                  │
│  ├── GET /health           서비스 상태 확인                               │
│  └── GET /api/db-health    DB 연결 상태 확인                              │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre><h3 id=62-주요-엔드포인트-구현>6.2 주요 엔드포인트 구현
<a class=anchor href=#62-%ec%a3%bc%ec%9a%94-%ec%97%94%eb%93%9c%ed%8f%ac%ec%9d%b8%ed%8a%b8-%ea%b5%ac%ed%98%84>#</a></h3><h4 id=사용자-타임라인-조회>사용자 타임라인 조회
<a class=anchor href=#%ec%82%ac%ec%9a%a9%ec%9e%90-%ed%83%80%ec%9e%84%eb%9d%bc%ec%9d%b8-%ec%a1%b0%ed%9a%8c>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#a6e22e>@app.get</span>(<span style=color:#e6db74>&#34;/api/user-timeline/</span><span style=color:#e6db74>{email}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_user_timeline</span>(
</span></span><span style=display:flex><span>    email: str,
</span></span><span style=display:flex><span>    start_date: str <span style=color:#f92672>=</span> Query(<span style=color:#f92672>...</span>),
</span></span><span style=display:flex><span>    end_date: str <span style=color:#f92672>=</span> Query(<span style=color:#f92672>...</span>),
</span></span><span style=display:flex><span>    session: AsyncSession <span style=color:#f92672>=</span> Depends(get_db_session)
</span></span><span style=display:flex><span>) <span style=color:#f92672>-&gt;</span> UserTimelineResponse:
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    사용자의 통합 업무 타임라인 조회
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - Slack, Notion, OneDrive, Outlook 데이터 통합
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - 날짜 범위 필터링
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - 시간순 정렬
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 사용자 이름 조회 (이메일 → 이름)</span>
</span></span><span style=display:flex><span>    user_result <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> session<span style=color:#f92672>.</span>execute(
</span></span><span style=display:flex><span>        text(<span style=color:#e6db74>&#34;SELECT name FROM employee WHERE email = :email&#34;</span>),
</span></span><span style=display:flex><span>        {<span style=color:#e6db74>&#34;email&#34;</span>: email}
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    user <span style=color:#f92672>=</span> user_result<span style=color:#f92672>.</span>fetchone()
</span></span><span style=display:flex><span>    user_name <span style=color:#f92672>=</span> user[<span style=color:#ae81ff>0</span>] <span style=color:#66d9ef>if</span> user <span style=color:#66d9ef>else</span> email<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;@&#39;</span>)[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 타임스탬프 변환</span>
</span></span><span style=display:flex><span>    start_ts <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>strptime(start_date, <span style=color:#e6db74>&#34;%Y-%m-</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    end_ts <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>strptime(end_date, <span style=color:#e6db74>&#34;%Y-%m-</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span>) <span style=color:#f92672>+</span> timedelta(days<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    activities <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    summary <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 1. Slack 데이터 조회</span>
</span></span><span style=display:flex><span>    slack_sql <span style=color:#f92672>=</span> text(<span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        SELECT id, sender, receiver, timestamp, task_id, content
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        FROM slack
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        WHERE (sender = :user_name OR receiver = :user_name)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        AND timestamp BETWEEN :start_ts AND :end_ts
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ORDER BY timestamp DESC
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>)
</span></span><span style=display:flex><span>    slack_result <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> session<span style=color:#f92672>.</span>execute(slack_sql, {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;user_name&#34;</span>: user_name,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;start_ts&#34;</span>: start_ts,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;end_ts&#34;</span>: end_ts
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> row <span style=color:#f92672>in</span> slack_result<span style=color:#f92672>.</span>fetchall():
</span></span><span style=display:flex><span>        activities<span style=color:#f92672>.</span>append(TimelineActivity(
</span></span><span style=display:flex><span>            source<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;slack&#34;</span>,
</span></span><span style=display:flex><span>            timestamp<span style=color:#f92672>=</span>row<span style=color:#f92672>.</span>timestamp<span style=color:#f92672>.</span>isoformat(),
</span></span><span style=display:flex><span>            content<span style=color:#f92672>=</span>row<span style=color:#f92672>.</span>content,
</span></span><span style=display:flex><span>            metadata<span style=color:#f92672>=</span>{
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;id&#34;</span>: row<span style=color:#f92672>.</span>id,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;sender&#34;</span>: row<span style=color:#f92672>.</span>sender,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;receiver&#34;</span>: row<span style=color:#f92672>.</span>receiver,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;task_id&#34;</span>: row<span style=color:#f92672>.</span>task_id
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        ))
</span></span><span style=display:flex><span>    summary[<span style=color:#e6db74>&#34;slack&#34;</span>] <span style=color:#f92672>=</span> len([a <span style=color:#66d9ef>for</span> a <span style=color:#f92672>in</span> activities <span style=color:#66d9ef>if</span> a<span style=color:#f92672>.</span>source <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;slack&#34;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 2. Notion, OneDrive, Outlook도 동일한 패턴으로 조회</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># ... (생략)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 시간순 정렬</span>
</span></span><span style=display:flex><span>    activities<span style=color:#f92672>.</span>sort(key<span style=color:#f92672>=</span><span style=color:#66d9ef>lambda</span> x: x<span style=color:#f92672>.</span>timestamp, reverse<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> UserTimelineResponse(
</span></span><span style=display:flex><span>        user_id<span style=color:#f92672>=</span>email,
</span></span><span style=display:flex><span>        start_date<span style=color:#f92672>=</span>start_date,
</span></span><span style=display:flex><span>        end_date<span style=color:#f92672>=</span>end_date,
</span></span><span style=display:flex><span>        activities<span style=color:#f92672>=</span>activities,
</span></span><span style=display:flex><span>        summary<span style=color:#f92672>=</span>summary
</span></span><span style=display:flex><span>    )
</span></span></code></pre></div><h4 id=주간-보고서-생성>주간 보고서 생성
<a class=anchor href=#%ec%a3%bc%ea%b0%84-%eb%b3%b4%ea%b3%a0%ec%84%9c-%ec%83%9d%ec%84%b1>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#a6e22e>@app.post</span>(<span style=color:#e6db74>&#34;/reports/weekly&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create_weekly_report</span>(
</span></span><span style=display:flex><span>    request: ReportIn,
</span></span><span style=display:flex><span>    session: AsyncSession <span style=color:#f92672>=</span> Depends(get_db_session)
</span></span><span style=display:flex><span>):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    주간 보고서 생성
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    1. 플랫폼별 데이터 수집
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    2. Task별 그룹핑
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    3. LLM으로 보고서 생성
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    4. 임베딩과 함께 저장
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 날짜 파싱</span>
</span></span><span style=display:flex><span>    start_ts <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>strptime(request<span style=color:#f92672>.</span>start, <span style=color:#e6db74>&#34;%Y-%m-</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    end_ts <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>strptime(request<span style=color:#f92672>.</span>end, <span style=color:#e6db74>&#34;%Y-%m-</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span>) <span style=color:#f92672>+</span> timedelta(days<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 플랫폼별 데이터 수집</span>
</span></span><span style=display:flex><span>    all_data <span style=color:#f92672>=</span> {}  <span style=color:#75715e># {task_id: {platform: [data...]}}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> platform, ids <span style=color:#f92672>in</span> request<span style=color:#f92672>.</span>platform_ids<span style=color:#f92672>.</span>items():
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> ids:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        table_name <span style=color:#f92672>=</span> platform<span style=color:#f92672>.</span>lower()
</span></span><span style=display:flex><span>        sql <span style=color:#f92672>=</span> text(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            SELECT id, task_id, content, timestamp
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            FROM </span><span style=color:#e6db74>{</span>table_name<span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            WHERE id = ANY(:ids)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            AND timestamp BETWEEN :start_ts AND :end_ts
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        result <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> session<span style=color:#f92672>.</span>execute(sql, {
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;ids&#34;</span>: ids,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;start_ts&#34;</span>: start_ts,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;end_ts&#34;</span>: end_ts
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> row <span style=color:#f92672>in</span> result<span style=color:#f92672>.</span>fetchall():
</span></span><span style=display:flex><span>            task_id <span style=color:#f92672>=</span> row<span style=color:#f92672>.</span>task_id
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> task_id <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> all_data:
</span></span><span style=display:flex><span>                all_data[task_id] <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> platform <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> all_data[task_id]:
</span></span><span style=display:flex><span>                all_data[task_id][platform] <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>            all_data[task_id][platform]<span style=color:#f92672>.</span>append({
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;content&#34;</span>: row<span style=color:#f92672>.</span>content,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;timestamp&#34;</span>: row<span style=color:#f92672>.</span>timestamp<span style=color:#f92672>.</span>isoformat()
</span></span><span style=display:flex><span>            })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Task별 보고서 생성</span>
</span></span><span style=display:flex><span>    reports <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> task_id, platform_data <span style=color:#f92672>in</span> all_data<span style=color:#f92672>.</span>items():
</span></span><span style=display:flex><span>        <span style=color:#75715e># LLM으로 보고서 생성</span>
</span></span><span style=display:flex><span>        report_content <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> generate_report_with_fallback(
</span></span><span style=display:flex><span>            task_id, platform_data, start_ts, end_ts, session
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># 임베딩과 함께 저장</span>
</span></span><span style=display:flex><span>        report_id <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> store_report_with_embedding(
</span></span><span style=display:flex><span>            task_id, report_content, request<span style=color:#f92672>.</span>start, request<span style=color:#f92672>.</span>end,
</span></span><span style=display:flex><span>            request<span style=color:#f92672>.</span>writer, request<span style=color:#f92672>.</span>email, session
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        reports<span style=color:#f92672>.</span>append({
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;task_id&#34;</span>: task_id,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;report&#34;</span>: report_content
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;platform_ids&#34;</span>: request<span style=color:#f92672>.</span>platform_ids,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;range&#34;</span>: {<span style=color:#e6db74>&#34;start&#34;</span>: request<span style=color:#f92672>.</span>start, <span style=color:#e6db74>&#34;end&#34;</span>: request<span style=color:#f92672>.</span>end},
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;reports&#34;</span>: reports
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><h3 id=63-pydantic-스키마>6.3 Pydantic 스키마
<a class=anchor href=#63-pydantic-%ec%8a%a4%ed%82%a4%eb%a7%88>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 요청/응답 스키마 정의</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pydantic <span style=color:#f92672>import</span> BaseModel, EmailStr
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> typing <span style=color:#f92672>import</span> Optional, Dict, List, Any
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> datetime <span style=color:#f92672>import</span> datetime
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Authentication</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>EmployeeCreate</span>(BaseModel):
</span></span><span style=display:flex><span>    name: str
</span></span><span style=display:flex><span>    email: EmailStr
</span></span><span style=display:flex><span>    password: str
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>EmployeeLogin</span>(BaseModel):
</span></span><span style=display:flex><span>    email: EmailStr
</span></span><span style=display:flex><span>    password: str
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>EmployeeOut</span>(BaseModel):
</span></span><span style=display:flex><span>    id: int
</span></span><span style=display:flex><span>    name: str
</span></span><span style=display:flex><span>    email: str
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Timeline</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TimelineActivity</span>(BaseModel):
</span></span><span style=display:flex><span>    source: str              <span style=color:#75715e># &#34;slack&#34;, &#34;notion&#34;, &#34;onedrive&#34;, &#34;outlook&#34;</span>
</span></span><span style=display:flex><span>    timestamp: str           <span style=color:#75715e># ISO 8601 형식</span>
</span></span><span style=display:flex><span>    content: str
</span></span><span style=display:flex><span>    metadata: Dict[str, Any]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserTimelineResponse</span>(BaseModel):
</span></span><span style=display:flex><span>    user_id: str
</span></span><span style=display:flex><span>    start_date: str
</span></span><span style=display:flex><span>    end_date: str
</span></span><span style=display:flex><span>    activities: List[TimelineActivity]
</span></span><span style=display:flex><span>    summary: Dict[str, int]  <span style=color:#75715e># {&#34;slack&#34;: 10, &#34;notion&#34;: 5, ...}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Report</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ReportIn</span>(BaseModel):
</span></span><span style=display:flex><span>    platform_ids: Dict[str, List[int]]  <span style=color:#75715e># {&#34;slack&#34;: [1,2,3], ...}</span>
</span></span><span style=display:flex><span>    start: str                           <span style=color:#75715e># &#34;2024-01-01&#34;</span>
</span></span><span style=display:flex><span>    end: str                             <span style=color:#75715e># &#34;2024-01-07&#34;</span>
</span></span><span style=display:flex><span>    writer: str
</span></span><span style=display:flex><span>    email: EmailStr
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ReportResponse</span>(BaseModel):
</span></span><span style=display:flex><span>    success: bool
</span></span><span style=display:flex><span>    summary: Optional[str]
</span></span><span style=display:flex><span>    used_reports: List[Dict[str, Any]]
</span></span><span style=display:flex><span>    similarities: List[float]
</span></span></code></pre></div><hr><h2 id=7-docker-컨테이너화>7. Docker 컨테이너화
<a class=anchor href=#7-docker-%ec%bb%a8%ed%85%8c%ec%9d%b4%eb%84%88%ed%99%94>#</a></h2><h3 id=71-docker-compose-설정>7.1 Docker Compose 설정
<a class=anchor href=#71-docker-compose-%ec%84%a4%ec%a0%95>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># docker-compose.yml</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;3.8&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>postgres</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>pgvector/pgvector:pg15</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>weekly-report-postgres</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>POSTGRES_USER</span>: <span style=color:#ae81ff>myuser</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>POSTGRES_PASSWORD</span>: <span style=color:#ae81ff>mypassword</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>POSTGRES_DB</span>: <span style=color:#ae81ff>mydatabase</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;5433:5432&#34;</span>          <span style=color:#75715e># 호스트 5433 → 컨테이너 5432</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>postgres_data:/var/lib/postgresql/data</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./init.sql:/docker-entrypoint-initdb.d/init.sql</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>healthcheck</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>test</span>: [<span style=color:#e6db74>&#34;CMD-SHELL&#34;</span>, <span style=color:#e6db74>&#34;pg_isready -U myuser -d mydatabase&#34;</span>]
</span></span><span style=display:flex><span>      <span style=color:#f92672>interval</span>: <span style=color:#ae81ff>10s</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>timeout</span>: <span style=color:#ae81ff>5s</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>retries</span>: <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>postgres_data</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>driver</span>: <span style=color:#ae81ff>local</span>
</span></span></code></pre></div><h3 id=72-초기화-스크립트>7.2 초기화 스크립트
<a class=anchor href=#72-%ec%b4%88%ea%b8%b0%ed%99%94-%ec%8a%a4%ed%81%ac%eb%a6%bd%ed%8a%b8>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- init.sql (컨테이너 최초 실행 시 자동 실행)
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 1. pgvector 확장 활성화
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> EXTENSION <span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>EXISTS</span> vector;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 2. 테이블 생성
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>EXISTS</span> <span style=color:#66d9ef>public</span>.employee (...);
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>EXISTS</span> <span style=color:#66d9ef>public</span>.task (...);
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>EXISTS</span> <span style=color:#66d9ef>public</span>.slack (...);
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>EXISTS</span> <span style=color:#66d9ef>public</span>.notion (...);
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>EXISTS</span> <span style=color:#66d9ef>public</span>.onedrive (...);
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>EXISTS</span> <span style=color:#66d9ef>public</span>.outlook (...);
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>EXISTS</span> <span style=color:#66d9ef>public</span>.report (...);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 3. 초기 데이터 삽입
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#66d9ef>public</span>.task ...;
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#66d9ef>public</span>.employee ...;
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#66d9ef>public</span>.slack ...;
</span></span><span style=display:flex><span><span style=color:#75715e>-- ...
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 4. 시퀀스 리셋
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> setval(<span style=color:#e6db74>&#39;public.task_id_seq&#39;</span>, ...);
</span></span></code></pre></div><h3 id=73-실행-명령어>7.3 실행 명령어
<a class=anchor href=#73-%ec%8b%a4%ed%96%89-%eb%aa%85%eb%a0%b9%ec%96%b4>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 컨테이너 시작</span>
</span></span><span style=display:flex><span>docker-compose up -d
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 로그 확인</span>
</span></span><span style=display:flex><span>docker-compose logs -f postgres
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 상태 확인</span>
</span></span><span style=display:flex><span>docker-compose ps
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 컨테이너 접속</span>
</span></span><span style=display:flex><span>docker exec -it weekly-report-postgres psql -U myuser -d mydatabase
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 컨테이너 중지</span>
</span></span><span style=display:flex><span>docker-compose down
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 볼륨 포함 삭제 (데이터 초기화)</span>
</span></span><span style=display:flex><span>docker-compose down -v
</span></span></code></pre></div><h3 id=74-환경-변수-관리>7.4 환경 변수 관리
<a class=anchor href=#74-%ed%99%98%ea%b2%bd-%eb%b3%80%ec%88%98-%ea%b4%80%eb%a6%ac>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># .env 파일</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># PostgreSQL 연결 문자열 (asyncpg 드라이버)</span>
</span></span><span style=display:flex><span>DATABASE_URL<span style=color:#f92672>=</span>postgresql+asyncpg://myuser:mypassword@localhost:5433/mydatabase
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># OpenAI API 키 (보고서 생성용)</span>
</span></span><span style=display:flex><span>OPENAI_API_KEY<span style=color:#f92672>=</span>sk-proj-...
</span></span></code></pre></div><hr><h2 id=8-성능-최적화>8. 성능 최적화
<a class=anchor href=#8-%ec%84%b1%eb%8a%a5-%ec%b5%9c%ec%a0%81%ed%99%94>#</a></h2><h3 id=81-인덱스-전략>8.1 인덱스 전략
<a class=anchor href=#81-%ec%9d%b8%eb%8d%b1%ec%8a%a4-%ec%a0%84%eb%9e%b5>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 자주 사용되는 쿼리 패턴에 맞춘 인덱스
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 1. 사용자별 조회 (sender/receiver)
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>INDEX</span> idx_slack_sender <span style=color:#66d9ef>ON</span> slack(sender);
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>INDEX</span> idx_slack_receiver <span style=color:#66d9ef>ON</span> slack(receiver);
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>INDEX</span> idx_outlook_sender <span style=color:#66d9ef>ON</span> outlook(sender);
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>INDEX</span> idx_outlook_receiver <span style=color:#66d9ef>ON</span> outlook(receiver);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 2. 시간 범위 조회
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>INDEX</span> idx_slack_timestamp <span style=color:#66d9ef>ON</span> slack(<span style=color:#e6db74>&#34;timestamp&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>INDEX</span> idx_notion_timestamp <span style=color:#66d9ef>ON</span> notion(<span style=color:#e6db74>&#34;timestamp&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>INDEX</span> idx_outlook_timestamp <span style=color:#66d9ef>ON</span> outlook(<span style=color:#e6db74>&#34;timestamp&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>INDEX</span> idx_onedrive_timestamp <span style=color:#66d9ef>ON</span> onedrive(<span style=color:#e6db74>&#34;timestamp&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 3. Task 관계 조회
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>INDEX</span> idx_slack_task_id <span style=color:#66d9ef>ON</span> slack(task_id);
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>INDEX</span> idx_notion_task_id <span style=color:#66d9ef>ON</span> notion(task_id);
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>INDEX</span> idx_outlook_task_id <span style=color:#66d9ef>ON</span> outlook(task_id);
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>INDEX</span> idx_onedrive_task_id <span style=color:#66d9ef>ON</span> onedrive(task_id);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 4. 복합 인덱스 (사용자 + 시간)
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>INDEX</span> idx_slack_sender_timestamp <span style=color:#66d9ef>ON</span> slack(sender, <span style=color:#e6db74>&#34;timestamp&#34;</span> <span style=color:#66d9ef>DESC</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 5. 벡터 검색 인덱스
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>INDEX</span> idx_report_embedding <span style=color:#66d9ef>ON</span> report
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>USING</span> ivfflat (report_embedded vector_cosine_ops)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>WITH</span> (lists <span style=color:#f92672>=</span> <span style=color:#ae81ff>100</span>);
</span></span></code></pre></div><h3 id=82-쿼리-최적화>8.2 쿼리 최적화
<a class=anchor href=#82-%ec%bf%bc%eb%a6%ac-%ec%b5%9c%ec%a0%81%ed%99%94>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Before: N+1 문제</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> task_id <span style=color:#f92672>in</span> task_ids:
</span></span><span style=display:flex><span>    result <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> session<span style=color:#f92672>.</span>execute(
</span></span><span style=display:flex><span>        text(<span style=color:#e6db74>&#34;SELECT * FROM slack WHERE task_id = :id&#34;</span>),
</span></span><span style=display:flex><span>        {<span style=color:#e6db74>&#34;id&#34;</span>: task_id}
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># After: 배치 조회</span>
</span></span><span style=display:flex><span>result <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> session<span style=color:#f92672>.</span>execute(
</span></span><span style=display:flex><span>    text(<span style=color:#e6db74>&#34;SELECT * FROM slack WHERE task_id = ANY(:ids)&#34;</span>),
</span></span><span style=display:flex><span>    {<span style=color:#e6db74>&#34;ids&#34;</span>: task_ids}
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><h3 id=83-연결-풀-설정>8.3 연결 풀 설정
<a class=anchor href=#83-%ec%97%b0%ea%b2%b0-%ed%92%80-%ec%84%a4%ec%a0%95>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span>engine <span style=color:#f92672>=</span> create_async_engine(
</span></span><span style=display:flex><span>    DATABASE_URL,
</span></span><span style=display:flex><span>    pool_size<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>,        <span style=color:#75715e># 기본 연결 수</span>
</span></span><span style=display:flex><span>    max_overflow<span style=color:#f92672>=</span><span style=color:#ae81ff>20</span>,     <span style=color:#75715e># 최대 추가 연결</span>
</span></span><span style=display:flex><span>    pool_pre_ping<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>,  <span style=color:#75715e># 연결 유효성 검사</span>
</span></span><span style=display:flex><span>    pool_recycle<span style=color:#f92672>=</span><span style=color:#ae81ff>3600</span>,   <span style=color:#75715e># 1시간마다 연결 갱신</span>
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><h3 id=84-성능-측정-결과>8.4 성능 측정 결과
<a class=anchor href=#84-%ec%84%b1%eb%8a%a5-%ec%b8%a1%ec%a0%95-%ea%b2%b0%ea%b3%bc>#</a></h3><table><thead><tr><th>쿼리 유형</th><th>인덱스 전</th><th>인덱스 후</th><th>개선율</th></tr></thead><tbody><tr><td>사용자별 Slack 조회</td><td>120ms</td><td>8ms</td><td>93%</td></tr><tr><td>시간 범위 필터링</td><td>200ms</td><td>15ms</td><td>92%</td></tr><tr><td>벡터 유사도 검색 (Top 5)</td><td>500ms</td><td>45ms</td><td>91%</td></tr><tr><td>복합 조건 조회</td><td>350ms</td><td>25ms</td><td>93%</td></tr></tbody></table><hr><h2 id=9-문제-해결-사례>9. 문제 해결 사례
<a class=anchor href=#9-%eb%ac%b8%ec%a0%9c-%ed%95%b4%ea%b2%b0-%ec%82%ac%eb%a1%80>#</a></h2><h3 id=91-벡터-타입-캐스팅-오류>9.1 벡터 타입 캐스팅 오류
<a class=anchor href=#91-%eb%b2%a1%ed%84%b0-%ed%83%80%ec%9e%85-%ec%ba%90%ec%8a%a4%ed%8c%85-%ec%98%a4%eb%a5%98>#</a></h3><p><strong>문제:</strong> 문자열 벡터를 PostgreSQL vector 타입으로 저장 시 오류</p><pre tabindex=0><code>ERROR: column &#34;embedding&#34; is of type vector but expression is of type text
</code></pre><p><strong>원인:</strong> SQLAlchemy text()로 전달 시 자동 타입 캐스팅 실패</p><p><strong>해결:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Before (오류)</span>
</span></span><span style=display:flex><span>sql <span style=color:#f92672>=</span> text(<span style=color:#e6db74>&#34;UPDATE report SET report_embedded = :embedding WHERE id = :id&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>await</span> session<span style=color:#f92672>.</span>execute(sql, {<span style=color:#e6db74>&#34;embedding&#34;</span>: vector_string, <span style=color:#e6db74>&#34;id&#34;</span>: report_id})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># After (해결)</span>
</span></span><span style=display:flex><span>sql <span style=color:#f92672>=</span> text(<span style=color:#e6db74>&#34;UPDATE report SET report_embedded = :embedding::vector WHERE id = :id&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>await</span> session<span style=color:#f92672>.</span>execute(sql, {<span style=color:#e6db74>&#34;embedding&#34;</span>: vector_string, <span style=color:#e6db74>&#34;id&#34;</span>: report_id})
</span></span></code></pre></div><h3 id=92-비동기-세션-컨텍스트-오류>9.2 비동기 세션 컨텍스트 오류
<a class=anchor href=#92-%eb%b9%84%eb%8f%99%ea%b8%b0-%ec%84%b8%ec%85%98-%ec%bb%a8%ed%85%8d%ec%8a%a4%ed%8a%b8-%ec%98%a4%eb%a5%98>#</a></h3><p><strong>문제:</strong> 비동기 세션 외부에서 쿼리 실행 시 오류</p><pre tabindex=0><code>MissingGreenlet: greenlet_spawn has not been called
</code></pre><p><strong>원인:</strong> 비동기 컨텍스트 밖에서 동기 방식으로 세션 접근</p><p><strong>해결:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Before (오류)</span>
</span></span><span style=display:flex><span>session <span style=color:#f92672>=</span> async_session()
</span></span><span style=display:flex><span>result <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>execute(sql)  <span style=color:#75715e># 비동기 컨텍스트 없음</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># After (해결)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>with</span> async_session() <span style=color:#66d9ef>as</span> session:
</span></span><span style=display:flex><span>    result <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> session<span style=color:#f92672>.</span>execute(sql)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> session<span style=color:#f92672>.</span>commit()
</span></span></code></pre></div><h3 id=93-타임존-불일치-문제>9.3 타임존 불일치 문제
<a class=anchor href=#93-%ed%83%80%ec%9e%84%ec%a1%b4-%eb%b6%88%ec%9d%bc%ec%b9%98-%eb%ac%b8%ec%a0%9c>#</a></h3><p><strong>문제:</strong> 프론트엔드 날짜와 DB 타임스탬프 비교 시 데이터 누락</p><p><strong>원인:</strong> 프론트엔드는 날짜만, DB는 시간까지 포함</p><p><strong>해결:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Before (데이터 누락)</span>
</span></span><span style=display:flex><span>start_ts <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>strptime(start_date, <span style=color:#e6db74>&#34;%Y-%m-</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>end_ts <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>strptime(end_date, <span style=color:#e6db74>&#34;%Y-%m-</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># After (전체 범위 포함)</span>
</span></span><span style=display:flex><span>start_ts <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>strptime(start_date, <span style=color:#e6db74>&#34;%Y-%m-</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>end_ts <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>strptime(end_date, <span style=color:#e6db74>&#34;%Y-%m-</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span>) <span style=color:#f92672>+</span> timedelta(days<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># 2024-01-07 → 2024-01-08 00:00:00 (07일 23:59:59까지 포함)</span>
</span></span></code></pre></div><h3 id=94-대용량-임베딩-메모리-문제>9.4 대용량 임베딩 메모리 문제
<a class=anchor href=#94-%eb%8c%80%ec%9a%a9%eb%9f%89-%ec%9e%84%eb%b2%a0%eb%94%a9-%eb%a9%94%eb%aa%a8%eb%a6%ac-%eb%ac%b8%ec%a0%9c>#</a></h3><p><strong>문제:</strong> 다수의 문서 임베딩 생성 시 메모리 부족</p><p><strong>해결:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 싱글톤 패턴으로 모델 재사용</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ReportEmbeddingService</span>:
</span></span><span style=display:flex><span>    _instance <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>    _model <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__new__</span>(cls):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> cls<span style=color:#f92672>.</span>_instance <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>            cls<span style=color:#f92672>.</span>_instance <span style=color:#f92672>=</span> super()<span style=color:#f92672>.</span><span style=color:#a6e22e>__new__</span>(cls)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> cls<span style=color:#f92672>.</span>_instance
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__init__</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ReportEmbeddingService<span style=color:#f92672>.</span>_model <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>            <span style=color:#75715e># 모델 한 번만 로드</span>
</span></span><span style=display:flex><span>            ReportEmbeddingService<span style=color:#f92672>.</span>_model <span style=color:#f92672>=</span> SentenceTransformer(<span style=color:#f92672>...</span>)
</span></span></code></pre></div><hr><h2 id=10-프로젝트-성과>10. 프로젝트 성과
<a class=anchor href=#10-%ed%94%84%eb%a1%9c%ec%a0%9d%ed%8a%b8-%ec%84%b1%ea%b3%bc>#</a></h2><h3 id=101-기술적-성과>10.1 기술적 성과
<a class=anchor href=#101-%ea%b8%b0%ec%88%a0%ec%a0%81-%ec%84%b1%ea%b3%bc>#</a></h3><table><thead><tr><th>항목</th><th>성과</th></tr></thead><tbody><tr><td><strong>데이터 통합</strong></td><td>4개 플랫폼 (Slack, Notion, OneDrive, Outlook) 통합</td></tr><tr><td><strong>벡터 검색</strong></td><td>pgvector 기반 시맨틱 검색 구현</td></tr><tr><td><strong>쿼리 성능</strong></td><td>인덱스 최적화로 평균 92% 성능 개선</td></tr><tr><td><strong>비동기 처리</strong></td><td>전체 API 비동기화로 처리량 3배 향상</td></tr><tr><td><strong>확장성</strong></td><td>Docker 컨테이너화로 쉬운 배포</td></tr></tbody></table><h3 id=102-데이터-구조-성과>10.2 데이터 구조 성과
<a class=anchor href=#102-%eb%8d%b0%ec%9d%b4%ed%84%b0-%ea%b5%ac%ec%a1%b0-%ec%84%b1%ea%b3%bc>#</a></h3><pre tabindex=0><code>┌─────────────────────────────────────────────────────────────────────┐
│                    Database Statistics                               │
├─────────────────────────────────────────────────────────────────────┤
│  Tables                 : 7                                          │
│  Total Columns          : 42                                         │
│  Vector Columns         : 6 (384D: 2, 768D: 4)                       │
│  Foreign Key Relations  : 6                                          │
│  Indexes                : 15+ (B-tree, IVFFlat)                      │
│  Sample Data Records    : 180+                                       │
└─────────────────────────────────────────────────────────────────────┘
</code></pre><h3 id=103-api-성능-지표>10.3 API 성능 지표
<a class=anchor href=#103-api-%ec%84%b1%eb%8a%a5-%ec%a7%80%ed%91%9c>#</a></h3><table><thead><tr><th>엔드포인트</th><th>평균 응답 시간</th><th>P99 응답 시간</th></tr></thead><tbody><tr><td>GET /api/user-timeline</td><td>45ms</td><td>120ms</td></tr><tr><td>POST /reports/weekly</td><td>2.5s</td><td>5s</td></tr><tr><td>POST /api/generate-summary</td><td>150ms</td><td>300ms</td></tr><tr><td>GET /api/users</td><td>8ms</td><td>25ms</td></tr><tr><td>GET /health</td><td>2ms</td><td>5ms</td></tr></tbody></table><h3 id=104-학습-및-성장>10.4 학습 및 성장
<a class=anchor href=#104-%ed%95%99%ec%8a%b5-%eb%b0%8f-%ec%84%b1%ec%9e%a5>#</a></h3><h4 id=기술적-학습>기술적 학습
<a class=anchor href=#%ea%b8%b0%ec%88%a0%ec%a0%81-%ed%95%99%ec%8a%b5>#</a></h4><ul><li>PostgreSQL pgvector 확장 및 벡터 인덱싱</li><li>SQLAlchemy 2.0 비동기 ORM 패턴</li><li>Docker 기반 데이터베이스 컨테이너화</li><li>시맨틱 검색 및 임베딩 모델 활용</li></ul><h4 id=아키텍처-설계-역량>아키텍처 설계 역량
<a class=anchor href=#%ec%95%84%ed%82%a4%ed%85%8d%ec%b2%98-%ec%84%a4%ea%b3%84-%ec%97%ad%eb%9f%89>#</a></h4><ul><li>다중 플랫폼 데이터 통합 스키마 설계</li><li>확장 가능한 벡터 저장소 구조 설계</li><li>성능과 정확도의 트레이드오프 분석</li></ul><hr><h2 id=-부록>📎 부록
<a class=anchor href=#-%eb%b6%80%eb%a1%9d>#</a></h2><h3 id=a-실행-방법>A. 실행 방법
<a class=anchor href=#a-%ec%8b%a4%ed%96%89-%eb%b0%a9%eb%b2%95>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 1. Docker PostgreSQL 시작</span>
</span></span><span style=display:flex><span>cd backend
</span></span><span style=display:flex><span>docker-compose up -d
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 2. 가상환경 활성화</span>
</span></span><span style=display:flex><span>source venv/bin/activate
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 3. 의존성 설치</span>
</span></span><span style=display:flex><span>pip install -r requirements.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 4. 백엔드 서버 실행</span>
</span></span><span style=display:flex><span>python main.py
</span></span></code></pre></div><h3 id=b-데이터베이스-접속>B. 데이터베이스 접속
<a class=anchor href=#b-%eb%8d%b0%ec%9d%b4%ed%84%b0%eb%b2%a0%ec%9d%b4%ec%8a%a4-%ec%a0%91%ec%86%8d>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Docker 컨테이너 psql 접속</span>
</span></span><span style=display:flex><span>docker exec -it weekly-report-postgres psql -U myuser -d mydatabase
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 외부 클라이언트 (DBeaver, pgAdmin 등)</span>
</span></span><span style=display:flex><span>Host: localhost
</span></span><span style=display:flex><span>Port: <span style=color:#ae81ff>5433</span>
</span></span><span style=display:flex><span>Database: mydatabase
</span></span><span style=display:flex><span>User: myuser
</span></span><span style=display:flex><span>Password: mypassword
</span></span></code></pre></div><h3 id=c-유용한-sql-쿼리>C. 유용한 SQL 쿼리
<a class=anchor href=#c-%ec%9c%a0%ec%9a%a9%ed%95%9c-sql-%ec%bf%bc%eb%a6%ac>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 테이블별 레코드 수 확인
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;employee&#39;</span> <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>table_name</span>, <span style=color:#66d9ef>COUNT</span>(<span style=color:#f92672>*</span>) <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>count</span> <span style=color:#66d9ef>FROM</span> employee
</span></span><span style=display:flex><span><span style=color:#66d9ef>UNION</span> <span style=color:#66d9ef>ALL</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#e6db74>&#39;task&#39;</span>, <span style=color:#66d9ef>COUNT</span>(<span style=color:#f92672>*</span>) <span style=color:#66d9ef>FROM</span> task
</span></span><span style=display:flex><span><span style=color:#66d9ef>UNION</span> <span style=color:#66d9ef>ALL</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#e6db74>&#39;slack&#39;</span>, <span style=color:#66d9ef>COUNT</span>(<span style=color:#f92672>*</span>) <span style=color:#66d9ef>FROM</span> slack
</span></span><span style=display:flex><span><span style=color:#66d9ef>UNION</span> <span style=color:#66d9ef>ALL</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#e6db74>&#39;notion&#39;</span>, <span style=color:#66d9ef>COUNT</span>(<span style=color:#f92672>*</span>) <span style=color:#66d9ef>FROM</span> notion
</span></span><span style=display:flex><span><span style=color:#66d9ef>UNION</span> <span style=color:#66d9ef>ALL</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#e6db74>&#39;onedrive&#39;</span>, <span style=color:#66d9ef>COUNT</span>(<span style=color:#f92672>*</span>) <span style=color:#66d9ef>FROM</span> onedrive
</span></span><span style=display:flex><span><span style=color:#66d9ef>UNION</span> <span style=color:#66d9ef>ALL</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#e6db74>&#39;outlook&#39;</span>, <span style=color:#66d9ef>COUNT</span>(<span style=color:#f92672>*</span>) <span style=color:#66d9ef>FROM</span> outlook
</span></span><span style=display:flex><span><span style=color:#66d9ef>UNION</span> <span style=color:#66d9ef>ALL</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#e6db74>&#39;report&#39;</span>, <span style=color:#66d9ef>COUNT</span>(<span style=color:#f92672>*</span>) <span style=color:#66d9ef>FROM</span> report;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 벡터 인덱스 확인
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> indexname, indexdef
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> pg_indexes
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> tablename <span style=color:#66d9ef>IN</span> (<span style=color:#e6db74>&#39;slack&#39;</span>, <span style=color:#e6db74>&#39;report&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 사용자별 활동 요약
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>    e.name,
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>COUNT</span>(<span style=color:#f92672>*</span>) <span style=color:#66d9ef>FROM</span> slack <span style=color:#66d9ef>WHERE</span> sender <span style=color:#f92672>=</span> e.name) <span style=color:#66d9ef>as</span> slack_sent,
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>COUNT</span>(<span style=color:#f92672>*</span>) <span style=color:#66d9ef>FROM</span> notion <span style=color:#66d9ef>WHERE</span> participant_id <span style=color:#f92672>=</span> e.name) <span style=color:#66d9ef>as</span> notion_docs,
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>COUNT</span>(<span style=color:#f92672>*</span>) <span style=color:#66d9ef>FROM</span> onedrive <span style=color:#66d9ef>WHERE</span> writer <span style=color:#f92672>=</span> e.name) <span style=color:#66d9ef>as</span> onedrive_files
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> employee e;
</span></span></code></pre></div><h3 id=d-관련-링크>D. 관련 링크
<a class=anchor href=#d-%ea%b4%80%eb%a0%a8-%eb%a7%81%ed%81%ac>#</a></h3><ul><li>Backend API: http://localhost:8001</li><li>API Documentation: http://localhost:8001/docs</li><li>PostgreSQL: localhost:5433</li></ul><hr><p><em>이 포트폴리오는 Silok 프로젝트의 Database 구축 과정을 상세히 문서화한 자료입니다.</em></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments><script src=https://giscus.app/client.js data-repo=yshghid/yshghid.github.io data-repo-id=R_kgDONkMkNg data-category-id=DIC_kwDONkMkNs4CloJh data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=ko crossorigin=anonymous async></script></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#프로젝트-개요>프로젝트 개요</a></li><li><a href=#-목차>📋 목차</a></li><li><a href=#1-기술적-의사결정>1. 기술적 의사결정</a><ul><li><a href=#11-데이터베이스-선정-근거>1.1 데이터베이스 선정 근거</a></li><li><a href=#12-orm-및-드라이버-선정>1.2 ORM 및 드라이버 선정</a></li><li><a href=#13-임베딩-모델-선정>1.3 임베딩 모델 선정</a></li></ul></li><li><a href=#2-데이터베이스-아키텍처>2. 데이터베이스 아키텍처</a><ul><li><a href=#21-프로젝트-디렉토리-구조>2.1 프로젝트 디렉토리 구조</a></li><li><a href=#22-공유-모델-modeldatapy>2.2 공유 모델 (model/data.py)</a></li><li><a href=#23-전체-시스템-아키텍처>2.3 전체 시스템 아키텍처</a></li><li><a href=#22-데이터-흐름>2.2 데이터 흐름</a></li><li><a href=#23-erd-entity-relationship-diagram>2.3 ERD (Entity Relationship Diagram)</a></li></ul></li><li><a href=#3-스키마-설계>3. 스키마 설계</a><ul><li><a href=#31-테이블-정의>3.1 테이블 정의</a></li><li><a href=#32-벡터-차원-설계-근거>3.2 벡터 차원 설계 근거</a></li></ul></li><li><a href=#4-벡터-검색-구현>4. 벡터 검색 구현</a><ul><li><a href=#41-pgvector-확장-설정>4.1 pgvector 확장 설정</a></li><li><a href=#42-임베딩-서비스-구현>4.2 임베딩 서비스 구현</a></li><li><a href=#43-유사도-검색-쿼리>4.3 유사도 검색 쿼리</a></li><li><a href=#44-벡터-인덱스-전략>4.4 벡터 인덱스 전략</a></li></ul></li><li><a href=#5-orm-및-비동기-처리>5. ORM 및 비동기 처리</a><ul><li><a href=#51-sqlalchemy-비동기-설정>5.1 SQLAlchemy 비동기 설정</a></li><li><a href=#52-의존성-주입-패턴>5.2 의존성 주입 패턴</a></li><li><a href=#53-트랜잭션-관리>5.3 트랜잭션 관리</a></li><li><a href=#54-raw-sql-vs-orm>5.4 Raw SQL vs ORM</a></li></ul></li><li><a href=#6-api-엔드포인트-설계>6. API 엔드포인트 설계</a><ul><li><a href=#61-엔드포인트-구조>6.1 엔드포인트 구조</a></li><li><a href=#62-주요-엔드포인트-구현>6.2 주요 엔드포인트 구현</a></li><li><a href=#63-pydantic-스키마>6.3 Pydantic 스키마</a></li></ul></li><li><a href=#7-docker-컨테이너화>7. Docker 컨테이너화</a><ul><li><a href=#71-docker-compose-설정>7.1 Docker Compose 설정</a></li><li><a href=#72-초기화-스크립트>7.2 초기화 스크립트</a></li><li><a href=#73-실행-명령어>7.3 실행 명령어</a></li><li><a href=#74-환경-변수-관리>7.4 환경 변수 관리</a></li></ul></li><li><a href=#8-성능-최적화>8. 성능 최적화</a><ul><li><a href=#81-인덱스-전략>8.1 인덱스 전략</a></li><li><a href=#82-쿼리-최적화>8.2 쿼리 최적화</a></li><li><a href=#83-연결-풀-설정>8.3 연결 풀 설정</a></li><li><a href=#84-성능-측정-결과>8.4 성능 측정 결과</a></li></ul></li><li><a href=#9-문제-해결-사례>9. 문제 해결 사례</a><ul><li><a href=#91-벡터-타입-캐스팅-오류>9.1 벡터 타입 캐스팅 오류</a></li><li><a href=#92-비동기-세션-컨텍스트-오류>9.2 비동기 세션 컨텍스트 오류</a></li><li><a href=#93-타임존-불일치-문제>9.3 타임존 불일치 문제</a></li><li><a href=#94-대용량-임베딩-메모리-문제>9.4 대용량 임베딩 메모리 문제</a></li></ul></li><li><a href=#10-프로젝트-성과>10. 프로젝트 성과</a><ul><li><a href=#101-기술적-성과>10.1 기술적 성과</a></li><li><a href=#102-데이터-구조-성과>10.2 데이터 구조 성과</a></li><li><a href=#103-api-성능-지표>10.3 API 성능 지표</a></li><li><a href=#104-학습-및-성장>10.4 학습 및 성장</a></li></ul></li><li><a href=#-부록>📎 부록</a><ul><li><a href=#a-실행-방법>A. 실행 방법</a></li><li><a href=#b-데이터베이스-접속>B. 데이터베이스 접속</a></li><li><a href=#c-유용한-sql-쿼리>C. 유용한 SQL 쿼리</a></li><li><a href=#d-관련-링크>D. 관련 링크</a></li></ul></li></ul></nav></div></aside></main></body></html>