<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="NetMHCpan # 목록 # [논문] NetMHCpan 4.0: Improved peptide-MHC class I interaction predictions integrating eluted ligand and peptide binding affinity data &raquo;
NetMHCpan 4.0: Improved peptide-MHC class I interaction predictions integrating eluted ligand and peptide binding affinity data # Abstract # Cytotoxic T cells are of central importance in the immune system’s response to disease. They recognize defective cells by binding to peptides presented on the cell surface by MHC (major histocompatibility complex) class I molecules.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/docs/study/bi/bi13/">
  <meta property="og:site_name" content="Lifelog 2025">
  <meta property="og:title" content="BI">
  <meta property="og:description" content="NetMHCpan # 목록 # [논문] NetMHCpan 4.0: Improved peptide-MHC class I interaction predictions integrating eluted ligand and peptide binding affinity data »
NetMHCpan 4.0: Improved peptide-MHC class I interaction predictions integrating eluted ligand and peptide binding affinity data # Abstract # Cytotoxic T cells are of central importance in the immune system’s response to disease. They recognize defective cells by binding to peptides presented on the cell surface by MHC (major histocompatibility complex) class I molecules.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">
    <meta property="article:published_time" content="2025-01-19T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-01-19T00:00:00+00:00">
    <meta property="article:tag" content="2025-01">
<title>BI | Lifelog 2025</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="http://localhost:1313/docs/study/bi/bi13/">
<link rel="stylesheet" href="/book.min.b79d7c33395061c8f79ecaf2ed506fabfbb4f7a048c6bf40218447335d11296c.css" integrity="sha256-t518MzlQYcj3nsry7VBvq/u096BIxr9AIYRHM10RKWw=" crossorigin="anonymous">
  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.3cee19c080ab174413ad44df468ef1f12bf9ec37b69659caac14ca71cd7844e4.js" integrity="sha256-PO4ZwICrF0QTrUTfRo7x8Sv57De2llnKrBTKcc14ROQ=" crossorigin="anonymous"></script>

  

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/logo.png" alt="Logo" class="book-icon" /><span>Lifelog 2025</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>















  
  <ul>
    
      
        <li class="book-section-flat" >
          
  
  

  
    <span>기록</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/hobby/book/" class="">책</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/hobby/movie/" class="">영화</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/hobby/daily/" class="">일상</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <span>공부</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/study/bi/" class="">BI</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/study/cs/" class="">CS</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/disk/" class="">◡̈⋆*</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/about/" class=""> </a>
  

        </li>
      
    
  </ul>














</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>BI</h3>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#목록">목록</a></li>
    <li><a href="#netmhcpan-40-improved-peptide-mhc-class-i-interaction-predictions-integrating-eluted-ligand-and-peptide-binding-affinity-data">NetMHCpan 4.0: Improved peptide-MHC class I interaction predictions integrating eluted ligand and peptide binding affinity data</a></li>
    <li><a href="#abstract">Abstract</a></li>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#materials-and-methods">Materials and Methods</a>
      <ul>
        <li><a href="#data-sets">Data sets</a></li>
        <li><a href="#neural-network-training">Neural network training</a></li>
        <li><a href="#netmhcpan-methods-참고용-chatgpt-설명"><strong>NetMHCpan: Methods</strong> (참고용 chatgpt 설명)</a></li>
        <li><a href="#1-데이터-처리"><strong>1. 데이터 처리</strong></a></li>
        <li><a href="#2-신경망-구조-설계"><strong>2. 신경망 구조 설계</strong></a></li>
        <li><a href="#3-데이터-인코딩"><strong>3. 데이터 인코딩</strong></a></li>
        <li><a href="#4-학습-알고리즘"><strong>4. 학습 알고리즘</strong></a></li>
        <li><a href="#5-앙상블-학습"><strong>5. 앙상블 학습</strong></a></li>
        <li><a href="#결론"><strong>결론</strong></a></li>
        <li><a href="#neural-network-training---번역">Neural network training - 번역</a></li>
        <li><a href="#performance">Performance</a></li>
        <li><a href="#length-preference-of-mhc-molecules">Length preference of MHC molecules</a></li>
        <li><a href="#leave-one-out-validation">Leave-one-out validation</a></li>
        <li><a href="#the-final-netmhcpan-40-method-implementation">The final NetMHCpan-4.0 method implementation</a></li>
        <li><a href="#validation-on-external-data-sets">Validation on external data sets</a></li>
      </ul>
    </li>
    <li><a href="#results">Results</a>
      <ul>
        <li><a href="#peptide-length-preference-of-mhc-molecules">Peptide length preference of MHC molecules</a></li>
        <li><a href="#leave-one-out-experiments-on-eluted-ligand-data">Leave-one-out experiments on eluted ligand data</a></li>
        <li><a href="#the-netmhcpan-40-method">The NetMHCpan-4.0 method</a></li>
        <li><a href="#validation-on-external-data-sets-1">Validation on external data sets</a></li>
        <li><a href="#to-be-or-not-to-be-a-ligand">To be or not to be a ligand</a></li>
        <li><a href="#evaluation-on-unbiased-data-sets">Evaluation on unbiased data sets</a></li>
        <li><a href="#identification-of-cancer-neoantigens">Identification of cancer neoantigens</a></li>
      </ul>
    </li>
    <li><a href="#discussion">Discussion</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="netmhcpan">
  NetMHCpan
  <a class="anchor" href="#netmhcpan">#</a>
</h1>
<h2 id="목록">
  목록
  <a class="anchor" href="#%eb%aa%a9%eb%a1%9d">#</a>
</h2>
<p>[논문] NetMHCpan 4.0: Improved peptide-MHC class I interaction predictions integrating eluted ligand and peptide binding affinity data <a href="https://yshghid.github.io/docs/study/bi/bi13/#netmhcpan-40-improved-peptide-mhc-class-i-interaction-predictions-integrating-eluted-ligand-and-peptide-binding-affinity-data">&raquo;</a></p>
<hr>
<h2 id="netmhcpan-40-improved-peptide-mhc-class-i-interaction-predictions-integrating-eluted-ligand-and-peptide-binding-affinity-data">
  NetMHCpan 4.0: Improved peptide-MHC class I interaction predictions integrating eluted ligand and peptide binding affinity data
  <a class="anchor" href="#netmhcpan-40-improved-peptide-mhc-class-i-interaction-predictions-integrating-eluted-ligand-and-peptide-binding-affinity-data">#</a>
</h2>
<h2 id="abstract">
  Abstract
  <a class="anchor" href="#abstract">#</a>
</h2>
<p>Cytotoxic T cells are of central importance in the immune system’s response to disease. They recognize defective cells by binding to peptides presented on the cell surface by MHC (major histocompatibility complex) class I molecules. Peptide binding to MHC molecules is the single most selective step in the antigen presentation pathway. On the quest for T cell epitopes, the prediction of peptide binding to MHC molecules has therefore attracted large attention. In the past, predictors of peptide-MHC interaction have in most cases been trained on binding affinity data. Recently an increasing amount of MHC presented peptides identified by mass spectrometry has been published containing information about peptide processing steps in the presentation pathway and the length distribution of naturally presented peptides. Here, we present NetMHCpan-4.0, a method trained on both binding affinity and eluted ligand data leveraging the information from both data types. Large-scale benchmarking of the method demonstrates an increased predictive performance compared to state-of-the-art when it comes to identification of naturally processed ligands, cancer neoantigens, and T cell epitopes.</p>
<ul>
<li>MHC-Peptide의 결합 예측이 중요하다.</li>
<li>기존 예측 모델은 결합 친화도 데이터에 기반한다. 이는 펩타이드가 실제로 제시되는 과정에서 발생하는 항원 가공 및 안정성 같은 추가적인 요인을 반영하지 못함.</li>
<li>결합 친화도 데이터와 eluted ligand 데이터를 통합하여 MHC class I-펩타이드 결합을 더 정확히 예측하는 기계 학습 모델을 개발함.</li>
</ul>
<h2 id="introduction">
  Introduction
  <a class="anchor" href="#introduction">#</a>
</h2>
<p>Cytotoxic T cells play a central role in the immune regulation of pathogenesis and malignancy. They perform the task of scrutinizing the surface of cells for the non-self peptides presented in complex with MHC (major histocompatibility complex) molecules. In cases such peptides are recognized, an immune response can be initiated potentially leading to killing of the infected (mal-functioning) cell. The most selective step in the pathway leading to this peptide presentation is the binding to MHC.</p>
<p>Over the last decades, large efforts have been dedicated to the development of computational methods capable of accurately predicting this event. The accuracy of these methods has improved substantially over the last years, and most recent benchmark results demonstrate that more than 90% of naturally presented MHC ligands are identified at an impressive specificity of 98% (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R1">1</a>). This gain in performance is achieved partly by the extended experimental binding data sets made available in the IEDB (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R2">2</a>), and partly by the development of novel machine-learning algorithms capable of capturing the information in the experimental binding data in a more effective manner. One such novel method is NNAlign-2.0, allowing the integration of peptides of variable length into the machine-learning framework (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R3">3</a>). This novel training approach allows both the incorporation of a larger set of training data, but also and maybe more importantly enables the method to directly learn the length preference presented peptides for each MHC molecule from the experimental binding data (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R4">4</a>). Even though most presented MHC class I ligands are of length 9 amino acids, the ability to incorporate length preferences directly into the model is critical as experimental data demonstrate that the length profiles of presented ligands can vary substantially between MHC molecules; prominent examples are the mouse H-2-Kb, with a preference for eight amino acids-long peptides (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R5">5</a>) and HLA-A*01:01, where close to one third of MHC presented peptides have a length longer than nine amino acids (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R6">6</a>).</p>
<p>Some of the most well documented and applied of methods for predicting peptide binding to MHC class I include NetMHC (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R4">4</a>, <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R7">7</a>), and NetMHCpan (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R1">1</a>, <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R8">8</a>). These tools have over the last years gained increasing interest due to the recent focus on neoantigen identification within the field of personalized immunotherapy (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R9">9</a>, <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R10">10</a>). However, as underlined in several studies including the recent Nature Biotechnology Editorial (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R11">11</a>), “neoantigen discovery and validation remains a daunting problem”, mostly due to the relative high false positive rate of predicted epitopes.</p>
<p>One potential cause for this relatively high rate of false positive epitope predictions is the fact that most methods are trained on binding affinity data, and as a consequence only model the single event of peptide-MHC binding. As stated above this binding to MHC is the most selective step in peptide antigen presentation. However, other factors including antigen processing (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R12">12</a>) and the stability of the peptide:MHC complex (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R13">13</a>) could influence the likelihood of a given peptide to be presented as an MHC ligand. Similarly, the length distribution of peptides available for binding to MHC molecules is impacted by other steps in the processing and presentation pathway, such as TAP transport and ERAP trimming, which are not reflected in binding data in itself (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R6">6</a>). Advances in mass spectrometry (MS) have allowed the field of MS peptidomics to move forward. In this context, recent studies (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R14">14</a>, <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R15">15</a>, <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R16">16</a>) have suggested that training prediction methods on such data rather than binding affinity data could improve the ability to accurately identify MHC ligands. As such, MS peptidome data would contain the comprehensive signal of antigen processing and presentation rather than just MHC binding affinity. Moreover, MS peptidome data generated by immunopeptidomic studies would contain precise information about the allele-specific peptide length profile preferences not available in the MHC binding affinity data sets.</p>
<p>Identification of MHC bound peptides by mass spectrometry thus holds great promise for the generation of large scale data sets characterizing the peptidome specific for individual MHC molecules (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R15">15</a>, <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R17">17</a>), and potentially also for the identification of T cell epitopes (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R18">18</a>). It is however clear that, within the foreseeable future, the number of MHC molecules characterized by such MS studies will remain limited. In this context, large efforts have over the last decades been dedicated to experimentally characterize the peptide binding space of MHC molecules using semi high-throughput MHC-peptide binding affinity assays (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R19">19</a>, <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R20">20</a>), enabling binding specificity characterization of a large set of MHC molecules from different species.</p>
<p>The IEDB contains a comprehensive set of MHC binding and ligand data available in the public domain. While this data set contains binding affinity data characterizing more than 150 different MHC class I molecules (from human, non-human primates, mouse, and life-stock), at the onset of this study only 55 MHC class I molecules were characterized by MS peptidome data. This imbalance made us suggest a novel machine learning approach integrating information from both types of data (binding affinity and MS ligands) into a combined framework benefitting from information from the two worlds. The proposed framework is “pan-specific” as it can leverage information across MHC molecules, data types, and peptide lengths into one single model. We hence expect this approach to achieve superior predictive performance compared to models trained on the two data types individually, and also achieve an improved performance when it comes to predicting length profile preferences of different MHC molecules.</p>
<p>While recent works have demonstrated the improved ability to identify MHC ligands using methods trained on MS peptidome data (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R14">14</a>, <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R15">15</a>), limited data is available on their impact for the identification of T cell epitopes. In this work, we focus on demonstrating the improved prediction performance not only on large sets of MS peptidome data but also on T cell epitope data independent from the data used to train the new predictor.</p>
<h2 id="materials-and-methods">
  Materials and Methods
  <a class="anchor" href="#materials-and-methods">#</a>
</h2>
<h3 id="data-sets">
  Data sets
  <a class="anchor" href="#data-sets">#</a>
</h3>
<p>Data on all class I MHC ligand elution assays available in IEDB database (<a href="http://www.iedb.org/">www.iedb.org</a>) were collected including the ligand sequence, details of the source protein, position of the ligand in the source protein and the restricting allele of the ligand. There were 160,527 distinct assays in total and the length of the ligands ranged from 4–37. All lengths with a count of ligands at least 0.5% of total ligands were selected for further analysis which included lengths 8–15 and comprised of 99% of the assay entries.</p>
<p>The restricting MHC molecule of the ligands were analyzed and entries with alleles listed unambiguously were selected. For example, some entries where the HLA alleles are listed as just the gene name and alleles from chicken, horse, cow and mouse for which we did not have binding prediction algorithms were excluded. Representative alleles were assigned for entries where only supertypes were listed (e.g. HLA-A*26:01 for HLA-A26). Thus there were 127 class I molecules from human and mouse in the selected data set. Redundant entries with same ligand sequence and MHC molecule were removed and MHC molecules with at least 50 ligand entries were selected. This included 55 class I molecules and the number of available ligands per molecule varied widely from 50 to 9500.</p>
<p>We hypothesized that some of the ligands could be artefacts of the elution assays and therefore their source proteins could be false positive as antigens. A protocol was designed to identify such false positive antigens and exclude them from the final data selected. The protocol identified proteins that had significantly lesser number of predicted binders among ligands than expected of random peptides using binomial probability distribution. Five sets of random peptides were generated from the ligand sequences by shuffling the amino acid residues within the ligands. Binding affinity was then predicted for the original ligands and random peptide sets for their corresponding alleles. The median of the predicted percentile ranks of the five random sets was estimated and assigned as the binding affinity of the random peptides. Based on a predicted binding affinity cut-off of percentile rank 1.0, the number of predicted binders among the original ligands and the random peptide sets were estimated. Five proteins were thus identified as false positives and ligand entries from these proteins were excluded from the data set.</p>
<p>The final data set had 85,217 entries in total with ligand length ranging from 8 to 15. The ligands originated from 14,797 source antigens and were restricted by 55 unique HLA molecules.</p>
<p>Random artificial negatives were generated for each MHC molecule covered by eluted ligand data by sampling randomly 10*N peptides of each length 8–15 amino acids from the antigen source protein sequences, where N is the number of 9mer ligands for the given MHC molecule.</p>
<p>IEDB 데이터베이스(<a href="https://www.iedb.org">www.iedb.org</a>)에 있는 모든 클래스 I MHC 리간드 용출 분석 데이터를 수집하였으며, 여기에는 리간드 서열, 소스 단백질의 세부 정보, 소스 단백질 내 리간드의 위치, 그리고 리간드를 제한하는 대립유전자의 정보가 포함됩니다. 총 160,527개의 개별 분석이 있었으며, 리간드의 길이는 437 사이였습니다. 리간드 개수가 전체 리간드의 최소 0.5% 이상인 길이만 추가 분석 대상으로 선택되었으며, 이 길이는 815로 전체 분석 항목의 99%를 차지했습니다.</p>
<p>리간드의 제한 MHC 분자를 분석하였고, 대립유전자가 명확하게 기재된 항목만을 선택했습니다. 예를 들어, HLA 대립유전자가 단순히 유전자 이름으로만 표시된 항목이나, 결합 예측 알고리즘이 없는 닭, 말, 소, 쥐의 대립유전자 항목은 제외되었습니다. 슈퍼타입만 기재된 항목(e.g., HLA-A26은 HLA-A*26:01로 표시)에 대해서는 대표 대립유전자를 할당했습니다. 이렇게 하여 최종 선택된 데이터 세트에는 인간과 쥐의 127개의 클래스 I 분자가 포함되었습니다. 동일한 리간드 서열과 MHC 분자를 가지는 중복 항목은 제거되었고, 최소 50개의 리간드 항목을 가지는 MHC 분자만 선택되었습니다. 결과적으로 55개의 클래스 I 분자가 포함되었으며, 분자당 사용 가능한 리간드 수는 50에서 9500까지 다양했습니다.</p>
<p>우리는 일부 리간드가 용출 분석의 아티팩트(오차)일 수 있으며, 따라서 이들의 소스 단백질이 항원으로서의 잘못된 양성 결과일 가능성이 있다고 가정했습니다. 이러한 잘못된 양성 항원을 식별하고 최종 데이터에서 제외하기 위한 프로토콜을 설계했습니다. 이 프로토콜은 리간드 중 예측 결합체 수가 무작위 펩타이드에서 기대되는 수보다 유의미하게 적은 단백질을 식별했습니다. 리간드 서열 내 아미노산 잔기를 섞어서 5세트의 무작위 펩타이드를 생성했습니다. 원래 리간드와 무작위 펩타이드 세트의 대립유전자에 대한 결합 친화도를 예측했습니다. 5개의 무작위 세트에 대한 예측 백분위수 순위의 중앙값을 무작위 펩타이드의 결합 친화도로 할당했습니다. 예측 결합 친화도 컷오프를 백분위수 순위 1.0으로 설정한 후, 원래 리간드와 무작위 펩타이드 세트에서 예측 결합체 수를 추정했습니다. 이렇게 하여 5개의 단백질이 잘못된 양성 항원으로 식별되었으며, 이 단백질에서 유래한 리간드 항목은 데이터 세트에서 제외되었습니다.</p>
<p>최종 데이터 세트는 총 85,217개의 항목을 포함하며, 리간드 길이는 8~15로 범위가 설정되었습니다. 리간드는 14,797개의 소스 항원에서 유래했으며, 55개의 고유 HLA 분자에 의해 제한되었습니다.</p>
<p>무작위 인공 음성 샘플은 용출 리간드 데이터에 포함된 각 MHC 분자에 대해 생성되었으며, 이는 소스 항원 단백질 서열에서 길이가 8~15 아미노산인 펩타이드를 임의로 추출하여 10*N 개의 샘플을 구성했습니다(N은 주어진 MHC 분자의 9mer 리간드 수).</p>
<ul>
<li>IEDB에서 160,527개의 MHC 리간드 데이터를 수집.</li>
<li>리간드의 길이는 4-37. 이 중 8-15aa 길이를 가진 리간드만 분석에 사용.</li>
<li>불분명하거나 결합 예측 알고리즘이 없는 동물의 데이터(닭, 말, 소, 쥐)는 제외 -&gt; 55개의 MHC 분자와 85,217개의 리간드가 분석 데이터로 사용됨.</li>
<li>랜덤 음성 데이터 생성: 각 MHC 분자에 대해 랜덤 펩타이드를 생성하여 학습 데이터로 활용.</li>
</ul>
<blockquote>
<p><strong>MHC-peptide 데이터 선택</strong></p>
<ul>
<li>160,527개 MHC-peptide 데이터 중 길이가 8~15 아미노산인 리간드만 선택함.</li>
<li>50개 이상의 리간드 데이터를 포함한 MHC 분자만 선택함.</li>
<li>최종적으로 55개의 class I MHC 분자 선택, 각 MHC 분자의 리간드 수는 50-9500개.</li>
<li>거짓 양성 항원 제거 -&gt; 55개의 MHC, 85,217개 리간드 데이터 선택. (14,797개 항원 유래)</li>
</ul>
</blockquote>
<blockquote>
<p><strong>랜덤 음성 데이터 생성</strong></p>
<ul>
<li>MHC 분자별로 생성.</li>
<li>각 리간드의 소스 단백질에서 8~15aa 펩타이드를 무작위로 추출.</li>
<li>각 MHC 분자에 대해 데이터베이스에서 발견된 9mer 리간드의 수x10개의 음성 데이터 생성(MHC class I 분자는 주로 길이가 **9개의 아미노산(9mer)**인 펩타이드를 선호하기 때문에, 이 길이는 모델 학습과 데이터 생성에서 기본 단위로 사용됨).</li>
</ul>
</blockquote>
<h3 id="neural-network-training">
  Neural network training
  <a class="anchor" href="#neural-network-training">#</a>
</h3>
<p>The NNAlign training approach with insertions and deletions (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R3">3</a>) was extended by adding a second output neuron as shown in <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#F1">figure 1</a>. This was done to allow combined training on binding affinity and MS eluted ligand data. Binding affinity values are measured as IC50 values in nM (aff) and can be rescaled to the interval [0,1] by applying 1-log(aff)/log(50,000), representing continuous target values (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R21">21</a>). For eluted ligands the strength of the interaction between peptide and MHC molecules is unknown, therefore a target value of 1 is assigned to binders and 0 to artificial negative peptides (see above).</p>
<p>In this network architecture weights between the input and hidden layer are shared between the two input types (binding affinity/ligand), and weights connecting the hidden and output layer are specific for each input type. During neural network an example is randomly selected from either data set and submitted to forward- and backpropagation according to the NNAlign algorithm (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R3">3</a>). In this setting, we define one training epoch as the average number of iterations needed to process each data point in the smaller data once.</p>
<p>A neural network ensemble was trained as described by Andreatta et al. (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R1">1</a>) using 5-fold nested cross-validation. Networks with 60 and 70 hidden neurons were trained leading to an ensemble of 40 networks in total.</p>
<p>The inputs to the neural networks consisted of the peptide and the MHC molecule in terms of a pseudo sequence (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R8">8</a>). All peptides were represented as 9-mer binding cores by the use of insertions and deletions as described by Andreatta et al. (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R4">4</a>) and encoded using BLOSUM encoding (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R21">21</a>). As in the earlier work by Andreatta et al. (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R4">4</a>), additional features for the encoding of peptides included: the length of the deletion/insertion; the length of peptide flanking regions, which are larger than zero in the case of a predicted extension of the peptide outside either terminus of the binding groove; and the length L of the peptide, encoded with four input neurons corresponding to the four cases L&lt;=8, L=9, L=10, L&gt;=11.</p>
<ul>
<li>기계 학습 모델: NNAlign 프레임워크를 확장하여 결합 친화도 데이터와 eluted ligand 데이터를 동시에 학습하도록 설계.</li>
<li>네트워크 출력 노드: 첫 번째 노드는 결합 친화도 점수 / 두 번째 노드는 eluted ligand 점수.</li>
<li>교차 검증 및 모델 최적화: 5겹 교차 검증을 사용하여 데이터 오버피팅 방지. 각 데이터 포인트를 무작위로 학습하여 평균 성능 극대화.</li>
</ul>
<blockquote>
<p><strong>모델 설명</strong></p>
<ul>
<li>기존 NNAlign 모델: 주어진 펩타이드-리간드 데이터를 기반으로 MHC 결합을 예측하기 위해 설계된 인공 신경망.</li>
<li>확장된 모델: 결합 친화도 데이터와 방출된 리간드 데이터를 모두 학습하기 위해, 출력 뉴런(output neuron)을 하나 더 추가.</li>
<li>첫 번째 출력 뉴런: 결합 친화도(binding affinity) 점수 / 두 번째 출력 뉴런: 방출된 리간드 여부(리간드가 실제 MHC와 결합했는지).</li>
</ul>
</blockquote>
<blockquote>
<p><strong>데이터 스케일링 및 라벨링</strong></p>
<ul>
<li>Affinity 데이터 단위: IC50(결합 친화도 측정 단위/nM)</li>
<li>IC50 값을 [0, 1] 범위로 스케일링. 50,000은 스케일링 기준값으로, IC50 값이 이 값보다 높을 경우 결합 친화도가 매우 낮은 것으로 간주함.</li>
<li>방출된 리간드 데이터: 이진 레이블. 실제 결합된 리간드는 1, 랜덤 음성 데이터는 0.</li>
</ul>
</blockquote>
<blockquote>
<p><strong>신경망 구조</strong></p>
<ul>
<li>입력층과 은닉층 간 가중치 공유, 은닉층과 출력층 간 가중치 분리.</li>
<li>입력층-은닉층: 결합 친화도 데이터와 방출된 리간드 데이터가 서로 다른 유형의 데이터이지만 입력층에서 은닉층(hidden layer)으로 전달되는 가중치는 동일하게 공유. 이를 통해 두 데이터 유형 간의 공통된 패턴을 학습.</li>
<li>은닉층-출력층: 출력 뉴런(결합 친화도와 방출된 리간드 점수)별로 다른 가중치를 사용하여, 각 데이터 유형의 특성을 반영.</li>
</ul>
</blockquote>
<blockquote>
<p><strong>신경망 학습 과정</strong></p>
<ul>
<li>데이터 세트에서 임의의 예제를 선택하여 순전파(forward propagation) 및 역전파(backpropagation)를 수행.</li>
<li>NNAlign 알고리즘을 통해 최적화.</li>
<li>한 학습 에포크(epoch): 데이터 세트 중 작은 세트의 모든 데이터를 한 번씩 처리하는 평균 반복 횟수로 정의.</li>
</ul>
</blockquote>
<blockquote>
<p><strong>신경망 앙상블 학습</strong></p>
<ul>
<li>5겹 중첩 교차 검증(5-fold nested cross-validation): 데이터 세트를 5개의 서브셋으로 나누고, 학습과 검증을 교차로 수행하여 모델의 일반화 성능을 높임.</li>
<li>신경망 설계: 은닉 뉴런(hidden neuron) 개수를 60개와 70개로 설정. 총 40개의 신경망으로 구성된 앙상블 학습 수행.</li>
</ul>
</blockquote>
<blockquote>
<p><strong>입력 데이터 인코딩</strong></p>
<ul>
<li>펩타이드의 표현: 9mer 결합 코어로 표현.NNAlign 알고리즘은 삽입(insertion)과 삭제(deletion)을 사용해 펩타이드 길이를 조정.</li>
<li>MHC 분자의 표현: 의사 서열(pseudo sequence)로 표현. MHC의 고유 결합 영역을 단순화하여 입력 데이터로 사용.</li>
<li>인코딩 방식: BLOSUM 인코딩: 아미노산 서열의 유사성을 나타내는 행렬 기반 인코딩.</li>
<li>추가 특징: 삽입/삭제의 길이, 펩타이드의 양 끝에 있는 &ldquo;flanking region&rdquo;(결합 영역 밖의 서열)의 길이, 펩타이드의 길이 L은 L&lt;=8, L=9, L=10, L&gt;=11을 각각 4개의 입력 뉴런으로 인코딩.</li>
</ul>
</blockquote>
<p><img src="https://github.com/user-attachments/assets/efa180cf-5f25-4d2c-a642-e81a73ef5dd3" alt="image" /></p>
<blockquote>
<p><strong>요약</strong></p>
<ul>
<li>두 가지 데이터를 동시에 학습하여, 결합 친화도와 방출된 리간드의 특성을 모두 반영하는 예측 모델.</li>
<li>입력과 은닉층 사이의 가중치를 공유함으로써 두 데이터 유형 간 공통된 패턴을 학습하고, 출력층에서 개별 데이터를 최적화하여 정확성을 높였음.</li>
<li>앙상블 학습과 효율적인 데이터 인코딩을 통해 예측 성능을 극대화함.</li>
</ul>
</blockquote>
<hr>
<p><strong>Method 정리</strong></p>
<ol>
<li>데이터 인코딩: 입력값 구성은 아래와 같다.</li>
</ol>
<ul>
<li>펩타이드 코어: 9x20 = 180(BLOSUM 인코딩)</li>
<li>PFR(Flanking Region): 2x20=40(평균 BLOSUM 값)</li>
<li>펩타이드 및 PFR 길이: 6</li>
<li>P1 위치 점수: 1
-&gt; 총 입력값: 227</li>
</ul>
<p>1-1) 펩타이드 코어: 9x20 = 180(BLOSUM 인코딩)</p>
<p>ex) &ldquo;AAQLLTSYTGLV&rdquo; 팹타이드(12aa).</p>
<p>-&gt; 길이가 9인 코어를 추출할 수 있는 모든 가능한 서브시퀀스를 생성: 총 4개의 9mer 생성 가능(AAQLLTSYT, AQLLTSYTG, QLLTSYTGL, LLTSYTGLV)</p>
<p>-&gt; 각 9mer에 대해 MHC 분자와의 결합 점수(binding score) 계산</p>
<p>-&gt; 가장 강력한 결합 코어 선택: &ldquo;QLLTSYTG&quot;가 선택됐다고 가정.</p>
<p>-&gt; 펩타이드 &ldquo;AAQLLTSYTGLV&quot;는 NNAlign 알고리즘에 의해 &ldquo;QLLTSYTGL&quot;이라는 결합 코어로 변환됨. 신경망 모델은 이 9mer 코어를 사용해 MHC와의 결합 가능성을 예측함.</p>
<p>(MHC class I 분자는 길이와 서열 특성이 엄격히 제한된 펩타이드와 결합하기 때문에, 정확한 코어 식별이 중요함. 플랭킹 영역(Flanking Region) 즉 펩타이드의 양 끝 부분은 결합에 직접적으로 관여하지 않으므로, 결합 코어를 중심으로 학습하여 모델의 효율성을 높일 수 있다)</p>
<p>1-2) PFR(Flanking Region): 2x20=40(평균 BLOSUM 값)</p>
<p>ex) 펩타이드*&ldquo;AAQLLTSYTGLV&quot;에서 코어가 &ldquo;QLLTSYTGL&quot;이라면:</p>
<p>-&gt; N-말단 PFR: &ldquo;AA&rdquo;, C-말단 PFR: &ldquo;V&rdquo;</p>
<p>= 플랭킹 영역은 고정된 길이를 가지지 않으므로, 플랭킹 영역의 평균 값을 계산한다. N-말단 PFR이 &ldquo;AA&quot;라면 &ldquo;A&quot;와 &ldquo;A&quot;의 BLOSUM 벡터를 가져와서 평균 벡터를 계산함. 결과적으로 각 플랭킹 영역의 (평균) 벡터는 20차원으로 표현되고 따라서 2x20=40임.</p>
<p>1-3) 펩타이드 및 PFR 길이: 6</p>
<ul>
<li>6 = 펩타이드 길이 인코딩 (2개의 입력값) + 플랭킹 영역(PFR) 길이 인코딩 (4개의 입력값)</li>
</ul>
<p>-&gt; 펩타이드 길이 L을 LPEP으로 정규화하고 LPEP, 1-LPEP이 입력값이 됨.</p>
<p>-&gt; 플랭킹 영역의 길이 LN, LC을 LN/3, LC/3으로 정규화하고 LN/3, 1-LN/3, LC/3, 1-LC/3이 입력값이 됨.</p>
<p>1-4) P1 위치 점수</p>
<ul>
<li>P1 위치는 이 9mer 서열의 첫 번째 아미노산 위치를 의미.</li>
</ul>
<p>ex) &ldquo;AAQLLTSYTGLV&quot;에서 결합 코어 &ldquo;QLLTSYTGL&quot;이면 P1 위치는 &ldquo;Q&rdquo;.</p>
<ul>
<li>P1 위치의 아미노산은 MHC의 특정 주머니(pocket)와 결합하여 결합 안정성과 친화도에 중요한 역할을 함 -&gt; MHC 분자에는 특정 위치(예: P1, P2, P9 등)에서 특정 아미노산을 선호하는 경향이 있음.</li>
</ul>
<p>ex) HLA-A*02:01 대립유전자는 P1 위치에서 글루탐산(E)을 선호할 수 있음.</p>
<ul>
<li>P1 위치 점수는 PSSM(Position-Specific Scoring Matrix)을 사용해 계산됨. 각 MHC 대립유전자에 대해 P1에서 각 아미노산(20개)에 대해 선호도 점수, 아미노산이 특정 위치에서 나타날 확률과, 결합 친화도에 미치는 기여도를 반영해서 계산.</li>
</ul>
<ol start="2">
<li>학습 알고리즘</li>
</ol>
<ul>
<li>
<ol>
<li>결합 코어 탐색</li>
<li>가중치 업데이트</li>
<li>교차 검증</li>
</ol>
</li>
</ul>
<p>2-1) 결합 코어 탐색: 모든 가능한 9mer 코어를 탐색하고 가장 높은 점수를 가진 코어를 선택해서 학습에 사용.</p>
<p>2-2) 역전파(Backpropagation) 알고리즘을 통해 가중치를 조정.</p>
<ul>
<li>데이터 중복(결합 코어가 동일한 펩타이드)의 영향을 줄이기 위해, Hobohm-1 알고리즘으로 동일 코어를 가진 데이터를 클러스터링하여 중복도를 계산하고 중복도가 높을수록 학습 속도를 줄임.</li>
</ul>
<p>ex)</p>
<ul>
<li>펩타이드 1: &ldquo;AAQLLTSYTGLV&rdquo;, 결합 코어: &ldquo;QLLTSYTGL&rdquo;</li>
<li>펩타이드 2: &ldquo;AALLLTSYTGLI&rdquo;, 결합 코어: &ldquo;QLLTSYTGL&rdquo;</li>
<li>펩타이드 3: &ldquo;QQQLLTSYTLL&rdquo;, 결합 코어: &ldquo;LLTSYTLL&rdquo;</li>
</ul>
<p>-&gt; 클러스터 1: [&ldquo;QLLTSYTGL&rdquo;, &ldquo;QLLTSYTGL&rdquo;], 클러스터 2: [&ldquo;LLTSYTLL&rdquo;].</p>
<p>-&gt; 클러스터 중복도 계산: 클러스터 1의 중복도: 2, 클러스터 2의 중복도: 1.</p>
<p>-&gt; 학습 속도(learning rate)를 중복도 N에 비례하여 감소시킴. (N=클러스터의 중복도 즉 클러스터의 크기)</p>
<p>-&gt; 중복도가 높은 데이터일수록 학습 속도가 줄어들어, 모델이 다양한 데이터를 균형 있게 학습하도록 유도.</p>
<p>-&gt; ex) 기본 학습 속도 η=0.1, 클러스터 1의 중복도 N=2, 클러스터 2의 중복도 N=1.</p>
<p>-&raquo; 학습 속도 조정: 클러스터 1: ηadjusted = 0.1/2 = 0.05, 클러스터 2: ηadjusted = 0.1/1 = 0.1.</p>
<p>-&raquo; 클러스터 1의 데이터는 학습 속도가 절반으로 줄어들어 과도한 학습이 방지됨.</p>
<ol start="3">
<li>교차 검증: 5겹 교차 검증(5-fold cross-validation). 데이터 세트를 5개로 나누어 학습 및 검증을 교차로 수행. 데이터 오버피팅 방지 및 모델의 일반화 성능 향상.</li>
</ol>
<ul>
<li>
<p>5겹 교차 검증: 데이터를 5개의 부분으로 나누어 각 부분을 테스트 세트로 사용하고, 나머지 4개를 학습 세트로 사용하여 모델을 학습. 5번 반복하여 모든 데이터가 한 번씩 테스트 세트로 사용됨.</p>
</li>
<li>
<p>두 가지 신경망 구조: 교차 검증 반복(5번)에서 두 가지 신경망 구조를 학습: 은닉 뉴런(hidden neurons) 60개, 은닉 뉴런(hidden neurons) 70개.</p>
</li>
</ul>
<p>ex) 데이터가 5개의 부분으로 나뉨: A, B, C, D, E.</p>
<p>-&gt; 교차 검증 1번째 단계: A를 테스트 데이터로, B+C+D+E를 학습 데이터로 사용, 60개 은닉 뉴런 신경망 1개 학습 + 70개 은닉 뉴런 신경망 1개 학습.
-&gt; &hellip; 5번째 단계까지 수행: 총 10개의 신경망 학습.</p>
<p>-&gt; 근데 왜 40개지?&hellip;</p>
<hr>
<h3 id="netmhcpan-methods-참고용-chatgpt-설명">
  <strong>NetMHCpan: Methods</strong> (참고용 chatgpt 설명)
  <a class="anchor" href="#netmhcpan-methods-%ec%b0%b8%ea%b3%a0%ec%9a%a9-chatgpt-%ec%84%a4%eb%aa%85">#</a>
</h3>
<p>NetMHCpan은 <strong>MHC 클래스 I 및 II 분자와 펩타이드 간 결합</strong>을 예측하기 위해 설계된 고도화된 <strong>인공 신경망(Artificial Neural Network)</strong> 기반 모델입니다. 이 모델은 기존 NNAlign 방법론을 확장하여 <strong>결합 친화도 데이터</strong>와 <strong>방출된 리간드 데이터</strong>를 동시에 학습할 수 있는 기능을 포함합니다. NetMHCpan의 메서드(Method)는 데이터 처리, 신경망 구조 설계, 학습 알고리즘, 데이터 인코딩, 그리고 앙상블 학습으로 구성됩니다.</p>
<h3 id="1-데이터-처리">
  <strong>1. 데이터 처리</strong>
  <a class="anchor" href="#1-%eb%8d%b0%ec%9d%b4%ed%84%b0-%ec%b2%98%eb%a6%ac">#</a>
</h3>
<h4 id="11-결합-친화도-데이터-binding-affinity-data">
  <strong>1.1 결합 친화도 데이터 (Binding Affinity Data)</strong>
  <a class="anchor" href="#11-%ea%b2%b0%ed%95%a9-%ec%b9%9c%ed%99%94%eb%8f%84-%eb%8d%b0%ec%9d%b4%ed%84%b0-binding-affinity-data">#</a>
</h4>
<ul>
<li><strong>데이터 출처</strong>:
<ul>
<li>IEDB 데이터베이스에서 얻은 MHC-펩타이드 결합 친화도 데이터(IC50 단위).</li>
</ul>
</li>
<li><strong>IC50 값</strong>:
<ul>
<li>펩타이드와 MHC 간 결합 강도를 나타내는 값으로, 나노몰(nM) 단위로 측정.</li>
<li>낮은 IC50 값: 높은 결합 친화도.</li>
<li>높은 IC50 값: 낮은 결합 친화도.</li>
</ul>
</li>
<li><strong>스케일링</strong>:
<ul>
<li>IC50 값을 [0, 1] 범위로 정규화하여 신경망의 입력값으로 변환.</li>
<li>변환 공식:
[
\text{Normalized Affinity} = 1 - \frac{\log(\text{IC50})}{\log(50,000)}
]</li>
<li>( \log(50,000) ): 기준값으로, IC50이 50,000 이상일 경우 결합 친화도가 매우 낮다고 간주.</li>
</ul>
</li>
</ul>
<h4 id="12-방출된-리간드-데이터-eluted-ligand-data">
  <strong>1.2 방출된 리간드 데이터 (Eluted Ligand Data)</strong>
  <a class="anchor" href="#12-%eb%b0%a9%ec%b6%9c%eb%90%9c-%eb%a6%ac%ea%b0%84%eb%93%9c-%eb%8d%b0%ec%9d%b4%ed%84%b0-eluted-ligand-data">#</a>
</h4>
<ul>
<li><strong>방출된 리간드</strong>:
<ul>
<li>실험적으로 확인된 MHC와 결합 후 방출된 펩타이드 데이터.</li>
</ul>
</li>
<li><strong>음성 데이터(Artificial Negatives)</strong>:
<ul>
<li>랜덤하게 생성된 펩타이드 데이터를 음성 사례로 사용.</li>
</ul>
</li>
<li><strong>이진 라벨링</strong>:
<ul>
<li>방출된 리간드: 1.</li>
<li>음성 데이터: 0.</li>
</ul>
</li>
</ul>
<h3 id="2-신경망-구조-설계">
  <strong>2. 신경망 구조 설계</strong>
  <a class="anchor" href="#2-%ec%8b%a0%ea%b2%bd%eb%a7%9d-%ea%b5%ac%ec%a1%b0-%ec%84%a4%ea%b3%84">#</a>
</h3>
<p>NetMHCpan은 기존 NNAlign 신경망 모델을 확장하여 결합 친화도 데이터와 방출된 리간드 데이터를 동시에 학습할 수 있도록 설계되었습니다.</p>
<h4 id="21-피드포워드-신경망-구조">
  <strong>2.1 피드포워드 신경망 구조</strong>
  <a class="anchor" href="#21-%ed%94%bc%eb%93%9c%ed%8f%ac%ec%9b%8c%eb%93%9c-%ec%8b%a0%ea%b2%bd%eb%a7%9d-%ea%b5%ac%ec%a1%b0">#</a>
</h4>
<ul>
<li><strong>구성</strong>:
<ul>
<li>입력층(Input Layer), 은닉층(Hidden Layer), 출력층(Output Layer)으로 구성된 피드포워드 신경망.</li>
</ul>
</li>
<li><strong>출력층</strong>:
<ul>
<li>두 개의 출력 뉴런:
<ol>
<li><strong>첫 번째 출력 뉴런</strong>: 결합 친화도 점수.</li>
<li><strong>두 번째 출력 뉴런</strong>: 방출된 리간드 여부.</li>
</ol>
</li>
</ul>
</li>
</ul>
<h4 id="22-가중치-공유-및-분리">
  <strong>2.2 가중치 공유 및 분리</strong>
  <a class="anchor" href="#22-%ea%b0%80%ec%a4%91%ec%b9%98-%ea%b3%b5%ec%9c%a0-%eb%b0%8f-%eb%b6%84%eb%a6%ac">#</a>
</h4>
<ul>
<li><strong>입력층-은닉층 간 가중치 공유</strong>:
<ul>
<li>결합 친화도 데이터와 방출된 리간드 데이터는 동일한 가중치를 통해 은닉층으로 전달.</li>
<li><strong>목적</strong>: 두 데이터 유형 간 공통된 패턴(예: 특정 아미노산의 중요성)을 학습.</li>
</ul>
</li>
<li><strong>은닉층-출력층 간 가중치 분리</strong>:
<ul>
<li>출력층에서는 데이터 유형별로 서로 다른 가중치를 적용.</li>
<li><strong>목적</strong>: 각 데이터 유형의 특성을 반영하여 개별적인 예측 수행.</li>
</ul>
</li>
</ul>
<h3 id="3-데이터-인코딩">
  <strong>3. 데이터 인코딩</strong>
  <a class="anchor" href="#3-%eb%8d%b0%ec%9d%b4%ed%84%b0-%ec%9d%b8%ec%bd%94%eb%94%a9">#</a>
</h3>
<p>NetMHCpan은 펩타이드와 MHC 데이터를 벡터 형태로 변환하여 신경망의 입력값으로 사용합니다.</p>
<h4 id="31-펩타이드-인코딩">
  <strong>3.1 펩타이드 인코딩</strong>
  <a class="anchor" href="#31-%ed%8e%a9%ed%83%80%ec%9d%b4%eb%93%9c-%ec%9d%b8%ec%bd%94%eb%94%a9">#</a>
</h4>
<ul>
<li><strong>9mer 결합 코어</strong>:
<ul>
<li>펩타이드는 중심이 되는 9mer 결합 코어로 변환.</li>
<li>NNAlign 알고리즘을 활용하여 펩타이드 서열에서 가장 강력한 결합을 갖는 코어를 탐색.</li>
</ul>
</li>
<li><strong>BLOSUM 인코딩</strong>:
<ul>
<li>펩타이드의 아미노산 서열을 <strong>BLOSUM 행렬</strong>을 사용해 벡터로 변환.</li>
<li>아미노산 간의 유사성을 반영하여 신경망 입력값으로 사용.</li>
</ul>
</li>
<li><strong>플랭킹 영역(Flanking Region, PFR)</strong>:
<ul>
<li>결합 코어 외부의 양 끝 아미노산 서열.</li>
<li>PFR의 평균 BLOSUM 값을 계산하여 입력값으로 사용.</li>
</ul>
</li>
<li><strong>PFR 길이 인코딩</strong>:
<ul>
<li>PFR 길이를 비율로 정규화:
[
\text{LPFR}/3 \text{ 와 } 1 - \text{LPFR}/3
]</li>
</ul>
</li>
</ul>
<h4 id="32-mhc-인코딩">
  <strong>3.2 MHC 인코딩</strong>
  <a class="anchor" href="#32-mhc-%ec%9d%b8%ec%bd%94%eb%94%a9">#</a>
</h4>
<ul>
<li><strong>의사 서열(Pseudo Sequence)</strong>:
<ul>
<li>MHC 분자의 결합 특성을 나타내는 고유 서열을 벡터로 단순화.</li>
</ul>
</li>
<li><strong>P1 위치 특성</strong>:
<ul>
<li>결합 코어의 첫 번째 위치(P1)의 아미노산에 대한 PSSM 점수를 포함.</li>
</ul>
</li>
</ul>
<h4 id="33-입력값-구성">
  <strong>3.3 입력값 구성</strong>
  <a class="anchor" href="#33-%ec%9e%85%eb%a0%a5%ea%b0%92-%ea%b5%ac%ec%84%b1">#</a>
</h4>
<ul>
<li>펩타이드 코어: ( 9 \times 20 = 180 ) (BLOSUM 인코딩).</li>
<li>PFR: ( 2 \times 20 = 40 ) (평균 BLOSUM 값).</li>
<li>펩타이드 및 PFR 길이: 6.</li>
<li>P1 위치 점수: 1.</li>
<li><strong>총 입력값</strong>: 227.</li>
</ul>
<h3 id="4-학습-알고리즘">
  <strong>4. 학습 알고리즘</strong>
  <a class="anchor" href="#4-%ed%95%99%ec%8a%b5-%ec%95%8c%ea%b3%a0%eb%a6%ac%ec%a6%98">#</a>
</h3>
<h4 id="41-결합-코어-탐색">
  <strong>4.1 결합 코어 탐색</strong>
  <a class="anchor" href="#41-%ea%b2%b0%ed%95%a9-%ec%bd%94%ec%96%b4-%ed%83%90%ec%83%89">#</a>
</h4>
<ul>
<li>펩타이드 서열에서 모든 가능한 9mer 코어를 탐색.</li>
<li>가장 높은 점수를 가진 코어를 선택하여 학습에 사용.</li>
</ul>
<h4 id="42-가중치-업데이트">
  <strong>4.2 가중치 업데이트</strong>
  <a class="anchor" href="#42-%ea%b0%80%ec%a4%91%ec%b9%98-%ec%97%85%eb%8d%b0%ec%9d%b4%ed%8a%b8">#</a>
</h4>
<ul>
<li>역전파(Backpropagation) 알고리즘을 통해 가중치를 조정.</li>
<li>데이터 중복(결합 코어가 동일한 펩타이드)의 영향을 줄이기 위해 학습 속도 조정:
<ul>
<li>동일 코어를 가진 데이터를 클러스터링(Hobohm-1 알고리즘)하여 중복도를 계산.</li>
<li>중복도가 높을수록 학습 속도를 줄임.</li>
</ul>
</li>
</ul>
<h4 id="43-교차-검증">
  <strong>4.3 교차 검증</strong>
  <a class="anchor" href="#43-%ea%b5%90%ec%b0%a8-%ea%b2%80%ec%a6%9d">#</a>
</h4>
<ul>
<li><strong>5겹 교차 검증(5-fold cross-validation)</strong>:
<ul>
<li>데이터 세트를 5개로 나누어 학습 및 검증을 교차로 수행.</li>
<li>데이터 오버피팅 방지 및 모델의 일반화 성능 향상.</li>
</ul>
</li>
</ul>
<h3 id="5-앙상블-학습">
  <strong>5. 앙상블 학습</strong>
  <a class="anchor" href="#5-%ec%95%99%ec%83%81%eb%b8%94-%ed%95%99%ec%8a%b5">#</a>
</h3>
<h4 id="51-네트워크-구성">
  <strong>5.1 네트워크 구성</strong>
  <a class="anchor" href="#51-%eb%84%a4%ed%8a%b8%ec%9b%8c%ed%81%ac-%ea%b5%ac%ec%84%b1">#</a>
</h4>
<ul>
<li>은닉 뉴런 개수를 60개와 70개로 설정하여 총 40개의 신경망을 학습.</li>
<li>각 신경망의 초기값을 다르게 설정하여 다양한 학습 결과를 생성.</li>
</ul>
<h4 id="52-앙상블-생성">
  <strong>5.2 앙상블 생성</strong>
  <a class="anchor" href="#52-%ec%95%99%ec%83%81%eb%b8%94-%ec%83%9d%ec%84%b1">#</a>
</h4>
<ul>
<li>각 학습 설정에서 가장 높은 성능(Pearson 상관 계수)을 가진 네트워크 10개를 선택.</li>
<li>최종적으로 앙상블 방식으로 결과를 결합하여 예측 정확도를 향상.</li>
</ul>
<h3 id="결론">
  <strong>결론</strong>
  <a class="anchor" href="#%ea%b2%b0%eb%a1%a0">#</a>
</h3>
<p>NetMHCpan의 메서드는 NNAlign의 구조를 확장하여 <strong>결합 친화도와 방출된 리간드 데이터를 동시에 학습</strong>하도록 설계되었습니다. 데이터 인코딩, 신경망 구조, 학습 알고리즘, 그리고 앙상블 학습 전략은 높은 예측 성능을 보장하며, MHC-펩타이드 상호작용 예측을 위한 강력한 도구로 자리 잡았습니다.</p>
<hr>
<h3 id="neural-network-training---번역">
  Neural network training - 번역
  <a class="anchor" href="#neural-network-training---%eb%b2%88%ec%97%ad">#</a>
</h3>
<p>The NNAlign training approach with insertions and deletions (3) was extended by adding a second output neuron as shown in figure 1. This was done to allow combined training on binding affinity and MS eluted ligand data. Binding affinity values are measured as IC50 values in nM (aff) and can be rescaled to the interval [0,1] by applying 1-log(aff)/log(50,000), representing continuous target values (21). For eluted ligands the strength of the interaction between peptide and MHC molecules is unknown, therefore a target value of 1 is assigned to binders and 0 to artificial negative peptides (see above).</p>
<p>In this network architecture weights between the input and hidden layer are shared between the two input types (binding affinity/ligand), and weights connecting the hidden and output layer are specific for each input type. During neural network an example is randomly selected from either data set and submitted to forward- and backpropagation according to the NNAlign algorithm (3). In this setting, we define one training epoch as the average number of iterations needed to process each data point in the smaller data once.</p>
<p>A neural network ensemble was trained as described by Andreatta et al. (1) using 5-fold nested cross-validation. Networks with 60 and 70 hidden neurons were trained leading to an ensemble of 40 networks in total.</p>
<p>The inputs to the neural networks consisted of the peptide and the MHC molecule in terms of a pseudo sequence (8). All peptides were represented as 9-mer binding cores by the use of insertions and deletions as described by Andreatta et al. (4) and encoded using BLOSUM encoding (21). As in the earlier work by Andreatta et al. (4), additional features for the encoding of peptides included: the length of the deletion/insertion; the length of peptide flanking regions, which are larger than zero in the case of a predicted extension of the peptide outside either terminus of the binding groove; and the length L of the peptide, encoded with four input neurons corresponding to the four cases L&lt;=8, L=9, L=10, L&gt;=11.</p>
<p>삽입 및 삭제를 포함한 NNAlign 학습 방법(3)은 그림 1에 표시된 바와 같이 두 번째 출력 뉴런을 추가하여 확장되었습니다. 이는 결합 친화도 데이터와 MS 방출 리간드 데이터를 결합하여 학습할 수 있도록 하기 위함입니다. 결합 친화도 값은 nM 단위의 IC50 값(aff)으로 측정되며, 1-log(aff)/log(50,000) 공식을 적용하여 [0, 1] 구간으로 재조정되어 연속적인 목표 값을 나타냅니다(21). 방출 리간드의 경우, 펩타이드와 MHC 분자 간 상호작용의 강도는 알려져 있지 않으므로, 실제 결합된 리간드에는 목표 값 1이, 인공 음성 펩타이드에는 목표 값 0이 할당됩니다(위 참조).</p>
<p>이 신경망 구조에서는 입력층과 은닉층 간의 가중치는 두 입력 유형(결합 친화도/리간드) 사이에서 공유되며, 은닉층과 출력층을 연결하는 가중치는 각 입력 유형에 따라 개별적으로 설정됩니다. 신경망 학습 중 하나의 예제는 두 데이터 세트 중 임의로 선택되어 NNAlign 알고리즘(3)에 따라 순전파와 역전파 과정을 거칩니다. 이 설정에서 학습 에포크(epoch)는 작은 데이터 세트의 모든 데이터 포인트를 한 번 처리하는 데 필요한 평균 반복 횟수로 정의됩니다.</p>
<p>신경망 앙상블은 Andreatta 등(1)이 설명한 방식에 따라 5겹 중첩 교차 검증을 사용하여 학습되었습니다. 은닉 뉴런이 60개와 70개인 신경망이 학습되었으며, 최종적으로 총 40개의 신경망으로 구성된 앙상블이 만들어졌습니다.</p>
<p>신경망의 입력은 펩타이드와 MHC 분자의 의사 서열(pseudo sequence)(8)로 구성되었습니다. 모든 펩타이드는 Andreatta 등(4)이 설명한 삽입 및 삭제 방식을 사용하여 9-mer 결합 코어로 변환되었고, BLOSUM 인코딩(21)을 통해 인코딩되었습니다. Andreatta 등(4)의 이전 연구와 마찬가지로, 펩타이드 인코딩의 추가적인 특징으로는 삽입/삭제의 길이, 결합 홈의 양끝 바깥에서 펩타이드가 확장될 경우 플랭킹 영역(flanking region)의 길이(0 이상), 그리고 펩타이드 길이 L가 포함되었습니다. 펩타이드 길이는 L≤8, L=9, L=10, L≥11의 네 가지 경우에 해당하는 입력 뉴런 4개로 인코딩되었습니다.</p>
<hr>
<h3 id="performance">
  Performance
  <a class="anchor" href="#performance">#</a>
</h3>
<p>In order to benchmark the combined training method described above (referred to as BA+EL), additional methods with only one output but otherwise identical setup were trained on binding affinity data only (BA data) and eluted ligand data only (EL method). Performance was measured as area under the receiver operating curve (AUC), a value of AUC=0.5 indicates random model performance while an AUC=1 represents a perfect model. AUC values were calculated for each MHC allele separately and subsequently binomial tests were performed to compare the different models.</p>
<h3 id="length-preference-of-mhc-molecules">
  Length preference of MHC molecules
  <a class="anchor" href="#length-preference-of-mhc-molecules">#</a>
</h3>
<p>For all MHC molecules shared between the binding affinity and eluted ligand data sets, we generated predictions for 80,000 random natural peptides of lengths 8–15 amino acids (10,000 of each length). From the top 2% predictions, the frequency of each peptide length was estimated. Subsequently Pearson&rsquo;s correlation coefficient was calculated between the frequencies observed in the eluted ligand data set and the frequencies predicted by 4 models (BA only, EL only, binding affinity of BA+EL, and eluted ligand predictions of BA+EL)</p>
<h3 id="leave-one-out-validation">
  Leave-one-out validation
  <a class="anchor" href="#leave-one-out-validation">#</a>
</h3>
<p>Leave-one-out experiments were performed for all MHC molecules present in the eluted ligand data set. For this, a given MHC molecule was removed from the eluted ligand data set, then the BA+EL method was trained in five-fold cross-validation as described above, omitting multiple random initializations, resulting in an ensemble of 10 networks. Performance of the leave-one-out models is compared to an ensemble of neural networks of the same size trained on the complete data set. Further predictions are made for 80,000 peptides of lengths 8–15 amino acids derived from natural proteins to evaluate a model’s ability to predict the length preference of an MHC allele that was not part of the eluted ligand training data.</p>
<h3 id="the-final-netmhcpan-40-method-implementation">
  The final NetMHCpan-4.0 method implementation
  <a class="anchor" href="#the-final-netmhcpan-40-method-implementation">#</a>
</h3>
<p>The final neural network ensemble of the NetMHCpan-4.0 method is trained on binding affinity and eluted ligand data as described above using 5-fold cross-validation. Networks with 56 and 66 hidden neurons (in accordance with earlier NetMHCpan implementations) were trained using 10 distinct random initial configurations, leading to an ensemble of 100 networks in total.</p>
<p>Percentile rank scores was estimated from predicted EL and BA binding values from a set of 125,000 8–12mer random natural peptides (25,000 of each length)</p>
<ul>
<li>기존 모델과의 비교: NetMHCpan 4.0은 결합 친화도와 eluted ligand 데이터를 통합 학습하여 기존 NetMHCpan 3.0에 비해 결합 예측 정확도 및 T 세포 에피톱 식별 능력에서 높은 성능을 보임.</li>
<li>단일 데이터셋 모델과의 비교: eluted ligand 데이터만 학습한 모델보다 통합 학습 모델의 성능이 뛰어났음.</li>
<li>펩타이드 길이 선호도 예측: 각 MHC 분자가 선호하는 펩타이드 길이를 정확히 예측함. HLA-A01:01(10-mer 선호), HLA-A02:01(9-mer 선호) 등 다양한 MHC 분자의 길이 프로파일을 성공적으로 반영.</li>
</ul>
<h3 id="validation-on-external-data-sets">
  Validation on external data sets
  <a class="anchor" href="#validation-on-external-data-sets">#</a>
</h3>
<p>A dataset of eluted ligands was obtained from Pearson et al. (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R17">17</a>). Also, a set of positive CD8 epitopes was downloaded from the IEDB. The epitope set was identified using the following search criteria “T cell assays: IFNg&rdquo;, &ldquo;positive assays only&rdquo;, &ldquo;MHC restriction Type: Class I&rdquo;. Only entries with fully typed HLA restriction, peptides length in the range 8–14 amino acids, and with annotated source protein sequence were included. Positive entries with a predicted rank score greater than 10% using NetMHCpan-3.0 were excluded to filter out likely noise (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R6">6</a>). For both the T-cell epitope and eluted ligand data sets, negative peptides were obtained by extracting all 8–14mer peptides from the source proteins of the eluted ligands and subsequently excluding peptides-MHC combination found with an exact match in the training data (both binding affinity and eluted ligand data sets). The final eluted data set contained 15,965 positive ligands restricted to 27 different HLA molecules, and the IEDB T cell epitope data set 1,251 positive T cell epitopes restricted to 80 HLA molecules.</p>
<p>A Frank value was calculated for each positive-HLA pair as the ratio between the number of peptides with a prediction score higher than the positive peptide and the number of peptides contained within the source protein. The Frank value is hence 0 if the positive peptide has the highest prediction value of all peptides within the source protein, and a value of 0.5 in cases where an equal amount of peptides has a higher and lower prediction value compared to the positive peptide.</p>
<p>An unfiltered eluted ligand data set was obtained from Bassani-Sternberg et al. (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R22">22</a>). This data sets consisted of eluted ligand data from 6 cell lines each with fully typed HLA-A, B and C alleles. A data set was constructed for each cell line, including all 8–13mer ligand as positives, and 5 times the total number of ligands random natural negatives for each length 8–13. That is if a data set contained 5,000 ligands, 5<em>5000 = 25,000 random natural peptides of length 8, 9, 10, 11, 12, and 13 were added as negatives arriving at a final data set with 155,000 (5000 + 6</em>25000) peptides.</p>
<ul>
<li>
<p>외부 데이터 검증 1: 독립적인 데이터 세트(16,000개의 MHC 리간드와 1,250개의 T 세포 에피톱)를 활용하여 NetMHCpan 4.0의 향상된 성능을 입증.</p>
</li>
<li>
<p>외부 데이터 검증 2: 암 네오안티젠(neoantigen) 식별에 있어 기존 방법보다 높은 민감도와 특이도를 보임.</p>
</li>
<li>
<p>결과: 결합 친화도와 eluted ligand 데이터를 통합하여 모델 개선 -&gt; 암 치료를 위한 신항원 식별과 T 세포 기반 면역 반응 예측에서 높은 잠재력을 보임.</p>
</li>
</ul>
<h2 id="results">
  Results
  <a class="anchor" href="#results">#</a>
</h2>
<p>We trained the NetMHCpan method version 4.0 for the prediction of the interaction of peptides with MHC class I molecules integrating binding affinity and MS eluted ligand data. Combined training was achieved by adding a second output neuron to the NNAlign approach described previously (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R3">3</a>). In this setup, the first output neuron returns a score of binding affinity, and the second output neuron a score of ligand elution. As described in materials and methods, the model parameters between the input and hidden layer of the artificial neural network are shared between the two input types. Thanks to this network architecture, we expect the model to be able to combine informative patterns found in the two data types, boosting performance for both output neurons. To demonstrate this, we compared the performance of the BA+EL method to the BA method, trained only on binding affinity data and the EL method trained only on eluted ligand data. <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#F2">Figure 2</a> shows the mean performance per MHC allele of the four methods on four different data sets given in in terms of AUC (for details see <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#SD1">Supplementary Table 1</a>). From this analysis, it is clear that especially the BA+EL method with EL predictions performs much better on binding affinity data than the EL only method. This observation strongly suggests that the EL only method, as a results of the small number of only 55 different MHC molecules included in the eluted ligand data set, has limited pan-specific potential compared to the BA+EL EL method trained on data from 169 MHC molecules included in the combined binding and MS eluted ligand data set.</p>
<h3 id="peptide-length-preference-of-mhc-molecules">
  Peptide length preference of MHC molecules
  <a class="anchor" href="#peptide-length-preference-of-mhc-molecules">#</a>
</h3>
<p>We next set out to investigate how well the different methods could capture the peptide length preferences of individual MHC molecules. For this, we predicted binding scores for a set of random natural peptides of lengths 8–15 amino acids and calculated the frequencies of peptides of different lengths in the top 2% of predictions. In <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#F3">figure 3a-c</a>, we visualize examples of such peptide length preference profiles predicted by the BA, BA+EL BA, BA+EL EL, and EL only methods. The depicted MHC molecules are known to have preferences for different peptide lengths. All HLAs have a preference for 9mer peptides. However, HLA-A<em>01:01 has an increased preference for 10-mers compared to average, HLA-A</em>02:01 has a strong preference for 9-mers only, and HLA-B*51:01 has an increased preference for 8-mers compared to average (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R6">6</a>). Binding affinity predictors often overestimate the amount of binding 10-mer peptides due to their over-representation in the binding affinity data set (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R4">4</a>), which is also visualized in <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#F3">figure 3</a>.</p>
<p>Next, we extended the analysis to all MHC molecules included in the eluted ligand data set, calculating the correlation between observed and predicted length frequencies for each prediction method. This analysis (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#F3">figure 3d</a>) clearly confirms the results obtained from the 3 case examples, namely that the two methods BA+EL EL and EL only show significantly higher power for predicting the peptide length preference of individual MHC molecules compared to the two methods trained to predict binding affinity (BA, and BA+EL BA).</p>
<p>The predictions for the two eluted ligand likelihood models only show low performance for one molecule; HLA-B41:04. This molecule is however only characterized by 52 eluted ligands, whose length profile forms an unusual bimodal distribution with peaks at length 9 and 11 (data not shown).</p>
<h3 id="leave-one-out-experiments-on-eluted-ligand-data">
  Leave-one-out experiments on eluted ligand data
  <a class="anchor" href="#leave-one-out-experiments-on-eluted-ligand-data">#</a>
</h3>
<p>In the above experiment, the MHC molecules used for the peptide length preference evaluation were also included as training data of the EL prediction methods. This naturally leads to a bias in the performance evaluation. To address this, and to access the pan-specific potential of the BA+EL EL prediction method, we conducted a leave-one-out experiment. Here, a given MHC molecule was removed from the eluted ligand data set, and the BA+EL method retrained as described in material and methods. Next, both the predictive performance (estimated in terms of AUC for separating the known ligands from the artificial negatives) and the ability to predict the peptide length preference were evaluated. The result of the benchmark is shown in <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#F4">figure 4</a>. This figure clearly confirms the pan-specific power of the BA+EL method. In terms of the predictive performance (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#F4">figure 4a</a>), the LOO methods display, as expected, a slight decrease in performance compared to a method trained and evaluated on all data (the all data method). When looking at the performance for predicting the peptide length profile (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#F4">figure 4b</a>), the LOO methods display a very high performance. Only in one case, the EL LOO method shows a substantial drop in performance for the left out MHC molecule. This case is H2-Kb, the only mouse molecule in the MS ligand data set with a strong preference for 8mer ligands. The BA+EL EL LOO method is able to predict the length profile of H2-Kb due to the H2-Kb affinity data present in the BA training data set.</p>
<h3 id="the-netmhcpan-40-method">
  The NetMHCpan-4.0 method
  <a class="anchor" href="#the-netmhcpan-40-method">#</a>
</h3>
<p>Having demonstrated the increased predictive power of the BA+EL method when it comes to prediction of peptide binding affinity (the BA+EL BA model), likelihood of being an eluted ligand (BA+EL EL model), and the ability of capturing the MHC specific peptide length binding preferences (also the BA+EL EL model), we set out to construct the final NetMHCpan-4.0 method. This method was trained as the BA+EL method, using 5 fold cross-validation as described in materials and methods. The method is accessible at <a href="http://www.cbs.dtu.dk/services/NetMHCpan-4.0">www.cbs.dtu.dk/services/NetMHCpan-4.0</a>. The functionality is identical to the earlier NetMHCpan implementations with the important additional functionality that two different output options (binding affinity and eluted ligand likelihood) are available. By default, the program returns eluted ligand likelihood scores. An example of the output of the method is shown in <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#SD2">Supplementary figure 1</a>.</p>
<h3 id="validation-on-external-data-sets-1">
  Validation on external data sets
  <a class="anchor" href="#validation-on-external-data-sets-1">#</a>
</h3>
<p>The performance of the updated NetMHCpan method was assessed on two independent external data sets; one consisting of 15,965 eluted ligands covering 27 HLA molecules, and another consisting of 1,251 validated CTL epitopes covering 80 HLA molecules reported in the IEDB. The validation data sets were constructed as described in materials and methods. The source protein sequence was identified for each ligand/epitope, and all overlapping 8–14 mer peptides except the ligand/epitope were annotated as negatives. All data points included in the binding affinity and eluted ligand training data sets were excluded from the validation data set. A Frank value was calculated for each positive-HLA pair as described in materials and methods as the ratio of the number of peptides with a prediction score higher than the positive peptide to the number of peptides contained within the source protein. In this manner, we can construct the sensitivity curves presented in <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#F5">figure 5</a>. Two observations are striking from these results. First and foremost, the results clearly demonstrated the increased predictive power of integrating eluted ligand data into the training data of NetMHCpan. In the left panel (the analysis of the eluted ligand data), we can observe that the gain in sensitivity at a Frank threshold of 1% for the EL models (NetMHCpan-4.0 EL or EL only) compared to NetMHCpan-3.0 is 10% (95% versus 85%), and 15% at a Frank threshold of 0.5% (90% versus 75%). These numbers mean that a ligand will have a prediction score within the top 0.5% of its source protein peptides in 90% of the cases using the EL models, compared to only 75% using NetMHCpan-3.0. The results shown in the left panel of <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#F5">figure 5</a> however also suggest that the two EL models achieve very similar predictive performance when it come to identification of eluted ligands. This is in strong contrast to the results obtained from the IEDB epitope data set (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#F5">figure 5</a>, right panel). Here, only the NetMHCpan-4.0 EL model demonstrates an improved predictive performance compared to NetMHCpan-3.0.</p>
<p>There are several potential explanations for the improved performance of the EL models on the eluted ligand evaluation data including i) a bias against cysteins specific for the eluted ligand training and evaluation data, ii) as suggested earlier (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R15">15</a>) differences in the MHC binding motifs contained within the eluted ligand and <em>in-vitro</em> binding data, and iii) the improved prediction accuracy of the ligand length preference (see <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#F3">figure 3d</a>). To investigate i) we repeated the experiment displayed in <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#F5">figure 5</a>, removing all peptides containing one of more cysteins. If the bias against cysteins in the eluted ligand data had any impact on the predictive performance of the proposed method, the bias would be reflected in an altered predictive performance on the reduced data sets. This turned out not to be the case (data not shown) hence suggesting that cysteine bias is not the influencing the relative predictive performance of the different methods. Looking into the differences in the binding motif derived from binding affinity and eluted ligand data respectively for specific HLA molecules, we find differences for most MHC molecules. A few examples are shown in <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#F6">figure 6</a>..</p>
<p>These results demonstrated that eluted ligands tend to share more conserved anchor motifs compared to affinity-defined binders. This observation is in agreement with earlier findings suggesting eluted ligands to be more stably bound to MHC-I molecules compared with other affinity matched peptides (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R13">13</a>, <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R23">23</a>). In summary, these analyses suggest that the gained predictive performance of the EL method on the eluted ligand evaluation data is driven by at least two factors; differences in binding preferences between eluted ligand and affinity-defined peptide binders, and the improved prediction accuracy of ligand length preference of the EL methods.</p>
<h3 id="to-be-or-not-to-be-a-ligand">
  To be or not to be a ligand
  <a class="anchor" href="#to-be-or-not-to-be-a-ligand">#</a>
</h3>
<p>We investigated what prediction threshold to use to best separate ligand from non-ligand peptides. Earlier work by others and us suggests that different MHC molecules present peptides at different predicted binding affinity thresholds (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R1">1</a>, <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R24">24</a>). Given this, it was interesting to investigate to what degree a similar observation could be made for the eluted ligand likelihood predictions produced by the NetMHCpan-4.0 method. To address the question, we compared the predicted ligand likelihood scores of all 15,965 ligands in the Pearson data set. The result of this analysis is displayed as box-plots in the left panel of <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#F7">figure 7</a>.</p>
<p>This figure reveals that the likelihood prediction scores for known ligands come out very different for different HLA molecules. The large difference in prediction values between HLA molecules can to a high degree be linked to their absence from the eluted ligand training data. The molecules with lowest median eluted ligand likelihood scores in this figure are molecules absent from the eluted ligand training data set. However, as demonstrated in <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#F4">figure 4</a> and <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#F5">5</a>, the fact that an HLA molecule has not been characterized with eluted ligand training data does not impair its predictability. Given this, a natural measure to correct for this great imbalance in prediction score is use percentile rank scores to reconcile and make prediction score comparable between different MHC molecules. The right panel of <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#F7">figure 7</a> shows the results of such a transformation. Here, eluted ligand likelihood prediction values for each ligand in the Pearson data are transformed to percentile rank scores, and the score distribution is visualized as box plots for each HLA molecule. Given that percentile rank values fall in the range 0–100%, it is apparent that transforming the prediction values into such rank scores, allows for a direct score comparison between HLA molecules.</p>
<p>In light of these results, we next investigated what percentile rank threshold to apply to optimally identify MHC ligands. We assess this by calculating sensitivity/specificity curves as a function of the percentile rank score threshold for a balanced set (max 100 ligands per HLA) of eluted ligands and source protein negatives from the Pearson evaluation data set. The results are shown in <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#F8">figure 8</a> and confirm earlier findings that the vast majority (96.5%) of natural ligands are identified at a very high specificity (98.5) using a percentile rank threshold of 2%.</p>
<h3 id="evaluation-on-unbiased-data-sets">
  Evaluation on unbiased data sets
  <a class="anchor" href="#evaluation-on-unbiased-data-sets">#</a>
</h3>
<p>Most eluted ligand data potentially suffer from biases towards current prediction methods. This is because many eluted ligand studies, including the Pearson data used here, assign MHC restriction based on predicted binding. To address the impact of this bias, we here benchmark our method against sets of unfiltered eluted ligand data. These data sets were obtained from Bassani-Sternberg et al. (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R22">22</a>), and cover eluted ligands obtained from 6 cell lines each with typed HLA expression. From these data, we constructed 6 benchmark data sets by enriching each positive eluted ligand data set with a set of random natural negative peptides (for details see materials and methods). After filtering out data included in the training data of NetMHCpan-4.0, we next benchmarked the predictive power of the different prediction methods. The result of the benchmark is shown in <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#F9">figure 9</a>.</p>
<p>These results clearly confirm the improved performance of the proposed NetMHCpan-4.0 eluted ligand likelihood predictions over both the NetMHCpan-4.0 and NetMHCpan-3.0 binding affinity predictions. Also, the results show that in the majority of cases the percentile rank predictions achieve improved predictive performance compared to the raw prediction scores.</p>
<h3 id="identification-of-cancer-neoantigens">
  Identification of cancer neoantigens
  <a class="anchor" href="#identification-of-cancer-neoantigens">#</a>
</h3>
<p>A research field where prediction of naturally processed and presented eluted ligand has attracted large recent attention is rational identification of cancer neoantigens. In contrast to tumor-associated self-antigens, cancer neoantigen are naturally presented ligands containing tumour-specific mutations. Such neoantigens are attracting large attention since these peptides are new to the immune system and not found in normal tissues, and hence are ideal potential cancer vaccine candidates or targets for adoptive T cell therapy. Depending on the mutational load, the number of potential tumour-specific neopeptides (peptides containing one or more missense mutations) can be in the order of many thousands (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R25">25</a>). This large number of potential peptide candidates clearly underlines the need for tools to rationally downsize the peptide space in the search for cancer neoepitopes. A recent study by Bassani-Sternberg et al. (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R14">14</a>) demonstrated how this downsizing could be effectively achieved by a prediction method trained on a large set of MS eluted ligands. Here, we repeated this benchmark analysis using NetMHCpan-4.0. The results are shown in <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#F10">figure 10</a> and confirm the finding by Bassani-Sternberg et al. (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R14">14</a>), that predictors trained on MS eluted ligand data information in most cases show very high predictive power for the identification of cancer neoantigens. Both the NetMHCpan-4.0 and MixMHCpred method proposed by Bassani-Sternberg et al. (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R14">14</a>) identify the known neoantigens within the top 25 peptides in 6 out out 10 cases. NetMHCpan-3.0 only achieves this in 2 out of 10 cases. The results also confirm the earlier findings presented here, that NetMHCpan-4.0 achieves improved performance compared to that of version 3.0, and that the ligands in all cases are predicted with very strong eluted ligand likelihood values (all percentile rank values are less than 1, and the majority are less than or equal to 0.02).</p>
<h2 id="discussion">
  Discussion
  <a class="anchor" href="#discussion">#</a>
</h2>
<p>In this work, we have demonstrated how a relatively simple pan-specific machine learning method based on the NNAlign framework can be constructed integrating information from binding affinity data with MS peptidome data. Benefitting from the larger set of peptide binding affinity data with very broad MHC coverage (more than 150 molecules), and the additional information contained within MS peptideome data (information about both antigen processing and presentation, and allele specific peptide length profile), we could demonstrate that the proposed method, NetMHCpan-4.0, achieved improved predictive performance not only when it comes to characterizing the binding specificity of a given MHC molecule, but also when it comes to predicting the peptide length profile. Due to the pan-specific potential of the method, the improved performance was extended beyond the relatively few MHC molecules characterized by MS binding data included in the training of the method. Given this, we thus conclude that the proposed framework is able to benefit from the best of the two data sets; MHC coverage from the binding affinity data, and antigen processing and presentation, and allele specific peptide length profile from the MS data.</p>
<p>Our benchmarks confirmed earlier findings that prediction values for known ligands vary substantially between MHC molecules (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R26">26</a>), and that only by the use of percentile rank scores can predictions between different MHC molecules be readily compared.</p>
<p>The improved peptide-MHC tool is made publicly available at <a href="http://www.cbs.dtu.dk/services/NetMHCpan-4.0">www.cbs.dtu.dk/services/NetMHCpan-4.0</a>. The tool was benchmarked on two large independent data sets; one consisting of ~16,000 MS identified MHC restricted ligands (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R17">17</a>) and one consisting of more than 1,250 validated T cell epitopes described in the IEDB. For both data sets, the updated version 4.0 of NetMHCpan significantly outperformed the earlier NetMHCpan 3.0 method. In particular, the benchmark on T cell epitope data - to the best of our knowledge - demonstrated for the first time how integration of MS peptidome data into a prediction method of MHC peptide presentation, can lead to improved predictive performance for T cell epitope discovery. The improved performance on this data set was only observed for the method trained on the combined data, and was not observed for the method trained on MS peptidome data alone. This observation underlines the large benefit of merging the two data types.</p>
<p>Investigating potential causes for the observed improved performance of the proposed tool for identification of eluted ligands confirmed earlier findings that eluted ligands share a reduced amino acid diversity at the MHC anchor positions (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R13">13</a>). This observation is consistent with the notion that ligands are more stably bound to MHC-I molecules compared with average affinity-defined bound peptides. We postulate that this difference in binding preferences between eluted ligand and affinity-defined peptide binders, combined with the improved prediction accuracy of ligand length preference of the EL methods are the main factors driving the improved predictive performance.</p>
<p>When benchmarking the predictive performance for identification of T cell epitopes, we observed that only the NetMHCpan-4.0 EL model trained on the combined eluted ligand and binding affinity data set demonstrated an improved predictive performance compared to NetMHCpan-3.0. This observation was surprising at first, as we would expect an improved performance also by the method trained on the eluted ligand only due to the reasons outlined above. One likely explanation for this result is the bias in the T cell epitope data towards predicted binding affinity motifs. Most T cell epitopes have been identified using some kind of HLA binding predictions as a filter prior to experimental validation hence giving a bias towards prediction methods trained based on binding affinity data. Given this, the source of the improved performance of the NetMHCpan-4.0 EL method compared to NetMHCpan-4.0 BA on the T cell epitope benchmark data set is thus primarily driven by its improved prediction of the ligand length preference.</p>
<p>It is clear that even with the improved predictive performance of the NetMHCpan-4.0 tool reported here, not all MHC ligands and T cell epitopes will be captured by a prediction workflow. Likewise, it is clear that very few if any experimental workflows enable the exhaustive identification of the ligandome or epitope set contained within a given sample. Given the two workflows to work in concert and use <em>in-silico</em> screens as a guide to the experimental setup to effectively boost the sensitivity of the combined workflow. Such an approach where <em>in-silico</em> predictions were used to reduce the search space has with success been used to improve the sensitivity of MHC class I ligand discovery (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R27">27</a>) and we expect other similar applications to appear in the future.</p>
<p>The machine-learning framework proposed here is not limited to the integration of MHC class I peptide binding affinity and MS peptidome data. The approach can readily be extended to integrate other types of relevant data including MHC binding stability (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R28">28</a>), and epitope data. Also, the approach can in its current form be directly applied to the MHC class II system. The only critical limitation for such data integrations is the criteria that each data point must be associated with a specific MHC element. This information is not always readily available, but can in most cases be inferred by unsupervised clustering of the available data (using GibbsCluster (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R29">29</a>), position weight matrix mixture models (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5679736/#R16">16</a>), or similar approaches), and association of each cluster to an MHC molecule of the given host.</p>
<p>In conclusion, we have here described a new framework for training of prediction methods for MHC peptide presentation prediction integrating information from two data sources (MS eluted ligand and peptide binding affinity). The framework was used to develop an updated version of NetMHCpan (version 4.0, available at <a href="http://www.cbs.dtu.dk/services/NetMHCpan-4.0">www.cbs.dtu.dk/services/NetMHCpan-4.0</a>) with improved predictive performance for identification of validated eluted ligands, cancer neoantigens and T cell epitopes.</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments"><script src="https://giscus.app/client.js"
        data-repo="yshghid/yshghid.github.io"
        data-repo-id="R_kgDONkMkNg"
        data-category-id="DIC_kwDONkMkNs4CloJh"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="ko"
        crossorigin="anonymous"
        async>
</script>
</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#목록">목록</a></li>
    <li><a href="#netmhcpan-40-improved-peptide-mhc-class-i-interaction-predictions-integrating-eluted-ligand-and-peptide-binding-affinity-data">NetMHCpan 4.0: Improved peptide-MHC class I interaction predictions integrating eluted ligand and peptide binding affinity data</a></li>
    <li><a href="#abstract">Abstract</a></li>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#materials-and-methods">Materials and Methods</a>
      <ul>
        <li><a href="#data-sets">Data sets</a></li>
        <li><a href="#neural-network-training">Neural network training</a></li>
        <li><a href="#netmhcpan-methods-참고용-chatgpt-설명"><strong>NetMHCpan: Methods</strong> (참고용 chatgpt 설명)</a></li>
        <li><a href="#1-데이터-처리"><strong>1. 데이터 처리</strong></a></li>
        <li><a href="#2-신경망-구조-설계"><strong>2. 신경망 구조 설계</strong></a></li>
        <li><a href="#3-데이터-인코딩"><strong>3. 데이터 인코딩</strong></a></li>
        <li><a href="#4-학습-알고리즘"><strong>4. 학습 알고리즘</strong></a></li>
        <li><a href="#5-앙상블-학습"><strong>5. 앙상블 학습</strong></a></li>
        <li><a href="#결론"><strong>결론</strong></a></li>
        <li><a href="#neural-network-training---번역">Neural network training - 번역</a></li>
        <li><a href="#performance">Performance</a></li>
        <li><a href="#length-preference-of-mhc-molecules">Length preference of MHC molecules</a></li>
        <li><a href="#leave-one-out-validation">Leave-one-out validation</a></li>
        <li><a href="#the-final-netmhcpan-40-method-implementation">The final NetMHCpan-4.0 method implementation</a></li>
        <li><a href="#validation-on-external-data-sets">Validation on external data sets</a></li>
      </ul>
    </li>
    <li><a href="#results">Results</a>
      <ul>
        <li><a href="#peptide-length-preference-of-mhc-molecules">Peptide length preference of MHC molecules</a></li>
        <li><a href="#leave-one-out-experiments-on-eluted-ligand-data">Leave-one-out experiments on eluted ligand data</a></li>
        <li><a href="#the-netmhcpan-40-method">The NetMHCpan-4.0 method</a></li>
        <li><a href="#validation-on-external-data-sets-1">Validation on external data sets</a></li>
        <li><a href="#to-be-or-not-to-be-a-ligand">To be or not to be a ligand</a></li>
        <li><a href="#evaluation-on-unbiased-data-sets">Evaluation on unbiased data sets</a></li>
        <li><a href="#identification-of-cancer-neoantigens">Identification of cancer neoantigens</a></li>
      </ul>
    </li>
    <li><a href="#discussion">Discussion</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












